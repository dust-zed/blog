<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="benchmark核心 所有语言的Benchmark都在做：\n计时 - 测量执行时间 重复 - 多次运行取平均 统计 - 计算均值、标准差 对比 - 比较不同实现 通用流程\n预热 → 测量 → 统计 → 报告 （防优化） 预热: 跳过缓存未命中的初测\nCriterion Criterion是rust中最现代化的benchmark库，接下来跟着例子一步步深入了benchmark。\n入门 #![allow(unused)] fn main() { use criterion::{black_box, criterion_group, criterion_main, Criterion}; use mycrate::fibonacci; pub fn criterion_benchmark(c: &amp;mut Criterion) { c.bench_function(&#34;fib 20&#34;, |b| b.iter(|| fibonacci(black_box(20)))); } criterion_group!(benches, criterion_benchmark); criterion_main!(benches); } 1. bench_function方法 c.bench_function(&#34;fib 20&#34;, |b| b.iter(|| fibonacci(black_box(20)))); 作用：定义一个基准测试用例 参数: fib 20： 测试用例的名称（用于结果报告） 闭包函数：包含实际的测试逻辑 闭包内部 b: Bencher对象(自动传入) b.iter(|| ...)：运行被测代码多次并测量时间 black_box(20)：阻止编译器优化(确保真实计算) fibonacci(20)：实际被测函数 2. criterion_group!宏 criterion_group!(benches, criterion_benchmark); 作用：创建基准测试组 参数： benches：组名称（自定义标识符） criterion_benchmark：包含测试的函数名（本例中的基准函数） 特性： 将多个基准测试组织成组 支持添加多个测试函数 生成对应的 bench_ 开头的函数（如benches_benchmark） 3. criterion_main!宏 criterion_main!(benches); 作用：生成基准测试的入口函数 参数： benches：前面定义的测试组名 功能： 自动生成main()函数 配置并运行所有指定的测试组 处理命令行参数（如 --filter, --savebaseline） 4. benches的来源 criterion_group!(benches, ...); // ^^^^^^ 这里定义 criterion_main!(benches); // ^^^^^^ 这里使用 benches 是由 criterion_group! 宏创建的自定义标识符 在 criterion_main! 中引用时： 查找同名测试组 将组内测试函数添加到执行队列 生成报告和图表 进阶 // 使用 benchmark_group 组织测试 let mut group = c.benchmark_group(&#34;data_structures&#34;); group.sample_size(100); // 配置采样 group.measurement_time(Duration::from_secs(5)); // ... 多个相关测试 group.finish(); benchmark_group方法 作用： 创建共享配置的容器，作为多个相关测试的配置载体 必须被包含在 criterion_group! 注册的测试函数中，并由其调度执行。 理解统计输出 time: [123.45 µs 125.67 µs 128.90 µs] ↑ ↑ ↑ 下界 中位数 上界 change: [-5.23% +2.34% +10.23%] ↑ ↑ ↑ 最好 预期变化 最坏 Found 3 outliers among 100 measurements 2 high mild ← 稍微偏高 1 high severe ← 严重偏高 例子 1. 参数化测试 // 测试不同输入大小 let mut group = c.benchmark_group(&#34;fibonacci&#34;); for i in [10, 15, 20, 25].iter() { group.bench_with_input( BenchmarkId::from_parameter(i), i, |b, &amp;i| b.iter(|| fibonacci(black_box(i))) ); } group.finish(); 2. 对比多个实现 let mut group = c.benchmark_group(&#34;sum&#34;); group.bench_function(&#34;for_loop&#34;, |b| { b.iter(|| sum_for_loop(black_box(&amp;data))) }); group.bench_function(&#34;iterator&#34;, |b| { b.iter(|| sum_iterator(black_box(&amp;data))) }); group.finish(); 吞吐量测量 let mut group = c.benchmark_group(&#34;throughput&#34;); // 设置吞吐量单位 group.throughput(Throughput::Bytes(data.len() as u64)); group.bench_function(&#34;process&#34;, |b| { b.iter(|| process(black_box(&amp;data))) }); // 报告会显示 MB/s 自定义配置 group.sample_size(1000); // 样本数 group.warm_up_time(Duration::from_secs(3)); // 预热时间 group.measurement_time(Duration::from_secs(10)); // 测量时间 group.noise_threshold(0.05); // 噪音阈值 ">
<title>Benchmark学习</title>

<link rel='canonical' href='http://localhost:1313/rust/benchmark%E5%AD%A6%E4%B9%A0/'>

<link rel="stylesheet" href="/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css"><meta property='og:title' content="Benchmark学习">
<meta property='og:description' content="benchmark核心 所有语言的Benchmark都在做：\n计时 - 测量执行时间 重复 - 多次运行取平均 统计 - 计算均值、标准差 对比 - 比较不同实现 通用流程\n预热 → 测量 → 统计 → 报告 （防优化） 预热: 跳过缓存未命中的初测\nCriterion Criterion是rust中最现代化的benchmark库，接下来跟着例子一步步深入了benchmark。\n入门 #![allow(unused)] fn main() { use criterion::{black_box, criterion_group, criterion_main, Criterion}; use mycrate::fibonacci; pub fn criterion_benchmark(c: &amp;mut Criterion) { c.bench_function(&#34;fib 20&#34;, |b| b.iter(|| fibonacci(black_box(20)))); } criterion_group!(benches, criterion_benchmark); criterion_main!(benches); } 1. bench_function方法 c.bench_function(&#34;fib 20&#34;, |b| b.iter(|| fibonacci(black_box(20)))); 作用：定义一个基准测试用例 参数: fib 20： 测试用例的名称（用于结果报告） 闭包函数：包含实际的测试逻辑 闭包内部 b: Bencher对象(自动传入) b.iter(|| ...)：运行被测代码多次并测量时间 black_box(20)：阻止编译器优化(确保真实计算) fibonacci(20)：实际被测函数 2. criterion_group!宏 criterion_group!(benches, criterion_benchmark); 作用：创建基准测试组 参数： benches：组名称（自定义标识符） criterion_benchmark：包含测试的函数名（本例中的基准函数） 特性： 将多个基准测试组织成组 支持添加多个测试函数 生成对应的 bench_ 开头的函数（如benches_benchmark） 3. criterion_main!宏 criterion_main!(benches); 作用：生成基准测试的入口函数 参数： benches：前面定义的测试组名 功能： 自动生成main()函数 配置并运行所有指定的测试组 处理命令行参数（如 --filter, --savebaseline） 4. benches的来源 criterion_group!(benches, ...); // ^^^^^^ 这里定义 criterion_main!(benches); // ^^^^^^ 这里使用 benches 是由 criterion_group! 宏创建的自定义标识符 在 criterion_main! 中引用时： 查找同名测试组 将组内测试函数添加到执行队列 生成报告和图表 进阶 // 使用 benchmark_group 组织测试 let mut group = c.benchmark_group(&#34;data_structures&#34;); group.sample_size(100); // 配置采样 group.measurement_time(Duration::from_secs(5)); // ... 多个相关测试 group.finish(); benchmark_group方法 作用： 创建共享配置的容器，作为多个相关测试的配置载体 必须被包含在 criterion_group! 注册的测试函数中，并由其调度执行。 理解统计输出 time: [123.45 µs 125.67 µs 128.90 µs] ↑ ↑ ↑ 下界 中位数 上界 change: [-5.23% +2.34% +10.23%] ↑ ↑ ↑ 最好 预期变化 最坏 Found 3 outliers among 100 measurements 2 high mild ← 稍微偏高 1 high severe ← 严重偏高 例子 1. 参数化测试 // 测试不同输入大小 let mut group = c.benchmark_group(&#34;fibonacci&#34;); for i in [10, 15, 20, 25].iter() { group.bench_with_input( BenchmarkId::from_parameter(i), i, |b, &amp;i| b.iter(|| fibonacci(black_box(i))) ); } group.finish(); 2. 对比多个实现 let mut group = c.benchmark_group(&#34;sum&#34;); group.bench_function(&#34;for_loop&#34;, |b| { b.iter(|| sum_for_loop(black_box(&amp;data))) }); group.bench_function(&#34;iterator&#34;, |b| { b.iter(|| sum_iterator(black_box(&amp;data))) }); group.finish(); 吞吐量测量 let mut group = c.benchmark_group(&#34;throughput&#34;); // 设置吞吐量单位 group.throughput(Throughput::Bytes(data.len() as u64)); group.bench_function(&#34;process&#34;, |b| { b.iter(|| process(black_box(&amp;data))) }); // 报告会显示 MB/s 自定义配置 group.sample_size(1000); // 样本数 group.warm_up_time(Duration::from_secs(3)); // 预热时间 group.measurement_time(Duration::from_secs(10)); // 测量时间 group.noise_threshold(0.05); // 噪音阈值 ">
<meta property='og:url' content='http://localhost:1313/rust/benchmark%E5%AD%A6%E4%B9%A0/'>
<meta property='og:site_name' content='zed的博客'>
<meta property='og:type' content='article'><meta property='article:section' content='Rust' /><meta property='article:published_time' content='2025-10-13T10:33:08&#43;08:00'/><meta property='article:modified_time' content='2025-10-13T10:33:08&#43;08:00'/>
<meta name="twitter:title" content="Benchmark学习">
<meta name="twitter:description" content="benchmark核心 所有语言的Benchmark都在做：\n计时 - 测量执行时间 重复 - 多次运行取平均 统计 - 计算均值、标准差 对比 - 比较不同实现 通用流程\n预热 → 测量 → 统计 → 报告 （防优化） 预热: 跳过缓存未命中的初测\nCriterion Criterion是rust中最现代化的benchmark库，接下来跟着例子一步步深入了benchmark。\n入门 #![allow(unused)] fn main() { use criterion::{black_box, criterion_group, criterion_main, Criterion}; use mycrate::fibonacci; pub fn criterion_benchmark(c: &amp;mut Criterion) { c.bench_function(&#34;fib 20&#34;, |b| b.iter(|| fibonacci(black_box(20)))); } criterion_group!(benches, criterion_benchmark); criterion_main!(benches); } 1. bench_function方法 c.bench_function(&#34;fib 20&#34;, |b| b.iter(|| fibonacci(black_box(20)))); 作用：定义一个基准测试用例 参数: fib 20： 测试用例的名称（用于结果报告） 闭包函数：包含实际的测试逻辑 闭包内部 b: Bencher对象(自动传入) b.iter(|| ...)：运行被测代码多次并测量时间 black_box(20)：阻止编译器优化(确保真实计算) fibonacci(20)：实际被测函数 2. criterion_group!宏 criterion_group!(benches, criterion_benchmark); 作用：创建基准测试组 参数： benches：组名称（自定义标识符） criterion_benchmark：包含测试的函数名（本例中的基准函数） 特性： 将多个基准测试组织成组 支持添加多个测试函数 生成对应的 bench_ 开头的函数（如benches_benchmark） 3. criterion_main!宏 criterion_main!(benches); 作用：生成基准测试的入口函数 参数： benches：前面定义的测试组名 功能： 自动生成main()函数 配置并运行所有指定的测试组 处理命令行参数（如 --filter, --savebaseline） 4. benches的来源 criterion_group!(benches, ...); // ^^^^^^ 这里定义 criterion_main!(benches); // ^^^^^^ 这里使用 benches 是由 criterion_group! 宏创建的自定义标识符 在 criterion_main! 中引用时： 查找同名测试组 将组内测试函数添加到执行队列 生成报告和图表 进阶 // 使用 benchmark_group 组织测试 let mut group = c.benchmark_group(&#34;data_structures&#34;); group.sample_size(100); // 配置采样 group.measurement_time(Duration::from_secs(5)); // ... 多个相关测试 group.finish(); benchmark_group方法 作用： 创建共享配置的容器，作为多个相关测试的配置载体 必须被包含在 criterion_group! 注册的测试函数中，并由其调度执行。 理解统计输出 time: [123.45 µs 125.67 µs 128.90 µs] ↑ ↑ ↑ 下界 中位数 上界 change: [-5.23% +2.34% +10.23%] ↑ ↑ ↑ 最好 预期变化 最坏 Found 3 outliers among 100 measurements 2 high mild ← 稍微偏高 1 high severe ← 严重偏高 例子 1. 参数化测试 // 测试不同输入大小 let mut group = c.benchmark_group(&#34;fibonacci&#34;); for i in [10, 15, 20, 25].iter() { group.bench_with_input( BenchmarkId::from_parameter(i), i, |b, &amp;i| b.iter(|| fibonacci(black_box(i))) ); } group.finish(); 2. 对比多个实现 let mut group = c.benchmark_group(&#34;sum&#34;); group.bench_function(&#34;for_loop&#34;, |b| { b.iter(|| sum_for_loop(black_box(&amp;data))) }); group.bench_function(&#34;iterator&#34;, |b| { b.iter(|| sum_iterator(black_box(&amp;data))) }); group.finish(); 吞吐量测量 let mut group = c.benchmark_group(&#34;throughput&#34;); // 设置吞吐量单位 group.throughput(Throughput::Bytes(data.len() as u64)); group.bench_function(&#34;process&#34;, |b| { b.iter(|| process(black_box(&amp;data))) }); // 报告会显示 MB/s 自定义配置 group.sample_size(1000); // 样本数 group.warm_up_time(Duration::from_secs(3)); // 预热时间 group.measurement_time(Duration::from_secs(10)); // 测量时间 group.noise_threshold(0.05); // 噪音阈值 ">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column compact"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_f509edb42ecc0ebd.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">zed的博客</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/android-develop' >
                
                
                
                <span>android-develop</span>
            </a>
        </li>
        
        
        <li >
            <a href='/rust' >
                
                
                
                <span>rust</span>
            </a>
        </li>
        
        
        <li >
            <a href='/learning-reflection/' >
                
                
                
                <span>Learning-Reflections</span>
            </a>
        </li>
        
        
        <li >
            <a href='/tutorials/' >
                
                
                
                <span>Tutorials</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    

            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/rust/" >
                Rust
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/rust/benchmark%E5%AD%A6%E4%B9%A0/">Benchmark学习</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Oct 13, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 2 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h4 id="benchmark核心">benchmark核心
</h4><p>所有语言的<strong>Benchmark</strong>都在做：</p>
<ul>
<li>计时 - 测量执行时间</li>
<li>重复 - 多次运行取平均</li>
<li>统计 - 计算均值、标准差</li>
<li>对比 - 比较不同实现</li>
</ul>
<p><strong>通用流程</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>预热 → 测量 → 统计 → 报告 （防优化）
</span></span></code></pre></div><p><strong>预热</strong>: 跳过缓存未命中的初测</p>
<h4 id="criterion">Criterion
</h4><p><code>Criterion</code>是rust中最现代化的benchmark库，接下来跟着例子一步步深入了benchmark。</p>
<h4 id="入门">入门
</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">#![allow(unused)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> criterion::{black_box, criterion_group, criterion_main, Criterion};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> mycrate::fibonacci;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">criterion_benchmark</span>(c: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> Criterion) {
</span></span><span style="display:flex;"><span>    c.bench_function(<span style="color:#e6db74">&#34;fib 20&#34;</span>, <span style="color:#f92672">|</span>b<span style="color:#f92672">|</span> b.iter(<span style="color:#f92672">||</span> fibonacci(black_box(<span style="color:#ae81ff">20</span>))));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">criterion_group!</span>(benches, criterion_benchmark);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">criterion_main!</span>(benches);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="1-bench_function方法">1. <code>bench_function</code>方法
</h5><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>c.bench_function(<span style="color:#e6db74">&#34;fib 20&#34;</span>, <span style="color:#f92672">|</span>b<span style="color:#f92672">|</span> b.iter(<span style="color:#f92672">||</span> fibonacci(black_box(<span style="color:#ae81ff">20</span>))));
</span></span></code></pre></div><ul>
<li><strong>作用</strong>：定义一个基准测试用例</li>
<li><strong>参数</strong>:
<ul>
<li><code>fib 20</code>： 测试用例的名称（用于结果报告）</li>
<li>闭包函数：包含实际的测试逻辑</li>
</ul>
</li>
<li><strong>闭包内部</strong>
<ul>
<li><code>b</code>:   <code>Bencher</code>对象(自动传入)</li>
<li><code>b.iter(|| ...)</code>：运行被测代码多次并测量时间</li>
<li><code>black_box(20)</code>：阻止编译器优化(确保真实计算)</li>
<li><code>fibonacci(20)</code>：实际被测函数</li>
</ul>
</li>
</ul>
<h5 id="2-criterion_group宏">2. <code>criterion_group!</code>宏
</h5><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#a6e22e">criterion_group!</span>(benches, criterion_benchmark);
</span></span></code></pre></div><ul>
<li><strong>作用</strong>：创建基准测试组</li>
<li><strong>参数</strong>：
<ul>
<li><code>benches</code>：组名称（自定义标识符）</li>
<li><code>criterion_benchmark</code>：包含测试的函数名（本例中的基准函数）</li>
</ul>
</li>
<li><strong>特性</strong>：
<ul>
<li>将多个基准测试组织成组</li>
<li>支持添加多个测试函数</li>
<li>生成对应的 <code>bench_</code> 开头的函数（如<code>benches_benchmark</code>）</li>
</ul>
</li>
</ul>
<h5 id="3-criterion_main宏">3. <code>criterion_main!</code>宏
</h5><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#a6e22e">criterion_main!</span>(benches);
</span></span></code></pre></div><ul>
<li><strong>作用</strong>：生成基准测试的入口函数</li>
<li><strong>参数</strong>：
<ul>
<li><code>benches</code>：前面定义的测试组名</li>
</ul>
</li>
<li><strong>功能</strong>：
<ul>
<li>自动生成<code>main()</code>函数</li>
<li>配置并运行所有指定的测试组</li>
<li>处理命令行参数（如 <code>--filter</code>, <code>--savebaseline</code>）</li>
</ul>
</li>
</ul>
<h5 id="4-benches的来源">4. <code>benches</code>的来源
</h5><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#a6e22e">criterion_group!</span>(benches, <span style="color:#f92672">..</span>.);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//             ^^^^^^ 这里定义
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">criterion_main!</span>(benches);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//             ^^^^^^ 这里使用
</span></span></span></code></pre></div><ul>
<li><code>benches</code> 是由 <code>criterion_group!</code> <strong>宏创建的自定义标识符</strong></li>
<li>在 <code>criterion_main!</code> 中引用时：
<ol>
<li>查找同名测试组</li>
<li>将组内测试函数添加到执行队列</li>
<li>生成报告和图表</li>
</ol>
</li>
</ul>
<h4 id="进阶">进阶
</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">// 使用 benchmark_group 组织测试
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> group <span style="color:#f92672">=</span> c.benchmark_group(<span style="color:#e6db74">&#34;data_structures&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>group.sample_size(<span style="color:#ae81ff">100</span>);  <span style="color:#75715e">// 配置采样
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>group.measurement_time(Duration::from_secs(<span style="color:#ae81ff">5</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ... 多个相关测试
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>group.finish();
</span></span></code></pre></div><h5 id="benchmark_group方法"><code>benchmark_group</code>方法
</h5><ul>
<li>作用： 创建共享配置的容器，作为多个相关测试的配置载体</li>
<li>必须被包含在 <code>criterion_group!</code> 注册的测试函数中，并由其调度执行。</li>
</ul>
<h4 id="理解统计输出">理解统计输出
</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>time:   <span style="color:#f92672">[</span>123.45 µs 125.67 µs 128.90 µs<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>        ↑          ↑          ↑
</span></span><span style="display:flex;"><span>      下界      中位数       上界
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>change: <span style="color:#f92672">[</span>-5.23% +2.34% +10.23%<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>        ↑        ↑       ↑
</span></span><span style="display:flex;"><span>      最好    预期变化  最坏
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Found <span style="color:#ae81ff">3</span> outliers among <span style="color:#ae81ff">100</span> measurements
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">2</span> high mild    ← 稍微偏高
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">1</span> high severe  ← 严重偏高
</span></span></code></pre></div><h4 id="例子">例子
</h4><h5 id="1-参数化测试">1. 参数化测试
</h5><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">// 测试不同输入大小
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> group <span style="color:#f92672">=</span> c.benchmark_group(<span style="color:#e6db74">&#34;fibonacci&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#66d9ef">in</span> [<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">25</span>].iter() {
</span></span><span style="display:flex;"><span>    group.bench_with_input(
</span></span><span style="display:flex;"><span>        BenchmarkId::from_parameter(i),
</span></span><span style="display:flex;"><span>        i,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">|</span>b, <span style="color:#f92672">&amp;</span>i<span style="color:#f92672">|</span> b.iter(<span style="color:#f92672">||</span> fibonacci(black_box(i)))
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>group.finish();
</span></span></code></pre></div><h5 id="2-对比多个实现">2. 对比多个实现
</h5><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> group <span style="color:#f92672">=</span> c.benchmark_group(<span style="color:#e6db74">&#34;sum&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>group.bench_function(<span style="color:#e6db74">&#34;for_loop&#34;</span>, <span style="color:#f92672">|</span>b<span style="color:#f92672">|</span> {
</span></span><span style="display:flex;"><span>    b.iter(<span style="color:#f92672">||</span> sum_for_loop(black_box(<span style="color:#f92672">&amp;</span>data)))
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>group.bench_function(<span style="color:#e6db74">&#34;iterator&#34;</span>, <span style="color:#f92672">|</span>b<span style="color:#f92672">|</span> {
</span></span><span style="display:flex;"><span>    b.iter(<span style="color:#f92672">||</span> sum_iterator(black_box(<span style="color:#f92672">&amp;</span>data)))
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>group.finish();
</span></span></code></pre></div><h5 id="吞吐量测量">吞吐量测量
</h5><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> group <span style="color:#f92672">=</span> c.benchmark_group(<span style="color:#e6db74">&#34;throughput&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 设置吞吐量单位
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>group.throughput(Throughput::Bytes(data.len() <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">u64</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>group.bench_function(<span style="color:#e6db74">&#34;process&#34;</span>, <span style="color:#f92672">|</span>b<span style="color:#f92672">|</span> {
</span></span><span style="display:flex;"><span>    b.iter(<span style="color:#f92672">||</span> process(black_box(<span style="color:#f92672">&amp;</span>data)))
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 报告会显示 MB/s
</span></span></span></code></pre></div><h5 id="自定义配置">自定义配置
</h5><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>group.sample_size(<span style="color:#ae81ff">1000</span>);              <span style="color:#75715e">// 样本数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>group.warm_up_time(Duration::from_secs(<span style="color:#ae81ff">3</span>));  <span style="color:#75715e">// 预热时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>group.measurement_time(Duration::from_secs(<span style="color:#ae81ff">10</span>)); <span style="color:#75715e">// 测量时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>group.noise_threshold(<span style="color:#ae81ff">0.05</span>);          <span style="color:#75715e">// 噪音阈值
</span></span></span></code></pre></div>
</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 zed的博客
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.0640c0f9745d7bd65b558574cdb67852b46437c1f807526bf043aebc566fd6e4.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>

<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>zedçš„åšå®¢</title><link>https://www.dust-zed.site/</link><description>Recent content on zedçš„åšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 03 Nov 2025 14:09:03 +0800</lastBuildDate><atom:link href="https://www.dust-zed.site/index.xml" rel="self" type="application/rss+xml"/><item><title>HttpsåŠ å¯†å·¥ä½œæµç¨‹</title><link>https://www.dust-zed.site/basic/internet/https%E5%8A%A0%E5%AF%86%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/</link><pubDate>Mon, 03 Nov 2025 14:09:03 +0800</pubDate><guid>https://www.dust-zed.site/basic/internet/https%E5%8A%A0%E5%AF%86%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/</guid><description>&lt;h2 id="httpsåŠ å¯†å·¥ä½œæµç¨‹è¯¦è§£">HTTPSåŠ å¯†å·¥ä½œæµç¨‹è¯¦è§£
&lt;/h2>&lt;h3 id="ä¸€-æ ¸å¿ƒé—®é¢˜ä¸è§£å†³æ€è·¯">ä¸€ã€ æ ¸å¿ƒé—®é¢˜ä¸è§£å†³æ€è·¯
&lt;/h3>&lt;h4 id="11-httpçš„ä¸‰å¤§å®‰å…¨é—®é¢˜">1.1 HTTPçš„ä¸‰å¤§å®‰å…¨é—®é¢˜
&lt;/h4>&lt;pre tabindex="0">&lt;code>é—®é¢˜ 1: çªƒå¬
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å®¢æˆ·ç«¯ â”€â”€â”€[æ˜æ–‡æ•°æ®]â”€â”€â”€&amp;gt; æœåŠ¡å™¨
â†‘
æ”»å‡»è€…èƒ½çœ‹åˆ°
é—®é¢˜ 2: ç¯¡æ”¹
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å®¢æˆ·ç«¯ â”€â”€â”€[æ•°æ®]â”€â”€â”€&amp;gt; æ”»å‡»è€…ä¿®æ”¹ â”€â”€â”€&amp;gt; æœåŠ¡å™¨
â†“
æ”¹æˆå‡æ•°æ®
é—®é¢˜ 3: å†’å……
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å®¢æˆ·ç«¯ â”€â”€â”€[è¯·æ±‚]â”€â”€â”€&amp;gt; å‡æœåŠ¡å™¨
â†“
çªƒå–ç”¨æˆ·ä¿¡æ¯
&lt;/code>&lt;/pre>&lt;h3 id="12-https-çš„è§£å†³æ–¹æ¡ˆ">1.2 HTTPS çš„è§£å†³æ–¹æ¡ˆ
&lt;/h3>&lt;pre tabindex="0">&lt;code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯¹ç§°åŠ å¯† â†’ è§£å†³çªƒå¬å’Œç¯¡æ”¹ â”‚
â”‚ éå¯¹ç§°åŠ å¯† â†’ è§£å†³å¯†é’¥äº¤æ¢é—®é¢˜ â”‚
â”‚ æ•°å­—è¯ä¹¦ â†’ è§£å†³èº«ä»½å†’å……é—®é¢˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code>&lt;/pre>&lt;h4 id="äºŒå¯¹ç§°åŠ å¯†çš„å·¥ä½œæµç¨‹">äºŒã€å¯¹ç§°åŠ å¯†çš„å·¥ä½œæµç¨‹
&lt;/h4>&lt;h3 id="21-åŸºæœ¬åŸç†">2.1 åŸºæœ¬åŸç†
&lt;/h3>&lt;pre tabindex="0">&lt;code>å¯¹ç§°åŠ å¯† = åŠ å¯†å’Œè§£å¯†ç”¨åŒä¸€æŠŠé’¥åŒ™
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” å¯†é’¥K â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” å¯†é’¥K â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜æ–‡ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt; â”‚ å¯†æ–‡ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt; â”‚ æ˜æ–‡ â”‚
â”‚ Hello â”‚ åŠ å¯† â”‚ Kf9sL2 â”‚ è§£å¯† â”‚ Hello â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å‘é€æ–¹ ä¼ è¾“ä¸­ æ¥æ”¶æ–¹
â†‘
â”‚ æ”»å‡»è€…å³ä½¿æ‹¦æˆªä¹Ÿæ— æ³•è§£å¯†
â”‚ (æ²¡æœ‰å¯†é’¥K)
&lt;/code>&lt;/pre>&lt;h3 id="22-å¯¹ç§°åŠ å¯†çš„ä¼˜ç‚¹">2.2 å¯¹ç§°åŠ å¯†çš„ä¼˜ç‚¹
&lt;/h3>&lt;pre tabindex="0">&lt;code>âœ“ é€Ÿåº¦å¿«
- é€‚åˆåŠ å¯†å¤§é‡æ•°æ®
- 1GB æ•°æ®å‡ ç§’é’Ÿå°±èƒ½åŠ å¯†å®Œ
âœ“ å®‰å…¨æ€§é«˜
- åªè¦å¯†é’¥ä¸æ³„éœ²,å‡ ä¹æ— æ³•ç ´è§£
âœ“ è®¡ç®—å¼€é”€å°
- CPU å ç”¨ä½
- æœ‰ç¡¬ä»¶åŠ é€Ÿ
&lt;/code>&lt;/pre>&lt;h3 id="23-å¯¹ç§°åŠ å¯†çš„é—®é¢˜">2.3 å¯¹ç§°åŠ å¯†çš„é—®é¢˜
&lt;/h3>&lt;pre tabindex="0">&lt;code>âŒ å¯†é’¥å¦‚ä½•å®‰å…¨ä¼ é€’?
åœºæ™¯: Alice æƒ³ç»™ Bob å‘é€åŠ å¯†æ¶ˆæ¯
Alice Bob
| |
| æ­¥éª¤1: æˆ‘ä»¬ç”¨å¯†é’¥&amp;#34;abc123&amp;#34; |
|â”€â”€â”€â”€â”€â”€â”€â”€&amp;#34;abc123&amp;#34;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;|
| |
â†‘
â”‚ é—®é¢˜: å¯†é’¥å¿…é¡»é€šè¿‡ç½‘ç»œä¼ è¾“
â”‚ æ”»å‡»è€…å¯ä»¥æ‹¦æˆªå¯†é’¥
â”‚ æ‹¦æˆªåå°±èƒ½è§£å¯†æ‰€æœ‰é€šä¿¡!
ä¸­é—´äºº
â”Œâ”€â”€â”€â”€â”€â”
â”‚ ğŸ‘€ â”‚ çœ‹åˆ°äº†å¯†é’¥ &amp;#34;abc123&amp;#34;
â””â”€â”€â”€â”€â”€â”˜ å¯ä»¥è§£å¯†åç»­æ‰€æœ‰æ¶ˆæ¯
&lt;/code>&lt;/pre>&lt;p>&lt;strong>æ ¸å¿ƒçŸ›ç›¾&lt;/strong>&lt;/p>
&lt;pre tabindex="0">&lt;code>éœ€è¦åŠ å¯†é€šä¿¡ â†’ éœ€è¦å…±äº«å¯†é’¥ â†’ å¦‚ä½•å®‰å…¨ä¼ é€’å¯†é’¥?
&lt;/code>&lt;/pre>&lt;hr>
&lt;h3 id="ä¸‰éå¯¹ç§°åŠ å¯†çš„å·¥ä½œæµç¨‹">ä¸‰ã€éå¯¹ç§°åŠ å¯†çš„å·¥ä½œæµç¨‹
&lt;/h3>&lt;h4 id="31-åŸºæœ¬åŸç†">3.1 åŸºæœ¬åŸç†
&lt;/h4>&lt;pre tabindex="0">&lt;code>éå¯¹ç§°åŠ å¯† = ä¸€å¯¹å¯†é’¥(å…¬é’¥ + ç§é’¥)
å¯†é’¥å¯¹ç‰¹æ€§:
â”œâ”€ å…¬é’¥åŠ å¯†çš„,åªèƒ½ç”¨ç§é’¥è§£å¯†
â””â”€ ç§é’¥åŠ å¯†çš„,åªèƒ½ç”¨å…¬é’¥è§£å¯†
ç”Ÿæˆå¯†é’¥å¯¹:
Bobç”Ÿæˆ â”€â”€&amp;gt; å…¬é’¥(å¯ä»¥å…¬å¼€) + ç§é’¥(ä¸¥æ ¼ä¿å¯†)
&lt;/code>&lt;/pre>&lt;h3 id="32-åŠ å¯†é€šä¿¡æµç¨‹">3.2 åŠ å¯†é€šä¿¡æµç¨‹
&lt;/h3>&lt;pre tabindex="0">&lt;code>åœºæ™¯: Alice ç»™ Bob å‘é€ç§˜å¯†æ¶ˆæ¯
å‡†å¤‡é˜¶æ®µ:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Bob: ç”Ÿæˆå¯†é’¥å¯¹
â”œâ”€ å…¬é’¥: PubKey_Bob (å…¬å¼€å‘å¸ƒ)
â””â”€ ç§é’¥: PrivKey_Bob (è‡ªå·±ä¿ç®¡)
æ­¥éª¤ 1: è·å–å…¬é’¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Alice Bob
| |
| è¯·æ±‚å…¬é’¥ |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;|
| |
| PubKey_Bob |
|&amp;lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ |
| |
è¯´æ˜: å…¬é’¥å¯ä»¥å…¬å¼€ä¼ è¾“,ä¸æ€•è¢«çªƒå¬
æ­¥éª¤ 2: åŠ å¯†æ¶ˆæ¯
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Alice:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” ç”¨Bobçš„å…¬é’¥ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜æ–‡ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt; â”‚ å¯†æ–‡ â”‚
â”‚ &amp;#34;Hello&amp;#34; â”‚ åŠ å¯† â”‚ &amp;#34;Kf9sL2&amp;#34; â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
åªæœ‰Bobçš„ç§é’¥èƒ½è§£å¯†
æ­¥éª¤ 3: å‘é€å¯†æ–‡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Alice Bob
| |
| å¯†æ–‡ &amp;#34;Kf9sL2&amp;#34; |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;|
| |
â†‘
ä¸­é—´äººæ‹¦æˆª
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘€ â”‚ çœ‹åˆ°äº†å¯†æ–‡
â””â”€â”€â”€â”€â”€â”€â”˜ ä½†æ²¡æœ‰ç§é’¥,æ— æ³•è§£å¯†!
(åªæœ‰å…¬é’¥æ²¡ç”¨)
æ­¥éª¤ 4: è§£å¯†æ¶ˆæ¯
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Bob:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” ç”¨è‡ªå·±çš„ç§é’¥ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯†æ–‡ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt; â”‚ æ˜æ–‡ â”‚
â”‚ &amp;#34;Kf9sL2&amp;#34; â”‚ è§£å¯† â”‚ &amp;#34;Hello&amp;#34; â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
åªæœ‰ Bob æœ‰ç§é’¥ â†’ åªæœ‰ Bob èƒ½è§£å¯†
&lt;/code>&lt;/pre>&lt;h4 id="33-éå¯¹ç§°åŠ å¯†çš„ä¼˜ç‚¹">3.3 éå¯¹ç§°åŠ å¯†çš„ä¼˜ç‚¹
&lt;/h4>&lt;pre tabindex="0">&lt;code>âœ“ å¯†é’¥åˆ†å‘ç®€å•
- å…¬é’¥å¯ä»¥å…¬å¼€ä¼ è¾“
- ä¸æ‹…å¿ƒè¢«çªƒå¬
âœ“ ä¸éœ€è¦é¢„å…ˆå…±äº«å¯†é’¥
- ä»»ä½•äººéƒ½å¯ä»¥ç”¨å…¬é’¥åŠ å¯†
- åªæœ‰ç§é’¥æŒæœ‰è€…èƒ½è§£å¯†
&lt;/code>&lt;/pre>&lt;h3 id="34-éå¯¹ç§°åŠ å¯†çš„é—®é¢˜">3.4 éå¯¹ç§°åŠ å¯†çš„é—®é¢˜
&lt;/h3>&lt;pre tabindex="0">&lt;code>âŒ é€Ÿåº¦éå¸¸æ…¢
- æ¯”å¯¹ç§°åŠ å¯†æ…¢ 100~1000 å€
- ä¸é€‚åˆåŠ å¯†å¤§é‡æ•°æ®
ç¤ºä¾‹:
å¯¹ç§°åŠ å¯† 1GB æ•°æ®: å‡ ç§’
éå¯¹ç§°åŠ å¯† 1GB æ•°æ®: å‡ å°æ—¶!
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="å››https-çš„æ··åˆåŠ å¯†ç­–ç•¥">å››ã€HTTPS çš„æ··åˆåŠ å¯†ç­–ç•¥
&lt;/h4>&lt;h4 id="41-æ ¸å¿ƒæ€æƒ³">4.1 æ ¸å¿ƒæ€æƒ³
&lt;/h4>&lt;pre tabindex="0">&lt;code>ç»“åˆå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„ä¼˜ç‚¹ï¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 1: ç”¨éå¯¹ç§°åŠ å¯†ä¼ é€’å¯¹ç§°å¯†é’¥ â”‚
â”‚ (åªç”¨ä¸€æ¬¡,é€Ÿåº¦æ…¢ä¹Ÿèƒ½æ¥å—) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é˜¶æ®µ 2: ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†æ‰€æœ‰å®é™…æ•°æ® â”‚
â”‚ (é€Ÿåº¦å¿«,é€‚åˆå¤§é‡æ•°æ®) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code>&lt;/pre>&lt;h4 id="42-å®Œæ•´å·¥ä½œæµç¨‹">4.2 å®Œæ•´å·¥ä½œæµç¨‹
&lt;/h4>&lt;pre tabindex="0">&lt;code>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
é˜¶æ®µ 1: æ¡æ‰‹é˜¶æ®µ (éå¯¹ç§°åŠ å¯†)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å®¢æˆ·ç«¯ æœåŠ¡å™¨
| |
| â‘  è¯·æ±‚å»ºç«‹è¿æ¥ |
| - æˆ‘æ”¯æŒå“ªäº›åŠ å¯†ç®—æ³• |
| - å®¢æˆ·ç«¯éšæœºæ•°A |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;|
| |
| | â‘¡ æœåŠ¡å™¨å“åº”
| - é€‰æ‹©åŠ å¯†ç®—æ³• | - é€‰å®šåŠ å¯†ç®—æ³•
| - æœåŠ¡å™¨éšæœºæ•°B | - ç”Ÿæˆéšæœºæ•°
| - æ•°å­—è¯ä¹¦(å«å…¬é’¥) | - å‘é€è¯ä¹¦
|&amp;lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
| |
| â‘¢ å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦ |
| - æ£€æŸ¥è¯ä¹¦æ˜¯å¦å¯ä¿¡ |
| - æå–æœåŠ¡å™¨å…¬é’¥ |
| |
| â‘£ ç”Ÿæˆå¯¹ç§°å¯†é’¥ |
| - å®¢æˆ·ç«¯ç”Ÿæˆéšæœºæ•°C |
| (ç§°ä¸ºé¢„ä¸»å¯†é’¥) |
| - ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†éšæœºæ•°C |
| |
| åŠ å¯†çš„éšæœºæ•°C |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;|
| |
| | â‘¤ æœåŠ¡å™¨è§£å¯†
| | - ç”¨ç§é’¥è§£å¯†
| | - å¾—åˆ°éšæœºæ•°C
| |
| â‘¥ åŒæ–¹ç”¨ç›¸åŒæ–¹æ³•è®¡ç®—å¯¹ç§°å¯†é’¥ |
| å¯†é’¥ = å‡½æ•°(éšæœºæ•°A, éšæœºæ•°B, éšæœºæ•°C)
| |
| åŒæ–¹ç°åœ¨æœ‰äº†ç›¸åŒçš„å¯¹ç§°å¯†é’¥! |
| |
é‡ç‚¹:
- éšæœºæ•°Cç”¨éå¯¹ç§°åŠ å¯†ä¼ è¾“(å®‰å…¨ä½†æ…¢)
- åªä¼ è¾“ä¸€æ¬¡
- æ”»å‡»è€…å³ä½¿æ‹¦æˆªä¹Ÿæ— æ³•è·å¾—éšæœºæ•°C
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
é˜¶æ®µ 2: æ•°æ®ä¼ è¾“é˜¶æ®µ (å¯¹ç§°åŠ å¯†)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å®¢æˆ·ç«¯ æœåŠ¡å™¨
| |
| HTTP è¯·æ±‚ |
| â”€â”€&amp;gt; ç”¨å¯¹ç§°å¯†é’¥åŠ å¯† â”€â”€&amp;gt; [å¯†æ–‡1] |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;|
| | â”€â”€&amp;gt; ç”¨å¯¹ç§°å¯†é’¥è§£å¯†
| | â”€â”€&amp;gt; å¤„ç†è¯·æ±‚
| |
| | HTTP å“åº”
| &amp;lt;â”€â”€ ç”¨å¯¹ç§°å¯†é’¥è§£å¯† &amp;lt;â”€â”€ [å¯†æ–‡2] &amp;lt;â”€â”€ |
|&amp;lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
| |
| åç»­æ‰€æœ‰é€šä¿¡éƒ½ç”¨å¯¹ç§°å¯†é’¥ |
|&amp;lt;=====================================&amp;gt;|
| é€Ÿåº¦å¿«! |
é‡ç‚¹:
- å®é™…æ•°æ®ç”¨å¯¹ç§°åŠ å¯†(é€Ÿåº¦å¿«)
- åŒæ–¹ç”¨ç›¸åŒçš„å¯¹ç§°å¯†é’¥
- æ”»å‡»è€…æ²¡æœ‰å¯†é’¥,æ— æ³•è§£å¯†
&lt;/code>&lt;/pre>&lt;h4 id="43-ä¸ºä»€ä¹ˆéœ€è¦ä¸‰ä¸ªéšæœºæ•°">4.3 ä¸ºä»€ä¹ˆéœ€è¦ä¸‰ä¸ªéšæœºæ•°ï¼Ÿ
&lt;/h4>&lt;pre tabindex="0">&lt;code>éšæœºæ•°æ¥æºè¶Šå¤šï¼Œæœ€ç»ˆå¯†é’¥è¶Šéš¾è¶Šæµ‹
å®¢æˆ·ç«¯éšæœºæ•°A: å®¢æˆ·ç«¯ç”Ÿæˆ
æœåŠ¡å™¨éšæœºæ•°B: æœåŠ¡å™¨ç”Ÿæˆ
é¢„ä¸»å¯†é’¥C: å®¢æˆ·ç«¯ç”Ÿæˆ
æœ€ç»ˆå¯¹ç§°å¯†é’¥ = å¤æ‚å‡½æ•°(A, B, C)
å¥½å¤„:
â”œâ”€ å³ä½¿æ”»å‡»è€…æ§åˆ¶äº†å®¢æˆ·ç«¯,ä¹Ÿä¸çŸ¥é“Bå’ŒC
â”œâ”€ å³ä½¿æ”»å‡»è€…æ§åˆ¶äº†æœåŠ¡å™¨,ä¹Ÿä¸çŸ¥é“C
â”œâ”€ å¿…é¡»åŒæ—¶çŸ¥é“Aã€Bã€Cæ‰èƒ½è®¡ç®—å‡ºå¯†é’¥
â””â”€ æ¯æ¬¡è¿æ¥çš„å¯†é’¥éƒ½ä¸åŒ(å› ä¸ºéšæœºæ•°æ¯æ¬¡ä¸åŒ)
&lt;/code>&lt;/pre>&lt;hr>
&lt;h3 id="äº”æ•°å­—è¯ä¹¦çš„ä½œç”¨">äº”ã€æ•°å­—è¯ä¹¦çš„ä½œç”¨
&lt;/h3>&lt;h4 id="51-ä¸ºä»€ä¹ˆéœ€è¦è¯ä¹¦">5.1 ä¸ºä»€ä¹ˆéœ€è¦è¯ä¹¦ï¼Ÿ
&lt;/h4>&lt;pre tabindex="0">&lt;code>é—®é¢˜: å¦‚ä½•ç¡®è®¤å…¬é’¥çœŸçš„å±äºæœåŠ¡å™¨?
ä¸­é—´äººæ”»å‡»ç¤ºä¾‹ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å®¢æˆ·ç«¯ æ”»å‡»è€… çœŸå®æœåŠ¡å™¨
| | |
| â‘  è¯·æ±‚å…¬é’¥ | |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;| |
| | â‘¡ è¯·æ±‚å…¬é’¥ |
| |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;|
| | |
| | â‘¢ çœŸå®å…¬é’¥ |
| |&amp;lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
| | |
| â‘£ å‡å…¬é’¥ | |
|&amp;lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| |
| | |
| â‘¤ ç”¨å‡å…¬é’¥åŠ å¯†å¯†é’¥ | |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;| |
| | â‘¥ ç”¨å‡ç§é’¥è§£å¯† |
| | â†’ å¾—åˆ°å¯†é’¥! |
| | |
ç»“æœ: æ”»å‡»è€…å†’å……æœåŠ¡å™¨,çªƒå–äº†å¯†é’¥å’Œæ‰€æœ‰æ•°æ®!
&lt;/code>&lt;/pre>&lt;h4 id="52-è¯ä¹¦çš„æœ¬è´¨">5.2 è¯ä¹¦çš„æœ¬è´¨
&lt;/h4>&lt;pre tabindex="0">&lt;code>æ•°å­—è¯ä¹¦ = æœåŠ¡å™¨ä¿¡æ¯ + å…¬é’¥ + CAçš„ç­¾å
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯ä¹¦å†…å®¹: â”‚
â”‚ â”œâ”€ åŸŸå: www.example.com â”‚
â”‚ â”œâ”€ å…¬å¸: Example Inc â”‚
â”‚ â”œâ”€ æœ‰æ•ˆæœŸ: 2024-01-01 åˆ° 2025-01-01 â”‚
â”‚ â”œâ”€ å…¬é’¥: [æœåŠ¡å™¨çš„å…¬é’¥] â”‚
â”‚ â””â”€ è¯ä¹¦é¢å‘æœºæ„: DigiCert CA â”‚
â”‚ â”‚
â”‚ CAçš„ç­¾å: â”‚
â”‚ â””â”€ [CAç”¨è‡ªå·±ç§é’¥ç­¾åçš„æ•°æ®] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
è¯ä¹¦çš„ä½œç”¨:
è¯æ˜ &amp;#34;è¿™ä¸ªå…¬é’¥ç¡®å®å±äº www.example.com&amp;#34;
&lt;/code>&lt;/pre>&lt;h4 id="53-caè¯ä¹¦é¢å‘æœºæ„-çš„ä½œç”¨">5.3 CAï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰ çš„ä½œç”¨
&lt;/h4>&lt;pre tabindex="0">&lt;code>CA çš„å·¥ä½œæµç¨‹:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. ç½‘ç«™å‘ CA ç”³è¯·è¯ä¹¦
Example Inc: &amp;#34;æˆ‘æ˜¯ example.com çš„æ‰€æœ‰è€…,
è¿™æ˜¯æˆ‘çš„å…¬é’¥,è¯·ç»™æˆ‘é¢å‘è¯ä¹¦&amp;#34;
2. CA éªŒè¯èº«ä»½
â”œâ”€ éªŒè¯åŸŸåæ‰€æœ‰æƒ(å‘é‚®ä»¶/DNSè®°å½•)
â”œâ”€ éªŒè¯å…¬å¸èº«ä»½(è¥ä¸šæ‰§ç…§)
â””â”€ ç¡®è®¤ç”³è¯·è€…ç¡®å®æ‹¥æœ‰ç§é’¥
3. CA åˆ›å»ºè¯ä¹¦å†…å®¹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸŸå: example.com â”‚
â”‚ å…¬é’¥: [ç½‘ç«™å…¬é’¥] â”‚
â”‚ æœ‰æ•ˆæœŸ: 1å¹´ â”‚
â”‚ ... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
4. CA ç”¨è‡ªå·±çš„ç§é’¥ç­¾å
è¯ä¹¦å†…å®¹ â”€â”€&amp;gt; è®¡ç®—æ‘˜è¦ â”€â”€&amp;gt; ç”¨CAç§é’¥åŠ å¯†æ‘˜è¦
5. é¢å‘æœ€ç»ˆè¯ä¹¦
[è¯ä¹¦å†…å®¹] + [CAç­¾å] â”€â”€&amp;gt; å®Œæ•´è¯ä¹¦
&lt;/code>&lt;/pre>&lt;hr>
&lt;h3 id="å…­è¯ä¹¦éªŒè¯æµç¨‹">å…­ã€è¯ä¹¦éªŒè¯æµç¨‹
&lt;/h3>&lt;h4 id="61-æµè§ˆå™¨å¦‚ä½•éªŒè¯è¯ä¹¦">6.1 æµè§ˆå™¨å¦‚ä½•éªŒè¯è¯ä¹¦
&lt;/h4>&lt;pre tabindex="0">&lt;code>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å®Œæ•´éªŒè¯æµç¨‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ­¥éª¤ 1: æ£€æŸ¥åŸŸå
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æµè§ˆå™¨è®¿é—®: https://www.example.com
è¯ä¹¦ä¸Šçš„åŸŸå: www.example.com
âœ“ åŸŸååŒ¹é…
æ­¥éª¤ 2: æ£€æŸ¥æœ‰æ•ˆæœŸ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¯ä¹¦æœ‰æ•ˆæœŸ: 2024-01-01 åˆ° 2025-01-01
å½“å‰æ—¶é—´: 2024-06-15
âœ“ åœ¨æœ‰æ•ˆæœŸå†…
æ­¥éª¤ 3: éªŒè¯è¯ä¹¦é“¾
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¯ä¹¦é“¾ç»“æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ www.example.com çš„è¯ä¹¦ â”‚ â† ç½‘ç«™è¯ä¹¦
â”‚ é¢å‘è€…: DigiCert SHA2 CA â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ è°é¢å‘çš„?
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DigiCert SHA2 CA çš„è¯ä¹¦ â”‚ â† ä¸­é—´è¯ä¹¦
â”‚ é¢å‘è€…: DigiCert Root CA â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ è°é¢å‘çš„?
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DigiCert Root CA çš„è¯ä¹¦ â”‚ â† æ ¹è¯ä¹¦
â”‚ é¢å‘è€…: è‡ªå·±(è‡ªç­¾å) â”‚
â”‚ âœ“ è¿™ä¸ªè¯ä¹¦å†…ç½®åœ¨æµè§ˆå™¨/æ“ä½œç³»ç»Ÿä¸­ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
éªŒè¯é€»è¾‘:
æˆ‘ä¿¡ä»» Root CA
â†’ Root CA ä¿¡ä»» SHA2 CA
â†’ SHA2 CA ä¿¡ä»» example.com
â†’ æ‰€ä»¥æˆ‘ä¿¡ä»» example.com
âœ“ è¯ä¹¦é“¾å®Œæ•´ä¸”å¯ä¿¡
æ­¥éª¤ 4: éªŒè¯ç­¾å
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
éªŒè¯ example.com è¯ä¹¦ä¸Šçš„ç­¾å:
â‘  æå–è¯ä¹¦å†…å®¹
å†…å®¹ = [åŸŸåã€å…¬é’¥ã€æœ‰æ•ˆæœŸç­‰]
â‘¡ è®¡ç®—è¯ä¹¦æ‘˜è¦
æ‘˜è¦A = Hash(è¯ä¹¦å†…å®¹)
â‘¢ ç”¨CAçš„å…¬é’¥è§£å¯†ç­¾å
ç­¾åå€¼ â”€â”€&amp;gt; ç”¨DigiCert SHA2 CAçš„å…¬é’¥è§£å¯† â”€â”€&amp;gt; æ‘˜è¦B
â‘£ æ¯”è¾ƒä¸¤ä¸ªæ‘˜è¦
æ‘˜è¦A == æ‘˜è¦B ?
âœ“ ç›¸ç­‰ â†’ è¯ä¹¦æœªè¢«ç¯¡æ”¹
âœ— ä¸ç­‰ â†’ è¯ä¹¦è¢«ç¯¡æ”¹,æ‹’ç»è¿æ¥
âœ“ ç­¾åæœ‰æ•ˆ
æ­¥éª¤ 5: æ£€æŸ¥åŠé”€çŠ¶æ€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æŸ¥è¯¢: è¿™ä¸ªè¯ä¹¦æ˜¯å¦è¢«CAæå‰åŠé”€?
æ–¹å¼1: CRL (è¯ä¹¦åŠé”€åˆ—è¡¨)
â”œâ”€ ä¸‹è½½CAç»´æŠ¤çš„åŠé”€åˆ—è¡¨
â””â”€ æ£€æŸ¥è¯ä¹¦åºåˆ—å·æ˜¯å¦åœ¨åˆ—è¡¨ä¸­
æ–¹å¼2: OCSP (åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®)
â”œâ”€ å®æ—¶æŸ¥è¯¢CAæœåŠ¡å™¨
â””â”€ æ›´å¿«æ›´æ–°
âœ“ è¯ä¹¦æœªè¢«åŠé”€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å…¨éƒ¨éªŒè¯é€šè¿‡!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æµè§ˆå™¨æ˜¾ç¤º: ğŸ”’ å®‰å…¨
&lt;/code>&lt;/pre>&lt;h4 id="62-ç­¾åéªŒè¯åŸç†">6.2 ç­¾åéªŒè¯åŸç†
&lt;/h4>&lt;pre tabindex="0">&lt;code>CA ç­¾åè¿‡ç¨‹:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¯ä¹¦å†…å®¹
â†“
è®¡ç®—Hashæ‘˜è¦
â†“
[æ‘˜è¦å€¼: a3f8d29c...]
â†“
ç”¨CAç§é’¥åŠ å¯†
â†“
[ç­¾åå€¼: 3e4f5a9c...]
â†“
æ”¾å…¥è¯ä¹¦
æµè§ˆå™¨éªŒè¯è¿‡ç¨‹:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ä»è¯ä¹¦æå–:
â”œâ”€ è¯ä¹¦å†…å®¹
â””â”€ ç­¾åå€¼
è·¯å¾„1: è®¡ç®—æ‘˜è¦
è¯ä¹¦å†…å®¹ â”€â”€&amp;gt; Hash â”€â”€&amp;gt; æ‘˜è¦A
è·¯å¾„2: è§£å¯†ç­¾å
ç­¾åå€¼ â”€â”€&amp;gt; ç”¨CAå…¬é’¥è§£å¯† â”€â”€&amp;gt; æ‘˜è¦B
æ¯”è¾ƒ:
æ‘˜è¦A == æ‘˜è¦B ?
âœ“ æ˜¯ â†’ è¯ä¹¦æœ‰æ•ˆ
âœ— å¦ â†’ è¯ä¹¦è¢«ç¯¡æ”¹
ä¸ºä»€ä¹ˆå®‰å…¨?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ”»å‡»è€…æƒ³ä¼ªé€ è¯ä¹¦:
1. ä¿®æ”¹è¯ä¹¦å†…å®¹
â”œâ”€ æŠŠåŸŸåæ”¹æˆ fake.com
â””â”€ æŠŠå…¬é’¥æ”¹æˆè‡ªå·±çš„
2. éœ€è¦é‡æ–°ç­¾å
â”œâ”€ è®¡ç®—æ–°çš„æ‘˜è¦
â””â”€ éœ€è¦ç”¨CAç§é’¥åŠ å¯†
3. âŒ é—®é¢˜: æ”»å‡»è€…æ²¡æœ‰CAç§é’¥!
â””â”€ æ— æ³•ç”Ÿæˆæœ‰æ•ˆç­¾å
4. æµè§ˆå™¨éªŒè¯æ—¶
â”œâ”€ ç”¨CAå…¬é’¥è§£å¯†ç­¾å
â”œâ”€ å¾—åˆ°çš„æ‘˜è¦ä¸åŒ¹é…
â””â”€ æ‹’ç»è¿æ¥!
&lt;/code>&lt;/pre>&lt;hr>
&lt;h3 id="ä¸ƒå®Œæ•´æµç¨‹æ€»ç»“">ä¸ƒã€å®Œæ•´æµç¨‹æ€»ç»“
&lt;/h3>&lt;h4 id="71-https-è¿æ¥çš„å®Œæ•´è¿‡ç¨‹">7.1 HTTPS è¿æ¥çš„å®Œæ•´è¿‡ç¨‹
&lt;/h4>&lt;pre tabindex="0">&lt;code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸€é˜¶æ®µ: è¯ä¹¦éªŒè¯ (ç¡®è®¤æœåŠ¡å™¨èº«ä»½) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å®¢æˆ·ç«¯ æœåŠ¡å™¨
| |
| â‘  è¯·æ±‚è¿æ¥ |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;|
| |
| â‘¡ å‘é€è¯ä¹¦ |
|&amp;lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
| |
| â‘¢ éªŒè¯è¯ä¹¦ |
| - åŸŸååŒ¹é…? |
| - æœ‰æ•ˆæœŸOK? |
| - CAç­¾åæœ‰æ•ˆ? |
| - è¯ä¹¦é“¾å®Œæ•´? |
| âœ“ å…¨éƒ¨é€šè¿‡ |
| |
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬äºŒé˜¶æ®µ: å¯†é’¥åå•† (å»ºç«‹å¯¹ç§°å¯†é’¥) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
| â‘£ ä»è¯ä¹¦æå–æœåŠ¡å™¨å…¬é’¥ |
| |
| â‘¤ ç”Ÿæˆé¢„ä¸»å¯†é’¥ |
| - å®¢æˆ·ç«¯ç”Ÿæˆéšæœºæ•° |
| - ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯† |
| |
| [åŠ å¯†çš„é¢„ä¸»å¯†é’¥] |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;|
| |
| | â‘¥ ç”¨ç§é’¥è§£å¯†
| | è·å¾—é¢„ä¸»å¯†é’¥
| |
| â‘¦ åŒæ–¹è®¡ç®—å¯¹ç§°å¯†é’¥ |
| å¯¹ç§°å¯†é’¥ = å‡½æ•°( |
| å®¢æˆ·ç«¯éšæœºæ•°, |
| æœåŠ¡å™¨éšæœºæ•°, |
| é¢„ä¸»å¯†é’¥ |
| ) |
| |
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸‰é˜¶æ®µ: åŠ å¯†é€šä¿¡ (ä¼ è¾“å®é™…æ•°æ®) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
| â‘§ å‘é€åŠ å¯†æ•°æ® |
| HTTPè¯·æ±‚ â†’ å¯¹ç§°åŠ å¯† â†’ å¯†æ–‡ |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&amp;gt;|
| |
| | â‘¨ è§£å¯†å¤„ç†
| | å¯†æ–‡ â†’ å¯¹ç§°è§£å¯† â†’ HTTPè¯·æ±‚
| | å¤„ç†è¯·æ±‚
| |
| â‘© åŠ å¯†å“åº” |
| å¯†æ–‡ â† å¯¹ç§°åŠ å¯† â† HTTPå“åº” |
|&amp;lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
| |
| â‘ª è§£å¯† |
| å¯†æ–‡ â†’ å¯¹ç§°è§£å¯† â†’ HTTPå“åº” |
| |
| åç»­æ‰€æœ‰é€šä¿¡ç”¨å¯¹ç§°å¯†é’¥åŠ å¯† |
|&amp;lt;â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•&amp;gt;|
&lt;/code>&lt;/pre>&lt;h4 id="72-å…³é”®æµç¨‹å›¾">7.2 å…³é”®æµç¨‹å›¾
&lt;/h4>&lt;pre tabindex="0">&lt;code> å¼€å§‹è®¿é—® HTTPS ç½‘ç«™
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å»ºç«‹ TCP è¿æ¥ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TLS æ¡æ‰‹å¼€å§‹ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å™¨å‘é€è¯ä¹¦ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµè§ˆå™¨éªŒè¯è¯ä¹¦ â”‚
â”‚ - åŸŸå â”‚
â”‚ - æœ‰æ•ˆæœŸ â”‚
â”‚ - CAç­¾å â”‚
â”‚ - è¯ä¹¦é“¾ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚ è¯ä¹¦æœ‰æ•ˆ? â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
æœ‰æ•ˆ â”‚ â”‚ æ— æ•ˆ
â†“ â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â””â”€â”€&amp;gt; âŒ æ˜¾ç¤ºè­¦å‘Š
â”‚ æå–å…¬é’¥ â”‚ ä¸­æ–­è¿æ¥
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”Ÿæˆé¢„ä¸»å¯†é’¥ â”‚
â”‚ ç”¨å…¬é’¥åŠ å¯†å‘é€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å™¨ç”¨ç§é’¥è§£å¯† â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŒæ–¹è®¡ç®—å¯¹ç§°å¯†é’¥ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†é€šä¿¡ â”‚
â”‚ ğŸ”’ å®‰å…¨è¿æ¥å»ºç«‹ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
å¼€å§‹ä¼ è¾“æ•°æ®
&lt;/code>&lt;/pre>&lt;hr>
&lt;h3 id="å…«ä¸‰ç§åŠ å¯†æ–¹å¼å¯¹æ¯”">å…«ã€ä¸‰ç§åŠ å¯†æ–¹å¼å¯¹æ¯”
&lt;/h3>&lt;pre tabindex="0">&lt;code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»´åº¦ â”‚ å¯¹ç§°åŠ å¯† â”‚ éå¯¹ç§°åŠ å¯† â”‚ HTTPSæ··åˆ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯†é’¥ â”‚ 1ä¸ªå¯†é’¥ â”‚ 2ä¸ªå¯†é’¥ â”‚ ä¸¤ç§éƒ½ç”¨ â”‚
â”‚ â”‚ (åŠ å¯†è§£å¯†åŒ) â”‚ (å…¬é’¥+ç§é’¥) â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€Ÿåº¦ â”‚ å¿« âš¡âš¡âš¡ â”‚ æ…¢ ğŸŒ â”‚ æœ€ä¼˜ âš¡âš¡ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯†é’¥åˆ†å‘ â”‚ å›°éš¾ âŒ â”‚ ç®€å• âœ“ â”‚ è§£å†³ âœ“ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‚ç”¨åœºæ™¯ â”‚ å¤§é‡æ•°æ® â”‚ å°‘é‡æ•°æ® â”‚ æ‰€æœ‰åœºæ™¯ â”‚
â”‚ â”‚ å¯†é’¥äº¤æ¢å â”‚ å¯†é’¥äº¤æ¢ â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®é™…ä½¿ç”¨ â”‚ ä¸å•ç‹¬ä½¿ç”¨ â”‚ ä¸å•ç‹¬ä½¿ç”¨ â”‚ HTTPSé‡‡ç”¨ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code>&lt;/pre>&lt;hr>
&lt;h3 id="ä¹æ€»ç»“è®°å¿†å›¾">ä¹ã€æ€»ç»“è®°å¿†å›¾
&lt;/h3>&lt;pre tabindex="0">&lt;code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTPS åŠ å¯†ä½“ç³»å®Œæ•´æ¶æ„ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç”¨æˆ·è®¿é—®ç½‘ç«™
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¯ä¹¦éªŒè¯é˜¶æ®µ â”‚
â”‚ (è§£å†³èº«ä»½é—®é¢˜) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
æœåŠ¡å™¨å‘é€æ•°å­—è¯ä¹¦
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯ä¹¦åŒ…å«: â”‚
â”‚ â”œâ”€ åŸŸå â”‚
â”‚ â”œâ”€ å…¬å¸ä¿¡æ¯ â”‚
â”‚ â”œâ”€ æœåŠ¡å™¨å…¬é’¥ â”‚
â”‚ â””â”€ CAçš„æ•°å­—ç­¾å â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
æµè§ˆå™¨éªŒè¯è¯ä¹¦
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éªŒè¯é¡¹: â”‚
â”‚ â”œâ”€ åŸŸååŒ¹é…? â”‚
â”‚ â”œâ”€ æœªè¿‡æœŸ? â”‚
â”‚ â”œâ”€ CAå¯ä¿¡? â”‚
â”‚ â””â”€ ç­¾åæœ‰æ•ˆ? â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
å…¨éƒ¨é€šè¿‡ âœ“
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å¯†é’¥åå•†é˜¶æ®µ â”‚
â”‚ (å»ºç«‹åŠ å¯†é€šé“) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
å®¢æˆ·ç«¯ç”Ÿæˆé¢„ä¸»å¯†é’¥
â†“
ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†
(éå¯¹ç§°åŠ å¯† - æ…¢ä½†å®‰å…¨)
â†“
æœåŠ¡å™¨ç”¨ç§é’¥è§£å¯†
â†“
åŒæ–¹è®¡ç®—å¯¹ç§°å¯†é’¥
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åŠ å¯†é€šä¿¡é˜¶æ®µ â”‚
â”‚ (ä¼ è¾“å®é™…æ•°æ®) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†æ‰€æœ‰æ•°æ®
(å¯¹ç§°åŠ å¯† - å¿«é€Ÿé«˜æ•ˆ)
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®‰å…¨é€šä¿¡å»ºç«‹! ğŸ”’ â”‚
â”‚ â”œâ”€ é˜²çªƒå¬ âœ“ â”‚
â”‚ â”œâ”€ é˜²ç¯¡æ”¹ âœ“ â”‚
â”‚ â””â”€ é˜²å†’å…… âœ“ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code>&lt;/pre>&lt;p>è¿™å°±æ˜¯ HTTPS åŠ å¯†çš„å®Œæ•´å·¥ä½œæµç¨‹!æ ¸å¿ƒå°±æ˜¯&lt;strong>ä¸‰ä¸ªé˜¶æ®µ&lt;/strong>:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>è¯ä¹¦éªŒè¯&lt;/strong> - ç¡®è®¤æ˜¯çœŸç½‘ç«™&lt;/li>
&lt;li>&lt;strong>å¯†é’¥åå•†&lt;/strong> - å®‰å…¨åœ°å»ºç«‹åŠ å¯†é€šé“ (ç”¨éå¯¹ç§°åŠ å¯†)&lt;/li>
&lt;li>&lt;strong>åŠ å¯†é€šä¿¡&lt;/strong> - å¿«é€Ÿä¼ è¾“æ•°æ® (ç”¨å¯¹ç§°åŠ å¯†)&lt;/li>
&lt;/ol></description></item><item><title>Httpåè®®æ·±åº¦è§£æ</title><link>https://www.dust-zed.site/basic/internet/http%E5%8D%8F%E8%AE%AE%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/</link><pubDate>Sun, 02 Nov 2025 10:14:30 +0800</pubDate><guid>https://www.dust-zed.site/basic/internet/http%E5%8D%8F%E8%AE%AE%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/</guid><description>&lt;h3 id="httpåè®®æ·±åº¦è§£æ">HTTPåè®®æ·±åº¦è§£æ
&lt;/h3>&lt;p>æ·±å…¥åœ°è®²è§£HTTPåè®®çš„æ ¸å¿ƒçŸ¥è¯†ã€‚&lt;/p>
&lt;h4 id="ä¸€httpåŸºç¡€æ¶æ„">ä¸€ã€HTTPåŸºç¡€æ¶æ„
&lt;/h4>&lt;h5 id="11-httpçš„æœ¬è´¨">1.1 HTTPçš„æœ¬è´¨
&lt;/h5>&lt;p>HTTPæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åº”ç”¨å±‚åè®®ï¼ŒåŸºäº&lt;strong>è¯·æ±‚-å“åº”&lt;/strong>æ¨¡å‹ï¼š&lt;/p>
&lt;ul>
&lt;li>å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚&lt;/li>
&lt;li>æœåŠ¡å™¨è¿”å›å“åº”&lt;/li>
&lt;li>æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒæœåŠ¡å™¨ä¸ä¿ç•™ä¹‹å‰çš„çŠ¶æ€&lt;/li>
&lt;/ul>
&lt;h5 id="12-ä¼ è¾“å±‚åŸºç¡€">1.2 ä¼ è¾“å±‚åŸºç¡€
&lt;/h5>&lt;p>HTTPå»ºç«‹åœ¨TCPä¹‹ä¸Šï¼š&lt;/p>
&lt;ul>
&lt;li>HTTP/1.0å’Œ1.1: ä½¿ç”¨TCP&lt;/li>
&lt;li>HTTP/2: ä½¿ç”¨TCPï¼ˆä½†ä¼˜åŒ–äº†å¤šè·¯å¤ç”¨ï¼‰&lt;/li>
&lt;li>HTTP/3:ä½¿ç”¨QUICï¼ˆåŸºäºUDPï¼‰&lt;/li>
&lt;/ul>
&lt;h4 id="äºŒ-httpè¯·æ±‚ç»“æ„">äºŒã€ HTTPè¯·æ±‚ç»“æ„
&lt;/h4>&lt;h5 id="21-è¯·æ±‚ç»„æˆ">2.1 è¯·æ±‚ç»„æˆ
&lt;/h5>&lt;pre tabindex="0">&lt;code>è¯·æ±‚è¡Œ (Request Line)
è¯·æ±‚å¤´ (Headers)
ç©ºè¡Œ
è¯·æ±‚ä½“ (Body, å¯é€‰)
&lt;/code>&lt;/pre>&lt;p>ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /api/users?page=1 &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">example.com&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>User-Agent&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">Mozilla/5.0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Accept&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">application/json&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Type&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">application/json&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Cookie&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">session_id=abc123&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{&lt;span style="color:#f92672">&amp;#34;filter&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;active&amp;#34;&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="22-è¯·æ±‚æ–¹æ³•æ·±å…¥">2.2 è¯·æ±‚æ–¹æ³•æ·±å…¥
&lt;/h5>&lt;p>&lt;strong>GET&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>è·å–èµ„æºï¼Œå¹‚ç­‰ä¸”å®‰å…¨&lt;/li>
&lt;li>å‚æ•°åœ¨URLä¸­ï¼Œæœ‰é•¿åº¦é™åˆ¶&lt;/li>
&lt;li>å¯è¢«ç¼“å­˜ã€ä¹¦ç­¾ä¿å­˜&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>POST&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>åˆ›å»ºèµ„æºæˆ–æäº¤æ•°æ®&lt;/li>
&lt;li>å‚æ•°åœ¨è¯·æ±‚ä½“ä¸­ï¼Œæ— é•¿åº¦é™åˆ¶&lt;/li>
&lt;li>ä¸å¯ç¼“å­˜ï¼ˆé™¤éæ˜¾å¼æŒ‡å®šï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>PUT&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å®Œæ•´æ›´æ–°èµ„æºï¼Œå¹‚ç­‰&lt;/li>
&lt;li>å¤šæ¬¡æ‰§è¡Œç»“æœç›¸åŒ&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>PATCH&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>éƒ¨åˆ†æ›´æ–°èµ„æº&lt;/li>
&lt;li>åªæ›´æ–°æŒ‡å®šå­—æ®µ&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>DELETE&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>åˆ é™¤èµ„æºï¼Œå¹‚ç­‰&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>HEAD&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>åªè·å–å“åº”å¤´ï¼Œä¸è¿”å›å“åº”ä½“&lt;/li>
&lt;li>ç”¨äºæ£€æŸ¥èµ„æºæ˜¯å¦å­˜åœ¨ã€è·å–å…ƒä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>OPTIONS&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æŸ¥è¯¢æœåŠ¡å™¨æ”¯æŒçš„æ–¹æ³•&lt;/li>
&lt;li>CORSé¢„æ£€è¯·æ±‚ä½¿ç”¨&lt;/li>
&lt;/ul>
&lt;h5 id="23-å…³é”®è¯·æ±‚å¤´">2.3 å…³é”®è¯·æ±‚å¤´
&lt;/h5>&lt;p>&lt;strong>Host&lt;/strong>ï¼šå¿…éœ€ï¼ŒæŒ‡å®šç›®æ ‡ä¸»æœº&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Host: www.example.com:8080
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>User-Agent&lt;/strong>ï¼šå®¢æˆ·ç«¯ä¿¡æ¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Acceptç³»åˆ—&lt;/strong>ï¼šå†…å®¹åå•†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Accept: text/html,application/json
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Accept-Encoding: gzip, deflate, br
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Authoriation&lt;/strong>ï¼šè®¤è¯ä¿¡æ¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Cookie&lt;/strong>ï¼šä¼šè¯æ ‡è¯†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Cookie: session_id=abc123; user_pref=dark_mode
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä¸‰-httpå“åº”ç»“æ„">ä¸‰ã€ HTTPå“åº”ç»“æ„
&lt;/h4>&lt;h5 id="31-å“åº”ç»„æˆ">3.1 å“åº”ç»„æˆ
&lt;/h5>&lt;pre tabindex="0">&lt;code>çŠ¶æ€è¡Œ (Status Line)
å“åº”å¤´ (Headers)
ç©ºè¡Œ
å“åº”ä½“ (Body)
&lt;/code>&lt;/pre>&lt;p>ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Type&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">application/json&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Length&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">348&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Cache-Control&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">max-age=3600&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Set-Cookie&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">session_id=xyz789; HttpOnly; Secure&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{&lt;span style="color:#f92672">&amp;#34;status&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;success&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;#34;data&amp;#34;&lt;/span>: {&lt;span style="color:#960050;background-color:#1e0010">...&lt;/span>}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="32-çŠ¶æ€ç æ·±åº¦è§£æ">3.2 çŠ¶æ€ç æ·±åº¦è§£æ
&lt;/h5>&lt;p>&lt;strong>1xx&lt;/strong>ä¿¡æ¯æ€§å“åº”&lt;/p>
&lt;ul>
&lt;li>&lt;code>100 Continue&lt;/code>ï¼šå®¢æˆ·ç«¯ç»§ç»­å‘é€è¯·æ±‚ä½“&lt;/li>
&lt;li>&lt;code>101 Switching Protocols&lt;/code>ï¼šåˆ‡æ¢åè®®ï¼ˆå¦‚WebSocketï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>2xx&lt;/strong>æˆåŠŸ&lt;/p>
&lt;ul>
&lt;li>&lt;code>200 OK&lt;/code>ï¼šè¯·æ±‚æˆåŠŸ&lt;/li>
&lt;li>&lt;code>201 Created&lt;/code>ï¼šèµ„æºå·²åˆ›å»º&lt;/li>
&lt;li>&lt;code>204 No Content&lt;/code>ï¼š æˆåŠŸä½†æ— å“åº”ä½“&lt;/li>
&lt;li>&lt;code>206 Partial Content&lt;/code>ï¼šèŒƒå›´è¯·æ±‚æˆåŠŸ&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>3xx&lt;/strong>é‡å®šå‘&lt;/p>
&lt;ul>
&lt;li>&lt;code>301 Moved Permanently&lt;/code>ï¼šæ°¸ä¹…é‡å®šå‘ï¼Œä¼šæ”¹å˜åç»­è¯·æ±‚æ–¹æ³•ä¸ºGET&lt;/li>
&lt;li>&lt;code>302 Found&lt;/code>ï¼šä¸´æ—¶é‡å®šå‘&lt;/li>
&lt;li>&lt;code>303 See Other&lt;/code>ï¼šä½¿ç”¨GETæ–¹æ³•é‡å®šå‘&lt;/li>
&lt;li>&lt;code>304 Not Modified&lt;/code>ï¼šèµ„æºæœªä¿®æ”¹ï¼Œä½¿ç”¨ç¼“å­˜&lt;/li>
&lt;li>&lt;code>307 Temporary Redirect&lt;/code>ï¼šä¸´æ—¶é‡å®šå‘ï¼Œä¿æŒè¯·æ±‚æ–¹æ³•&lt;/li>
&lt;li>&lt;code>308 Permanent Redirect&lt;/code>ï¼šæ°¸ä¹…é‡å®šå‘ï¼Œä¿æŒè¯·æ±‚æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>4xx&lt;/strong>å®¢æˆ·ç«¯é”™è¯¯&lt;/p>
&lt;ul>
&lt;li>&lt;code>400 Bad Request&lt;/code>ï¼šè¯·æ±‚è¯­æ³•é”™è¯¯&lt;/li>
&lt;li>&lt;code>401 Unathorized&lt;/code>ï¼šéœ€è¦è®¤è¯&lt;/li>
&lt;li>&lt;code>403 Fobidden&lt;/code>ï¼šæ‹’ç»è®¿é—®&lt;/li>
&lt;li>&lt;code>404 Not Found&lt;/code>ï¼šèµ„æºä¸å­˜åœ¨&lt;/li>
&lt;li>&lt;code>405 Method Not Allowed&lt;/code>ï¼šæ–¹æ³•ä¸å…è®¸&lt;/li>
&lt;li>&lt;code>409 Conflict&lt;/code>ï¼šè¯·æ±‚å†²çª&lt;/li>
&lt;li>&lt;code>429 Too Many Requests&lt;/code>ï¼šè¯·æ±‚è¿‡å¤š&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>5xx&lt;/strong>æœåŠ¡å™¨é”™è¯¯&lt;/p>
&lt;ul>
&lt;li>&lt;code>500 Internal Server Error&lt;/code>ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯&lt;/li>
&lt;li>&lt;code>502 Bad Gateway&lt;/code>ï¼šç½‘å…³é”™è¯¯&lt;/li>
&lt;li>&lt;code>503 Service Unavailable&lt;/code>ï¼šæœåŠ¡ä¸å¯ç”¨&lt;/li>
&lt;li>&lt;code>504 Gateway Timeout&lt;/code>ï¼šç½‘å…³è¶…æ—¶&lt;/li>
&lt;/ul>
&lt;h5 id="33-å…³é”®å“åº”å¤´">3.3 å…³é”®å“åº”å¤´
&lt;/h5>&lt;p>&lt;strong>Content-Type&lt;/strong>ï¼šå“åº”ä½“ç±»å‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Content-Type: application/json; charset=utf-8
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Content-Type: text/html; charset=utf-8
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Set-Cookie&lt;/strong>ï¼šè®¾ç½®Cookie&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Set-Cookie: session_id=abc123; Path=/; HttpOnly; Secure; SameSite=Strict; Max-Age=3600
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Cache-Control&lt;/strong>ï¼šç¼“å­˜ç­–ç•¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Cache-Control: no-cache, no-store, must-revalidate
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Cache-Control: public, max-age=31536000
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å››httpè¿æ¥ç®¡ç†">å››ã€HTTPè¿æ¥ç®¡ç†
&lt;/h4>&lt;h5 id="41-æŒä¹…è¿æ¥keep-alive">4.1 æŒä¹…è¿æ¥(Keep-Alive)
&lt;/h5>&lt;p>HTTP/1.0: é»˜è®¤çŸ­è¿æ¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Connection: Keep-Alive
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>HTTP/1.1: é»˜è®¤æŒä¹…è¿æ¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Connection: close # æ˜ç¡®å…³é—­
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ä¼˜åŠ¿&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡å°‘ TCP æ¡æ‰‹å¼€é”€&lt;/li>
&lt;li>é™ä½å»¶è¿Ÿ&lt;/li>
&lt;li>å‡è½»æœåŠ¡å™¨è´Ÿæ‹…&lt;/li>
&lt;/ul>
&lt;h5 id="42-ç®¡é“åŒ–pipelining">4.2 ç®¡é“åŒ–ï¼ˆPipeliningï¼‰
&lt;/h5>&lt;ul>
&lt;li>HTTP/1.1 æ”¯æŒä½†å¾ˆå°‘ç”¨&lt;/li>
&lt;li>å¯ä»¥è¿ç»­å‘é€å¤šä¸ªè¯·æ±‚ï¼Œæ— éœ€ç­‰å¾…å“åº”&lt;/li>
&lt;li>å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜&lt;/li>
&lt;/ul>
&lt;h5 id="43-http2-å¤šè·¯å¤ç”¨">4.3 HTTP/2 å¤šè·¯å¤ç”¨
&lt;/h5>&lt;pre tabindex="0">&lt;code>å•ä¸ª TCP è¿æ¥
â”œâ”€ Stream 1: /index.html
â”œâ”€ Stream 2: /style.css
â”œâ”€ Stream 3: /script.js
â””â”€ Stream 4: /api/data
&lt;/code>&lt;/pre>&lt;p>&lt;strong>ç‰¹æ€§:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>äºŒè¿›åˆ¶åˆ†å¸§&lt;/li>
&lt;li>è¯·æ±‚/å“åº”å¹¶è¡Œ&lt;/li>
&lt;li>æœåŠ¡å™¨æ¨é€&lt;/li>
&lt;li>å¤´éƒ¨å‹ç¼©(HPACK)&lt;/li>
&lt;/ul>
&lt;h4 id="äº”ç¼“å­˜æœºåˆ¶æ·±å…¥">äº”ã€ç¼“å­˜æœºåˆ¶æ·±å…¥
&lt;/h4>&lt;h5 id="51-å¼ºç¼“å­˜">5.1 å¼ºç¼“å­˜
&lt;/h5>&lt;p>&lt;strong>Expires&lt;/strong>(HTTP/1.0)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Expires: Wed, 21 Oct 2025 07:28:00 GMT
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Cache-Control&lt;/strong>(HTTP/1.1,ä¼˜å…ˆçº§æ›´é«˜)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Cache-Control: max-age=3600
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Cache-Control: public, max-age=31536000, immutable
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŒ‡ä»¤è¯¦è§£ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>public&lt;/code>: å¯è¢«ä»»ä½•ç¼“å­˜å­˜å‚¨&lt;/li>
&lt;li>&lt;code>private&lt;/code>ï¼šåªèƒ½è¢«æµè§ˆå™¨ç¼“å­˜&lt;/li>
&lt;li>&lt;code>no-cache&lt;/code>ï¼šå¿…é¡»éªŒè¯åæ‰èƒ½ä½¿ç”¨&lt;/li>
&lt;li>&lt;code>no-store&lt;/code>ï¼šä¸å¾—ç¼“å­˜&lt;/li>
&lt;li>&lt;code>max-age=N&lt;/code>ï¼šç¼“å­˜Nç§’&lt;/li>
&lt;li>&lt;code>s-maxage=N&lt;/code>: ä»£ç†æœåŠ¡å™¨ç¼“å­˜Nç§’&lt;/li>
&lt;li>&lt;code>immutable&lt;/code>ï¼šèµ„æºæ°¸ä¸æ”¹å˜&lt;/li>
&lt;/ul>
&lt;h5 id="52-åå•†ç¼“å­˜">5.2 åå•†ç¼“å­˜
&lt;/h5>&lt;p>&lt;strong>Last-Modified/ If-Modified-Since&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># é¦–æ¬¡å“åº”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Last-Modified: Wed, 21 Oct 2024 07:28:00 GMT
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># å†æ¬¡è¯·æ±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">If-Modified-Since: Wed, 21 Oct 2024 07:28:00 GMT
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># æœªä¿®æ”¹è¿”å›
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span> &lt;span style="color:#ae81ff">304&lt;/span> &lt;span style="color:#a6e22e">Not Modified&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ETag/ If-None-Match&lt;/strong>(æ›´ç²¾ç¡®)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># é¦–æ¬¡å“åº”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">ETag: &amp;#34;33a64df551425fcc55e4d42a148795d9f25f89d4&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># å†æ¬¡è¯·æ±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">If-None-Match: &amp;#34;33a64df551425fcc55e4d42a148795d9f25f89d4&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># æœªä¿®æ”¹è¿”å›
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span> &lt;span style="color:#ae81ff">304&lt;/span> &lt;span style="color:#a6e22e">Not Modified&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="53-ç¼“å­˜ç­–ç•¥">5.3 ç¼“å­˜ç­–ç•¥
&lt;/h5>&lt;p>å¼ºç¼“å­˜ä¼˜å…ˆç­–ç•¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Cache-Control: public, max-age=31536000, immutable
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åå•†ç¼“å­˜ç­–ç•¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Cache-Control: no-cache
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">ETag: &amp;#34;version-123&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ç¼“å­˜ç­–ç•¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Cache-Control: no-store, no-cache, must-revalidate
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Pragma: no-cache
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å…­å®‰å…¨ç›¸å…³">å…­ã€å®‰å…¨ç›¸å…³
&lt;/h4>&lt;h5 id="61-httpsåŸç†">6.1 HTTPSåŸç†
&lt;/h5>&lt;p>&lt;strong>TLS/SSL&lt;/strong>æ¡æ‰‹è¿‡ç¨‹ï¼š&lt;/p>
&lt;ol>
&lt;li>å®¢æˆ·ç«¯å‘é€æ”¯æŒçš„åŠ å¯†å¥—ä»¶&lt;/li>
&lt;li>æœåŠ¡å™¨é€‰æ‹©åŠ å¯†å¥—ä»¶ï¼Œå‘é€è¯ä¹¦&lt;/li>
&lt;li>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦ï¼Œç”Ÿæˆé¢„ä¸»å¯†é’¥&lt;/li>
&lt;li>åŒæ–¹åå•†ä¼šè¯å¯†é’¥&lt;/li>
&lt;li>ä½¿ç”¨å¯¹ç§°åŠ å¯†é€šä¿¡&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>å¯¹ç§°åŠ å¯† + éå¯¹ç§°åŠ å¯†æ··åˆï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>éå¯¹ç§°åŠ å¯†äº¤æ¢å¯†é’¥ï¼ˆæ…¢ä½†å®‰å…¨ï¼‰&lt;/li>
&lt;li>å¯¹ç§°åŠ å¯†ä¼ è¾“æ•°æ®ï¼ˆå¿«ï¼‰&lt;/li>
&lt;/ul>
&lt;h5 id="62-cookieå®‰å…¨">6.2 Cookieå®‰å…¨
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Set-Cookie: session=abc;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"> HttpOnly; # é˜²æ­¢ XSS æ”»å‡»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"> Secure; # åªé€šè¿‡ HTTPS ä¼ è¾“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"> SameSite=Strict; # é˜²æ­¢ CSRF æ”»å‡»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"> Domain=.example.com;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"> Path=/;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"> Max-Age=3600
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>SameSite&lt;/strong>å±æ€§:&lt;/p>
&lt;ul>
&lt;li>Strict: å®Œå…¨ç¦æ­¢è·¨ç«™å‘é€&lt;/li>
&lt;li>Laxï¼šGETè¯·æ±‚å¯è·¨ç«™å‘é€&lt;/li>
&lt;li>Noneï¼šå…è®¸è·¨ç«™ï¼ˆéœ€é…åˆSecureï¼‰&lt;/li>
&lt;/ul>
&lt;h5 id="63-å®‰å…¨å“åº”å¤´">6.3 å®‰å…¨å“åº”å¤´
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># é˜²æ­¢ç‚¹å‡»åŠ«æŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">X-Frame-Options: DENY
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># å†…å®¹ç±»å‹å—…æ¢ä¿æŠ¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">X-Content-Type-Options: nosniff
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># XSS ä¿æŠ¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">X-XSS-Protection: 1; mode=block
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># å†…å®¹å®‰å…¨ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Content-Security-Policy: default-src &amp;#39;self&amp;#39;; script-src &amp;#39;self&amp;#39; &amp;#39;unsafe-inline&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># HTTPS å¼ºåˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Strict-Transport-Security: max-age=31536000; includeSubDomains
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä¸ƒæ€§èƒ½ä¼˜åŒ–">ä¸ƒã€æ€§èƒ½ä¼˜åŒ–
&lt;/h4>&lt;h5 id="71-å†…å®¹ç¼–ç ">7.1 å†…å®¹ç¼–ç 
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># è¯·æ±‚æ”¯æŒçš„ç¼–ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Accept-Encoding: gzip, deflate, br
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># å“åº”ä½¿ç”¨çš„ç¼–ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Content-Encoding: gzip
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‹ç¼©ç‡å¯¹æ¯”ï¼š&lt;/p>
&lt;ul>
&lt;li>gzip: 70-90%&lt;/li>
&lt;li>Brotli(br): 75-95%(æ›´ä¼˜)&lt;/li>
&lt;/ul>
&lt;h5 id="72-èŒƒå›´è¯·æ±‚æ–­ç‚¹ç»­ä¼ ">7.2 èŒƒå›´è¯·æ±‚ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># è¯·æ±‚éƒ¨åˆ†å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Range: bytes=0-1023
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># å“åº”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span> &lt;span style="color:#ae81ff">206&lt;/span> &lt;span style="color:#a6e22e">Partial Content&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Range&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">bytes 0-1023/10240&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Length&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">1024&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="73-æ¡ä»¶è¯·æ±‚">7.3 æ¡ä»¶è¯·æ±‚
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># åªåœ¨èµ„æºæœªä¿®æ”¹æ—¶æ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">If-Unmodified-Since: Wed, 21 Oct 2024 07:28:00 GMT
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">If-Match: &amp;#34;etag-value&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å…«corsè·¨åŸŸ">å…«ã€CORSè·¨åŸŸ
&lt;/h4>&lt;h5 id="81-ç®€å•è¯·æ±‚">8.1 ç®€å•è¯·æ±‚
&lt;/h5>&lt;p>æ»¡è¶³æ¡ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>æ–¹æ³•ï¼šGETï¼ŒHEADï¼ŒPOST&lt;/li>
&lt;li>å¤´éƒ¨ï¼šAccept, Accept-Language, Content-Language, Content-Type&lt;/li>
&lt;li>Content-Type: text/plain, multipart/form-data, application/x-www-form-urlencoded&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># è¯·æ±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Origin: https://example.com
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># å“åº”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Access-Control-Allow-Origin: https://example.com
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Access-Control-Allow-Credentials: true
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="82-é¢„æ£€è¯·æ±‚">8.2 é¢„æ£€è¯·æ±‚
&lt;/h5>&lt;p>å¤æ‚è¯·æ±‚éœ€è¦å…ˆå‘é€OPTIONSï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"># é¢„æ£€è¯·æ±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#a6e22e">OPTIONS&lt;/span> /api/data &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Origin&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">https://example.com&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Access-Control-Request-Method&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">PUT&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Access-Control-Request-Headers&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">Content-Type, X-Custom-Header&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span># é¢„æ£€å“åº”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HTTP/1.1 204 No Content
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Access-Control-Allow-Origin: https://example.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Access-Control-Allow-Methods: GET, POST, PUT, DELETE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Access-Control-Allow-Headers: Content-Type, X-Custom-Header
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Access-Control-Max-Age: 86400
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä¹http3-ä¸quic">ä¹ã€HTTP/3 ä¸QUIC
&lt;/h4>&lt;h5 id="91-æ ¸å¿ƒæ”¹è¿›">9.1 æ ¸å¿ƒæ”¹è¿›
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>åŸºäºUDP&lt;/strong>ï¼šé¿å…TCPé˜Ÿå¤´é˜»å¡&lt;/li>
&lt;li>&lt;strong>0-RTT&lt;/strong>ï¼šé¦–æ¬¡è¿æ¥åï¼Œåç»­è¿æ¥æ— éœ€æ¡æ‰‹&lt;/li>
&lt;li>&lt;strong>è¿æ¥è¿ç§»&lt;/strong>ï¼šIPå˜åŒ–ä¸å½±å“è¿æ¥&lt;/li>
&lt;li>&lt;strong>å†…ç½®åŠ å¯†&lt;/strong>ï¼šå¼ºåˆ¶ TLS 1.3&lt;/li>
&lt;/ul>
&lt;h5 id="92-æ€§èƒ½å¯¹æ¯”">9.2 æ€§èƒ½å¯¹æ¯”
&lt;/h5>&lt;pre tabindex="0">&lt;code>HTTP/1.1: å¤šä¸ª TCP è¿æ¥,é˜Ÿå¤´é˜»å¡
HTTP/2: å•ä¸ª TCP è¿æ¥,TCP å±‚é˜Ÿå¤´é˜»å¡
HTTP/3: QUIC,æ— é˜Ÿå¤´é˜»å¡,è¿æ¥è¿ç§»
&lt;/code>&lt;/pre>&lt;h4 id="åå®è·µå»ºè®®">åã€å®è·µå»ºè®®
&lt;/h4>&lt;h5 id="101-api-è®¾è®¡">10.1 API è®¾è®¡
&lt;/h5>&lt;ul>
&lt;li>ä½¿ç”¨åˆé€‚çš„ HTTP æ–¹æ³•&lt;/li>
&lt;li>è¿”å›æ­£ç¡®çš„çŠ¶æ€ç &lt;/li>
&lt;li>è®¾è®¡æ¸…æ™°çš„ URL ç»“æ„&lt;/li>
&lt;li>å®ç°å¹‚ç­‰æ€§&lt;/li>
&lt;/ul>
&lt;h5 id="102-æ€§èƒ½ä¼˜åŒ–">10.2 æ€§èƒ½ä¼˜åŒ–
&lt;/h5>&lt;ul>
&lt;li>å¯ç”¨ HTTP/2 æˆ– HTTP/3&lt;/li>
&lt;li>ä½¿ç”¨ CDN å’Œç¼“å­˜ç­–ç•¥&lt;/li>
&lt;li>å‹ç¼©å“åº”å†…å®¹&lt;/li>
&lt;li>å‡å°‘è¯·æ±‚æ•°é‡&lt;/li>
&lt;/ul>
&lt;h5 id="103-å®‰å…¨æªæ–½">10.3 å®‰å…¨æªæ–½
&lt;/h5>&lt;ul>
&lt;li>ä½¿ç”¨ HTTPS&lt;/li>
&lt;li>è®¾ç½®å®‰å…¨å“åº”å¤´&lt;/li>
&lt;li>å®ç°é€Ÿç‡é™åˆ¶&lt;/li>
&lt;li>éªŒè¯è¾“å…¥æ•°æ®&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="å±‚æ¬¡åä½œ">å±‚æ¬¡åä½œ
&lt;/h4>&lt;pre tabindex="0">&lt;code>åº”ç”¨å±‚: HTTP å®šä¹‰å†…å®¹å’Œæ ¼å¼
â†“
&amp;#34;GET /index.html HTTP/1.1\r\nHost: example.com\r\n\r\n&amp;#34;
â†“
ä¼ è¾“å±‚: TCP è´Ÿè´£å¯é ä¼ è¾“
â†“
[åˆ†æ®µ] â†’ [åŠ åºåˆ—å·] â†’ [ç¡®è®¤æœºåˆ¶] â†’ [é‡ä¼ æœºåˆ¶]
â†“
ç½‘ç»œå±‚: IP è´Ÿè´£å¯»å€å’Œè·¯ç”±
â†“
[æ·»åŠ  IP åœ°å€] â†’ [é€‰æ‹©è·¯å¾„]
â†“
é“¾è·¯å±‚: ä»¥å¤ªç½‘/WiFi è´Ÿè´£å®é™…ä¼ è¾“
â†“
[è½¬æ¢æˆç”µä¿¡å·/æ— çº¿ä¿¡å·]
&lt;/code>&lt;/pre>&lt;p>&lt;strong>TCP&lt;/strong> æ˜¯ä¼ è¾“ç®¡é“(è´Ÿè´£æ€ä¹ˆé€),&lt;strong>HTTP&lt;/strong> æ˜¯ç®¡é“é‡Œçš„å†…å®¹è§„èŒƒ(è§„å®šé€ä»€ä¹ˆå’Œä»€ä¹ˆæ ¼å¼)&lt;/p>
&lt;h4 id="osiä¸ƒå±‚æ¨¡å‹-vs-tcpipå››å±‚æ¨¡å‹">OSIä¸ƒå±‚æ¨¡å‹ vs TCP/IPå››å±‚æ¨¡å‹
&lt;/h4>&lt;pre tabindex="0">&lt;code>OSI ä¸ƒå±‚æ¨¡å‹ TCP/IP å››å±‚æ¨¡å‹ å®é™…åè®®ç¤ºä¾‹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. åº”ç”¨å±‚ â”‚ â”‚ â”‚ HTTP, FTP, SMTP, DNS
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚ 6. è¡¨ç¤ºå±‚ â”‚ â”‚ åº”ç”¨å±‚ â”‚ SSL/TLS, JPEG, MPEG
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚ 5. ä¼šè¯å±‚ â”‚ â”‚ â”‚ NetBIOS, RPC
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. ä¼ è¾“å±‚ â”‚ â”‚ ä¼ è¾“å±‚ â”‚ TCP, UDP
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. ç½‘ç»œå±‚ â”‚ â”‚ ç½‘ç»œå±‚ â”‚ IP, ICMP, ARP
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. æ•°æ®é“¾è·¯å±‚â”‚ â”‚ â”‚ Ethernet, WiFi, PPP
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ é“¾è·¯å±‚ â”‚
â”‚ 1. ç‰©ç†å±‚ â”‚ â”‚ â”‚ ç½‘çº¿, å…‰çº¤, æ— çº¿ç”µæ³¢
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code>&lt;/pre>&lt;p>&lt;strong>è¯´æ˜&lt;/strong>ï¼šOSI æ˜¯ç†è®ºæ¨¡å‹ï¼ŒTCP/IP æ˜¯å®é™…åº”ç”¨çš„æ¨¡å‹&lt;/p></description></item><item><title>Composeå…¥é—¨</title><link>https://www.dust-zed.site/android-develop/compose%E5%85%A5%E9%97%A8/</link><pubDate>Sat, 25 Oct 2025 19:52:44 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/compose%E5%85%A5%E9%97%A8/</guid><description>&lt;h4 id="å¤§çº²">å¤§çº²
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>å£°æ˜å¼UI&lt;/strong>ï¼šåªéœ€è¦æè¿°åœ¨ç‰¹å®šçŠ¶æ€ä¸‹UIåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼ŒComposeæ¡†æ¶ä¼šè´Ÿè´£æ›´æ–°ã€‚&lt;/li>
&lt;li>&lt;strong>ç»„åˆä¸å¤ç”¨&lt;/strong>ï¼šå°†UIæ‹†åˆ†æˆå°è€Œä¸“ä¸€çš„Composableå‡½æ•°ï¼Œç„¶ååƒæ­ç§¯æœ¨ä¸€æ ·ç»„åˆå®ƒä»¬ã€‚&lt;/li>
&lt;li>&lt;strong>å•å‘æ•°æ®æµ&lt;/strong>ï¼šçŠ¶æ€ä»&lt;code>ViewModel&lt;/code>å‘ä¸‹æµåŠ¨åˆ°Composableï¼Œäº‹ä»¶ä»Composableå‘ä¸Šä¼ é€’ç»™&lt;code>ViewModel&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;strong>å‰¯ä½œç”¨å¤„ç†&lt;/strong>ï¼šä½¿ç”¨&lt;code>LaunchedEffect&lt;/code>ç­‰APIæ¥å®‰å…¨åœ°å¤„ç†éœ€è¦åœ¨Composableç”Ÿå‘½å‘¨æœŸå†…æ‰§è¡Œçš„&lt;strong>éUI&lt;/strong>æ“ä½œã€‚&lt;/li>
&lt;/ol>
&lt;h4 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ
&lt;/h4>&lt;h5 id="ç»„åˆä¸é‡ç»„">ç»„åˆä¸é‡ç»„
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>ç»„åˆ(Composition)&lt;/strong>ï¼šè¿™æ˜¯Composeç¬¬ä¸€æ¬¡æ„å»ºUIçš„è¿‡ç¨‹ã€‚å½“ä½ è°ƒç”¨ä¸€ä¸ªComposableå‡½æ•°æ—¶ï¼ŒComposeæ¡†æ¶ä¼šæ‰§è¡Œå®ƒï¼ŒæŠŠå®ƒæè¿°çš„UIå…ƒç´ ï¼ˆå¦‚&lt;code>Text&lt;/code>,&lt;code>Button&lt;/code>,&lt;code>Box&lt;/code>ç­‰ï¼‰æ·»åŠ åˆ°UIæ ‘ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹åªä¼šå‘ç”Ÿä¸€æ¬¡ã€‚&lt;/li>
&lt;li>&lt;strong>é‡ç»„(Recomposition)&lt;/strong>ï¼šè¿™æ˜¯Composeæ›´æ–°UIçš„è¿‡ç¨‹ã€‚å½“ä¸€ä¸ªComposableå‡½æ•°æ‰€ä¾èµ–çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒComposeä¸ä¼šé‡æ–°æ„å»ºæ•´ä¸ªå±å¹•ï¼Œè€Œæ˜¯æ™ºèƒ½åœ°ã€æœ‰é€‰æ‹©æ€§åœ°å†æ¬¡è°ƒç”¨è¿™ä¸ªComposableå‡½æ•°ï¼ˆä»¥åŠå…¶ä»–ä¾èµ–äº†ç›¸åŒæ•°æ®çš„å‡½æ•°ï¼‰ï¼Œç”¨æ–°çš„æ•°æ®æ¥æ›´æ–°UIæ ‘ä¸­å¯¹åº”çš„éƒ¨åˆ†ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½å‘ç”Ÿå¤šæ¬¡ï¼Œç”šè‡³éå¸¸é¢‘ç¹ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æ ¸å¿ƒæ€æƒ³&lt;/strong>ï¼šä½ åªéœ€è¦ç”¨ä»£ç å£°æ˜åœ¨æŸä¸ªæ•°æ®çŠ¶æ€ä¸‹ï¼Œä½ çš„UIåº”è¯¥é•¿ä»€ä¹ˆæ ·ã€‚å½“æ•°æ®å˜åŒ–æ—¶ï¼ŒComposeæ¡†æ¶ä¼šè‡ªåŠ¨å¸®ä½ å®Œæˆä»æ—§UIåˆ°æ–°UIçš„è½¬æ¢ï¼Œä¸éœ€è¦æ‰‹åŠ¨å»æŸ¥æ‰¾å¹¶æ›´æ–°æŸä¸ª&lt;code>TextView&lt;/code>æˆ–&lt;code>ImageView&lt;/code>ã€‚&lt;/p>
&lt;h5 id="çŠ¶æ€state">çŠ¶æ€ï¼ˆStateï¼‰
&lt;/h5>&lt;p>åœ¨Composeä¸­ï¼Œ&lt;strong>State&lt;/strong>å°±æ˜¯ä»»ä½•ä¼šéšæ—¶é—´å˜åŒ–å¹¶ä¸”ä¼šå½±å“&lt;strong>UI&lt;/strong>çš„å€¼ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>State&amp;lt;T&amp;gt;&lt;/code>å’Œ&lt;code>MutableState&amp;lt;T&amp;gt;&lt;/code>&lt;/li>
&lt;/ul>
&lt;h5 id="remember">remember
&lt;/h5>&lt;p>åœ¨å¤šæ¬¡é‡ç»„ä¹‹é—´ä¿æŒComposableå†…éƒ¨çŠ¶æ€æˆ–å¯¹è±¡çš„å…³é”®æœºåˆ¶ã€‚æ²¡æœ‰å®ƒï¼Œæ¯æ¬¡é‡ç»„éƒ½ä¼šå¯¼è‡´å±€éƒ¨å˜é‡è¢«é‡ç½®ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>remember&lt;/code>çš„ä½œç”¨æ˜¯è®©ä¸€ä¸ªå¯¹è±¡ï¼ˆä»»ä½•å¯¹è±¡ï¼‰åœ¨å¤šæ¬¡é‡ç»„ä¹‹é—´æ´»ä¸‹æ¥ã€‚&lt;/li>
&lt;li>&lt;code>State&lt;/code>çš„ä½œç”¨æ˜¯å½“å®ƒçš„å€¼æ”¹å˜æ—¶ï¼Œé€šçŸ¥Composeè¿›è¡Œé‡ç»„ã€‚&lt;/li>
&lt;/ul>
&lt;p>rememberå’ŒStateæ˜¯ä¸€å¯¹é»„é‡‘æ­æ¡£ï¼Œå…±åŒè§£å†³äº†â€œUIå†…éƒ¨çŠ¶æ€â€çš„é—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>æˆ‘éœ€è¦ä¸€ä¸ªå˜é‡æ¥å­˜å‚¨UIçš„çŠ¶æ€(ä¾‹å¦‚ï¼Œä¸€ä¸ªè®¡æ•°å™¨ï¼Œä¸€ä¸ªå¤é€‰æ¡†æ˜¯å¦è¢«é€‰ä¸­)ã€‚&lt;/li>
&lt;li>è¿™ä¸ªå˜é‡å¿…é¡»èƒ½åœ¨å¤šæ¬¡é‡ç»„ä¸­ä¿æŒä»–çš„å€¼ä¸è¢«é‡ç½® -&amp;gt; æ‰€ä»¥ç”¨&lt;code>remember&lt;/code>ã€‚&lt;/li>
&lt;li>å½“è¿™ä¸ªå˜é‡çš„å€¼æ”¹å˜æ—¶ï¼ŒUIå¿…é¡»è‡ªåŠ¨æ›´æ–°ï¼ˆå³é‡ç»„ï¼‰-&amp;gt; æ‰€ä»¥ç”¨&lt;code>State&lt;/code>ã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;code>remember&lt;/code>æ˜¯ä¸ºäº†â€œè®°å¿†â€ï¼šè®©å˜é‡/å¯¹è±¡åœ¨é‡ç»„ä¸­å¹¸å­˜ã€‚&lt;/li>
&lt;li>&lt;code>State&lt;/code>æ˜¯ä¸ºäº†â€œé€šçŸ¥â€ï¼šè®©å€¼çš„å˜åŒ–èƒ½è§¦å‘é‡ç»„ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="é‡ç»„è§¦å‘æœºåˆ¶">é‡ç»„è§¦å‘æœºåˆ¶
&lt;/h4>&lt;h5 id="1-åŸºäºstateçš„è®¢é˜…å¼é‡ç»„state-read-based-recomposition">1. åŸºäºStateçš„è®¢é˜…å¼é‡ç»„ï¼ˆState-Read-based-Recompositionï¼‰
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>æ³¨å†Œ/è®¢é˜…&lt;/strong>ï¼šå½“ä¸€ä¸ªComposableå‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¯»å–(Read)äº†ä¸€ä¸ª&lt;code>State&lt;/code>å¯¹è±¡çš„å€¼ï¼ŒComposeå°±ä¼šåœ¨è¿™ä¸ªå‡½æ•°å’Œè¿™ä¸ª&lt;code>State&lt;/code>å¯¹è±¡ä¹‹é—´å»ºç«‹ä¸€ä¸ªéšè—çš„è®¢é˜…å…³ç³»ã€‚&lt;/li>
&lt;li>&lt;strong>å˜åŒ–é€šçŸ¥&lt;/strong>ï¼šå½“è¿™ä¸ª&lt;code>State&lt;/code>å¯¹è±¡çš„å€¼è¢«å†™å…¥(write)ä¸€ä¸ªæ–°å€¼æ—¶ï¼Œå®ƒä¼šåƒä¸€ä¸ªå‘å¸ƒè€…ä¸€æ ·ï¼Œé€šçŸ¥æ‰€æœ‰è®¢é˜…äº†å®ƒçš„Composable: â€œæˆ‘çš„å€¼å˜äº†!â€&lt;/li>
&lt;li>&lt;strong>ç²¾ç¡®é‡ç»„&lt;/strong>ï¼šæ”¶åˆ°é€šçŸ¥çš„Composableä¼šæ ‡è®°ä¸ºâ€œéœ€è¦é‡ç»„â€ï¼ŒComposeä¼šåœ¨ä¸‹ä¸€å¸§é«˜æ•ˆåœ°æ›´æ–°å®ƒä»¬ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä¼˜ç‚¹&lt;/strong>ï¼šéå¸¸ç²¾ç¡®å’Œé«˜æ•ˆã€‚åªæœ‰ç›´æ¥è¯»å–äº†è¿™ä¸ªStateçš„Composableæ‰ä¼šè¢«é‡ç»„ã€‚&lt;/p>
&lt;h5 id="2-åŸºäºå‡½æ•°è°ƒç”¨ä¸å‚æ•°å˜åŒ–çš„é‡ç»„function-call-with-parameter-change-recomposition">2. åŸºäºâ€œå‡½æ•°è°ƒç”¨ä¸å‚æ•°å˜åŒ–â€çš„é‡ç»„ï¼ˆFunction-Call-with-Parameter-Change Recompositionï¼‰
&lt;/h5>&lt;p>å½“ä¸€ä¸ªçˆ¶Composableå‘ç”Ÿé‡ç»„æ—¶ï¼Œå®ƒä¼šé‡æ–°æ‰§è¡Œå…¶å‡½æ•°ä½“å†…çš„ä»£ç ã€‚å¦‚æœå‡½æ•°ä½“å†…åŒ…å«äº†å¯¹å­Composableçš„è°ƒç”¨ï¼ˆæ¯”å¦‚&lt;code>Greeting(name)&lt;/code>ï¼‰ï¼Œé‚£ä¹ˆComposeå°±ä¼šæ‰§è¡Œä¸€æ¬¡â€œå‰ç½®æ£€æŸ¥â€ï¼š&lt;/p>
&lt;ol>
&lt;li>å‚æ•°æ¯”è¾ƒï¼šComposeä¼šæ¯”è¾ƒè¿™æ¬¡è°ƒç”¨&lt;code>Greeting&lt;/code>æ—¶ä¼ å…¥çš„å‚æ•°(&lt;code>name&lt;/code>)å’Œä¸Šä¸€æ¬¡è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°ã€‚&lt;/li>
&lt;li>å†³ç­–ï¼š
&lt;ul>
&lt;li>å¦‚æœå‚æ•°æ²¡æœ‰å˜åŒ–ï¼ŒComposeå°±ä¼šè·³è¿‡(&lt;strong>Skip&lt;/strong>)&lt;code>Greeting&lt;/code>å‡½æ•°çš„æ‰§è¡Œï¼Œç›´æ¥å¤ç”¨ä¸Šæ¬¡çš„ç»“æœã€‚&lt;/li>
&lt;li>å¦‚æœå‚æ•°å‘ç”Ÿäº†å˜åŒ–ï¼ŒComposeå°±ä¼šæ‰§è¡Œ&lt;code>Greeting&lt;/code>å‡½æ•°ï¼Œç”¨æ–°çš„å‚æ•°æ¥ç”Ÿæˆæ–°çš„UIã€‚è¿™ä¸ªæ‰§è¡Œè¿‡ç¨‹ï¼Œå°±æ˜¯å­Composableçš„é‡ç»„ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ... åœ¨æœ‰çŠ¶æ€çš„ ForYouScreen ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æœºåˆ¶ 1 çš„å¼€å§‹ï¼šè®¢é˜… StateFlowï¼Œè½¬æ¢ä¸º State
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> feedState &lt;span style="color:#66d9ef">by&lt;/span> viewModel.feedState.collectAsStateWithLifecycle()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æœºåˆ¶ 2 çš„å¼€å§‹ï¼šå› ä¸º feedState å˜äº†ï¼Œæ‰€ä»¥å†æ¬¡è°ƒç”¨æ— çŠ¶æ€çš„ ForYouScreen
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>ForYouScreen(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> feedState = feedState, &lt;span style="color:#75715e">// &amp;lt;--- å‚æ•°å‘ç”Ÿå˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">..&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>&lt;code>ViewModel&lt;/code> ä¸­çš„ &lt;code>StateFlow&lt;/code> å‘å‡ºäº†ä¸€ä¸ªæ–°å€¼ã€‚&lt;/li>
&lt;li>&lt;code>collectAsStateWithLifecycle()&lt;/code> å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª &lt;code>State&lt;/code> å¯¹è±¡ï¼Œå¹¶æ›´æ–°äº†è¿™ä¸ª &lt;code>State&lt;/code> çš„å€¼ã€‚(æœºåˆ¶ 1 è§¦å‘)&lt;/li>
&lt;li>å› ä¸ºæœ‰çŠ¶æ€çš„ &lt;code>ForYouScreen&lt;/code> è¯»å–äº†è¿™ä¸ª &lt;code>State&lt;/code>ï¼Œæ‰€ä»¥å®ƒè¢«å®‰æ’é‡ç»„ã€‚&lt;/li>
&lt;li>æœ‰çŠ¶æ€çš„ &lt;code>ForYouScreen&lt;/code> é‡æ–°æ‰§è¡Œï¼Œå½“å®ƒè°ƒç”¨æ— çŠ¶æ€çš„ &lt;code>ForYouScreen&lt;/code> æ—¶ï¼Œä¼ å…¥çš„ &lt;code>feedState&lt;/code> å‚æ•°æ˜¯ä¸€ä¸ªå…¨æ–°çš„å€¼ã€‚(æœºåˆ¶ 2 è§¦å‘)&lt;/li>
&lt;li>æ— çŠ¶æ€çš„ &lt;code>ForYouScreen&lt;/code> æ£€æµ‹åˆ° &lt;code>feedState&lt;/code> å‚æ•°å˜åŒ–ï¼Œå› æ­¤å®ƒä¹Ÿå¿…é¡»é‡ç»„ï¼Œå¹¶æ ¹æ®æ–°çš„ &lt;code>feedState&lt;/code> æ›´æ–°å…¶å†…éƒ¨çš„ UIã€‚&lt;/li>
&lt;/ol>
&lt;h5 id="è¡¥å……æ™ºèƒ½é‡ç»„smart-recomposition">è¡¥å……ï¼šæ™ºèƒ½é‡ç»„(Smart Recomposition)
&lt;/h5>&lt;p>Composeèƒ½å¤Ÿè·³è¿‡(&lt;strong>Skip&lt;/strong>)é‚£äº›è¾“å…¥å‚æ•°æ²¡æœ‰å˜åŒ–çš„Composableå‡½æ•°çš„æ‰§è¡Œã€‚&lt;/p>
&lt;p>è¿™å¥—æœºåˆ¶ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸ºæ™ºèƒ½é‡ç»„(&lt;strong>Smart Recomposition&lt;/strong>)ã€‚å®ƒä¾èµ–ä¸¤ä¸ªåŸºæœ¬åŸåˆ™ï¼š&lt;/p>
&lt;ol>
&lt;li>ä½ç½®è®°å¿†ï¼šComposeä¸é å‡½æ•°åï¼Œè€Œæ˜¯é Composableåœ¨UIæ ‘ä¸­çš„â€œä½ç½®â€æ¥è¯†åˆ«å®ƒã€‚åœ¨é‡ç»„æ—¶ï¼Œå®ƒçŸ¥é“ä¸Šæ¬¡åœ¨åŒä¸€ä¸ªä½ç½®çš„æ˜¯å“ªä¸ªå‡½æ•°ã€‚&lt;/li>
&lt;li>è¾“å…¥å‚æ•°ç¨³å®šæ€§ï¼šåœ¨é‡ç»„æ—¶ï¼ŒComposeä¼šæ¯”è¾ƒä¸€ä¸ªComposableä¸Šä¸€æ¬¡è°ƒç”¨æ—¶çš„è¾“å…¥å‚æ•°å’Œè¿™ä¸€æ¬¡è°ƒç”¨çš„è¾“å…¥å‚æ•°ã€‚å¦‚æœæ‰€æœ‰å‚æ•°éƒ½æ²¡æœ‰å˜åŒ–ï¼ŒComposeå°±ä¼šå®Œå…¨è·³è¿‡è¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œï¼Œç›´æ¥å¤ç”¨å®ƒä¸Šæ¬¡ç”Ÿæˆçš„UIã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>ä»€ä¹ˆæ˜¯â€œç¨³å®šçš„â€(Stable)å‚æ•°&lt;/strong>&lt;/p>
&lt;p>Composeçš„è¿™ä¸ªSkipæœºåˆ¶ä¾èµ–äºèƒ½å¤Ÿå¯é åœ°åˆ¤æ–­å‚æ•°æ˜¯å¦â€œç›¸ç­‰â€ã€‚å¯¹äºä»¥ä¸‹ç±»å‹çš„å‚æ•°ï¼ŒComposeè®¤ä¸ºå®ƒä»¬æ˜¯ç¨³å®šçš„ï¼š&lt;/p>
&lt;ul>
&lt;li>åŸºæœ¬ç±»å‹ï¼š&lt;code>Int&lt;/code>,&lt;code>Float&lt;/code>,&lt;code>Boolean&lt;/code>,&lt;code>String&lt;/code>ç­‰ã€‚Composeå¯ä»¥è½»æ˜“åœ°é€šè¿‡&lt;code>==&lt;/code>æ¥åˆ¤æ–­å®ƒä»¬æ˜¯å¦ç›¸ç­‰ã€‚&lt;/li>
&lt;li>å‡½æ•°ç±»å‹ï¼šä¾‹å¦‚&lt;code>()-&amp;gt; Unit&lt;/code>ã€‚åªè¦ä»–ä»¬ä¸æ˜¯åœ¨æ¯æ¬¡é‡ç»„æ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„lambdaå®ä¾‹ï¼Œå®ƒä»¬å°±æ˜¯ç¨³å®šçš„&lt;/li>
&lt;li>è¢«&lt;code>@Stable&lt;/code>æˆ–&lt;code>@Immutable&lt;/code>æ³¨è§£çš„ç±»ï¼š&lt;code>data class&lt;/code>é»˜è®¤æ˜¯ç¨³å®šçš„ï¼Œå› ä¸ºå®ƒçš„&lt;code>equals&lt;/code>æ˜¯åŸºäºæ‰€æœ‰å±æ€§çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™äº›æ³¨è§£å‘Šè¯‰Composeä½ çš„ç±»æ˜¯ç¨³å®šçš„ã€‚å³ä½¿å®ƒä¸æ˜¯&lt;code>data class&lt;/code>ã€‚&lt;/li>
&lt;li>Composeçš„å†…ç½®ç±»å‹ï¼šå¦‚&lt;code>Modifier&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Stable&lt;/code>å‚æ•°æ„å‘³ç€Composeå¯ä»¥å®‰å…¨çš„é€šè¿‡æ¯”è¾ƒï¼ˆé€šå¸¸æ˜¯&lt;code>equals&lt;/code>ï¼‰æ¥ç¡®å®šå®ƒæ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œä»è€Œå†³å®šæ˜¯å¦Skipä½¿ç”¨å®ƒçš„Composableé‡ç»„ã€‚&lt;/p></description></item><item><title>Gradleæ„å»ºç»„ç»‡æ–¹å¼Convention Plugins</title><link>https://www.dust-zed.site/android-develop/gradle%E6%9E%84%E5%BB%BA%E7%BB%84%E7%BB%87%E6%96%B9%E5%BC%8Fconvention-plugins/</link><pubDate>Fri, 24 Oct 2025 03:52:15 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/gradle%E6%9E%84%E5%BB%BA%E7%BB%84%E7%BB%87%E6%96%B9%E5%BC%8Fconvention-plugins/</guid><description>&lt;h4 id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³
&lt;/h4>&lt;p>Convention Pluginsæ˜¯ä¸€ç§é€šè¿‡é¢„é…ç½®çš„Gradleæ’ä»¶æ¥&lt;strong>æ ‡å‡†åŒ–å’Œå¤ç”¨æ„å»ºé€»è¾‘&lt;/strong>çš„æ–¹æ³•ï¼Œæ ¸å¿ƒç†å¿µæ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>çº¦å®šä¼˜äºé…ç½® ï¼ˆConvention over Configurationï¼‰&lt;/li>
&lt;li>&lt;strong>DRY&lt;/strong>åŸåˆ™ï¼ˆDon&amp;rsquo;t Repeat Yourselfï¼‰&lt;/li>
&lt;li>æ„å»ºé€»è¾‘é›†ä¸­ç®¡ç†&lt;/li>
&lt;li>ç±»å‹å®‰å…¨çš„é…ç½®&lt;/li>
&lt;/ul>
&lt;h4 id="å…¸å‹é¡¹ç›®ç»“æ„">å…¸å‹é¡¹ç›®ç»“æ„
&lt;/h4>&lt;pre tabindex="0">&lt;code>project/
â”œâ”€â”€ build-logic/ # æ„å»ºé€»è¾‘æ¨¡å—
â”‚ â”œâ”€â”€ settings.gradle.kts
â”‚ â””â”€â”€ convention/ # çº¦å®šæ’ä»¶æ¨¡å—
â”‚ â”œâ”€â”€ build.gradle.kts
â”‚ â””â”€â”€ src/main/kotlin/
â”‚ â”œâ”€â”€ AndroidApplicationConventionPlugin.kt
â”‚ â”œâ”€â”€ AndroidLibraryConventionPlugin.kt
â”‚ â”œâ”€â”€ AndroidFeatureConventionPlugin.kt
â”‚ â””â”€â”€ KotlinLibraryConventionPlugin.kt
â”œâ”€â”€ settings.gradle.kts
â”œâ”€â”€ app/
â”œâ”€â”€ feature/
â”‚ â”œâ”€â”€ feature-foryou/
â”‚ â””â”€â”€ feature-bookmarks/
â””â”€â”€ core/
â”œâ”€â”€ core-ui/
â””â”€â”€ core-data/
&lt;/code>&lt;/pre>&lt;h4 id="è§£å†³çš„é—®é¢˜">è§£å†³çš„é—®é¢˜
&lt;/h4>&lt;p>å¦‚æœä¸ä½¿ç”¨Convention Pluginsä¼šæ€ä¹ˆæ ·ï¼Œé¡¹ç›®ä¸­æœ‰10ä¸ª&lt;code>feature&lt;/code>æ¨¡å—ï¼ˆæ¯”å¦‚&lt;code>:feature:foryou&lt;/code>,&lt;code>:feature:bookmarks&lt;/code>,&lt;code>feature:settings&lt;/code>ç­‰ï¼‰ã€‚åœ¨ä¼ ç»Ÿçš„åšæ³•ä¸­ï¼Œæ¯ä¸ªæ¨¡å—çš„&lt;code>build.gradle.kts&lt;/code>æ–‡ä»¶éƒ½ä¼šåŒ…å«å¤§é‡ç›¸ä¼¼çš„é…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åœ¨ :feature:foryou/build.gradle.kts æ–‡ä»¶ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>plugins {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id(&lt;span style="color:#e6db74">&amp;#34;com.android.library&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id(&lt;span style="color:#e6db74">&amp;#34;kotlin-android&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id(&lt;span style="color:#e6db74">&amp;#34;dagger.hilt.android.plugin&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...å¯èƒ½è¿˜æœ‰å…¶ä»–æ’ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>android {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...å¤§é‡é€šç”¨çš„å®‰å“é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dependencies {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementation(project(&lt;span style="color:#e6db74">&amp;#34;:core:designsystem&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementation(project(&lt;span style="color:#e6db74">&amp;#34;:core:ui&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementation(&lt;span style="color:#e6db74">&amp;#34;androidx.lifecycle:lifecycle-viewmodel-compose:...&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...å¯èƒ½è¿˜æœ‰10ä¸ªä»¥ä¸Šæ‰€æœ‰featureæ¨¡å—éƒ½éœ€è¦çš„é€šç”¨ä¾èµ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨ï¼Œå¦‚æœä½ éœ€è¦ä¸ºæ‰€æœ‰&lt;code>feature&lt;/code>æ¨¡å—æ·»åŠ ä¸€ä¸ªæ–°çš„é€šç”¨ä¾èµ–åº“ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªé€šç”¨çš„ç¼–è¯‘é€‰é¡¹ï¼Œä½ å°±å¿…é¡»æ‰‹åŠ¨å»ä¿®æ”¹10ä¸ªä¸åŒçš„&lt;code>build.gradle.kts&lt;/code>æ–‡ä»¶ã€‚è¿™ä¸ä»…ç¹çï¼Œè€Œä¸”ææ˜“å‡ºé”™ï¼Œéå¸¸éš¾ä»¥ç»´æŠ¤ã€‚&lt;/p>
&lt;h4 id="å®ç°æ–¹å¼">å®ç°æ–¹å¼
&lt;/h4>&lt;h5 id="1-è®¾ç½®build-logicæ¨¡å—">1. è®¾ç½®build-logicæ¨¡å—
&lt;/h5>&lt;p>&lt;strong>build-logic/settings.gradle.kts&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>pluginManagement {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> repositories {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gradlePluginPortal()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> google()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dependencyResolutionManagement {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> repositories {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> google {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> content {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> includeGroupByRegex(&lt;span style="color:#e6db74">&amp;#34;com&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">.android.*&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> includeGroupByRegex(&lt;span style="color:#e6db74">&amp;#34;com&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">.google.*&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> includeGroupByRegex(&lt;span style="color:#e6db74">&amp;#34;androidx.*&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mavenCentral()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> versionCatalogs {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> create(&lt;span style="color:#e6db74">&amp;#34;libs&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> from(files(&lt;span style="color:#e6db74">&amp;#34;../gradle/libs.versions.toml&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rootProject.name = &lt;span style="color:#e6db74">&amp;#34;build-logic&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>include(&lt;span style="color:#e6db74">&amp;#34;:convention&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>build-logic/convention/build.gradle.kts&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>plugins {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>kotlin-dsl&lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dependencies {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> compileOnly(libs.android.gradlePlugin)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> compileOnly(libs.kotlin.gradlePlugin)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> compileOnly(libs.ksp.gradlePlugin)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gradlePlugin {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> plugins {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> register(&lt;span style="color:#e6db74">&amp;#34;androidApplicationCompose&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id = libs.plugins.nowinandroid.android.application.compose.&lt;span style="color:#66d9ef">get&lt;/span>().pluginId
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementationClass = &lt;span style="color:#e6db74">&amp;#34;AndroidApplicationComposeConventionPlugin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> register(&lt;span style="color:#e6db74">&amp;#34;androidApplication&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id = libs.plugins.nowinandroid.android.application.asProvider().&lt;span style="color:#66d9ef">get&lt;/span>().pluginId
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementationClass = &lt;span style="color:#e6db74">&amp;#34;AndroidApplicationConventionPlugin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> register(&lt;span style="color:#e6db74">&amp;#34;androidLibraryCompose&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id = libs.plugins.nowinandroid.android.library.compose.&lt;span style="color:#66d9ef">get&lt;/span>().pluginId
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementationClass = &lt;span style="color:#e6db74">&amp;#34;AndroidLibraryComposeConventionPlugin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> register(&lt;span style="color:#e6db74">&amp;#34;androidLibrary&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id = libs.plugins.nowinandroid.android.library.asProvider().&lt;span style="color:#66d9ef">get&lt;/span>().pluginId
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementationClass = &lt;span style="color:#e6db74">&amp;#34;AndroidLibraryConventionPlugin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> register(&lt;span style="color:#e6db74">&amp;#34;androidFeature&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id = libs.plugins.nowinandroid.android.feature.&lt;span style="color:#66d9ef">get&lt;/span>().pluginId
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementationClass = &lt;span style="color:#e6db74">&amp;#34;AndroidFeatureConventionPlugin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-åˆ›å»ºçº¦å®šæ’ä»¶">2. åˆ›å»ºçº¦å®šæ’ä»¶
&lt;/h5>&lt;p>&lt;strong>AndroidApplicationConventionPlugin.kt&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AndroidApplicationConventionPlugin&lt;/span> : Plugin&amp;lt;Project&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">apply&lt;/span>(target: Project) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> with(target) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;com.android.application&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;org.jetbrains.kotlin.android&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;nowinandroid.android.lint&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;com.dropbox.dependency-guard&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> extensions.configure&amp;lt;ApplicationExtension&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureKotlinAndroid(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> defaultConfig.targetSdk = &lt;span style="color:#ae81ff">35&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Suppress&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;UnstableApiUsage&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> testOptions.animationsDisabled = &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureGradleManagedDevices(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> extensions.configure&amp;lt;ApplicationAndroidComponentsExtension&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configurePrintApksTask(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureBadgingTasks(extensions.getByType&amp;lt;ApplicationExtension&amp;gt;(), &lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>AndroidApplicationComposeConventionPlugin.kt&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AndroidApplicationComposeConventionPlugin&lt;/span> : Plugin&amp;lt;Project&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">apply&lt;/span>(target: Project) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> with(target) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;com.android.application&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;org.jetbrains.kotlin.plugin.compose&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> extension = extensions.getByType&amp;lt;ApplicationExtension&amp;gt;()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureAndroidCompose(extension)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>AndroidLibraryComposeConventionPlugin.kt&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AndroidLibraryComposeConventionPlugin&lt;/span> : Plugin&amp;lt;Project&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">apply&lt;/span>(target: Project) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> with(target) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;com.android.library&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;org.jetbrains.kotlin.plugin.compose&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> extension = extensions.getByType&amp;lt;LibraryExtension&amp;gt;()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureAndroidCompose(extension)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>AndroidLibraryConventionPlugin.kt&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AndroidLibraryConventionPlugin&lt;/span> : Plugin&amp;lt;Project&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">apply&lt;/span>(target: Project) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> with(target) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;com.android.library&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;org.jetbrains.kotlin.android&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;nowinandroid.android.lint&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> extensions.configure&amp;lt;LibraryExtension&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureKotlinAndroid(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> testOptions.targetSdk = &lt;span style="color:#ae81ff">35&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lint.targetSdk = &lt;span style="color:#ae81ff">35&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> defaultConfig.testInstrumentationRunner = &lt;span style="color:#e6db74">&amp;#34;androidx.test.runner.AndroidJUnitRunner&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> testOptions.animationsDisabled = &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureFlavors(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureGradleManagedDevices(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// The resource prefix is derived from the module name,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// so resources inside &amp;#34;:core:module1&amp;#34; must be prefixed with &amp;#34;core_module1_&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> resourcePrefix =
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> path.split(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;\W&amp;#34;&amp;#34;&amp;#34;&lt;/span>.toRegex()).drop(&lt;span style="color:#ae81ff">1&lt;/span>).distinct().joinToString(separator = &lt;span style="color:#e6db74">&amp;#34;_&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .lowercase() + &lt;span style="color:#e6db74">&amp;#34;_&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> extensions.configure&amp;lt;LibraryAndroidComponentsExtension&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configurePrintApksTask(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> disableUnnecessaryAndroidTests(target)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dependencies {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;androidTestImplementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;kotlin.test&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;testImplementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;kotlin.test&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;androidx.tracing.ktx&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>AndroidFeatureConvention.kt&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AndroidFeatureConventionPlugin&lt;/span> : Plugin&amp;lt;Project&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">apply&lt;/span>(target: Project) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> with(target) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;nowinandroid.android.library&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;nowinandroid.hilt&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;org.jetbrains.kotlin.plugin.serialization&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> extensions.configure&amp;lt;LibraryExtension&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> testOptions.animationsDisabled = &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureGradleManagedDevices(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dependencies {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(project(&lt;span style="color:#e6db74">&amp;#34;:core:ui&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(project(&lt;span style="color:#e6db74">&amp;#34;:core:designsystem&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;androidx.hilt.navigation.compose&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;androidx.lifecycle.runtimeCompose&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;androidx.lifecycle.viewModelCompose&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;androidx.navigation.compose&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;androidx.tracing.ktx&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;kotlinx.serialization.json&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;testImplementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;androidx.navigation.testing&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;androidTestImplementation&amp;#34;&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;androidx.lifecycle.runtimeTesting&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-æ ¸å¿ƒæ–¹æ³•apply">3. æ ¸å¿ƒæ–¹æ³•ï¼š&lt;code>apply&lt;/code>
&lt;/h5>&lt;p>å½“ä½ å°†è¿™ä¸ªæ’ä»¶å¼•ç”¨åˆ°ä¸€ä¸ªæ¨¡å—æ—¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨&lt;code>:feature:foryou&lt;/code>ä¸­åº”ç”¨å®ƒï¼‰ï¼ŒGradleå°±ä¼šæ‰§è¡Œè¿™ä¸ªæ’ä»¶ç±»ä¸­çš„&lt;code>apply&lt;/code>æ–¹æ³•ã€‚é€è¡Œåˆ†æè¿™ä¸ªæ–¹æ³•åšäº†ä»€ä¹ˆï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åœ¨ AndroidFeatureConventionPlugin.kt ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AndroidFeatureConventionPlugin&lt;/span> : Plugin&amp;lt;Project&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">apply&lt;/span>(target: Project) { &lt;span style="color:#75715e">// &amp;#39;target&amp;#39; å°±æ˜¯åº”ç”¨è¿™ä¸ªæ’ä»¶çš„æ¨¡å—, æ¯”å¦‚ :feature:foryou
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> with(target) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// --- åŠ¨ä½œä¸€ï¼šåº”ç”¨å…¶ä»–æ›´åŸºç¡€çš„çº¦å®šæ’ä»¶ ---
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// è¿™è¡Œä»£ç åœ¨è¯´ï¼šâ€œä¸€ä¸ª `feature` æ¨¡å—ï¼Œé¦–å…ˆå®ƒæ˜¯ä¸€ä¸ª `library` æ¨¡å—ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// å¹¶ä¸”å®ƒä¹Ÿéœ€è¦ Hilt ä¾èµ–æ³¨å…¥å’Œåºåˆ—åŒ–åŠŸèƒ½ã€‚â€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// è¿™ä½“ç°äº†æ’ä»¶çš„ç»„åˆèƒ½åŠ›ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;nowinandroid.android.library&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;nowinandroid.hilt&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> apply(plugin = &lt;span style="color:#e6db74">&amp;#34;org.jetbrains.kotlin.plugin.serialization&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// --- åŠ¨ä½œäºŒï¼šé…ç½®é€šç”¨çš„ Android å±æ€§ ---
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// è¿™é‡Œç»Ÿä¸€ä¸ºæ‰€æœ‰ feature æ¨¡å—é…ç½® &amp;#39;android&amp;#39; ä»£ç å—ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// æ¯”å¦‚ï¼Œç»Ÿä¸€å…³é—­æµ‹è¯•ä¸­çš„åŠ¨ç”»ï¼Œç»Ÿä¸€é…ç½®æµ‹è¯•è®¾å¤‡ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> extensions.configure&amp;lt;LibraryExtension&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> testOptions.animationsDisabled = &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureGradleManagedDevices(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// --- åŠ¨ä½œä¸‰ï¼šæ·»åŠ æ‰€æœ‰ feature æ¨¡å—éƒ½éœ€è¦çš„é€šç”¨ä¾èµ– ---
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// è¿™æ˜¯æœ€å¼ºå¤§çš„éƒ¨åˆ†ã€‚å®ƒå£°æ˜äº†â€œæ¯ä¸€ä¸ªâ€ feature æ¨¡å—éƒ½ä¼šè‡ªåŠ¨è·å¾—è¿™äº›ä¾èµ–ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// æ— éœ€åœ¨å„è‡ªçš„ build.gradle.kts ä¸­é‡å¤æ·»åŠ ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> dependencies {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(project(&lt;span style="color:#e6db74">&amp;#34;:core:ui&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(project(&lt;span style="color:#e6db74">&amp;#34;:core:designsystem&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;androidx.hilt.navigation.compose&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;implementation&amp;#34;&lt;/span>(libs.findLibrary(&lt;span style="color:#e6db74">&amp;#34;androidx.lifecycle.viewModelCompose&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">get&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ... ä»¥åŠå…¶ä»–æ‰€æœ‰é€šç”¨ä¾èµ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-å…±äº«é…ç½®å‡½æ•°">4. å…±äº«é…ç½®å‡½æ•°
&lt;/h5>&lt;p>&lt;strong>KotlinAndroid.kt&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> com.android.build.api.dsl.CommonExtension
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> org.gradle.api.JavaVersion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> org.gradle.api.Project
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> org.gradle.kotlin.dsl.dependencies
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> org.gradle.kotlin.dsl.withType
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> org.jetbrains.kotlin.gradle.tasks.KotlinCompile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">internal&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">Project&lt;/span>.configureKotlinAndroid(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> commonExtension: CommonExtension&amp;lt;*, *, *, *, *, *&amp;gt;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> commonExtension.apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> compileSdk = &lt;span style="color:#ae81ff">34&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> defaultConfig {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> minSdk = &lt;span style="color:#ae81ff">24&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> compileOptions {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sourceCompatibility = &lt;span style="color:#a6e22e">JavaVersion&lt;/span>.VERSION_17
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> targetCompatibility = &lt;span style="color:#a6e22e">JavaVersion&lt;/span>.VERSION_17
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> configureKotlin()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">Project&lt;/span>.configureKotlin() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tasks.withType&amp;lt;KotlinCompile&amp;gt;().configureEach {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> kotlinOptions {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> jvmTarget = &lt;span style="color:#a6e22e">JavaVersion&lt;/span>.VERSION_17.toString()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freeCompilerArgs = freeCompilerArgs + listOf(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;-opt-in=kotlin.RequiresOptIn&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;-opt-in=kotlinx.coroutines.ExperimentalCoroutinesApi&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="5-åœ¨æ ¹é¡¹ç›®ä¸­å¼•å…¥">5. åœ¨æ ¹é¡¹ç›®ä¸­å¼•å…¥
&lt;/h5>&lt;p>&lt;strong>settings.gradle.kts&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>pluginManagement {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> includeBuild(&lt;span style="color:#e6db74">&amp;#34;build-logic&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> repositories {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> google()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mavenCentral()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gradlePluginPortal()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="6-åœ¨æ¨¡å—ä¸­å¼•å…¥">6. åœ¨æ¨¡å—ä¸­å¼•å…¥
&lt;/h5>&lt;p>&lt;strong>app/build.gradle.kts&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>plugins {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id(&lt;span style="color:#e6db74">&amp;#34;myapp.android.application&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id(&lt;span style="color:#e6db74">&amp;#34;myapp.android.application.compose&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>android {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> namespace = &lt;span style="color:#e6db74">&amp;#34;com.example.myapp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åªéœ€é…ç½®ç‰¹å®šäºæ­¤æ¨¡å—çš„å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> defaultConfig {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> applicationId = &lt;span style="color:#e6db74">&amp;#34;com.example.myapp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dependencies {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementation(project(&lt;span style="color:#e6db74">&amp;#34;:feature:home&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementation(project(&lt;span style="color:#e6db74">&amp;#34;:feature:profile&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>feature/feature-home/build.gradle.kts&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>plugins {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id(&lt;span style="color:#e6db74">&amp;#34;myapp.android.feature&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>android {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> namespace = &lt;span style="color:#e6db74">&amp;#34;com.example.myapp.feature.home&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dependencies {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Feature ç‰¹å®šçš„ä¾èµ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="convention-pluginçš„ä¼˜åŠ¿">Convention Pluginçš„ä¼˜åŠ¿
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>DRY (Don&amp;rsquo;t Repeat Yourself)&lt;/strong> åŸåˆ™ï¼šæ¶ˆé™¤äº†åœ¨å‡ åä¸ªæ–‡ä»¶ä¸­å¤åˆ¶ç²˜è´´çš„æ„å»ºé€»è¾‘ã€‚&lt;/li>
&lt;li>å•ä¸€äº‹å®æ¥æº (&lt;strong>Single Source of Truth&lt;/strong>)ï¼šå¦‚æœéœ€è¦æ›´æ–°ä¸€ä¸ªæ‰€æœ‰&lt;code> feature&lt;/code> æ¨¡å—éƒ½åœ¨ç”¨çš„åº“ç‰ˆæœ¬ï¼ˆæ¯”å¦‚ Lifecycleï¼‰ï¼Œä½ åªéœ€è¦åœ¨ &lt;code>AndroidFeatureConventionPlugin.kt&lt;/code> è¿™ä¸€ä¸ªæ–‡ä»¶é‡Œä¿®æ”¹å³å¯ã€‚&lt;/li>
&lt;li>ç®€æ´ä¸æ¸…æ™°ï¼šæ¯ä¸ªæ¨¡å—çš„æ„å»ºè„šæœ¬å˜å¾—éå¸¸çŸ­ï¼ŒåªåŒ…å«å¯¹è¯¥æ¨¡å—ç‹¬ä¸€æ— äºŒçš„é…ç½®ï¼Œå¯è¯»æ€§å¤§å¤§æé«˜ã€‚&lt;/li>
&lt;li>ç±»å‹å®‰å…¨ä¸ IDE æ”¯æŒï¼šå› ä¸ºè¿™äº›æ’ä»¶æ˜¯ç”¨ Kotlin ç¼–å†™çš„ï¼Œä½ å¯ä»¥äº«å—åˆ° IDE çš„è‡ªåŠ¨è¡¥å…¨ã€ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥å’Œæ–¹ä¾¿çš„å¯¼èˆªè·³è½¬ï¼Œè¿™æ¯”ä¼ ç»Ÿçš„ Groovy è„šæœ¬è¦å¼ºå¤§å¾—å¤šã€‚&lt;/li>
&lt;/ol>
&lt;p>è¿™äº›éƒ½æ˜¯&lt;code>now-in-android&lt;/code>æ‰€åº”ç”¨çš„ï¼Œæ›´è¯¦ç»†çš„å¯ä»¥é€šè¿‡æ­¤é¡¹ç›®å­¦ä¹ &lt;/p></description></item><item><title>Androidå››å¤§ç»„ä»¶</title><link>https://www.dust-zed.site/android-develop/android%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/</link><pubDate>Tue, 21 Oct 2025 00:05:46 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/android%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/</guid><description>&lt;h4 id="activity">Activity
&lt;/h4>&lt;h5 id="ç”Ÿå‘½å‘¨æœŸ">ç”Ÿå‘½å‘¨æœŸ
&lt;/h5>&lt;pre tabindex="0">&lt;code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Activity â”‚
â”‚ Created â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
onCreate() â† åˆ›å»ºï¼Œåˆå§‹åŒ–å˜é‡ã€åŠ è½½å¸ƒå±€
â†“
onStart() â† å¯è§ä½†ä¸å¯äº¤äº’
â†“
onResume() â† å¯è§ä¸”å¯äº¤äº’ï¼ˆå‰å°ï¼‰
â†“
[è¿è¡Œä¸­]
â†“
onPause() â† éƒ¨åˆ†å¯è§ï¼ˆè¢«é®æŒ¡ï¼Œå¦‚å¯¹è¯æ¡†ï¼‰
â†“
onStop() â† å®Œå…¨ä¸å¯è§ï¼ˆåˆ‡åˆ°åå°ï¼‰
â†“
onDestroy() â† é”€æ¯ï¼Œé‡Šæ”¾èµ„æº
â†“
[ç»“æŸ]
&lt;/code>&lt;/pre>&lt;hr>
&lt;h5 id="çŠ¶æ€ä¿å­˜ä¸æ¢å¤">çŠ¶æ€ä¿å­˜ä¸æ¢å¤
&lt;/h5>&lt;h6 id="ä¸ºä»€ä¹ˆéœ€è¦ä¿å­˜çŠ¶æ€">ä¸ºä»€ä¹ˆéœ€è¦ä¿å­˜çŠ¶æ€ï¼Ÿ
&lt;/h6>&lt;pre tabindex="0">&lt;code>ç”¨æˆ·æ­£åœ¨å¡«å†™è¡¨å•
â†“
çªç„¶æ¥ç”µè¯ â†’ Activity è¢«é”€æ¯
â†“
ç”µè¯ç»“æŸè¿”å› â†’ Activity é‡æ–°åˆ›å»º
â†“
è¡¨å•å†…å®¹ä¸¢å¤±äº†ï¼âŒ
&lt;/code>&lt;/pre>&lt;h5 id="ä¿å­˜çŠ¶æ€">ä¿å­˜çŠ¶æ€
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">FormActivity&lt;/span> : AppCompatActivity() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> userName: String = &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> age: Int = &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¿å­˜çŠ¶æ€ï¼ˆç³»ç»Ÿæ€æ­» Activity å‰è°ƒç”¨ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onSaveInstanceState&lt;/span>(outState: Bundle) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onSaveInstanceState(outState)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> outState.putString(&lt;span style="color:#e6db74">&amp;#34;userName&amp;#34;&lt;/span>, userName)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> outState.putInt(&lt;span style="color:#e6db74">&amp;#34;age&amp;#34;&lt;/span>, age)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;State&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;çŠ¶æ€å·²ä¿å­˜&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¢å¤çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreate&lt;/span>(savedInstanceState: Bundle?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onCreate(savedInstanceState)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setContentView(&lt;span style="color:#a6e22e">R&lt;/span>.layout.activity_form)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ–¹å¼ 1: åœ¨ onCreate ä¸­æ¢å¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (savedInstanceState &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> userName = savedInstanceState.getString(&lt;span style="color:#e6db74">&amp;#34;userName&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> age = savedInstanceState.getInt(&lt;span style="color:#e6db74">&amp;#34;age&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;State&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;çŠ¶æ€å·²æ¢å¤: &lt;/span>&lt;span style="color:#e6db74">$userName&lt;/span>&lt;span style="color:#e6db74">, &lt;/span>&lt;span style="color:#e6db74">$age&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ–¹å¼ 2: åœ¨ onRestoreInstanceState ä¸­æ¢å¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onRestoreInstanceState&lt;/span>(savedInstanceState: Bundle) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onRestoreInstanceState(savedInstanceState)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> userName = savedInstanceState.getString(&lt;span style="color:#e6db74">&amp;#34;userName&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> age = savedInstanceState.getInt(&lt;span style="color:#e6db74">&amp;#34;age&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h5 id="å¯åŠ¨æ¨¡å¼">å¯åŠ¨æ¨¡å¼
&lt;/h5>&lt;h6 id="4ç§å¯åŠ¨æ¨¡å¼">4ç§å¯åŠ¨æ¨¡å¼
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&amp;lt;!&lt;span style="color:#f92672">--&lt;/span> &lt;span style="color:#a6e22e">AndroidManifest&lt;/span>.xml &lt;span style="color:#f92672">--&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;activity
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> android:name=&lt;span style="color:#e6db74">&amp;#34;.MainActivity&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> android:launchMode=&lt;span style="color:#e6db74">&amp;#34;standard&amp;#34;&lt;/span> /&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="1-standard">1. standard
&lt;/h6>&lt;pre tabindex="0">&lt;code>æ¯æ¬¡å¯åŠ¨éƒ½åˆ›å»ºæ–°å®ä¾‹
MainActivity â†’ MainActivity â†’ MainActivity
â†‘ â†‘ â†‘
å®ä¾‹ 1 å®ä¾‹ 2 å®ä¾‹ 3
è¿”å›æ ˆ: [å®ä¾‹3, å®ä¾‹2, å®ä¾‹1]
&lt;/code>&lt;/pre>&lt;h6 id="2-singletop">2. singleTop
&lt;/h6>&lt;pre tabindex="0">&lt;code>å¦‚æœåœ¨æ ˆé¡¶ï¼Œå¤ç”¨ï¼›å¦åˆ™åˆ›å»ºæ–°å®ä¾‹
åœºæ™¯ 1: MainActivity åœ¨æ ˆé¡¶
MainActivity (æ ˆé¡¶) â†’ å¯åŠ¨ MainActivity
â†“
è°ƒç”¨ onNewIntent() å¤ç”¨ï¼Œä¸åˆ›å»ºæ–°å®ä¾‹
åœºæ™¯ 2: MainActivity ä¸åœ¨æ ˆé¡¶
MainActivity â†’ DetailActivity â†’ å¯åŠ¨ MainActivity
â†“
åˆ›å»ºæ–°å®ä¾‹: [MainActivity(æ–°), DetailActivity, MainActivity(æ—§)]
&lt;/code>&lt;/pre>&lt;p>ç”¨é€”ï¼šé€šçŸ¥æ ç‚¹å‡»ã€æœç´¢ç»“æœé¡µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">SearchActivity&lt;/span> : AppCompatActivity() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreate&lt;/span>(savedInstanceState: Bundle?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onCreate(savedInstanceState)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handleIntent(intent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// singleTop æ¨¡å¼ä¸‹ï¼Œå†æ¬¡å¯åŠ¨æ—¶è°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onNewIntent&lt;/span>(intent: Intent) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onNewIntent(intent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setIntent(intent) &lt;span style="color:#75715e">// æ›´æ–° intent
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> handleIntent(intent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">handleIntent&lt;/span>(intent: Intent) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> query = intent.getStringExtra(&lt;span style="color:#e6db74">&amp;#34;query&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœç´¢...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="3-singletask">3. singleTask
&lt;/h6>&lt;pre tabindex="0">&lt;code>æ•´ä¸ªä»»åŠ¡æ ˆä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹
åœºæ™¯ 1: ä¸å­˜åœ¨
TaskA: [DetailActivity, MainActivity]
å¯åŠ¨ ProfileActivity (singleTask)
â†“
TaskA: [ProfileActivity, DetailActivity, MainActivity]
åœºæ™¯ 2: å·²å­˜åœ¨
TaskA: [DetailActivity, ProfileActivity, MainActivity]
å¯åŠ¨ ProfileActivity
â†“
æ¸…é™¤å…¶ä¸Šæ‰€æœ‰ Activityï¼ŒProfileActivity ç§»åˆ°æ ˆé¡¶
TaskA: [ProfileActivity, MainActivity]
DetailActivity è¢«é”€æ¯ï¼
&lt;/code>&lt;/pre>&lt;p>ç”¨é€”ï¼šä¸»é¡µã€ç™»å½•é¡µ&lt;/p>
&lt;h6 id="4-singleinstance">4. singleInstance
&lt;/h6>&lt;pre tabindex="0">&lt;code>ç‹¬å ä¸€ä¸ªä»»åŠ¡æ ˆï¼Œæ•´ä¸ªç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹
TaskA: [DetailActivity, MainActivity]
å¯åŠ¨ VideoActivity (singleInstance)
â†“
TaskA: [DetailActivity, MainActivity]
TaskB: [VideoActivity] â† ç‹¬ç«‹çš„ä»»åŠ¡æ ˆ
ä» VideoActivity å¯åŠ¨å…¶ä»– Activity
â†“
TaskA: [OtherActivity, DetailActivity, MainActivity]
TaskB: [VideoActivity] â† ä»ç„¶ç‹¬å 
&lt;/code>&lt;/pre>&lt;p>ç”¨é€”ï¼šè§†é¢‘é€šè¯ã€é—¹é’Ÿ&lt;/p>
&lt;hr>
&lt;h5 id="intent-flags">Intent Flags
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// FLAG_ACTIVITY_NEW_TASK: æ–°ä»»åŠ¡æ ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#66d9ef">this&lt;/span>, MainActivity&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>.java)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>intent.flags = &lt;span style="color:#a6e22e">Intent&lt;/span>.FLAG_ACTIVITY_NEW_TASK
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>startActivity(intent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// FLAG_ACTIVITY_CLEAR_TOP: æ¸…é™¤å…¶ä¸Šæ‰€æœ‰ Activity
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¸¸ç”¨äº&amp;#34;è¿”å›ä¸»é¡µ&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#66d9ef">this&lt;/span>, MainActivity&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>.java)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>intent.flags = &lt;span style="color:#a6e22e">Intent&lt;/span>.FLAG_ACTIVITY_CLEAR_TOP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>startActivity(intent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// FLAG_ACTIVITY_SINGLE_TOP: ç­‰åŒäº singleTop æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>intent.flags = &lt;span style="color:#a6e22e">Intent&lt;/span>.FLAG_ACTIVITY_SINGLE_TOP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç»„åˆä½¿ç”¨ï¼ˆæ¸…é™¤æ ˆå¹¶å¯åŠ¨ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>intent.flags = &lt;span style="color:#a6e22e">Intent&lt;/span>.FLAG_ACTIVITY_NEW_TASK or &lt;span style="color:#a6e22e">Intent&lt;/span>.FLAG_ACTIVITY_CLEAR_TASK
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="service">Service
&lt;/h4>&lt;h5 id="ä»€ä¹ˆæ˜¯service">ä»€ä¹ˆæ˜¯Serviceï¼Ÿ
&lt;/h5>&lt;p>Service = åœ¨åå°æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œæ“ä½œçš„ç»„ä»¶ï¼Œæ²¡æœ‰ç”¨æˆ·ç•Œé¢&lt;/p>
&lt;pre tabindex="0">&lt;code>å‰å° Activity: ç”¨æˆ·æ­£åœ¨æµè§ˆå•†å“
åå° Service: åŒæ—¶ä¸‹è½½æ–‡ä»¶ã€æ’­æ”¾éŸ³ä¹ã€åŒæ­¥æ•°æ®
&lt;/code>&lt;/pre>&lt;hr>
&lt;h5 id="serviceçš„ä¸‰ç§ç±»å‹">Serviceçš„ä¸‰ç§ç±»å‹
&lt;/h5>&lt;h6 id="1-å‰å°æœåŠ¡foreground-service">1. å‰å°æœåŠ¡ï¼ˆForeground Serviceï¼‰
&lt;/h6>&lt;p>å¿…é¡»æ˜¾ç¤ºé€šçŸ¥ï¼Œç”¨æˆ·å¯è§&lt;/p>
&lt;pre tabindex="0">&lt;code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”” é€šçŸ¥æ  â”‚
â”‚ æ­£åœ¨æ’­æ”¾éŸ³ä¹... â”‚ â† å‰å°æœåŠ¡çš„é€šçŸ¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº”ç”¨ç•Œé¢ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code>&lt;/pre>&lt;p>ç”¨é€”ï¼šéŸ³ä¹æ’­æ”¾ã€å¯¼èˆªã€æ–‡ä»¶ä¸‹è½½&lt;/p>
&lt;h6 id="2-åå°æœåŠ¡background-service">2. åå°æœåŠ¡ï¼ˆBackground Serviceï¼‰
&lt;/h6>&lt;p>ç”¨æˆ·ä¸å¯è§ï¼Œä½†ä¼šè¢«ç³»ç»Ÿé™åˆ¶ï¼›Android 8.0+ä¸¥æ ¼é™åˆ¶åå°æœåŠ¡&lt;/p>
&lt;p>ç”¨é€”ï¼šæ•°æ®åŒæ­¥ï¼Œæ—¥å¿—ä¸Šä¼ ï¼ˆä½†æ¨èç”¨WorkManagerï¼‰&lt;/p>
&lt;h6 id="3-ç»‘å®šæœåŠ¡bound-service">3. ç»‘å®šæœåŠ¡ï¼ˆBound Serviceï¼‰
&lt;/h6>&lt;p>ä¸ç»„ä»¶ç»‘å®šï¼Œæä¾›å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¥å£&lt;/p>
&lt;pre tabindex="0">&lt;code>Activity â†â”€â”€â”€ç»‘å®šâ”€â”€â”€â†’ Service
â†“ â†“
è°ƒç”¨æ–¹æ³• æä¾›æ–¹æ³•
&lt;/code>&lt;/pre>&lt;p>ç”¨é€”ï¼šè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ã€éŸ³ä¹æ’­æ”¾å™¨æ§åˆ¶&lt;/p>
&lt;hr>
&lt;h4 id="serviceç”Ÿå‘½å‘¨æœŸ">Serviceç”Ÿå‘½å‘¨æœŸ
&lt;/h4>&lt;h5 id="å¯åŠ¨æœåŠ¡started-service">å¯åŠ¨æœåŠ¡ï¼ˆStarted Serviceï¼‰
&lt;/h5>&lt;pre tabindex="0">&lt;code>startService()
â†“
onCreate() â† é¦–æ¬¡åˆ›å»ºæ—¶è°ƒç”¨ï¼ˆåªè°ƒç”¨ä¸€æ¬¡ï¼‰
â†“
onStartCommand() â† æ¯æ¬¡ startService() éƒ½è°ƒç”¨
â†“
[è¿è¡Œä¸­]
â†“
onDestroy() â† æœåŠ¡é”€æ¯
&lt;/code>&lt;/pre>&lt;h5 id="ç»‘å®šæœåŠ¡bound-service">ç»‘å®šæœåŠ¡ï¼ˆBound Serviceï¼‰
&lt;/h5>&lt;pre tabindex="0">&lt;code>bindService()
â†“
onCreate() â† é¦–æ¬¡åˆ›å»ºæ—¶è°ƒç”¨
â†“
onBind() â† è¿”å› IBinder å¯¹è±¡
â†“
[ç»‘å®šä¸­]
â†“
unbindService()
â†“
onUnbind() â† æ‰€æœ‰å®¢æˆ·ç«¯è§£ç»‘åè°ƒç”¨
â†“
onDestroy()
&lt;/code>&lt;/pre>&lt;h5 id="æ··åˆæ¨¡å¼æ—¢å¯åŠ¨åˆç»‘å®š">æ··åˆæ¨¡å¼ï¼ˆæ—¢å¯åŠ¨åˆç»‘å®šï¼‰
&lt;/h5>&lt;pre tabindex="0">&lt;code>startService() + bindService()
â†“
onCreate()
â†“
onStartCommand() + onBind()
â†“
[è¿è¡Œå¹¶ç»‘å®š]
â†“
unbindService() â† è§£ç»‘åä»ç„¶è¿è¡Œ
â†“
stopService() or stopSelf()
â†“
onDestroy()
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="å¯åŠ¨æœåŠ¡started-service-1">å¯åŠ¨æœåŠ¡ï¼ˆStarted Serviceï¼‰
&lt;/h4>&lt;h5 id="åŸºæœ¬å®ç°">åŸºæœ¬å®ç°
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// MyService.kt
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyService&lt;/span> : Service() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> TAG = &lt;span style="color:#e6db74">&amp;#34;MyService&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. åˆ›å»ºæ—¶è°ƒç”¨ï¼ˆåªè°ƒç”¨ä¸€æ¬¡ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreate&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onCreate()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(TAG, &lt;span style="color:#e6db74">&amp;#34;Service åˆ›å»º&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. æ¯æ¬¡ startService() éƒ½è°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onStartCommand&lt;/span>(intent: Intent?, flags: Int, startId: Int): Int {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(TAG, &lt;span style="color:#e6db74">&amp;#34;Service å¯åŠ¨&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è·å–ä¼ é€’çš„æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> data = intent&lt;span style="color:#f92672">?.&lt;/span>getStringExtra(&lt;span style="color:#e6db74">&amp;#34;data&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œåå°ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> doWork()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿”å›å€¼å†³å®šç³»ç»Ÿæ€æ­»æœåŠ¡åçš„è¡Œä¸º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> START_STICKY
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. é”€æ¯æ—¶è°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onDestroy&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onDestroy()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(TAG, &lt;span style="color:#e6db74">&amp;#34;Service é”€æ¯&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¿…é¡»å®ç°ï¼Œä½†å¯åŠ¨æœåŠ¡ä¸éœ€è¦ç»‘å®š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onBind&lt;/span>(intent: Intent?): IBinder? = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">doWork&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// âš ï¸ ä¸è¦åœ¨ä¸»çº¿ç¨‹åšè€—æ—¶æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Thread {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œåå°ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">Thread&lt;/span>.sleep(&lt;span style="color:#ae81ff">5000&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(TAG, &lt;span style="color:#e6db74">&amp;#34;ä»»åŠ¡å®Œæˆ&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stopSelf() &lt;span style="color:#75715e">// ä»»åŠ¡å®Œæˆååœæ­¢æœåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }.start()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å¯åŠ¨å’Œåœæ­¢æœåŠ¡">å¯åŠ¨å’Œåœæ­¢æœåŠ¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// MainActivity.kt
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MainActivity&lt;/span> : AppCompatActivity() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¯åŠ¨æœåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">startMyService&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#66d9ef">this&lt;/span>, MyService&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>.java)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intent.putExtra(&lt;span style="color:#e6db74">&amp;#34;data&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Hello Service&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Android 8.0+ å¦‚æœæ˜¯å‰å°æœåŠ¡ï¼Œä½¿ç”¨ startForegroundService
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">Build&lt;/span>.&lt;span style="color:#a6e22e">VERSION&lt;/span>.SDK_INT &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#a6e22e">Build&lt;/span>.&lt;span style="color:#a6e22e">VERSION_CODES&lt;/span>.O) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> startForegroundService(intent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> startService(intent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åœæ­¢æœåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">stopMyService&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#66d9ef">this&lt;/span>, MyService&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>.java)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stopService(intent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="onstartcommandè¿”å›å€¼">onStartCommandè¿”å›å€¼
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onStartCommand&lt;/span>(intent: Intent?, flags: Int, startId: Int): Int {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">when&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// START_STICKY: ç³»ç»Ÿæ€æ­»åé‡å¯æœåŠ¡ï¼Œä½† intent ä¸º null
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// é€‚ç”¨ï¼šéŸ³ä¹æ’­æ”¾å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> START_STICKY
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// START_NOT_STICKY: ç³»ç»Ÿæ€æ­»åä¸é‡å¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// é€‚ç”¨ï¼šä¸€æ¬¡æ€§ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> START_NOT_STICKY
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// START_REDELIVER_INTENT: ç³»ç»Ÿæ€æ­»åé‡å¯ï¼Œé‡æ–°ä¼ é€’ intent
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// é€‚ç”¨ï¼šéœ€è¦ä¿è¯ä»»åŠ¡å®Œæˆï¼ˆå¦‚ä¸‹è½½ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> START_REDELIVER_INTENT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="å‰å°æœåŠ¡">å‰å°æœåŠ¡
&lt;/h4>&lt;p>&lt;strong>Android 8.0+ä¸¥æ ¼é™åˆ¶åå°æœåŠ¡ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>åº”ç”¨è¿›å…¥åå°å‡ åˆ†é’Ÿåï¼Œç³»ç»Ÿä¼šåœæ­¢åå°æœåŠ¡&lt;/li>
&lt;li>å‰å°æœåŠ¡ä¸ä¼šè¢«é™åˆ¶ï¼Œä½†å¿…é¡»æ˜¾ç¤ºé€šçŸ¥&lt;/li>
&lt;/ul>
&lt;h5 id="å®ç°å‰å°æœåŠ¡">å®ç°å‰å°æœåŠ¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MusicService&lt;/span> : Service() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> CHANNEL_ID = &lt;span style="color:#e6db74">&amp;#34;music_channel&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> NOTIFICATION_ID = &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreate&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onCreate()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> createNotificationChannel()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onStartCommand&lt;/span>(intent: Intent?, flags: Int, startId: Int): Int {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºé€šçŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> notification = createNotification()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// âš ï¸ å¿…é¡»åœ¨ 5 ç§’å†…è°ƒç”¨ startForegroundï¼Œå¦åˆ™ ANR
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> startForeground(NOTIFICATION_ID, notification)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ’­æ”¾éŸ³ä¹...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> playMusic()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> START_STICKY
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">createNotificationChannel&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">Build&lt;/span>.&lt;span style="color:#a6e22e">VERSION&lt;/span>.SDK_INT &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#a6e22e">Build&lt;/span>.&lt;span style="color:#a6e22e">VERSION_CODES&lt;/span>.O) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> channel = NotificationChannel(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CHANNEL_ID,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;éŸ³ä¹æ’­æ”¾&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">NotificationManager&lt;/span>.IMPORTANCE_LOW
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ).apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> description = &lt;span style="color:#e6db74">&amp;#34;éŸ³ä¹æ’­æ”¾æœåŠ¡&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> manager = getSystemService(NotificationManager&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>.java)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> manager.createNotificationChannel(channel)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">createNotification&lt;/span>(): Notification {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç‚¹å‡»é€šçŸ¥æ‰“å¼€ Activity
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#66d9ef">this&lt;/span>, MainActivity&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>.java)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> pendingIntent = &lt;span style="color:#a6e22e">PendingIntent&lt;/span>.getActivity(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intent,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">PendingIntent&lt;/span>.FLAG_IMMUTABLE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">NotificationCompat&lt;/span>.Builder(&lt;span style="color:#66d9ef">this&lt;/span>, CHANNEL_ID)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .setContentTitle(&lt;span style="color:#e6db74">&amp;#34;æ­£åœ¨æ’­æ”¾&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .setContentText(&lt;span style="color:#e6db74">&amp;#34;æ­Œæ›²åç§° - è‰ºæœ¯å®¶&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .setSmallIcon(&lt;span style="color:#a6e22e">R&lt;/span>.drawable.ic_music)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .setContentIntent(pendingIntent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .setOngoing(&lt;span style="color:#66d9ef">true&lt;/span>) &lt;span style="color:#75715e">// ä¸å¯æ»‘åŠ¨åˆ é™¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .addAction(&lt;span style="color:#a6e22e">R&lt;/span>.drawable.ic_pause, &lt;span style="color:#e6db74">&amp;#34;æš‚åœ&amp;#34;&lt;/span>, createPauseIntent())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .addAction(&lt;span style="color:#a6e22e">R&lt;/span>.drawable.ic_next, &lt;span style="color:#e6db74">&amp;#34;ä¸‹ä¸€é¦–&amp;#34;&lt;/span>, createNextIntent())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .build()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">createPauseIntent&lt;/span>(): PendingIntent {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#66d9ef">this&lt;/span>, MusicService&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>.java).apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> action = &lt;span style="color:#e6db74">&amp;#34;ACTION_PAUSE&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">PendingIntent&lt;/span>.getService(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intent,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">PendingIntent&lt;/span>.FLAG_IMMUTABLE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">createNextIntent&lt;/span>(): PendingIntent {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#66d9ef">this&lt;/span>, MusicService&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>.java).apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> action = &lt;span style="color:#e6db74">&amp;#34;ACTION_NEXT&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">PendingIntent&lt;/span>.getService(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intent,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">PendingIntent&lt;/span>.FLAG_IMMUTABLE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">playMusic&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ’­æ”¾é€»è¾‘...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onBind&lt;/span>(intent: Intent?): IBinder? = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å‰å°æœåŠ¡ç±»å‹android-14">å‰å°æœåŠ¡ç±»å‹ï¼ˆAndroid 14+ï¼‰
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!-- AndroidManifest.xml --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;manifest&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å£°æ˜å‰å°æœåŠ¡ç±»å‹ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;uses-permission&lt;/span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;android.permission.FOREGROUND_SERVICE&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;uses-permission&lt;/span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;application&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;.MusicService&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:foregroundServiceType=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;mediaPlayback&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/application&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/manifest&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å‰å°æœåŠ¡ç±»å‹&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>camera&lt;/code> - ç›¸æœº&lt;/li>
&lt;li>&lt;code>connectedDevice&lt;/code> - è¿æ¥è®¾å¤‡&lt;/li>
&lt;li>&lt;code>dataSync&lt;/code> - æ•°æ®åŒæ­¥&lt;/li>
&lt;li>&lt;code>location&lt;/code> - ä½ç½®&lt;/li>
&lt;li>&lt;code>mediaPlayback&lt;/code> - åª’ä½“æ’­æ”¾&lt;/li>
&lt;li>&lt;code>mediaProjection&lt;/code> - å±å¹•å½•åˆ¶&lt;/li>
&lt;li>&lt;code>microphone&lt;/code> - éº¦å…‹é£&lt;/li>
&lt;li>&lt;code>phoneCall&lt;/code> - ç”µè¯&lt;/li>
&lt;li>&lt;code>remoteMessaging&lt;/code> - è¿œç¨‹æ¶ˆæ¯&lt;/li>
&lt;li>&lt;code>shortService&lt;/code> - çŸ­æ—¶æœåŠ¡&lt;/li>
&lt;li>&lt;code>specialUse&lt;/code> - ç‰¹æ®Šç”¨é€”&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="ç»‘å®šæœåŠ¡">ç»‘å®šæœåŠ¡
&lt;/h4>&lt;h5 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯
&lt;/h5>&lt;pre tabindex="0">&lt;code>Activity éœ€è¦ï¼š
- è°ƒç”¨ Service çš„æ–¹æ³•
- è·å– Service çš„æ•°æ®
- ç›‘å¬ Service çš„çŠ¶æ€
Example: éŸ³ä¹æ’­æ”¾å™¨æ§åˆ¶
Activity: æ’­æ”¾/æš‚åœ/åˆ‡æ­Œ
Service: æ‰§è¡Œå®é™…æ“ä½œ
&lt;/code>&lt;/pre>&lt;h5 id="å®ç°ç»‘å®šæœåŠ¡">å®ç°ç»‘å®šæœåŠ¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// MusicPlayerService.kt
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MusicPlayerService&lt;/span> : Service() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. å®šä¹‰ Binderï¼ˆæœ¬åœ°æœåŠ¡ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">inner&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MusicBinder&lt;/span> : Binder() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">getService&lt;/span>(): MusicPlayerService = &lt;span style="color:#66d9ef">this&lt;/span>&lt;span style="color:#a6e22e">@MusicPlayerService&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> binder = MusicBinder()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. è¿”å› Binder
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onBind&lt;/span>(intent: Intent?): IBinder = binder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. æä¾›å…¬å…±æ–¹æ³•ä¾›å®¢æˆ·ç«¯è°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">play&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;Music&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;æ’­æ”¾éŸ³ä¹&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">pause&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;Music&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;æš‚åœéŸ³ä¹&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">getCurrentPosition&lt;/span>(): Int {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#75715e">// è¿”å›å½“å‰æ’­æ”¾ä½ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ç»‘å®šæœåŠ¡-1">ç»‘å®šæœåŠ¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// MainActivity.kt
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MainActivity&lt;/span> : AppCompatActivity() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> musicService: MusicPlayerService? = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> isBound = &lt;span style="color:#66d9ef">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. å®šä¹‰ ServiceConnection
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> connection = &lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">: &lt;/span>&lt;span style="color:#a6e22e">ServiceConnection&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onServiceConnected&lt;/span>(name: ComponentName?, service: IBinder?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœåŠ¡è¿æ¥æˆåŠŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> binder = service &lt;span style="color:#66d9ef">as&lt;/span> &lt;span style="color:#a6e22e">MusicPlayerService&lt;/span>.MusicBinder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> musicService = binder.getService()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> isBound = &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;Bind&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;æœåŠ¡å·²è¿æ¥&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onServiceDisconnected&lt;/span>(name: ComponentName?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœåŠ¡æ„å¤–æ–­å¼€ï¼ˆå¦‚å´©æºƒï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> musicService = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> isBound = &lt;span style="color:#66d9ef">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;Bind&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;æœåŠ¡å·²æ–­å¼€&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreate&lt;/span>(savedInstanceState: Bundle?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onCreate(savedInstanceState)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setContentView(&lt;span style="color:#a6e22e">R&lt;/span>.layout.activity_main)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. ç»‘å®šæœåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#66d9ef">this&lt;/span>, MusicPlayerService&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span>.java)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bindService(intent, connection, &lt;span style="color:#a6e22e">Context&lt;/span>.BIND_AUTO_CREATE)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. è°ƒç”¨æœåŠ¡æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onPlayClick&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (isBound) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> musicService&lt;span style="color:#f92672">?.&lt;/span>play()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onPauseClick&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (isBound) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> musicService&lt;span style="color:#f92672">?.&lt;/span>pause()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onDestroy&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onDestroy()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. è§£ç»‘æœåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (isBound) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> unbindService(connection)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> isBound = &lt;span style="color:#66d9ef">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="aidlè·¨è¿›ç¨‹é€šä¿¡">AIDL(è·¨è¿›ç¨‹é€šä¿¡)
&lt;/h5>&lt;p>ç”¨äºä¸åŒåº”ç”¨ä¹‹é—´çš„é€šä¿¡&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-aidl" data-lang="aidl">// IMusicService.aidl
package com.example.myapp;
interface IMusicService {
void play();
void pause();
int getCurrentPosition();
}
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// MusicPlayerService.kt
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MusicPlayerService&lt;/span> : Service() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å®ç° AIDL æ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> binder = &lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">: &lt;/span>&lt;span style="color:#a6e22e">IMusicService&lt;/span>.Stub() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">play&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ’­æ”¾é€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">pause&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æš‚åœé€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">getCurrentPosition&lt;/span>(): Int {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onBind&lt;/span>(intent: Intent?): IBinder = binder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å®¢æˆ·ç«¯ Activity
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MainActivity&lt;/span> : AppCompatActivity() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> musicService: IMusicService? = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> connection = &lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">: &lt;/span>&lt;span style="color:#a6e22e">ServiceConnection&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onServiceConnected&lt;/span>(name: ComponentName?, service: IBinder?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> musicService = &lt;span style="color:#a6e22e">IMusicService&lt;/span>.&lt;span style="color:#a6e22e">Stub&lt;/span>.asInterface(service)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onServiceDisconnected&lt;/span>(name: ComponentName?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> musicService = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onPlayClick&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> musicService&lt;span style="color:#f92672">?.&lt;/span>play()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="serviceçš„é™åˆ¶android-80">Serviceçš„é™åˆ¶ï¼ˆAndroid 8.0+ï¼‰
&lt;/h4>&lt;h5 id="åå°æ‰§è¡Œé™åˆ¶">åå°æ‰§è¡Œé™åˆ¶
&lt;/h5>&lt;pre tabindex="0">&lt;code>åº”ç”¨è¿›å…¥åå°å‡ åˆ†é’Ÿåï¼š
- stopService() åå°æœåŠ¡è¢«åœæ­¢
- WorkManager ç»§ç»­æ‰§è¡Œï¼ˆæ¨èï¼‰
&lt;/code>&lt;/pre>&lt;h5 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ
&lt;/h5>&lt;h6 id="1-ä½¿ç”¨å‰å°æœåŠ¡">1. ä½¿ç”¨å‰å°æœåŠ¡
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// éŸ³ä¹æ’­æ”¾ã€å¯¼èˆªã€ä¸‹è½½
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>startForegroundService(intent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service.startForeground(NOTIFICATION_ID, notification)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="2-ä½¿ç”¨workmanger">2. ä½¿ç”¨workManger
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ•°æ®åŒæ­¥ã€æ—¥å¿—ä¸Šä¼ 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> workRequest = OneTimeWorkRequestBuilder&amp;lt;MyWorker&amp;gt;().build()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">WorkManager&lt;/span>.getInstance(context).enqueue(workRequest)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="broadcastreceiver">BroadcastReceiver
&lt;/h4>&lt;p>&lt;strong>BroadcastReceiver&lt;/strong> = æ¥æ”¶ç³»ç»Ÿæˆ–åº”ç”¨å‘å‡ºçš„å¹¿æ’­æ¶ˆæ¯&lt;/p>
&lt;pre tabindex="0">&lt;code>å‘é€è€… (Sender) æ¥æ”¶è€… (Receiver)
â†“ â†“
å‘é€å¹¿æ’­ â†’ [Android System] â†’ BroadcastReceiver
(Intent) (onReceive)
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="å¹¿æ’­çš„ç±»å‹">å¹¿æ’­çš„ç±»å‹
&lt;/h4>&lt;h5 id="1-ç³»ç»Ÿå¹¿æ’­system-broadcast">1. ç³»ç»Ÿå¹¿æ’­ï¼ˆSystem Broadcastï¼‰
&lt;/h5>&lt;p>ç³»ç»Ÿå‘å‡ºçš„å¹¿æ’­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¸¸è§ç³»ç»Ÿå¹¿æ’­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_BOOT_COMPLETED &lt;span style="color:#75715e">// å¼€æœºå®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_BATTERY_LOW &lt;span style="color:#75715e">// ç”µé‡ä½
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_POWER_CONNECTED &lt;span style="color:#75715e">// å……ç”µå™¨è¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_SCREEN_ON &lt;span style="color:#75715e">// å±å¹•å¼€å¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_SCREEN_OFF &lt;span style="color:#75715e">// å±å¹•å…³é—­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_TIMEZONE_CHANGED &lt;span style="color:#75715e">// æ—¶åŒºæ”¹å˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_LOCALE_CHANGED &lt;span style="color:#75715e">// è¯­è¨€æ”¹å˜
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="åº”ç”¨å†…å¹¿æ’­local-broadcast">åº”ç”¨å†…å¹¿æ’­ï¼ˆLocal Broadcastï¼‰
&lt;/h5>&lt;p>åªåœ¨åº”ç”¨å†…ä¼ é€’ï¼Œæ›´å®‰å…¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨ LocalBroadcastManagerï¼ˆå·²åºŸå¼ƒï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¨èä½¿ç”¨ LiveData æˆ–äº‹ä»¶æ€»çº¿
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-è‡ªå®šä¹‰å¹¿æ’­custom-broadcast">3. è‡ªå®šä¹‰å¹¿æ’­ï¼ˆCustom Broadcastï¼‰
&lt;/h5>&lt;p>åº”ç”¨è‡ªå·±å®šä¹‰çš„å¹¿æ’­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> ACTION_CUSTOM = &lt;span style="color:#e6db74">&amp;#34;com.example.ACTION_CUSTOM&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨">æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨
&lt;/h4>&lt;h5 id="æ–¹å¼1-é™æ€æ³¨å†Œmanifest">æ–¹å¼1: é™æ€æ³¨å†Œï¼ˆManifestï¼‰
&lt;/h5>&lt;p>åº”ç”¨æœªè¿è¡Œæ—¶ä¹Ÿèƒ½æ¥æ”¶å¹¿æ’­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!-- AndroidManifest.xml --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;manifest&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- éœ€è¦çš„æƒé™ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;uses-permission&lt;/span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;android.permission.RECEIVE_BOOT_COMPLETED&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;application&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- æ³¨å†Œæ¥æ”¶å™¨ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;receiver&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;.BootReceiver&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:enabled=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:exported=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å£°æ˜è¦æ¥æ”¶çš„å¹¿æ’­ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;intent-filter&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;action&lt;/span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;android.intent.action.BOOT_COMPLETED&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/intent-filter&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/receiver&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/application&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/manifest&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// BootReceiver.kt
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">BootReceiver&lt;/span> : BroadcastReceiver() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onReceive&lt;/span>(context: Context, intent: Intent) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">when&lt;/span> (intent.action) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_BOOT_COMPLETED &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;Boot&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;è®¾å¤‡å¯åŠ¨å®Œæˆ&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¯åŠ¨æœåŠ¡æˆ–æ‰§è¡Œåˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>**Android 8.0+**é™åˆ¶ï¼š&lt;/p>
&lt;ul>
&lt;li>å¤§éƒ¨åˆ†ç³»ç»Ÿå¹¿æ’­ä¸èƒ½é™æ€æ³¨å†Œ&lt;/li>
&lt;li>åªæœ‰å°‘æ•°ä¾‹å¤–ï¼ˆå¦‚&lt;code>BOOT_COMPLETED&lt;/code>ã€&lt;code>LOCALE_CHANGED&lt;/code>ï¼‰&lt;/li>
&lt;/ul>
&lt;h5 id="æ–¹å¼2åŠ¨æ€æ³¨å†Œ">æ–¹å¼2:åŠ¨æ€æ³¨å†Œ
&lt;/h5>&lt;p>åº”ç”¨è¿è¡Œæ—¶æ³¨å†Œï¼Œæ›´çµæ´»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MainActivity&lt;/span> : AppCompatActivity() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. åˆ›å»ºæ¥æ”¶å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> batteryReceiver = &lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">: &lt;/span>&lt;span style="color:#a6e22e">BroadcastReceiver&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onReceive&lt;/span>(context: Context, intent: Intent) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">when&lt;/span> (intent.action) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_BATTERY_LOW &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Toast&lt;/span>.makeText(context, &lt;span style="color:#e6db74">&amp;#34;ç”µé‡ä½&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">Toast&lt;/span>.LENGTH_SHORT).show()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_BATTERY_OKAY &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Toast&lt;/span>.makeText(context, &lt;span style="color:#e6db74">&amp;#34;ç”µé‡æ¢å¤&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">Toast&lt;/span>.LENGTH_SHORT).show()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreate&lt;/span>(savedInstanceState: Bundle?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onCreate(savedInstanceState)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setContentView(&lt;span style="color:#a6e22e">R&lt;/span>.layout.activity_main)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. æ³¨å†Œæ¥æ”¶å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> filter = IntentFilter().apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> addAction(&lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_BATTERY_LOW)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> addAction(&lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_BATTERY_OKAY)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> registerReceiver(batteryReceiver, filter)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onDestroy&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onDestroy()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. å¿…é¡»å–æ¶ˆæ³¨å†Œï¼Œé¿å…å†…å­˜æ³„æ¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> unregisterReceiver(batteryReceiver)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>**Android13+**åŠ¨æ€æ³¨å†Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Android 13+ éœ€è¦åœ¨è¿è¡Œæ—¶è¯·æ±‚æƒé™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">Build&lt;/span>.&lt;span style="color:#a6e22e">VERSION&lt;/span>.SDK_INT &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#a6e22e">Build&lt;/span>.&lt;span style="color:#a6e22e">VERSION_CODES&lt;/span>.TIRAMISU) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> registerReceiver(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">receiver&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> filter,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Context&lt;/span>.RECEIVER_NOT_EXPORTED &lt;span style="color:#75715e">// æˆ– RECEIVER_EXPORTED
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> registerReceiver(&lt;span style="color:#66d9ef">receiver&lt;/span>, filter)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="å‘é€å¹¿æ’­">å‘é€å¹¿æ’­
&lt;/h4>&lt;h5 id="1-æ ‡å‡†å¹¿æ’­normal-broadcast">1. æ ‡å‡†å¹¿æ’­ï¼ˆNormal Broadcastï¼‰
&lt;/h5>&lt;p>æ‰€æœ‰æ¥æ”¶å™¨å‡ ä¹åŒæ—¶æ”¶åˆ°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å‘é€å¹¿æ’­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#e6db74">&amp;#34;com.example.ACTION_CUSTOM&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>intent.putExtra(&lt;span style="color:#e6db74">&amp;#34;data&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Hello Broadcast&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sendBroadcast(intent)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¥æ”¶å¹¿æ’­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyReceiver&lt;/span> : BroadcastReceiver() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onReceive&lt;/span>(context: Context, intent: Intent) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> data = intent.getStringExtra(&lt;span style="color:#e6db74">&amp;#34;data&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;Receiver&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;æ”¶åˆ°: &lt;/span>&lt;span style="color:#e6db74">$data&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-æœ‰åºå¹¿æ’­ordered-broadcast">2. æœ‰åºå¹¿æ’­ï¼ˆOrdered Broadcastï¼‰
&lt;/h5>&lt;p>æŒ‰ä¼˜å…ˆçº§ä¸€æ¬¡ä¼ é€’ï¼Œå¯æ‹¦æˆª&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å‘é€æœ‰åºå¹¿æ’­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#e6db74">&amp;#34;com.example.ACTION_ORDERED&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sendOrderedBroadcast(intent, &lt;span style="color:#66d9ef">null&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&amp;lt;!&lt;span style="color:#f92672">--&lt;/span> è®¾ç½®ä¼˜å…ˆçº§ &lt;span style="color:#f92672">--&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;&lt;span style="color:#66d9ef">receiver&lt;/span> android:name=&lt;span style="color:#e6db74">&amp;#34;.HighPriorityReceiver&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;intent-filter android:priority=&lt;span style="color:#e6db74">&amp;#34;1000&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;action android:name=&lt;span style="color:#e6db74">&amp;#34;com.example.ACTION_ORDERED&amp;#34;&lt;/span> /&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="contentprovider">ContentProvider
&lt;/h4>&lt;p>&lt;strong>ContentProvider&lt;/strong> = è·¨åº”ç”¨å…±äº«æ•°æ®çš„æ ‡å‡†æ¥å£&lt;/p>
&lt;pre tabindex="0">&lt;code>åº”ç”¨ A (æ•°æ®æä¾›è€…) åº”ç”¨ B (æ•°æ®ä½¿ç”¨è€…)
â†“ â†“
ContentProvider â†â”€â”€â”€â”€â”€URIâ”€â”€â”€â”€â†’ ContentResolver
â†“
æ•°æ®åº“/æ–‡ä»¶/ç½‘ç»œ
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="contentproviderçš„ä½œç”¨">ContentProviderçš„ä½œç”¨
&lt;/h4>&lt;h5 id="1-è·¨åº”ç”¨æ•°æ®å…±äº«">1. è·¨åº”ç”¨æ•°æ®å…±äº«
&lt;/h5>&lt;pre tabindex="0">&lt;code>è”ç³»äººåº”ç”¨ â†’ ContentProvider â†’ å…¶ä»–åº”ç”¨è¯»å–è”ç³»äºº
ç›¸å†Œåº”ç”¨ â†’ ContentProvider â†’ å…¶ä»–åº”ç”¨è¯»å–å›¾ç‰‡
&lt;/code>&lt;/pre>&lt;h5 id="2-ç»Ÿä¸€æ•°æ®è®¿é—®æ¥å£">2. ç»Ÿä¸€æ•°æ®è®¿é—®æ¥å£
&lt;/h5>&lt;pre tabindex="0">&lt;code>ä¸ç®¡æ•°æ®å­˜åœ¨å“ªé‡Œï¼ˆæ•°æ®åº“/æ–‡ä»¶/ç½‘ç»œï¼‰
éƒ½é€šè¿‡ç»Ÿä¸€çš„ URI è®¿é—®
content://com.example.provider/users/1
content://com.android.contacts/contacts/1
&lt;/code>&lt;/pre>&lt;h5 id="3-æ•°æ®å®‰å…¨æ§åˆ¶">3. æ•°æ®å®‰å…¨æ§åˆ¶
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>å¯ä»¥æ§åˆ¶&lt;span style="color:#960050;background-color:#1e0010">ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- å“ªäº›åº”ç”¨å¯ä»¥è®¿é—®
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- å“ªäº›æ•°æ®å¯ä»¥è®¿é—®&lt;span style="color:#960050;background-color:#1e0010">ï¼ˆ&lt;/span>è¯»/å†™æƒé™&lt;span style="color:#960050;background-color:#1e0010">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- æ•°æ®è®¿é—®çš„ç²’åº¦
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="contentprovideræ¶æ„">ContentProvideræ¶æ„
&lt;/h4>&lt;p>&lt;strong>URI&lt;/strong>ç»“æ„&lt;/p>
&lt;pre tabindex="0">&lt;code>content://authority/path/id
â†‘ â†‘ â†‘ â†‘
åè®® æ ‡è¯†ç¬¦ è·¯å¾„ ID
ç¤ºä¾‹ï¼š
content://com.example.provider/users
content://com.example.provider/users/123
content://com.android.contacts/contacts
content://media/external/images/media
&lt;/code>&lt;/pre>&lt;p>ç»„ä»¶å…³ç³»&lt;/p>
&lt;pre tabindex="0">&lt;code>åº”ç”¨ A åº”ç”¨ B
â†“ â†“
ContentProvider ContentResolver
â†“ â†“
query() query()
insert() insert()
update() update()
delete() delete()
â†“
å®é™…æ•°æ®å­˜å‚¨ (SQLite/æ–‡ä»¶ç­‰)
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="åˆ›å»ºcontentprovider">åˆ›å»ºContentProvider
&lt;/h4>&lt;h5 id="æ­¥éª¤1å®šä¹‰æ•°æ®æ¨¡å‹">æ­¥éª¤1:å®šä¹‰æ•°æ®æ¨¡å‹
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Contract ç±»ï¼ˆå®šä¹‰ URI å’Œåˆ—åï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#a6e22e">UserContract&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> AUTHORITY = &lt;span style="color:#e6db74">&amp;#34;com.example.provider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> CONTENT_URI: Uri = &lt;span style="color:#a6e22e">Uri&lt;/span>.parse(&lt;span style="color:#e6db74">&amp;#34;content://&lt;/span>&lt;span style="color:#e6db74">$AUTHORITY&lt;/span>&lt;span style="color:#e6db74">/users&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#a6e22e">Columns&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> ID = &lt;span style="color:#e6db74">&amp;#34;_id&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> NAME = &lt;span style="color:#e6db74">&amp;#34;name&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> EMAIL = &lt;span style="color:#e6db74">&amp;#34;email&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> AGE = &lt;span style="color:#e6db74">&amp;#34;age&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="æ­¥éª¤2åˆ›å»ºæ•°æ®åº“helperå¯é€‰">æ­¥éª¤2ï¼šåˆ›å»ºæ•°æ®åº“Helper(å¯é€‰)
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">DatabaseHelper&lt;/span>(context: Context) : SQLiteOpenHelper(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> context,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;users.db&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">null&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreate&lt;/span>(db: SQLiteDatabase) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> db.execSQL(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> CREATE TABLE users (
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> _id INTEGER PRIMARY KEY AUTOINCREMENT,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> name TEXT NOT NULL,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> email TEXT,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> age INTEGER
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onUpgrade&lt;/span>(db: SQLiteDatabase, oldVersion: Int, newVersion: Int) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> db.execSQL(&lt;span style="color:#e6db74">&amp;#34;DROP TABLE IF EXISTS users&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> onCreate(db)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å®ç°contentprovider">å®ç°ContentProvider
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">UserProvider&lt;/span> : ContentProvider() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">lateinit&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> dbHelper: DatabaseHelper
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> uriMatcher = UriMatcher(&lt;span style="color:#a6e22e">UriMatcher&lt;/span>.NO_MATCH).apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> addURI(&lt;span style="color:#a6e22e">UserContract&lt;/span>.AUTHORITY, &lt;span style="color:#e6db74">&amp;#34;users&amp;#34;&lt;/span>, USERS)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> addURI(&lt;span style="color:#a6e22e">UserContract&lt;/span>.AUTHORITY, &lt;span style="color:#e6db74">&amp;#34;users/#&amp;#34;&lt;/span>, USER_ID)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">companion&lt;/span> &lt;span style="color:#66d9ef">object&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> USERS = &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> USER_ID = &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. åˆå§‹åŒ–ï¼ˆåœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreate&lt;/span>(): Boolean {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dbHelper = DatabaseHelper(context&lt;span style="color:#f92672">!!&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. æŸ¥è¯¢æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">query&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uri: Uri,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> projection: Array&amp;lt;String&amp;gt;?,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selection: String?,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selectionArgs: Array&amp;lt;String&amp;gt;?,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sortOrder: String?
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ): Cursor? {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> db = dbHelper.readableDatabase
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">when&lt;/span> (uriMatcher.match(uri)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> USERS &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> db.query(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;users&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> projection,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selection,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selectionArgs,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">null&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">null&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sortOrder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> USER_ID &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŸ¥è¯¢æŒ‡å®š ID çš„ç”¨æˆ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> id = uri.lastPathSegment
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> db.query(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;users&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> projection,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${UserContract.Columns.ID}&lt;/span>&lt;span style="color:#e6db74"> = ?&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> arrayOf(id),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">null&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">null&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sortOrder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">throw&lt;/span> IllegalArgumentException(&lt;span style="color:#e6db74">&amp;#34;Unknown URI: &lt;/span>&lt;span style="color:#e6db74">$uri&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. æ’å…¥æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">insert&lt;/span>(uri: Uri, values: ContentValues?): Uri? {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> db = dbHelper.writableDatabase
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">when&lt;/span> (uriMatcher.match(uri)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> USERS &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> id = db.insert(&lt;span style="color:#e6db74">&amp;#34;users&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">null&lt;/span>, values)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (id &amp;gt; &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> newUri = &lt;span style="color:#a6e22e">ContentUris&lt;/span>.withAppendedId(&lt;span style="color:#a6e22e">UserContract&lt;/span>.CONTENT_URI, id)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šçŸ¥æ•°æ®å˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> context&lt;span style="color:#f92672">?.&lt;/span>contentResolver&lt;span style="color:#f92672">?.&lt;/span>notifyChange(newUri, &lt;span style="color:#66d9ef">null&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> newUri
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">throw&lt;/span> IllegalArgumentException(&lt;span style="color:#e6db74">&amp;#34;Unknown URI: &lt;/span>&lt;span style="color:#e6db74">$uri&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. æ›´æ–°æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">update&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uri: Uri,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> values: ContentValues?,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selection: String?,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selectionArgs: Array&amp;lt;String&amp;gt;?
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ): Int {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> db = dbHelper.writableDatabase
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> count = &lt;span style="color:#66d9ef">when&lt;/span> (uriMatcher.match(uri)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> USERS &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> db.update(&lt;span style="color:#e6db74">&amp;#34;users&amp;#34;&lt;/span>, values, selection, selectionArgs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> USER_ID &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> id = uri.lastPathSegment
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> db.update(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;users&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> values,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${UserContract.Columns.ID}&lt;/span>&lt;span style="color:#e6db74"> = ?&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> arrayOf(id)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">throw&lt;/span> IllegalArgumentException(&lt;span style="color:#e6db74">&amp;#34;Unknown URI: &lt;/span>&lt;span style="color:#e6db74">$uri&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (count &amp;gt; &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> context&lt;span style="color:#f92672">?.&lt;/span>contentResolver&lt;span style="color:#f92672">?.&lt;/span>notifyChange(uri, &lt;span style="color:#66d9ef">null&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> count
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 5. åˆ é™¤æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">delete&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uri: Uri,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selection: String?,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selectionArgs: Array&amp;lt;String&amp;gt;?
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ): Int {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> db = dbHelper.writableDatabase
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> count = &lt;span style="color:#66d9ef">when&lt;/span> (uriMatcher.match(uri)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> USERS &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> db.delete(&lt;span style="color:#e6db74">&amp;#34;users&amp;#34;&lt;/span>, selection, selectionArgs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> USER_ID &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> id = uri.lastPathSegment
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> db.delete(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;users&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${UserContract.Columns.ID}&lt;/span>&lt;span style="color:#e6db74"> = ?&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> arrayOf(id)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">throw&lt;/span> IllegalArgumentException(&lt;span style="color:#e6db74">&amp;#34;Unknown URI: &lt;/span>&lt;span style="color:#e6db74">$uri&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (count &amp;gt; &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> context&lt;span style="color:#f92672">?.&lt;/span>contentResolver&lt;span style="color:#f92672">?.&lt;/span>notifyChange(uri, &lt;span style="color:#66d9ef">null&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> count
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 6. è¿”å› MIME ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">getType&lt;/span>(uri: Uri): String? {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">when&lt;/span> (uriMatcher.match(uri)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> USERS &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;vnd.android.cursor.dir/vnd.com.example.provider.users&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> USER_ID &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;vnd.android.cursor.item/vnd.com.example.provider.users&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">throw&lt;/span> IllegalArgumentException(&lt;span style="color:#e6db74">&amp;#34;Unknown URI: &lt;/span>&lt;span style="color:#e6db74">$uri&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="æ­¥éª¤4æ³¨å†Œprovider">æ­¥éª¤4:æ³¨å†ŒProvider
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!-- AndroidManifest.xml --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;manifest&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;application&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;provider&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;.UserProvider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:authorities=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.provider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:exported=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:permission=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.READ_USERS&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- æˆäºˆå…¶ä»–åº”ç”¨è¯»å†™æƒé™ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;grant-uri-permission&lt;/span> &lt;span style="color:#a6e22e">android:pathPattern=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/users/.*&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/provider&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/application&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å®šä¹‰æƒé™ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;permission&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.READ_USERS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:protectionLevel=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;normal&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;permission&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.WRITE_USERS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:protectionLevel=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;normal&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/manifest&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="ä½¿ç”¨contentprovider">ä½¿ç”¨ContentProvider
&lt;/h4>&lt;p>&lt;strong>æŸ¥è¯¢æ•°æ®&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MainActivity&lt;/span> : AppCompatActivity() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">queryUsers&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. è·å– ContentResolver
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> resolver = contentResolver
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. æ„å»ºæŸ¥è¯¢
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> uri = &lt;span style="color:#a6e22e">Uri&lt;/span>.parse(&lt;span style="color:#e6db74">&amp;#34;content://com.example.provider/users&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> projection = arrayOf(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">UserContract&lt;/span>.&lt;span style="color:#a6e22e">Columns&lt;/span>.ID,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">UserContract&lt;/span>.&lt;span style="color:#a6e22e">Columns&lt;/span>.NAME,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">UserContract&lt;/span>.&lt;span style="color:#a6e22e">Columns&lt;/span>.EMAIL
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> selection = &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${UserContract.Columns.AGE}&lt;/span>&lt;span style="color:#e6db74"> &amp;gt; ?&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> selectionArgs = arrayOf(&lt;span style="color:#e6db74">&amp;#34;18&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> sortOrder = &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${UserContract.Columns.NAME}&lt;/span>&lt;span style="color:#e6db74"> ASC&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. æ‰§è¡ŒæŸ¥è¯¢
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> cursor = resolver.query(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uri,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> projection,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selection,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selectionArgs,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sortOrder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. å¤„ç†ç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> cursor&lt;span style="color:#f92672">?.&lt;/span>use {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#66d9ef">it&lt;/span>.moveToNext()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> id = &lt;span style="color:#66d9ef">it&lt;/span>.getLong(&lt;span style="color:#66d9ef">it&lt;/span>.getColumnIndexOrThrow(&lt;span style="color:#a6e22e">UserContract&lt;/span>.&lt;span style="color:#a6e22e">Columns&lt;/span>.ID))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> name = &lt;span style="color:#66d9ef">it&lt;/span>.getString(&lt;span style="color:#66d9ef">it&lt;/span>.getColumnIndexOrThrow(&lt;span style="color:#a6e22e">UserContract&lt;/span>.&lt;span style="color:#a6e22e">Columns&lt;/span>.NAME))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> email = &lt;span style="color:#66d9ef">it&lt;/span>.getString(&lt;span style="color:#66d9ef">it&lt;/span>.getColumnIndexOrThrow(&lt;span style="color:#a6e22e">UserContract&lt;/span>.&lt;span style="color:#a6e22e">Columns&lt;/span>.EMAIL))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;User&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;ID: &lt;/span>&lt;span style="color:#e6db74">$id&lt;/span>&lt;span style="color:#e6db74">, Name: &lt;/span>&lt;span style="color:#e6db74">$name&lt;/span>&lt;span style="color:#e6db74">, Email: &lt;/span>&lt;span style="color:#e6db74">$email&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ’å…¥æ•°æ®&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">insertUser&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> resolver = contentResolver
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> uri = &lt;span style="color:#a6e22e">Uri&lt;/span>.parse(&lt;span style="color:#e6db74">&amp;#34;content://com.example.provider/users&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> values = ContentValues().apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> put(&lt;span style="color:#a6e22e">UserContract&lt;/span>.&lt;span style="color:#a6e22e">Columns&lt;/span>.NAME, &lt;span style="color:#e6db74">&amp;#34;Alice&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> put(&lt;span style="color:#a6e22e">UserContract&lt;/span>.&lt;span style="color:#a6e22e">Columns&lt;/span>.EMAIL, &lt;span style="color:#e6db74">&amp;#34;alice@example.com&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> put(&lt;span style="color:#a6e22e">UserContract&lt;/span>.&lt;span style="color:#a6e22e">Columns&lt;/span>.AGE, &lt;span style="color:#ae81ff">25&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> newUri = resolver.insert(uri, values)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;Insert&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;æ–°ç”¨æˆ· URI: &lt;/span>&lt;span style="color:#e6db74">$newUri&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ›´æ–°æ•°æ®&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">updateUser&lt;/span>(userId: Long) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> resolver = contentResolver
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> uri = &lt;span style="color:#a6e22e">ContentUris&lt;/span>.withAppendedId(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Uri&lt;/span>.parse(&lt;span style="color:#e6db74">&amp;#34;content://com.example.provider/users&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> userId
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> values = ContentValues().apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> put(&lt;span style="color:#a6e22e">UserContract&lt;/span>.&lt;span style="color:#a6e22e">Columns&lt;/span>.EMAIL, &lt;span style="color:#e6db74">&amp;#34;newemail@example.com&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> count = resolver.update(uri, values, &lt;span style="color:#66d9ef">null&lt;/span>, &lt;span style="color:#66d9ef">null&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;Update&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;æ›´æ–°äº† &lt;/span>&lt;span style="color:#e6db74">$count&lt;/span>&lt;span style="color:#e6db74"> æ¡è®°å½•&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>åˆ é™¤æ•°æ®&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">deleteUser&lt;/span>(userId: Long) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> resolver = contentResolver
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> uri = &lt;span style="color:#a6e22e">ContentUris&lt;/span>.withAppendedId(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Uri&lt;/span>.parse(&lt;span style="color:#e6db74">&amp;#34;content://com.example.provider/users&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> userId
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> count = resolver.delete(uri, &lt;span style="color:#66d9ef">null&lt;/span>, &lt;span style="color:#66d9ef">null&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;Delete&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;åˆ é™¤äº† &lt;/span>&lt;span style="color:#e6db74">$count&lt;/span>&lt;span style="color:#e6db74"> æ¡è®°å½•&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="ç›‘å¬æ•°æ®å˜åŒ–">ç›‘å¬æ•°æ®å˜åŒ–
&lt;/h4>&lt;p>&lt;strong>ContentObserver&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MainActivity&lt;/span> : AppCompatActivity() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> userObserver = &lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">: &lt;/span>&lt;span style="color:#a6e22e">ContentObserver&lt;/span>(Handler(&lt;span style="color:#a6e22e">Looper&lt;/span>.getMainLooper())) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onChange&lt;/span>(selfChange: Boolean, uri: Uri?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onChange(selfChange, uri)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Log&lt;/span>.d(&lt;span style="color:#e6db74">&amp;#34;Observer&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;æ•°æ®å˜åŒ–: &lt;/span>&lt;span style="color:#e6db74">$uri&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é‡æ–°æŸ¥è¯¢æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> queryUsers()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreate&lt;/span>(savedInstanceState: Bundle?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onCreate(savedInstanceState)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ³¨å†Œè§‚å¯Ÿè€…
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> contentResolver.registerContentObserver(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Uri&lt;/span>.parse(&lt;span style="color:#e6db74">&amp;#34;content://com.example.provider/users&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">true&lt;/span>, &lt;span style="color:#75715e">// ç›‘å¬æ‰€æœ‰å­ URI
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> userObserver
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onDestroy&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onDestroy()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å–æ¶ˆæ³¨å†Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> contentResolver.unregisterContentObserver(userObserver)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="æƒé™æ§åˆ¶">æƒé™æ§åˆ¶
&lt;/h4>&lt;h5 id="å®šä¹‰æƒé™">å®šä¹‰æƒé™
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!-- AndroidManifest.xml --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;manifest&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å®šä¹‰æƒé™ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;permission&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.READ_USERS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:label=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;è¯»å–ç”¨æˆ·æ•°æ®&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:description=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;å…è®¸è¯»å–ç”¨æˆ·æ•°æ®&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:protectionLevel=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;normal&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;permission&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.WRITE_USERS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:label=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;å†™å…¥ç”¨æˆ·æ•°æ®&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:protectionLevel=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;normal&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;application&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;provider&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;.UserProvider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:authorities=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.provider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:exported=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:readPermission=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.READ_USERS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:writePermission=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.WRITE_USERS&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/application&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/manifest&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="è¯·æ±‚æƒé™">è¯·æ±‚æƒé™
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!-- å…¶ä»–åº”ç”¨çš„ Manifest --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;manifest&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;uses-permission&lt;/span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.READ_USERS&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;uses-permission&lt;/span> &lt;span style="color:#a6e22e">android:name=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;com.example.WRITE_USERS&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/manifest&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ä¸´æ—¶æˆæƒuriæƒé™">ä¸´æ—¶æˆæƒ(URIæƒé™)
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æˆäºˆå…¶ä»–åº”ç”¨ä¸´æ—¶è®¿é—®æƒé™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> intent = Intent(&lt;span style="color:#a6e22e">Intent&lt;/span>.ACTION_VIEW)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>intent.&lt;span style="color:#66d9ef">data&lt;/span> = &lt;span style="color:#a6e22e">Uri&lt;/span>.parse(&lt;span style="color:#e6db74">&amp;#34;content://com.example.provider/users/1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>intent.addFlags(&lt;span style="color:#a6e22e">Intent&lt;/span>.FLAG_GRANT_READ_URI_PERMISSION)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>startActivity(intent)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Surfaceä½“ç³»æŒ‡å—</title><link>https://www.dust-zed.site/android-develop/surface%E4%BD%93%E7%B3%BB%E6%8C%87%E5%8D%97/</link><pubDate>Sun, 19 Oct 2025 13:50:30 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/surface%E4%BD%93%E7%B3%BB%E6%8C%87%E5%8D%97/</guid><description>&lt;h4 id="ä»€ä¹ˆæ˜¯surface">ä»€ä¹ˆæ˜¯surfaceï¼Ÿ
&lt;/h4>&lt;h5 id="é€šä¿—ç†è§£">é€šä¿—ç†è§£
&lt;/h5>&lt;p>&lt;strong>Surface&lt;/strong> = ä¸€å—ç”¨äºç»˜åˆ¶å†…å®¹çš„â€œç”»å¸ƒâ€&lt;/p>
&lt;p>Androidæœ‰å¤šå±‚å«ä¹‰çš„ Surface æ¦‚å¿µï¼Œå®¹æ˜“æ··æ·†ï¼š&lt;/p>
&lt;ol>
&lt;li>åº•å±‚å›¾å½¢ç³»ç»Ÿçš„&lt;strong>Surface&lt;/strong>ï¼ˆæœ¬è´¨ï¼‰&lt;/li>
&lt;li>&lt;strong>Material Design&lt;/strong>çš„&lt;strong>Surface&lt;/strong> ï¼ˆè®¾è®¡æ¦‚å¿µï¼‰&lt;/li>
&lt;li>&lt;strong>Compose&lt;/strong>çš„&lt;strong>Surface&lt;/strong>ç»„ä»¶ï¼ˆUIç»„ä»¶ï¼‰&lt;/li>
&lt;li>&lt;strong>SurfaceView&lt;/strong>å’Œ&lt;strong>TextureView&lt;/strong>ï¼ˆç‰¹æ®Šè§†å›¾ï¼‰&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h5 id="å±‚æ¬¡æ¶æ„">å±‚æ¬¡æ¶æ„
&lt;/h5>&lt;pre tabindex="0">&lt;code>åº”ç”¨å±‚
â†“
Material Surface (è®¾è®¡æ¦‚å¿µï¼šèƒŒæ™¯ã€å¡ç‰‡ã€å¯¹è¯æ¡†)
â†“
UI ç»„ä»¶ (Compose Surface / View / SurfaceView)
â†“
Android View System / Compose Runtime
â†“
åº•å±‚ Surface (å®é™…çš„æ¸²æŸ“ç›®æ ‡)
â†“
SurfaceFlinger (ç³»ç»Ÿåˆæˆå™¨)
â†“
å±å¹•æ˜¾ç¤º
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="1-material-design-ä¸­çš„surface">1. Material Design ä¸­çš„Surface
&lt;/h4>&lt;h5 id="ä»€ä¹ˆæ˜¯surfaceè®¾è®¡æ¦‚å¿µ">ä»€ä¹ˆæ˜¯Surfaceï¼ˆè®¾è®¡æ¦‚å¿µï¼‰ï¼Ÿ
&lt;/h5>&lt;p>åœ¨Material Designä¸­ï¼Œ&lt;strong>Surface&lt;/strong>æ˜¯æ‰¿è½½å†…å®¹çš„å®¹å™¨:&lt;/p>
&lt;pre tabindex="0">&lt;code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨èƒŒæ™¯ (Background) â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Surface (å¡ç‰‡) â”‚ â”‚ â† æœ‰é˜´å½±ã€åœ†è§’
â”‚ â”‚ [å†…å®¹] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Surface (å¯¹è¯æ¡†) â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="2-composeä¸­çš„surfaceç»„ä»¶">2. Composeä¸­çš„Surfaceç»„ä»¶
&lt;/h4>&lt;h5 id="surfaceçš„ä½œç”¨">Surfaceçš„ä½œç”¨
&lt;/h5>&lt;p>Composeçš„&lt;code>Surface&lt;/code>æ˜¯ä¸€ä¸ªå®¹å™¨ç»„ä»¶ï¼Œæä¾›ï¼š&lt;/p>
&lt;ul>
&lt;li>èƒŒæ™¯è‰²&lt;/li>
&lt;li>å½¢çŠ¶ï¼ˆåœ†è§’ã€åˆ‡è§’ï¼‰&lt;/li>
&lt;li>è¾¹æ¡†&lt;/li>
&lt;li>é˜´å½±/é«˜åº¦&lt;/li>
&lt;li>ç‚¹å‡»æ•ˆæœ&lt;/li>
&lt;/ul>
&lt;h5 id="åŸºç¡€ç”¨æ³•">åŸºç¡€ç”¨æ³•
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> androidx.compose.material3.Surface
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> androidx.compose.material3.MaterialTheme
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Composable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">BasicSurface&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœ€ç®€å•çš„ Surface
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Surface {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Text(&lt;span style="color:#e6db74">&amp;#34;Hello World&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è‡ªå®šä¹‰å±æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Surface(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> modifier = Modifier
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .fillMaxWidth()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .padding(&lt;span style="color:#ae81ff">16.&lt;/span>dp),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> color = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.colorScheme.primaryContainer, &lt;span style="color:#75715e">// èƒŒæ™¯è‰²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> contentColor = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.colorScheme.onPrimaryContainer, &lt;span style="color:#75715e">// å†…å®¹è‰²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> tonalElevation = &lt;span style="color:#ae81ff">2.&lt;/span>dp, &lt;span style="color:#75715e">// é«˜åº¦ï¼ˆå½±å“é¢œè‰²æ·±æµ…ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> shadowElevation = &lt;span style="color:#ae81ff">4.&lt;/span>dp, &lt;span style="color:#75715e">// é˜´å½±é«˜åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> shape = RoundedCornerShape(&lt;span style="color:#ae81ff">12.&lt;/span>dp), &lt;span style="color:#75715e">// å½¢çŠ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> border = BorderStroke(&lt;span style="color:#ae81ff">1.&lt;/span>dp, &lt;span style="color:#a6e22e">Color&lt;/span>.Gray) &lt;span style="color:#75715e">// è¾¹æ¡†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Column(modifier = &lt;span style="color:#a6e22e">Modifier&lt;/span>.padding(&lt;span style="color:#ae81ff">16.&lt;/span>dp)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Text(&lt;span style="color:#e6db74">&amp;#34;æ ‡é¢˜&amp;#34;&lt;/span>, style = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.typography.titleLarge)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Text(&lt;span style="color:#e6db74">&amp;#34;å†…å®¹&amp;#34;&lt;/span>, style = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.typography.bodyMedium)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="surface-vs-box-vs-card">Surface vs Box vs Card
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Boxï¼šçº¯å¸ƒå±€å®¹å™¨ï¼Œæ— æ ·å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>Box(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> modifier = Modifier
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .background(&lt;span style="color:#a6e22e">Color&lt;/span>.White) &lt;span style="color:#75715e">// æ‰‹åŠ¨è®¾ç½®èƒŒæ™¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .padding(&lt;span style="color:#ae81ff">16.&lt;/span>dp)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Text(&lt;span style="color:#e6db74">&amp;#34;Content&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Surfaceï¼šæœ‰èƒŒæ™¯ã€å½¢çŠ¶ã€é«˜åº¦çš„å®¹å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>Surface(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> color = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.colorScheme.surface,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tonalElevation = &lt;span style="color:#ae81ff">2.&lt;/span>dp,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> shape = RoundedCornerShape(&lt;span style="color:#ae81ff">8.&lt;/span>dp)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Text(&lt;span style="color:#e6db74">&amp;#34;Content&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Cardï¼šé¢„é…ç½®çš„ Surfaceï¼ˆè‡ªå¸¦ paddingã€åœ†è§’ã€é˜´å½±ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>Card(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> modifier = &lt;span style="color:#a6e22e">Modifier&lt;/span>.fillMaxWidth()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Text(&lt;span style="color:#e6db74">&amp;#34;Content&amp;#34;&lt;/span>, modifier = &lt;span style="color:#a6e22e">Modifier&lt;/span>.padding(&lt;span style="color:#ae81ff">16.&lt;/span>dp))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="é€‰æ‹©å»ºè®®">é€‰æ‹©å»ºè®®
&lt;/h6>&lt;ul>
&lt;li>éœ€è¦è‡ªå®šä¹‰å½¢çŠ¶/é˜´å½± â†’ &lt;code>Surface&lt;/code>&lt;/li>
&lt;li>å¡ç‰‡æ ·å¼ â†’ &lt;code>Card&lt;/code>ï¼ˆæœ¬è´¨æ˜¯é¢„è®¾å¥½çš„Surfaceï¼‰&lt;/li>
&lt;li>çº¯å¸ƒå±€ â†’ &lt;code>Box&lt;/code>&lt;/li>
&lt;/ul>
&lt;h5 id="å®æˆ˜å¡ç‰‡åˆ—è¡¨">å®æˆ˜ï¼šå¡ç‰‡åˆ—è¡¨
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Composable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">ProductCard&lt;/span>(product: Product) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Surface(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> modifier = Modifier
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .fillMaxWidth()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .padding(horizontal = &lt;span style="color:#ae81ff">16.&lt;/span>dp, vertical = &lt;span style="color:#ae81ff">8.&lt;/span>dp),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> shape = RoundedCornerShape(&lt;span style="color:#ae81ff">16.&lt;/span>dp),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> color = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.colorScheme.surface,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tonalElevation = &lt;span style="color:#ae81ff">2.&lt;/span>dp,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> shadowElevation = &lt;span style="color:#ae81ff">4.&lt;/span>dp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Row(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> modifier = &lt;span style="color:#a6e22e">Modifier&lt;/span>.padding(&lt;span style="color:#ae81ff">16.&lt;/span>dp),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> horizontalArrangement = &lt;span style="color:#a6e22e">Arrangement&lt;/span>.spacedBy(&lt;span style="color:#ae81ff">16.&lt;/span>dp)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// äº§å“å›¾ç‰‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Surface(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> shape = RoundedCornerShape(&lt;span style="color:#ae81ff">8.&lt;/span>dp),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> modifier = &lt;span style="color:#a6e22e">Modifier&lt;/span>.size(&lt;span style="color:#ae81ff">80.&lt;/span>dp)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> AsyncImage(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model = product.imageUrl,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> contentDescription = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// äº§å“ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Column(modifier = &lt;span style="color:#a6e22e">Modifier&lt;/span>.weight(&lt;span style="color:#ae81ff">1f&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Text(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text = product.name,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> style = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.typography.titleMedium
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Text(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text = product.description,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> style = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.typography.bodySmall,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> color = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.colorScheme.onSurfaceVariant
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Text(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text = &lt;span style="color:#e6db74">&amp;#34;$&lt;/span>&lt;span style="color:#e6db74">${product.price}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> style = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.typography.titleLarge,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> color = &lt;span style="color:#a6e22e">MaterialTheme&lt;/span>.colorScheme.primary
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="3-ä¼ ç»Ÿviewä¸­çš„surface">3. ä¼ ç»ŸViewä¸­çš„Surface
&lt;/h4>&lt;h5 id="materialcardviewå¸¸ç”¨">MaterialCardView(å¸¸ç”¨)
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!-- res/layout/item_card.xml --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;com.google.android.material.card.MaterialCardView&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:layout_width=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:layout_height=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;wrap_content&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">app:cardBackgroundColor=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;?attr/colorSurface&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">app:cardElevation=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;4dp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">app:cardCornerRadius=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;12dp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">app:strokeColor=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;?attr/colorOutline&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">app:strokeWidth=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;1dp&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;LinearLayout&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:layout_width=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:layout_height=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;wrap_content&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:orientation=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;vertical&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:padding=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;16dp&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;TextView&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:layout_width=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;wrap_content&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:layout_height=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;wrap_content&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:text=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;æ ‡é¢˜&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:textColor=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;?attr/colorOnSurface&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:textAppearance=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;?attr/textAppearanceTitleMedium&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;TextView&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:layout_width=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;wrap_content&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:layout_height=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;wrap_content&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:layout_marginTop=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;8dp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:text=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;å†…å®¹&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:textColor=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;?attr/colorOnSurfaceVariant&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">android:textAppearance=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;?attr/textAppearanceBodyMedium&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/LinearLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/com.google.android.material.card.MaterialCardView&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å¯¹è¯æ¡†dialogfragment">å¯¹è¯æ¡†ï¼ˆDialogFragmentï¼‰
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyDialogFragment&lt;/span> : DialogFragment() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreateDialog&lt;/span>(savedInstanceState: Bundle?): Dialog {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> MaterialAlertDialogBuilder(requireContext())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .setTitle(&lt;span style="color:#e6db74">&amp;#34;æ ‡é¢˜&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .setMessage(&lt;span style="color:#e6db74">&amp;#34;æ¶ˆæ¯å†…å®¹&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .setPositiveButton(&lt;span style="color:#e6db74">&amp;#34;ç¡®å®š&amp;#34;&lt;/span>) { _, _ &lt;span style="color:#f92672">-&amp;gt;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .setNegativeButton(&lt;span style="color:#e6db74">&amp;#34;å–æ¶ˆ&amp;#34;&lt;/span>) { _, _ &lt;span style="color:#f92672">-&amp;gt;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .create()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¯¹è¯æ¡†è‡ªåŠ¨ä½¿ç”¨ ?attr/colorSurface ä½œä¸ºèƒŒæ™¯
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="4-åº•å±‚surfacesurfaceview--textureview">4. åº•å±‚Surfaceï¼ˆSurfaceView / TextureViewï¼‰
&lt;/h4>&lt;h5 id="ä»€ä¹ˆæ—¶å€™ç”¨">ä»€ä¹ˆæ—¶å€™ç”¨
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>View&lt;/strong>
&lt;ul>
&lt;li>æ™®é€šUI&lt;/li>
&lt;li>æ€§èƒ½ä¸€èˆ¬&lt;/li>
&lt;li>ä¸»çº¿ç¨‹ç»˜åˆ¶&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>SurfaceView&lt;/strong>
&lt;ul>
&lt;li>è§†é¢‘æ’­æ”¾ã€ç›¸æœºé¢„è§ˆ&lt;/li>
&lt;li>æ€§èƒ½é«˜&lt;/li>
&lt;li>ç‹¬ç«‹Surfaceï¼Œåå°çº¿ç¨‹ç»˜åˆ¶&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>TextureView&lt;/strong>
&lt;ul>
&lt;li>éœ€è¦åŠ¨ç”»/å˜æ¢çš„è§†é¢‘&lt;/li>
&lt;li>æ€§èƒ½ä¸­ç­‰&lt;/li>
&lt;li>å¯ä»¥åšåŠ¨ç”»ï¼Œä½†æ€§èƒ½è¾ƒä½&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="surfaceviewç¤ºä¾‹">SurfaceViewç¤ºä¾‹
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">VideoPlayerActivity&lt;/span> : AppCompatActivity() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">lateinit&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> surfaceView: SurfaceView
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> mediaPlayer: MediaPlayer? = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onCreate&lt;/span>(savedInstanceState: Bundle?) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">super&lt;/span>.onCreate(savedInstanceState)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> surfaceView = SurfaceView(&lt;span style="color:#66d9ef">this&lt;/span>).apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> layoutParams = &lt;span style="color:#a6e22e">ViewGroup&lt;/span>.LayoutParams(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">ViewGroup&lt;/span>.&lt;span style="color:#a6e22e">LayoutParams&lt;/span>.MATCH_PARENT,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">ViewGroup&lt;/span>.&lt;span style="color:#a6e22e">LayoutParams&lt;/span>.MATCH_PARENT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setContentView(surfaceView)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç›‘å¬ Surface åˆ›å»º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> surfaceView.holder.addCallback(&lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">: &lt;/span>&lt;span style="color:#a6e22e">SurfaceHolder&lt;/span>.Callback {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">surfaceCreated&lt;/span>(holder: SurfaceHolder) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Surface å‡†å¤‡å¥½äº†ï¼Œå¼€å§‹æ’­æ”¾
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> mediaPlayer = MediaPlayer().apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setDataSource(&lt;span style="color:#e6db74">&amp;#34;https://example.com/video.mp4&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setDisplay(holder)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> prepareAsync()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setOnPreparedListener { start() }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">surfaceChanged&lt;/span>(holder: SurfaceHolder, format: Int, width: Int, height: Int) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Surface å¤§å°æ”¹å˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">surfaceDestroyed&lt;/span>(holder: SurfaceHolder) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Surface é”€æ¯ï¼Œé‡Šæ”¾èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> mediaPlayer&lt;span style="color:#f92672">?.&lt;/span>release()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mediaPlayer = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="surfaceview-vs-textureview">SurfaceView vs TextureView
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// SurfaceViewï¼šæ€§èƒ½æœ€å¥½ï¼Œä½†ä¸èƒ½åšåŠ¨ç”»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> surfaceView = SurfaceView(context)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// âœ… é€‚åˆï¼šè§†é¢‘æ’­æ”¾ã€ç›¸æœºé¢„è§ˆã€æ¸¸æˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// âŒ ä¸é€‚åˆï¼šéœ€è¦é€æ˜åº¦ã€æ—‹è½¬ã€ç¼©æ”¾åŠ¨ç”»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// TextureViewï¼šå¯ä»¥åšåŠ¨ç”»ï¼Œä½†æ€§èƒ½è¾ƒä½
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> textureView = TextureView(context)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>textureView.alpha = &lt;span style="color:#ae81ff">0.5f&lt;/span> &lt;span style="color:#75715e">// âœ… å¯ä»¥è®¾ç½®é€æ˜åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>textureView.rotation = &lt;span style="color:#ae81ff">45f&lt;/span> &lt;span style="color:#75715e">// âœ… å¯ä»¥æ—‹è½¬
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// âœ… é€‚åˆï¼šéœ€è¦åŠ¨ç”»æ•ˆæœçš„è§†é¢‘
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// âŒ ä¸é€‚åˆï¼šè¿½æ±‚æè‡´æ€§èƒ½çš„åœºæ™¯
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="composeä¸­ä½¿ç”¨surfaceview">Composeä¸­ä½¿ç”¨SurfaceView
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">@Composable&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">VideoPlayer&lt;/span>(videoUrl: String) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> AndroidView(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> factory = { context &lt;span style="color:#f92672">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SurfaceView(context).apply {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> holder.addCallback(&lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">: &lt;/span>&lt;span style="color:#a6e22e">SurfaceHolder&lt;/span>.Callback {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">surfaceCreated&lt;/span>(holder: SurfaceHolder) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆå§‹åŒ–è§†é¢‘æ’­æ”¾å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">surfaceChanged&lt;/span>(holder: SurfaceHolder, format: Int, width: Int, height: Int) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">surfaceDestroyed&lt;/span>(holder: SurfaceHolder) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¸…ç†èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> modifier = &lt;span style="color:#a6e22e">Modifier&lt;/span>.fillMaxSize()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="5-åº•å±‚surfaceå·¥ä½œåŸç†">5. åº•å±‚Surfaceå·¥ä½œåŸç†
&lt;/h4>&lt;p>&lt;strong>Surface&lt;/strong>çš„æœ¬è´¨&lt;/p>
&lt;pre tabindex="0">&lt;code>åº”ç”¨è¿›ç¨‹ ç³»ç»Ÿè¿›ç¨‹
â†“ â†“
Canvas.draw() SurfaceFlinger
â†“ â†“
Surface â†â”€â”€â”€â”€â”€å…±äº«å†…å­˜â”€â”€â”€â”€â”€â”€â”€â†’ Surface
â†“ â†“
å†™å…¥åƒç´ æ•°æ® è¯»å–åƒç´ æ•°æ®
â†“
åˆæˆåˆ°å±å¹•
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>Surface = {
SharedBuffer (å…±äº«å†…å­˜)
+ å…ƒæ•°æ® (å®½åº¦ã€é«˜åº¦ã€æ ¼å¼ã€Z-order)
}
&lt;/code>&lt;/pre>&lt;p>å…³é”®ç‚¹ï¼š&lt;/p>
&lt;ol>
&lt;li>æ¯ä¸ªWindowæœ‰ä¸€ä¸ªSurface&lt;/li>
&lt;li>SurfaceViewä¼šåˆ›å»ºç‹¬ç«‹çš„Surfaceï¼ˆä¸åœ¨ä¸»Windowä¸Šï¼‰&lt;/li>
&lt;li>SurfaceFlingerè´Ÿè´£åˆæˆæ‰€æœ‰Surface&lt;/li>
&lt;li>Surfaceé€šè¿‡å…±äº«å†…å­˜ä¼ é€’æ•°æ®ï¼Œé¿å…æ‹·è´&lt;/li>
&lt;/ol>
&lt;h5 id="ä¸ºä»€ä¹ˆsurfaceviewæ€§èƒ½é«˜">ä¸ºä»€ä¹ˆSurfaceViewæ€§èƒ½é«˜ï¼Ÿ
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>æ™®é€š View&lt;span style="color:#960050;background-color:#1e0010">ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ä¸»çº¿ç¨‹ç»˜åˆ¶ &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> ç­‰å¾… VSync &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> æ˜¾ç¤º
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†‘&lt;/span> é˜»å¡ä¸»çº¿ç¨‹
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SurfaceView&lt;span style="color:#960050;background-color:#1e0010">ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>åå°çº¿ç¨‹ç»˜åˆ¶ &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> ç›´æ¥æäº¤ç»™ SurfaceFlinger &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> æ˜¾ç¤º
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ä¸»çº¿ç¨‹ç»§ç»­å¤„ç† UI
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>SurfaceFlinger&lt;/strong>: ç³»ç»Ÿåˆæˆå™¨ï¼Œåˆæˆæ‰€æœ‰åº”ç”¨çš„ç”»é¢&lt;/li>
&lt;li>&lt;strong>Surface&lt;/strong>ï¼šå…±äº«å†…å­˜ï¼Œåº”ç”¨å†™å…¥ï¼Œç³»ç»Ÿè¯»å–&lt;/li>
&lt;li>&lt;strong>Window&lt;/strong>ï¼šçª—å£æŠ½è±¡ï¼Œç®¡ç†Surfaceå’Œè¾“å…¥äº‹ä»¶&lt;/li>
&lt;li>&lt;strong>Canvas&lt;/strong>ï¼šç»˜åˆ¶APIï¼Œæä¾›ç”»å›¾æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;hr></description></item><item><title>Androidé¡¹ç›®ç»„ç»‡ç»“æ„</title><link>https://www.dust-zed.site/android-develop/android%E9%A1%B9%E7%9B%AE%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84/</link><pubDate>Fri, 17 Oct 2025 09:28:07 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/android%E9%A1%B9%E7%9B%AE%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84/</guid><description>&lt;h4 id="é¡¹ç›®ç»“æ„è¯´æ˜">é¡¹ç›®ç»“æ„è¯´æ˜
&lt;/h4>&lt;h5 id="å®Œæ•´ç›®å½•ç»“æ„">å®Œæ•´ç›®å½•ç»“æ„
&lt;/h5>&lt;pre tabindex="0">&lt;code>project/
â”œâ”€â”€ gradle/
â”‚ â””â”€â”€ libs.versions.toml # Version Catalog
â”œâ”€â”€ app/
â”‚ â”œâ”€â”€ build.gradle.kts
â”‚ â””â”€â”€ src/
â”‚ â””â”€â”€ main/
â”‚ â”œâ”€â”€ AndroidManifest.xml
â”‚ â”œâ”€â”€ java/com/example/myapp/
â”‚ â”‚ â””â”€â”€ MainActivity.kt
â”‚ â””â”€â”€ res/
â”œâ”€â”€ build.gradle.kts # æ ¹ç›®å½•
â”œâ”€â”€ settings.gradle.kts
â””â”€â”€ gradle.properties
&lt;/code>&lt;/pre>&lt;h5 id="æ ¸å¿ƒåŸåˆ™">æ ¸å¿ƒåŸåˆ™
&lt;/h5>&lt;p>&lt;strong>å¿…éœ€åº“(2ä¸ª)&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>androidx.core:core-ktx&lt;/code> - Kotlinæ‰©å±•&lt;/li>
&lt;li>&lt;code>androidx.appcompat:appcompat&lt;/code> - å…¼å®¹æ€§æ”¯æŒ&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>UIæ–¹æ¡ˆ(äºŒé€‰ä¸€)&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>ä¼ ç»ŸView: Material + ConstraintLayout&lt;/li>
&lt;li>&lt;strong>Jetpack Compose&lt;/strong>: Compose BOM + Material3&lt;/li>
&lt;/ol>
&lt;p>å¯é€‰æ‰©å±•ï¼š&lt;/p>
&lt;ul>
&lt;li>æ¶æ„ç»„ä»¶ï¼šViewModel/LiveData (MVVMæ¨¡å¼éœ€è¦)&lt;/li>
&lt;li>åç¨‹ï¼šå¼‚æ­¥æ“ä½œ ï¼ˆç½‘ç»œæ“ä½œã€æ•°æ®åº“æ“ä½œéœ€è¦ï¼‰&lt;/li>
&lt;/ul>
&lt;h5 id="ä½¿ç”¨å»ºè®®">ä½¿ç”¨å»ºè®®
&lt;/h5>&lt;ol>
&lt;li>æœ€å°é¡¹ç›®ï¼šåªç”¨ core-ktx + appcompat + ä¸€ç§UI&lt;/li>
&lt;li>éœ€è¦æ¶æ„ï¼šæ·»åŠ lifecycle bundle&lt;/li>
&lt;li>éœ€è¦ç½‘ç»œ/æ•°æ®åº“ï¼šæ·»åŠ coroutines&lt;/li>
&lt;li>åº“ vs æ’ä»¶
&lt;ul>
&lt;li>&lt;code>android.application&lt;/code> / &lt;code>kotlin.android&lt;/code> - å¿…éœ€æ’ä»¶&lt;/li>
&lt;li>&lt;code>kotlin.compose&lt;/code> - ä»…Composeé¡¹ç›®éœ€è¦çš„æ’ä»¶&lt;/li>
&lt;li>å…¶ä»–éƒ½æ˜¯åº“ä¾èµ–&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h5 id="å¸¸è§è¯¯åŒº">å¸¸è§è¯¯åŒº
&lt;/h5>&lt;p>ä¸æ˜¯å¿…é¡»çš„åº“&lt;/p>
&lt;ul>
&lt;li>Activity/Fragmentåº“ ï¼ˆappcompatå·²åŒ…å«ï¼‰&lt;/li>
&lt;li>RecyclerView ï¼ˆé™¤éç¡®å®šè¦ç”¨åˆ—è¡¨ï¼‰&lt;/li>
&lt;li>Navigationç»„ä»¶ ï¼ˆç®€å•é¡¹ç›®ä¸éœ€è¦ï¼‰&lt;/li>
&lt;li>Room/Retrofit ï¼ˆæœ‰éœ€æ±‚å†åŠ ï¼‰&lt;/li>
&lt;/ul>
&lt;h4 id="libsversionstoml-ä¾‹å­">libs.versions.toml ä¾‹å­
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#a6e22e">versions&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ ¸å¿ƒç‰ˆæœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">agp&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;8.7.3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">kotlin&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;2.1.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">compileSdk&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;35&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">minSdk&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;24&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">targetSdk&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;35&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># AndroidX æ ¸å¿ƒåº“ï¼ˆå¿…éœ€ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">core-ktx&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;1.15.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">appcompat&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;1.7.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¯é€‰ï¼šUI åº“ï¼ˆæ ¹æ®éœ€è¦é€‰æ‹©ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">material&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;1.12.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ³¨ï¼šCompose å’Œä¼ ç»Ÿ View äºŒé€‰ä¸€&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">compose-bom&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;2024.12.01&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æˆ–è€…ä½¿ç”¨ ConstraintLayoutï¼ˆä¼ ç»Ÿ Viewï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">constraintlayout&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;2.2.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¯é€‰ï¼šç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚éœ€ ViewModel/LiveDataï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">lifecycle&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;2.8.7&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¯é€‰ï¼šåç¨‹ï¼ˆå¦‚éœ€å¼‚æ­¥æ“ä½œï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">coroutines&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;1.10.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#a6e22e">libraries&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># === æ ¸å¿ƒåº“ï¼ˆå¿…éœ€ï¼‰===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidx-core-ktx&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.core:core-ktx&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;core-ktx&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidx-appcompat&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.appcompat:appcompat&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;appcompat&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># === UI åº“ï¼ˆäºŒé€‰ä¸€æˆ–éƒ½ä¸è¦ï¼‰===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ–¹æ¡ˆ A: Material Componentsï¼ˆä¼ ç»Ÿ Viewï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">material&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;com.google.android.material:material&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;material&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidx-constraintlayout&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.constraintlayout:constraintlayout&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;constraintlayout&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ–¹æ¡ˆ B: Jetpack Composeï¼ˆç°ä»£å£°æ˜å¼ UIï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidx-compose-bom&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.compose:compose-bom&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;compose-bom&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidx-compose-ui&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.compose.ui:ui&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidx-compose-material3&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.compose.material3:material3&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidx-compose-ui-tooling-preview&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.compose.ui:ui-tooling-preview&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidx-activity-compose&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.activity:activity-compose&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;1.9.3&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># === å¯é€‰ï¼šæ¶æ„ç»„ä»¶ ===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ViewModelï¼ˆå¦‚éœ€ MVVM æ¶æ„ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidx-lifecycle-viewmodel-ktx&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.lifecycle:lifecycle-viewmodel-ktx&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;lifecycle&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># LiveDataï¼ˆå¦‚éœ€å“åº”å¼æ•°æ®ï¼ŒCompose é¡¹ç›®å¯ä¸ç”¨ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidx-lifecycle-livedata-ktx&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.lifecycle:lifecycle-livedata-ktx&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;lifecycle&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># === å¯é€‰ï¼šåç¨‹ï¼ˆå¦‚éœ€å¼‚æ­¥æ“ä½œï¼‰===&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">kotlinx-coroutines-android&lt;/span> = { &lt;span style="color:#a6e22e">module&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;org.jetbrains.kotlinx:kotlinx-coroutines-android&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;coroutines&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#a6e22e">plugins&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¿…éœ€æ’ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">android-application&lt;/span> = { &lt;span style="color:#a6e22e">id&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;com.android.application&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;agp&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">kotlin-android&lt;/span> = { &lt;span style="color:#a6e22e">id&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;org.jetbrains.kotlin.android&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;kotlin&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¯é€‰ï¼šCompose ç¼–è¯‘å™¨æ’ä»¶ï¼ˆä»… Compose é¡¹ç›®éœ€è¦ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">kotlin-compose&lt;/span> = { &lt;span style="color:#a6e22e">id&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;org.jetbrains.kotlin.plugin.compose&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;kotlin&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¯é€‰ï¼šå¦‚éœ€å¤šæ¨¡å—æˆ–åº“æ¨¡å—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">android-library&lt;/span> = { &lt;span style="color:#a6e22e">id&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;com.android.library&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;agp&amp;#34;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#a6e22e">bundles&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¯é€‰ï¼šç»„åˆå¸¸ç”¨åº“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¼ ç»Ÿ View UI å¥—ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">traditional-ui&lt;/span> = [&lt;span style="color:#e6db74">&amp;#34;androidx-core-ktx&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;androidx-appcompat&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;material&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;androidx-constraintlayout&amp;#34;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Compose UI å¥—ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">compose-ui&lt;/span> = [&lt;span style="color:#e6db74">&amp;#34;androidx-compose-ui&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;androidx-compose-material3&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;androidx-compose-ui-tooling-preview&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;androidx-activity-compose&amp;#34;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># MVVM æ¶æ„å¥—ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">lifecycle&lt;/span> = [&lt;span style="color:#e6db74">&amp;#34;androidx-lifecycle-viewmodel-ktx&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;androidx-lifecycle-livedata-ktx&amp;#34;&lt;/span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ç–‘é—®è§£ç­”">ç–‘é—®è§£ç­”
&lt;/h4>&lt;h5 id="ä¸ºä»€ä¹ˆé¡¹ç›®çº§è¦ç”¨apply-false">ä¸ºä»€ä¹ˆé¡¹ç›®çº§è¦ç”¨&lt;code>apply false&lt;/code>ï¼Ÿ
&lt;/h5>&lt;p>åœ¨é¡¹ç›®æ ¹ç›®å½•çš„&lt;code>build.gradle.kts&lt;/code>ä¸­ä½¿ç”¨&lt;code>apply false&lt;/code>æ˜¯ä¸ºäº†ï¼š&lt;/p>
&lt;ol>
&lt;li>å£°æ˜æ’ä»¶ç‰ˆæœ¬ï¼Œä½†ä¸åº”ç”¨åˆ°æ ¹é¡¹ç›®&lt;/li>
&lt;li>è®©å­æ¨¡å—å¯ä»¥å¤ç”¨è¿™äº›æ’ä»¶å®šä¹‰&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// âŒ é¡¹ç›®æ ¹ç›®å½•å¦‚æœä¸åŠ  apply false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>plugins {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> alias(libs.plugins.android.application) &lt;span style="color:#75715e">// ä¼šåº”ç”¨åˆ°æ ¹é¡¹ç›®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é—®é¢˜ï¼šæ ¹é¡¹ç›®ä¸æ˜¯ Android åº”ç”¨ï¼Œä¼šæŠ¥é”™ï¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// âœ… æ­£ç¡®åšæ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>plugins {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> alias(libs.plugins.android.application) apply &lt;span style="color:#66d9ef">false&lt;/span> &lt;span style="color:#75715e">// åªå£°æ˜ï¼Œä¸åº”ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ç±»æ¯”ç†è§£&lt;/strong>&lt;/p>
&lt;p>æŠŠæ ¹é¡¹ç›®æƒ³è±¡æˆæ’ä»¶ä»“åº“ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>apply false&lt;/code> = æŠŠæ’ä»¶æ”¾åœ¨ä»“åº“è´§æ¶ä¸Š&lt;/li>
&lt;li>å­æ¨¡å—&lt;code>alias()&lt;/code> = ä»è´§æ¶å–ç”¨æ’ä»¶&lt;/li>
&lt;li>è´§æ¶ç®¡ç†å‘˜ï¼ˆæ ¹é¡¹ç›®ï¼‰ä¸éœ€è¦ç”¨è¿™äº›å·¥å…·ï¼ˆæ’ä»¶ï¼‰&lt;/li>
&lt;/ul></description></item><item><title>Rust Jnié…ç½®</title><link>https://www.dust-zed.site/android-develop/rust-jni%E9%85%8D%E7%BD%AE/</link><pubDate>Wed, 15 Oct 2025 13:45:38 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/rust-jni%E9%85%8D%E7%BD%AE/</guid><description>&lt;h4 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®
&lt;/h4>&lt;h5 id="1-ç¯å¢ƒæ£€æŸ¥">1. ç¯å¢ƒæ£€æŸ¥
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ£€æŸ¥ Rust æ˜¯å¦å®‰è£…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rustc --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åº”è¯¥çœ‹åˆ°: rustc 1.xx.x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ£€æŸ¥ Cargo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cargo --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ£€æŸ¥ Android Studio å’Œ SDK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¡®ä¿å·²å®‰è£… Android Studio&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-å®‰è£…å¿…è¦å·¥å…·">2. å®‰è£…å¿…è¦å·¥å…·
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 1. å®‰è£… Android targets&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rustup target add aarch64-linux-android &lt;span style="color:#75715e"># ARM64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rustup target add armv7-linux-androideabi &lt;span style="color:#75715e"># ARM32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rustup target add i686-linux-android &lt;span style="color:#75715e"># x86&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rustup target add x86_64-linux-android &lt;span style="color:#75715e"># x86_64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 2. å®‰è£… cargo-ndk (é‡è¦!)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cargo install cargo-ndk
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 3. éªŒè¯å®‰è£…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cargo ndk --version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="é…ç½®ndkè·¯å¾„">é…ç½®NDKè·¯å¾„
&lt;/h5>&lt;p>&lt;strong>macOS/Linux&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¼–è¾‘ ~/.bashrc æˆ– ~/.zshrc&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export ANDROID_HOME&lt;span style="color:#f92672">=&lt;/span>$HOME/Library/Android/sdk &lt;span style="color:#75715e"># macOS&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æˆ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export ANDROID_HOME&lt;span style="color:#f92672">=&lt;/span>$HOME/Android/Sdk &lt;span style="color:#75715e"># Linux&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export ANDROID_NDK_HOME&lt;span style="color:#f92672">=&lt;/span>$ANDROID_HOME/ndk/25.2.9519653
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ³¨æ„: ç‰ˆæœ¬å·å¯èƒ½ä¸åŒ,æ£€æŸ¥ä½ çš„ ndk ç›®å½•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åº”ç”¨é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>source ~/.bashrc &lt;span style="color:#75715e"># æˆ– source ~/.zshrc&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Windows&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è®¾ç½®ç¯å¢ƒå˜é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>setx ANDROID_HOME &lt;span style="color:#e6db74">&amp;#34;C:\Users\YourName\AppData\Local\Android\Sdk&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>setx ANDROID_NDK_HOME &lt;span style="color:#e6db74">&amp;#34;%ANDROID_HOME%\ndk\25.2.9519653&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="éªŒè¯ndk">éªŒè¯NDK:
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>echo $ANDROID_NDK_HOME
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åº”è¯¥æ˜¾ç¤ºè·¯å¾„,å¦‚: /Users/xxx/Library/Android/sdk/ndk/25.2.9519653&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ls $ANDROID_NDK_HOME
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åº”è¯¥çœ‹åˆ°: build, platforms, sources ç­‰ç›®å½•&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Android_rustæ··åˆå¼€å‘å…¥é—¨</title><link>https://www.dust-zed.site/android-develop/android_rust%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/</link><pubDate>Wed, 15 Oct 2025 11:55:59 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/android_rust%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/</guid><description>&lt;h4 id="ä»€ä¹ˆæ˜¯ndk">ä»€ä¹ˆæ˜¯NDK?
&lt;/h4>&lt;p>&lt;strong>NDK = Native Development Kit(åŸç”Ÿå¼€å‘å·¥å…·åŒ…)&lt;/strong>&lt;/p>
&lt;p>&lt;strong>ä¸€å¥è¯è§£é‡Š&lt;/strong>&lt;/p>
&lt;p>NDK æ˜¯ Android æä¾›çš„å·¥å…·é›†,è®©ä½ èƒ½ç”¨ &lt;strong>C/C++/Rust&lt;/strong> ç­‰åŸç”Ÿè¯­è¨€å¼€å‘ Android åº”ç”¨çš„ä¸€éƒ¨åˆ†&lt;/p>
&lt;hr>
&lt;h4 id="androidåº”ç”¨çš„ä¸¤ç§å¼€å‘æ–¹å¼">Androidåº”ç”¨çš„ä¸¤ç§å¼€å‘æ–¹å¼
&lt;/h4>&lt;pre tabindex="0">&lt;code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Android åº”ç”¨ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚
â”‚ æ–¹å¼ 1: Java/Kotlin (Android SDK) â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Kotlin/Java ä»£ç  â”‚ â”‚
â”‚ â”‚ â†“ â”‚ â”‚
â”‚ â”‚ ç¼–è¯‘ä¸º DEX å­—èŠ‚ç  â”‚ â”‚
â”‚ â”‚ â†“ â”‚ â”‚
â”‚ â”‚ åœ¨ Dalvik/ART è™šæ‹Ÿæœºè¿è¡Œ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚
â”‚ æ–¹å¼ 2: C/C++/Rust (Android NDK) â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ C/C++/Rust ä»£ç  â”‚ â”‚
â”‚ â”‚ â†“ â”‚ â”‚
â”‚ â”‚ ç¼–è¯‘ä¸º .so æ–‡ä»¶ (æœºå™¨ç ) â”‚ â”‚
â”‚ â”‚ â†“ â”‚ â”‚
â”‚ â”‚ ç›´æ¥åœ¨ CPU ä¸Šè¿è¡Œ (æ— è™šæ‹Ÿæœº) â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚
â”‚ ä¸¤è€…é€šè¿‡ JNI æ¡¥æ¥ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code>&lt;/pre>&lt;h4 id="ä¸ºä»€ä¹ˆéœ€è¦ndk">ä¸ºä»€ä¹ˆéœ€è¦NDKï¼Ÿ
&lt;/h4>&lt;h5 id="å¯¹æ¯”ç†è§£">å¯¹æ¯”ç†è§£
&lt;/h5>&lt;p>çº¯ &lt;strong>Java/Kotlin(SDK):&lt;/strong>&lt;/p>
&lt;pre tabindex="0">&lt;code>ä¼˜ç‚¹:
âœ… å¼€å‘ç®€å•
âœ… è·¨è®¾å¤‡å…¼å®¹å¥½
âœ… è°ƒè¯•æ–¹ä¾¿
ç¼ºç‚¹:
âŒ æ€§èƒ½æœ‰é™ (è™šæ‹Ÿæœºå¼€é”€)
âŒ æŸäº›åŠŸèƒ½æ— æ³•å®ç°
âŒ æ— æ³•å¤ç”¨ C/C++ åº“
&lt;/code>&lt;/pre>&lt;p>&lt;strong>NDK(C/C++/Rust)&lt;/strong>&lt;/p>
&lt;pre tabindex="0">&lt;code>ä¼˜ç‚¹:
âœ… æ€§èƒ½æé«˜ (æ¥è¿‘æœºå™¨ç )
âœ… å¯ä»¥å¤ç”¨ç°æœ‰ C/C++ åº“
âœ… ç›´æ¥è®¿é—®ç¡¬ä»¶
âœ… è·¨å¹³å°ä»£ç å¤ç”¨
ç¼ºç‚¹:
âŒ å¼€å‘å¤æ‚
âŒ è°ƒè¯•å›°éš¾
âŒ éœ€è¦ä¸ºä¸åŒ CPU ç¼–è¯‘
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="ndkå·¥ä½œåŸç†">NDKå·¥ä½œåŸç†
&lt;/h4>&lt;h5 id="å®Œæ•´æµç¨‹">å®Œæ•´æµç¨‹
&lt;/h5>&lt;pre tabindex="0">&lt;code>ç¬¬ 1 æ­¥: å†™ Rust ä»£ç 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ // Rust ä»£ç  â”‚
â”‚ pub fn add(a: i32, b: i32) -&amp;gt; i32 {
â”‚ a + b â”‚
â”‚ } â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
ç¬¬ 2 æ­¥: NDK ç¼–è¯‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NDK å·¥å…·é“¾ç¼–è¯‘ â”‚
â”‚ - äº¤å‰ç¼–è¯‘ â”‚
â”‚ - é’ˆå¯¹ ARM/x86 CPU â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
ç¬¬ 3 æ­¥: ç”Ÿæˆ .so æ–‡ä»¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ librust_lib.so â”‚
â”‚ (æœºå™¨ç ,å¯ç›´æ¥è¿è¡Œ) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
ç¬¬ 4 æ­¥: Android åŠ è½½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System.loadLibrary(&amp;#34;rust_lib&amp;#34;)
â”‚ â”‚
â”‚ external fun add(a: Int, b: Int): Int
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
ç¬¬ 5 æ­¥: JNI è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Kotlin â†’ JNI â†’ Rust â”‚
â”‚ val result = add(5, 3) â”‚
â”‚ // result = 8 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="ndkåŒ…å«ä»€ä¹ˆ">NDKåŒ…å«ä»€ä¹ˆï¼Ÿ
&lt;/h4>&lt;h5 id="ndkå·¥å…·é›†">NDKå·¥å…·é›†
&lt;/h5>&lt;pre tabindex="0">&lt;code>$ANDROID_NDK_HOME/
â”œâ”€â”€ build/ # æ„å»ºè„šæœ¬
â”œâ”€â”€ toolchains/ # ç¼–è¯‘å™¨å·¥å…·é“¾
â”‚ â”œâ”€â”€ aarch64-linux-android/ # ARM64 ç¼–è¯‘å™¨
â”‚ â”œâ”€â”€ arm-linux-androideabi/ # ARM32 ç¼–è¯‘å™¨
â”‚ â”œâ”€â”€ x86/ # x86 ç¼–è¯‘å™¨
â”‚ â””â”€â”€ x86_64/ # x86_64 ç¼–è¯‘å™¨
â”œâ”€â”€ platforms/ # Android API çº§åˆ«çš„å¤´æ–‡ä»¶
â”œâ”€â”€ sources/ # ç¤ºä¾‹ä»£ç 
â””â”€â”€ sysroot/ # ç³»ç»Ÿåº“
&lt;/code>&lt;/pre>&lt;h5 id="ç¼–è¯‘å™¨">ç¼–è¯‘å™¨
&lt;/h5>&lt;pre tabindex="0">&lt;code>NDK æä¾›äº†é’ˆå¯¹ä¸åŒ CPU æ¶æ„çš„ç¼–è¯‘å™¨:
ARM64 (arm64-v8a): ç°ä»£æ‰‹æœº (ä¸»æµ)
ARM32 (armeabi-v7a): è€æ‰‹æœº
x86: æ¨¡æ‹Ÿå™¨
x86_64: æ¨¡æ‹Ÿå™¨
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="soæ–‡ä»¶æ˜¯ä»€ä¹ˆ">.soæ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ
&lt;/h4>&lt;h5 id="ç†è§£soæ–‡ä»¶">ç†è§£.soæ–‡ä»¶
&lt;/h5>&lt;pre tabindex="0">&lt;code>.so = Shared Object (å…±äº«å¯¹è±¡)
ç±»ä¼¼äº:
- Windows çš„ .dll æ–‡ä»¶
- macOS çš„ .dylib æ–‡ä»¶
ä½œç”¨:
- åŒ…å«ç¼–è¯‘åçš„æœºå™¨ç 
- å¯ä»¥è¢«å¤šä¸ªç¨‹åºå…±äº«ä½¿ç”¨
&lt;/code>&lt;/pre>&lt;h5 id="soæ–‡ä»¶ç¤ºä¾‹">.soæ–‡ä»¶ç¤ºä¾‹
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŸ¥çœ‹ .so æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ls android/app/src/main/jniLibs/arm64-v8a/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># librust_lib.so â† è¿™å°±æ˜¯ç¼–è¯‘åçš„ Rust ä»£ç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>file librust_lib.so
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># librust_lib.so: ELF 64-bit LSB shared object, ARM aarch64, ...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŸ¥çœ‹å¯¼å‡ºçš„å‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nm -D librust_lib.so | grep Java
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Java_com_example_rustdemo_RustBridge_add&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Java_com_example_rustdemo_RustBridge_reverseString&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="ndkå¼€å‘æµç¨‹">NDKå¼€å‘æµç¨‹
&lt;/h4>&lt;h5 id="å®Œæ•´å¼€å‘æµç¨‹">å®Œæ•´å¼€å‘æµç¨‹
&lt;/h5>&lt;pre tabindex="0">&lt;code>1. å®‰è£… NDK
â†“
Android Studio â†’ SDK Manager â†’ SDK Tools â†’ NDK
2. é…ç½®ç¯å¢ƒ
â†“
export ANDROID_NDK_HOME=/path/to/ndk
3. ç¼–å†™åŸç”Ÿä»£ç  (C/C++/Rust)
â†“
ä¾‹å¦‚: add.c, image.cpp, search.rs
4. ä½¿ç”¨ NDK ç¼–è¯‘
â†“
ndk-build (C/C++)
cargo-ndk (Rust)
5. ç”Ÿæˆ .so æ–‡ä»¶
â†“
libmylib.so
6. æ”¾å…¥ jniLibs ç›®å½•
â†“
app/src/main/jniLibs/arm64-v8a/libmylib.so
7. Kotlin åŠ è½½å’Œè°ƒç”¨
â†“
System.loadLibrary(&amp;#34;mylib&amp;#34;)
external fun add(a: Int, b: Int): Int
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="ndkæ ¸å¿ƒæ¦‚å¿µ">NDKæ ¸å¿ƒæ¦‚å¿µ
&lt;/h4>&lt;h5 id="jnijava-native-interface">JNI(Java Native Interface)
&lt;/h5>&lt;p>&lt;strong>JNI&lt;/strong>æ˜¯æ¡¥æ¢:&lt;/p>
&lt;pre tabindex="0">&lt;code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Kotlin â”‚ JNI â”‚ Rust â”‚
â”‚ (è™šæ‹Ÿæœº) â”‚ â—„â”€â”€â”€â”€â”€â–º â”‚ (åŸç”Ÿç ) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æ•°æ®ä¼ é€’:
Kotlin Int â†” Rust i32
Kotlin String â†” Rust String
Kotlin IntArray â†” Rust &amp;amp;[i32]
&lt;/code>&lt;/pre>&lt;h5 id="äº¤å‰ç¼–è¯‘">äº¤å‰ç¼–è¯‘
&lt;/h5>&lt;p>ä»€ä¹ˆæ˜¯äº¤å‰ç¼–è¯‘?&lt;/p>
&lt;pre tabindex="0">&lt;code>ä½ åœ¨ x86_64 ç”µè„‘ä¸Šå¼€å‘
â†“
ä½†æ‰‹æœºæ˜¯ ARM64 æ¶æ„
â†“
éœ€è¦&amp;#34;äº¤å‰ç¼–è¯‘&amp;#34;: åœ¨ x86_64 ä¸Šç¼–è¯‘å‡º ARM64 ä»£ç 
â†“
NDK æä¾›äº†äº¤å‰ç¼–è¯‘å·¥å…·é“¾
&lt;/code>&lt;/pre>&lt;h5 id="abiapplication-binary-interface">ABI(Application Binary Interface)
&lt;/h5>&lt;p>ä¸åŒ&lt;strong>CPU&lt;/strong>éœ€è¦ä¸åŒçš„**.so**æ–‡ä»¶:&lt;/p>
&lt;pre tabindex="0">&lt;code>arm64-v8a/libmylib.so â†’ ARM64 æ‰‹æœº
armeabi-v7a/libmylib.so â†’ ARM32 æ‰‹æœº
x86/libmylib.so â†’ x86 æ¨¡æ‹Ÿå™¨
x86_64/libmylib.so â†’ x86_64 æ¨¡æ‹Ÿå™¨
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="ä»€ä¹ˆæ—¶å€™ç”¨ndk">ä»€ä¹ˆæ—¶å€™ç”¨NDK?
&lt;/h4>&lt;h5 id="åº”è¯¥ç”¨ndkçš„åœºæ™¯">åº”è¯¥ç”¨NDKçš„åœºæ™¯
&lt;/h5>&lt;pre tabindex="0">&lt;code>1. æ€§èƒ½å…³é”®ä»£ç 
- å›¾åƒ/è§†é¢‘å¤„ç†
- éŸ³é¢‘å¤„ç†
- å¤§é‡æ•°å­¦è®¡ç®—
- åŠ å¯†/è§£å¯†
2. å¤ç”¨ç°æœ‰ä»£ç 
- å·²æœ‰ C/C++ åº“
- è·¨å¹³å°ä»£ç  (iOS/Android å…±äº«)
3. ä¿æŠ¤æ ¸å¿ƒç®—æ³•
- é˜²æ­¢åç¼–è¯‘
- å•†ä¸šé€»è¾‘ä¿æŠ¤
4. è®¿é—®åº•å±‚åŠŸèƒ½
- ç¡¬ä»¶æ§åˆ¶
- ç³»ç»Ÿè°ƒç”¨
&lt;/code>&lt;/pre>&lt;h5 id="ä¸åº”è¯¥ç”¨ndkçš„åœºæ™¯">ä¸åº”è¯¥ç”¨NDKçš„åœºæ™¯
&lt;/h5>&lt;pre tabindex="0">&lt;code>1. ç®€å•ä¸šåŠ¡é€»è¾‘
- æŒ‰é’®ç‚¹å‡»
- æ•°æ®å±•ç¤º
- ç½‘ç»œè¯·æ±‚
2. å¿«é€Ÿå¼€å‘
- åŸå‹éªŒè¯
- MVP é˜¶æ®µ
3. å›¢é˜Ÿä¸ç†Ÿæ‚‰ C/C++/Rust
- ç»´æŠ¤æˆæœ¬é«˜
- Bug éš¾ä»¥è°ƒè¯•
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="ndkå¼€å‘å·¥å…·">NDKå¼€å‘å·¥å…·
&lt;/h4>&lt;h5 id="å¿…å¤‡å·¥å…·">å¿…å¤‡å·¥å…·
&lt;/h5>&lt;pre tabindex="0">&lt;code>1. Android NDK
- ä¸‹è½½: Android Studio SDK Manager
2. CMake (C/C++) æˆ– cargo-ndk (Rust)
- cargo install cargo-ndk
3. LLDB (è°ƒè¯•å™¨)
- Android Studio å†…ç½®
&lt;/code>&lt;/pre>&lt;h5 id="è¾…åŠ©å·¥å…·">è¾…åŠ©å·¥å…·
&lt;/h5>&lt;pre tabindex="0">&lt;code># æŸ¥çœ‹ .so æ–‡ä»¶ä¿¡æ¯
readelf -h libmylib.so
# æŸ¥çœ‹å¯¼å‡ºçš„å‡½æ•°
nm -D libmylib.so
# åæ±‡ç¼– (è°ƒè¯•ç”¨)
objdump -d libmylib.so
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="æ€»ç»“">æ€»ç»“
&lt;/h4>&lt;h5 id="ndkæ˜¯ä»€ä¹ˆ">NDKæ˜¯ä»€ä¹ˆï¼Ÿ
&lt;/h5>&lt;pre tabindex="0">&lt;code>NDK = è®©ä½ ç”¨ C/C++/Rust å¼€å‘ Android çš„å·¥å…·åŒ…
ä½œç”¨:
1. æä¾›äº¤å‰ç¼–è¯‘å·¥å…·é“¾
2. ç¼–è¯‘å‡º .so æœºå™¨ç æ–‡ä»¶
3. é€šè¿‡ JNI ä¸ Kotlin äº¤äº’
4. è·å¾—åŸç”Ÿæ€§èƒ½
é€‚ç”¨åœºæ™¯:
- é«˜æ€§èƒ½è®¡ç®—
- å¤ç”¨ C/C++ åº“
- è·¨å¹³å°å¼€å‘
&lt;/code>&lt;/pre>&lt;h5 id="å…³é”®æ¦‚å¿µ">å…³é”®æ¦‚å¿µ
&lt;/h5>&lt;pre tabindex="0">&lt;code>NDK: å·¥å…·åŒ…
JNI: æ¡¥æ¢ (Kotlin â†” åŸç”Ÿä»£ç )
.so: ç¼–è¯‘åçš„æœºå™¨ç 
ABI: ä¸åŒ CPU æ¶æ„
æµç¨‹:
Rust ä»£ç  â†’ NDK ç¼–è¯‘ â†’ .so æ–‡ä»¶ â†’ JNI è°ƒç”¨ â†’ Kotlin ä½¿ç”¨
&lt;/code>&lt;/pre></description></item><item><title>Benchmarkå­¦ä¹ </title><link>https://www.dust-zed.site/rust/benchmark%E5%AD%A6%E4%B9%A0/</link><pubDate>Mon, 13 Oct 2025 10:33:08 +0800</pubDate><guid>https://www.dust-zed.site/rust/benchmark%E5%AD%A6%E4%B9%A0/</guid><description>&lt;h4 id="benchmarkæ ¸å¿ƒ">benchmarkæ ¸å¿ƒ
&lt;/h4>&lt;p>æ‰€æœ‰è¯­è¨€çš„&lt;strong>Benchmark&lt;/strong>éƒ½åœ¨åšï¼š&lt;/p>
&lt;ul>
&lt;li>è®¡æ—¶ - æµ‹é‡æ‰§è¡Œæ—¶é—´&lt;/li>
&lt;li>é‡å¤ - å¤šæ¬¡è¿è¡Œå–å¹³å‡&lt;/li>
&lt;li>ç»Ÿè®¡ - è®¡ç®—å‡å€¼ã€æ ‡å‡†å·®&lt;/li>
&lt;li>å¯¹æ¯” - æ¯”è¾ƒä¸åŒå®ç°&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>é€šç”¨æµç¨‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>é¢„çƒ­ â†’ æµ‹é‡ â†’ ç»Ÿè®¡ â†’ æŠ¥å‘Š ï¼ˆé˜²ä¼˜åŒ–ï¼‰
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>é¢„çƒ­&lt;/strong>: è·³è¿‡ç¼“å­˜æœªå‘½ä¸­çš„åˆæµ‹&lt;/p>
&lt;h4 id="criterion">Criterion
&lt;/h4>&lt;p>&lt;code>Criterion&lt;/code>æ˜¯rustä¸­æœ€ç°ä»£åŒ–çš„benchmarkåº“ï¼Œæ¥ä¸‹æ¥è·Ÿç€ä¾‹å­ä¸€æ­¥æ­¥æ·±å…¥äº†benchmarkã€‚&lt;/p>
&lt;h4 id="å…¥é—¨">å…¥é—¨
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#![allow(unused)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> criterion::{black_box, criterion_group, criterion_main, Criterion};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> mycrate::fibonacci;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">criterion_benchmark&lt;/span>(c: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> Criterion) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c.bench_function(&lt;span style="color:#e6db74">&amp;#34;fib 20&amp;#34;&lt;/span>, &lt;span style="color:#f92672">|&lt;/span>b&lt;span style="color:#f92672">|&lt;/span> b.iter(&lt;span style="color:#f92672">||&lt;/span> fibonacci(black_box(&lt;span style="color:#ae81ff">20&lt;/span>))));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">criterion_group!&lt;/span>(benches, criterion_benchmark);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">criterion_main!&lt;/span>(benches);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="1-bench_functionæ–¹æ³•">1. &lt;code>bench_function&lt;/code>æ–¹æ³•
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>c.bench_function(&lt;span style="color:#e6db74">&amp;#34;fib 20&amp;#34;&lt;/span>, &lt;span style="color:#f92672">|&lt;/span>b&lt;span style="color:#f92672">|&lt;/span> b.iter(&lt;span style="color:#f92672">||&lt;/span> fibonacci(black_box(&lt;span style="color:#ae81ff">20&lt;/span>))));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>ä½œç”¨&lt;/strong>ï¼šå®šä¹‰ä¸€ä¸ªåŸºå‡†æµ‹è¯•ç”¨ä¾‹&lt;/li>
&lt;li>&lt;strong>å‚æ•°&lt;/strong>:
&lt;ul>
&lt;li>&lt;code>fib 20&lt;/code>ï¼š æµ‹è¯•ç”¨ä¾‹çš„åç§°ï¼ˆç”¨äºç»“æœæŠ¥å‘Šï¼‰&lt;/li>
&lt;li>é—­åŒ…å‡½æ•°ï¼šåŒ…å«å®é™…çš„æµ‹è¯•é€»è¾‘&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é—­åŒ…å†…éƒ¨&lt;/strong>
&lt;ul>
&lt;li>&lt;code>b&lt;/code>: &lt;code>Bencher&lt;/code>å¯¹è±¡(è‡ªåŠ¨ä¼ å…¥)&lt;/li>
&lt;li>&lt;code>b.iter(|| ...)&lt;/code>ï¼šè¿è¡Œè¢«æµ‹ä»£ç å¤šæ¬¡å¹¶æµ‹é‡æ—¶é—´&lt;/li>
&lt;li>&lt;code>black_box(20)&lt;/code>ï¼šé˜»æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–(ç¡®ä¿çœŸå®è®¡ç®—)&lt;/li>
&lt;li>&lt;code>fibonacci(20)&lt;/code>ï¼šå®é™…è¢«æµ‹å‡½æ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="2-criterion_groupå®">2. &lt;code>criterion_group!&lt;/code>å®
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">criterion_group!&lt;/span>(benches, criterion_benchmark);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>ä½œç”¨&lt;/strong>ï¼šåˆ›å»ºåŸºå‡†æµ‹è¯•ç»„&lt;/li>
&lt;li>&lt;strong>å‚æ•°&lt;/strong>ï¼š
&lt;ul>
&lt;li>&lt;code>benches&lt;/code>ï¼šç»„åç§°ï¼ˆè‡ªå®šä¹‰æ ‡è¯†ç¬¦ï¼‰&lt;/li>
&lt;li>&lt;code>criterion_benchmark&lt;/code>ï¼šåŒ…å«æµ‹è¯•çš„å‡½æ•°åï¼ˆæœ¬ä¾‹ä¸­çš„åŸºå‡†å‡½æ•°ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ç‰¹æ€§&lt;/strong>ï¼š
&lt;ul>
&lt;li>å°†å¤šä¸ªåŸºå‡†æµ‹è¯•ç»„ç»‡æˆç»„&lt;/li>
&lt;li>æ”¯æŒæ·»åŠ å¤šä¸ªæµ‹è¯•å‡½æ•°&lt;/li>
&lt;li>ç”Ÿæˆå¯¹åº”çš„ &lt;code>bench_&lt;/code> å¼€å¤´çš„å‡½æ•°ï¼ˆå¦‚&lt;code>benches_benchmark&lt;/code>ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="3-criterion_mainå®">3. &lt;code>criterion_main!&lt;/code>å®
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">criterion_main!&lt;/span>(benches);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>ä½œç”¨&lt;/strong>ï¼šç”ŸæˆåŸºå‡†æµ‹è¯•çš„å…¥å£å‡½æ•°&lt;/li>
&lt;li>&lt;strong>å‚æ•°&lt;/strong>ï¼š
&lt;ul>
&lt;li>&lt;code>benches&lt;/code>ï¼šå‰é¢å®šä¹‰çš„æµ‹è¯•ç»„å&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>åŠŸèƒ½&lt;/strong>ï¼š
&lt;ul>
&lt;li>è‡ªåŠ¨ç”Ÿæˆ&lt;code>main()&lt;/code>å‡½æ•°&lt;/li>
&lt;li>é…ç½®å¹¶è¿è¡Œæ‰€æœ‰æŒ‡å®šçš„æµ‹è¯•ç»„&lt;/li>
&lt;li>å¤„ç†å‘½ä»¤è¡Œå‚æ•°ï¼ˆå¦‚ &lt;code>--filter&lt;/code>, &lt;code>--savebaseline&lt;/code>ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="4-benchesçš„æ¥æº">4. &lt;code>benches&lt;/code>çš„æ¥æº
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">criterion_group!&lt;/span>(benches, &lt;span style="color:#f92672">..&lt;/span>.);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ^^^^^^ è¿™é‡Œå®šä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">criterion_main!&lt;/span>(benches);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ^^^^^^ è¿™é‡Œä½¿ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>benches&lt;/code> æ˜¯ç”± &lt;code>criterion_group!&lt;/code> &lt;strong>å®åˆ›å»ºçš„è‡ªå®šä¹‰æ ‡è¯†ç¬¦&lt;/strong>&lt;/li>
&lt;li>åœ¨ &lt;code>criterion_main!&lt;/code> ä¸­å¼•ç”¨æ—¶ï¼š
&lt;ol>
&lt;li>æŸ¥æ‰¾åŒåæµ‹è¯•ç»„&lt;/li>
&lt;li>å°†ç»„å†…æµ‹è¯•å‡½æ•°æ·»åŠ åˆ°æ‰§è¡Œé˜Ÿåˆ—&lt;/li>
&lt;li>ç”ŸæˆæŠ¥å‘Šå’Œå›¾è¡¨&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;h4 id="è¿›é˜¶">è¿›é˜¶
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨ benchmark_group ç»„ç»‡æµ‹è¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> group &lt;span style="color:#f92672">=&lt;/span> c.benchmark_group(&lt;span style="color:#e6db74">&amp;#34;data_structures&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.sample_size(&lt;span style="color:#ae81ff">100&lt;/span>); &lt;span style="color:#75715e">// é…ç½®é‡‡æ ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>group.measurement_time(Duration::from_secs(&lt;span style="color:#ae81ff">5&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ... å¤šä¸ªç›¸å…³æµ‹è¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.finish();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="benchmark_groupæ–¹æ³•">&lt;code>benchmark_group&lt;/code>æ–¹æ³•
&lt;/h5>&lt;ul>
&lt;li>ä½œç”¨ï¼š åˆ›å»ºå…±äº«é…ç½®çš„å®¹å™¨ï¼Œä½œä¸ºå¤šä¸ªç›¸å…³æµ‹è¯•çš„é…ç½®è½½ä½“&lt;/li>
&lt;li>å¿…é¡»è¢«åŒ…å«åœ¨ &lt;code>criterion_group!&lt;/code> æ³¨å†Œçš„æµ‹è¯•å‡½æ•°ä¸­ï¼Œå¹¶ç”±å…¶è°ƒåº¦æ‰§è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="ç†è§£ç»Ÿè®¡è¾“å‡º">ç†è§£ç»Ÿè®¡è¾“å‡º
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>time: &lt;span style="color:#f92672">[&lt;/span>123.45 Âµs 125.67 Âµs 128.90 Âµs&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â†‘ â†‘ â†‘
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ä¸‹ç•Œ ä¸­ä½æ•° ä¸Šç•Œ
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>change: &lt;span style="color:#f92672">[&lt;/span>-5.23% +2.34% +10.23%&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â†‘ â†‘ â†‘
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> æœ€å¥½ é¢„æœŸå˜åŒ– æœ€å
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Found &lt;span style="color:#ae81ff">3&lt;/span> outliers among &lt;span style="color:#ae81ff">100&lt;/span> measurements
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">2&lt;/span> high mild â† ç¨å¾®åé«˜
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">1&lt;/span> high severe â† ä¸¥é‡åé«˜
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä¾‹å­">ä¾‹å­
&lt;/h4>&lt;h5 id="1-å‚æ•°åŒ–æµ‹è¯•">1. å‚æ•°åŒ–æµ‹è¯•
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æµ‹è¯•ä¸åŒè¾“å…¥å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> group &lt;span style="color:#f92672">=&lt;/span> c.benchmark_group(&lt;span style="color:#e6db74">&amp;#34;fibonacci&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#66d9ef">in&lt;/span> [&lt;span style="color:#ae81ff">10&lt;/span>, &lt;span style="color:#ae81ff">15&lt;/span>, &lt;span style="color:#ae81ff">20&lt;/span>, &lt;span style="color:#ae81ff">25&lt;/span>].iter() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group.bench_with_input(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BenchmarkId::from_parameter(i),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> i,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">|&lt;/span>b, &lt;span style="color:#f92672">&amp;amp;&lt;/span>i&lt;span style="color:#f92672">|&lt;/span> b.iter(&lt;span style="color:#f92672">||&lt;/span> fibonacci(black_box(i)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.finish();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-å¯¹æ¯”å¤šä¸ªå®ç°">2. å¯¹æ¯”å¤šä¸ªå®ç°
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> group &lt;span style="color:#f92672">=&lt;/span> c.benchmark_group(&lt;span style="color:#e6db74">&amp;#34;sum&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.bench_function(&lt;span style="color:#e6db74">&amp;#34;for_loop&amp;#34;&lt;/span>, &lt;span style="color:#f92672">|&lt;/span>b&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b.iter(&lt;span style="color:#f92672">||&lt;/span> sum_for_loop(black_box(&lt;span style="color:#f92672">&amp;amp;&lt;/span>data)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.bench_function(&lt;span style="color:#e6db74">&amp;#34;iterator&amp;#34;&lt;/span>, &lt;span style="color:#f92672">|&lt;/span>b&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b.iter(&lt;span style="color:#f92672">||&lt;/span> sum_iterator(black_box(&lt;span style="color:#f92672">&amp;amp;&lt;/span>data)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.finish();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ååé‡æµ‹é‡">ååé‡æµ‹é‡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> group &lt;span style="color:#f92672">=&lt;/span> c.benchmark_group(&lt;span style="color:#e6db74">&amp;#34;throughput&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è®¾ç½®ååé‡å•ä½
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>group.throughput(Throughput::Bytes(data.len() &lt;span style="color:#66d9ef">as&lt;/span> &lt;span style="color:#66d9ef">u64&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.bench_function(&lt;span style="color:#e6db74">&amp;#34;process&amp;#34;&lt;/span>, &lt;span style="color:#f92672">|&lt;/span>b&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b.iter(&lt;span style="color:#f92672">||&lt;/span> process(black_box(&lt;span style="color:#f92672">&amp;amp;&lt;/span>data)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŠ¥å‘Šä¼šæ˜¾ç¤º MB/s
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="è‡ªå®šä¹‰é…ç½®">è‡ªå®šä¹‰é…ç½®
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>group.sample_size(&lt;span style="color:#ae81ff">1000&lt;/span>); &lt;span style="color:#75715e">// æ ·æœ¬æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>group.warm_up_time(Duration::from_secs(&lt;span style="color:#ae81ff">3&lt;/span>)); &lt;span style="color:#75715e">// é¢„çƒ­æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>group.measurement_time(Duration::from_secs(&lt;span style="color:#ae81ff">10&lt;/span>)); &lt;span style="color:#75715e">// æµ‹é‡æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>group.noise_threshold(&lt;span style="color:#ae81ff">0.05&lt;/span>); &lt;span style="color:#75715e">// å™ªéŸ³é˜ˆå€¼
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ç®€å•ç‰ˆripgrepå®ç°æ€»ç»“</title><link>https://www.dust-zed.site/rust/ripgrep/%E7%AE%80%E5%8D%95%E7%89%88ripgrep%E5%AE%9E%E7%8E%B0%E6%80%BB%E7%BB%93/</link><pubDate>Fri, 10 Oct 2025 15:43:59 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/%E7%AE%80%E5%8D%95%E7%89%88ripgrep%E5%AE%9E%E7%8E%B0%E6%80%BB%E7%BB%93/</guid><description>&lt;h4 id="æ¦‚è¿°">æ¦‚è¿°
&lt;/h4>&lt;p>ä¾æ®å¯¹&lt;code>ripgrep&lt;/code>çš„å­¦ä¹ ï¼Œå®ç°ç®€å•çš„ä¸ªäººç‰ˆæœ¬çš„&lt;code>tbt_ripgrep&lt;/code>ï¼Œç®€å•çš„æœ‰ä»¥ä¸‹åŠŸèƒ½&lt;/p>
&lt;ul>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> åŸºæœ¬æœç´¢&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> æ·»åŠ é€‰é¡¹ï¼ˆå¿½ç•¥å¤§å°å†™ï¼Œè¡Œå·ï¼‰&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> å½©è‰²è¾“å‡º&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> æ”¯æŒé€’å½’æœç´¢ç›®å½•&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> æ˜¾ç¤ºä¸Šä¸‹æ–‡&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> æ€§èƒ½ä¼˜åŒ–ï¼ˆåŠ å¤šçº¿ç¨‹ï¼Œä¼˜åŒ–å¤§æ–‡ä»¶å¤„ç†ï¼Œåšæ€§èƒ½å¯¹æ¯”ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="åŠŸèƒ½å®ç°">åŠŸèƒ½å®ç°
&lt;/h4>&lt;p>å‘½ä»¤è¡Œå‚æ•°è§£æä½¿ç”¨çš„&lt;code>clap&lt;/code>åº“ï¼Œå½©è‰²è¾“å‡ºä¹Ÿæ˜¯ç”¨çš„&lt;code>colored&lt;/code>åº“ï¼Œæ­£åˆ™åŒ¹é…ä¹Ÿæ˜¯ç”¨çš„&lt;code>regex&lt;/code>åº“,åŸºäºä¸Šè¿°ä¸‰ä¸ªåº“æä¾›çš„åŠŸèƒ½ï¼ŒåŠŸèƒ½å®ç°çš„ä¸»è¦éš¾ç‚¹ä¸»è¦åœ¨&lt;strong>ä¸Šä¸‹æ–‡æ˜¾ç¤º&lt;/strong>ä¸&lt;strong>é€’å½’æœç´¢ç›®å½•&lt;/strong>ã€‚å…¶ä¸­é€’å½’æœç´¢ç›®å½•ä¹Ÿæ˜¯åŸºäº&lt;code>walkdir&lt;/code>åº“å®ç°çš„ï¼Œä½†æ˜¯ä¸»è¦æ˜¯æƒ³å­¦ä¹ &lt;code>ripgrep&lt;/code>çš„ç›®å½•å‘ç°æ€è·¯ã€‚&lt;/p>
&lt;hr>
&lt;h4 id="ç¨‹åºå¯¹æ¯”">ç¨‹åºå¯¹æ¯”
&lt;/h4>&lt;ol>
&lt;li>&lt;code>ripgrep&lt;/code>çš„èŒè´£åˆ†ç¦»åšçš„å¾ˆå¥½ï¼Œä»¥&lt;code>Searcher&lt;/code>ä¸ºä¾‹ï¼Œå¦‚æœä»¥æˆ‘è‡ªå·±çš„æƒ³æ³•çš„è¯ï¼Œæ˜¯ä¼šæŠŠ&lt;code>Path&lt;/code>æ”¾è¿›&lt;code>Searcher&lt;/code>ä¸­çš„ï¼Œä½†æ˜¯è¿™æ ·ä¼šè¿™æ ·ï¼Œ&lt;code>search&lt;/code>æ–¹æ³•å°±éœ€è¦å¤„ç†æ–‡ä»¶ç³»ç»Ÿé—®é¢˜ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å†…å®¹ï¼Œä½†é‚£äº›éƒ½ä¸æ˜¯æœç´¢çš„æ ¸å¿ƒé€»è¾‘ï¼š
&lt;ul>
&lt;li>éœ€è¦å¤„ç†æ–‡ä»¶ç³»ç»Ÿé”™è¯¯&lt;/li>
&lt;li>éœ€è¦å¤„ç†ç¬¦å·é“¾æ¥&lt;/li>
&lt;li>éœ€è¦å¤„ç†æ–‡ä»¶ç±»å‹åˆ¤æ–­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>åŸºäºä»¥ä¸Šçš„å·®å¼‚ï¼Œæœ¬è´¨ä¸Šæ˜¯æˆ‘æ²¡æœ‰åšå¥½&lt;strong>èŒè´£åˆ†ç¦»&lt;/strong>ï¼Œæˆ‘æ˜¯åŸºäºâ€œæ˜¯ä»€ä¹ˆâ€å»å®ç°åŠŸèƒ½çš„ï¼Œä½†æ˜¯&lt;code>ripgrep&lt;/code>æ˜¯åŸºäºâ€œåšä»€ä¹ˆâ€å»å®ç°ä»£ç çš„ï¼Œåšå¥½&lt;strong>èŒè´£åˆ†ç¦»&lt;/strong>,æ„Ÿè§‰ä¹Ÿç®—æ˜¯&lt;strong>é¢å‘æŠ½è±¡ç¼–ç¨‹&lt;/strong>çš„æ®Šé€”åŒå½’äº†å§ã€‚&lt;/li>
&lt;li>&lt;strong>æ˜¾ç¤ºä¸Šä¸‹æ–‡&lt;/strong>è™½ç„¶åŠŸèƒ½æ˜¯å®ç°äº†ï¼Œä½†æ˜¯è®¾è®¡çš„ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œå•ä¸ªæ–‡ä»¶çš„æœç´¢ç»“æœéƒ½ä¼šå­˜å‚¨ä¸‹æ¥ï¼Œç„¶åç»Ÿä¸€æ‰“å°å‡ºæ¥ï¼Œå•ä¸ªåŒ¹é…æ–‡ä»¶è¿‡å¤šçš„æ—¶å€™ï¼Œæ•ˆç‡ä½ä¸‹çš„ç¼ºç‚¹å°±ä¼šæ”¾å¤§äº†ï¼Œç›®å‰å¯¹&lt;code>ripgrep&lt;/code>çš„å®ç°è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä½†æ˜¯å¾ˆå¥½å¥‡æ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;code>ripgrep&lt;/code>æ˜¯å¦‚ä½•åšåˆ°æµå¼å¤„ç† + ä¸Šä¸‹æ–‡åŠŸèƒ½å¤„ç†çš„å‘¢ï¼Ÿ&lt;/li>
&lt;li>&lt;code>ripgrep&lt;/code>çš„&lt;code>walk&lt;/code>å®ç°ä¹Ÿæ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„ï¼Œæˆ‘åŸæœ¬çš„å®ç°ä¹Ÿå°±æ˜¯å¯¹&lt;code>walkdir&lt;/code>è¿”å›çš„è¿­ä»£å™¨è¿›è¡Œéå†å°±è¡Œï¼Œä½†æ˜¯&lt;code>ripgrep&lt;/code>å¯¹æ–‡ä»¶éå†è¿›è¡Œäº†åŠŸèƒ½å¤„ç†ï¼Œ&lt;code>WalkBuilder&lt;/code>,&lt;code>WalkEventIter&lt;/code>å’Œ&lt;code>Walk&lt;/code>éƒ½æ˜¯ï¼Œæˆ‘è§‰å¾—è¿™äº›éƒ½æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„&lt;/li>
&lt;/ol>
&lt;hr>
&lt;p>ä¼˜å…ˆè€ƒè™‘&lt;strong>åšä»€ä¹ˆ&lt;/strong>è€Œä¸æ˜¯&lt;strong>æ˜¯ä»€ä¹ˆ&lt;/strong>å»å®ç°åŠŸèƒ½ï¼Œ&lt;strong>é¢å‘è¡Œä¸ºç¼–ç¨‹&lt;/strong>ä¼˜äº&lt;strong>é¢å‘å¯¹è±¡ç¼–ç¨‹&lt;/strong>ï¼Œåšå¥½èŒè´£åˆ†ç¦»ã€‚&lt;/p></description></item><item><title>Regex</title><link>https://www.dust-zed.site/rust/docs_rs_zh/regex/</link><pubDate>Mon, 22 Sep 2025 12:19:53 +0800</pubDate><guid>https://www.dust-zed.site/rust/docs_rs_zh/regex/</guid><description>&lt;p>è¿™ä¸ªcrateæä¾›äº†åœ¨å­—ç¬¦ä¸²ä¸­æœç´¢ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…(&lt;code>regular expression&lt;/code>ç®€ç§°&lt;code>regex&lt;/code>)çš„ä¾‹ç¨‹ã€‚æœ¬åº“æ”¯æŒçš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•å’Œå…¶ä»–æ­£åˆ™å¼•æ“ç›¸ä¼¼ï¼Œä½†æ˜¯ç¼ºå°‘äº†ä¸€äº›æ— æ³•é«˜æ•ˆå®ç°çš„åŠŸèƒ½ã€‚åŒ…æ‹¬ä½†ä¸é™äºï¼Œ&lt;code>look-around&lt;/code>å’Œ&lt;code>backrefernces&lt;/code>ã€‚ç›¸åº”çš„ï¼Œæœ¬åº“çš„æ­£åˆ™æœç´¢æœ€å·®çš„æ—¶é—´å¤æ‚åº¦æ˜¯&lt;code>O(m * n)&lt;/code>ï¼Œ&lt;code>m&lt;/code>å’Œæ­£åˆ™è¡¨è¾¾å¼æˆæ­£æ¯”ï¼Œ&lt;code>n&lt;/code>å’Œè¢«æœç´¢çš„å­—ç¬¦ä¸²æˆæ­£æ¯”ã€‚&lt;/p>
&lt;p>å¦‚æœä½ åªéœ€è¦APIæ–‡æ¡£ï¼Œåªéœ€è¦è·³è½¬è‡³[Regex][https://docs.rs/regex/latest/regex/struct.Regex.html]ç±»å‹ã€‚å¦åˆ™ï¼Œæ­¤å¤„æ˜¯å¿«é€Ÿç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•è§£æç±»ä¼¼grepç¨‹åºçš„è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?m)^([^:]+):([0-9]+):(.+)$&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&lt;/span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">path/to/foo:54:Blue Harvest
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">path/to/bar:90:Something, Something, Something, Dark Side
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">path/to/baz:3:It&amp;#39;s a Trap!
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> results &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">vec!&lt;/span>[];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (_, [path, lineno, line]) &lt;span style="color:#66d9ef">in&lt;/span> re.captures_iter(hay).map(&lt;span style="color:#f92672">|&lt;/span>c&lt;span style="color:#f92672">|&lt;/span> c.extract()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> results.push((path, lineno.parse::&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u64&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>()&lt;span style="color:#f92672">?&lt;/span>, line));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(results, &lt;span style="color:#a6e22e">vec!&lt;/span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;path/to/foo&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">54&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Blue Harvest&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;path/to/bar&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">90&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Something, Something, Something, Dark Side&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;path/to/baz&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;It&amp;#39;s a Trap!&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ¦‚è¿°">æ¦‚è¿°
&lt;/h4>&lt;hr>
&lt;p>æœ¬åº“çš„ä¸»è¦ç±»å‹æ˜¯&lt;code>Regex&lt;/code>ã€‚å…¶é‡è¦çš„æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>Regex::new&lt;/code>ä½¿ç”¨é»˜è®¤é…ç½®ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ã€‚&lt;code>RegexBuilder&lt;/code>å…è®¸é…ç½®éé»˜è®¤é…ç½®ã€‚ï¼ˆä¾‹å¦‚ï¼Œä¸åŒºåˆ†å¤§å°å†™åŒ¹é…ï¼Œè¯¦ç»†æ¨¡å¼ç­‰ã€‚ï¼‰&lt;/li>
&lt;li>&lt;code>Regex::is_match&lt;/code> æŠ¥å‘Šåœ¨ç‰¹å®šçš„haystackæ˜¯å¦å­˜åœ¨åŒ¹é…ã€‚&lt;/li>
&lt;li>&lt;code>Regex::find&lt;/code>æŠ¥å‘ŠåŒ¹é…é¡¹åœ¨haystackçš„å­—èŠ‚åç§»ï¼Œå¦‚æœå­˜åœ¨çš„è¯ã€‚&lt;code>Regex::find_iter&lt;/code>è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”¨äºéå†æ‰€æœ‰åŒ¹é…é¡¹ã€‚&lt;/li>
&lt;li>&lt;code>Regex::captures&lt;/code>è¿”å›&lt;code>Captures&lt;/code>,å®ƒæŠ¥å‘Šäº†åœ¨haystackä¸­åŒ¹é…çš„å­—èŠ‚åç§»é‡ä»¥åŠä»haystackä¸­çš„regexåŒ¹é…çš„æ¯ä¸ªæ•è·ç»„çš„å­—èŠ‚åç§»é‡ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¹Ÿæœ‰&lt;code>RegexSet&lt;/code>ï¼Œå®ƒå…è®¸åœ¨ä¸€æ¬¡æœç´¢ä¸­æœç´¢å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚ç„¶è€Œï¼Œå®ƒåªæŠ¥å‘ŠåŒ¹é…çš„æ¨¡å¼è€Œä¸æŠ¥å‘ŠåŒ¹é…çš„å­—èŠ‚åç§»é‡ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œé¡¶çº§crateæ–‡æ¡£ç»„ç»‡å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="#Usage" >Usage&lt;/a>å±•ç¤ºäº†å¦‚ä½•åœ¨Rustå·¥ç¨‹ä¸­æ·»åŠ &lt;code>regex&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;a class="link" href="#Examples" >Examples&lt;/a>æä¾›äº†æœ‰é™çš„æ­£åˆ™è¡¨è¾¾å¼ç¤ºä¾‹ã€‚&lt;/li>
&lt;li>&lt;a class="link" href="#Performance" >Performance&lt;/a>æä¾›äº†å¦‚ä½•ä¼˜åŒ–æ­£åˆ™æœç´¢é€Ÿåº¦çš„ç®€å•æ€»ç»“ã€‚&lt;/li>
&lt;li>[Unicode][]è®¨è®ºäº†å¯¹non-ASCIIçš„æ”¯æŒã€‚&lt;/li>
&lt;li>[Syntax][]åˆ—ä¸¾äº†æœ¬åº“æ˜ç¡®æ”¯æŒçš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ã€‚&lt;/li>
&lt;li>[Untrusted input][]è®¨è®ºäº†æœ¬åº“å¦‚ä½•å¤„ç†ä¸å—ä¿¡ä»»çš„regexæˆ–haystackã€‚&lt;/li>
&lt;li>[Crate features][]è®°å½•äº†è¿™ä¸ªåº“å¯ä»¥è¢«å¯ç”¨æˆ–ç¦ç”¨çš„ç‰¹æ€§ã€‚&lt;/li>
&lt;li>[Other crates][]ä¸æ­£åˆ™å®¶æ—ä¸­å…¶ä»–åº“é“¾æ¥ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="usage">Usage
&lt;/h4>&lt;p>&lt;code>regex&lt;/code>åœ¨ [crates.io][https://crates.io/crates/regex]ä¸Šï¼Œå¯ä»¥é€šè¿‡åœ¨é¡¹ç›®&lt;code>Cargo.toml&lt;/code>æ–‡ä»¶æ·»åŠ &lt;code>regex&lt;/code>åˆ°ä½ çš„ä¾èµ–é¡¹æ¥ä½¿ç”¨ã€‚æ›´ç®€å•çš„æ–¹å¼ï¼Œåªéœ€è¦&lt;code>cargo run regex&lt;/code>ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Rust é¡¹ç›®ï¼Œæ·»åŠ äº†å¯¹ &lt;code>regex&lt;/code> çš„ä¾èµ–ï¼Œåˆ›å»ºäº†æ­£åˆ™æœç´¢çš„æºä»£ç ï¼Œç„¶åè¿è¡Œäº†ç¨‹åºã€‚&lt;/p>
&lt;p>ç¬¬ä¸€æ­¥ï¼Œåœ¨æ–°ç›®å½•æ–°å»ºé¡¹ç›®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ mkdir regex-example
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ cd regex-example
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ crago init
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬äºŒæ­¥ï¼Œæ·»åŠ &lt;code>regex&lt;/code>ä¾èµ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ cargo add regex
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬ä¸‰æ­¥ï¼šç¼–è¾‘&lt;code>src/main.rs&lt;/code>ï¼Œç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢å…¶æºç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Hello (?&amp;lt;name&amp;gt;\w+)!&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> Some(caps) &lt;span style="color:#f92672">=&lt;/span> re.captures(&lt;span style="color:#e6db74">&amp;#34;Hello Murphy!&amp;#34;&lt;/span>) &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;no match!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;The name is: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>caps[&lt;span style="color:#e6db74">&amp;#34;name&amp;#34;&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬å››æ­¥ï¼Œæ‰§è¡Œ&lt;code>cargo run&lt;/code>è¿è¡Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ cargo run
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiling memchr v2.5.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiling regex-syntax v0.7.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiling aho-corasick v1.0.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiling regex v1.8.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiling regex-example v0.1.0 &lt;span style="color:#f92672">(&lt;/span>/tmp/regex-example&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Finished dev &lt;span style="color:#f92672">[&lt;/span>unoptimized + debuginfo&lt;span style="color:#f92672">]&lt;/span> target&lt;span style="color:#f92672">(&lt;/span>s&lt;span style="color:#f92672">)&lt;/span> in 4.22s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Running &lt;span style="color:#e6db74">`&lt;/span>target/debug/regex-example&lt;span style="color:#e6db74">`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The name is: Murphy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¨‹åºç¬¬ä¸€æ¬¡è¿è¡Œå°†å±•ç¤ºæ›´å¤šè¾“å‡ºï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚ä½†æ˜¯åç»­è¿è¡Œä¸éœ€è¦é‡æ–°ç¼–è¯‘ä¾èµ–é¡¹ã€‚ã€&lt;/p>
&lt;h4 id="examples">Examples
&lt;/h4>&lt;hr>
&lt;p>æœ¬èŠ‚æä¾›äº†ä¸€äº›ç¤ºä¾‹ï¼Œä»¥æ•™ç¨‹é£æ ¼å±•ç¤ºå¦‚ä½•ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åœ¨haystackä¸­è¿›è¡Œæœç´¢ã€‚APIæ–‡æ¡£ä¸­è¿˜æœ‰æ›´å¤šç¤ºä¾‹ã€‚&lt;/p>
&lt;p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæœ‰å¿…è¦å®šä¹‰ä¸€äº›æœ¯è¯­ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>regex&lt;/strong>æ˜¯ç±»å‹ä¸º&lt;code>Regex&lt;/code>çš„å€¼ã€‚æˆ‘ä»¬ç”¨&lt;code>re&lt;/code>ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼çš„å˜é‡åã€‚&lt;/li>
&lt;li>&lt;strong>pattern&lt;/strong>ç”¨äºæ„å»ºæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬ç”¨&lt;code>pat&lt;/code>ä½œä¸ºæ¨¡å¼çš„å˜é‡åã€‚&lt;/li>
&lt;li>&lt;strong>haystack&lt;/strong>æ˜¯è¢«æ­£åˆ™è¡¨è¾¾å¼æœç´¢çš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬ç”¨&lt;code>hay&lt;/code>ä½œä¸ºhaystackçš„å˜é‡åã€‚&lt;/li>
&lt;/ul>
&lt;p>æœ‰æ—¶å€™â€œregexâ€å’Œâ€œpatternâ€è¿™ä¸¤ä¸ªè¯ä¼šè¢«äº’æ¢ä½¿ç”¨ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªcrateä¸­ï¼Œå¸¸è§„è¡¨è¾¾å¼çš„ä¸€èˆ¬ä½¿ç”¨æ–¹æ³•æ˜¯å°†ä¸€ä¸ªæ¨¡å¼ç¼–è¯‘æˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç„¶åä½¿ç”¨è¯¥æ­£åˆ™è¡¨è¾¾å¼æ¥æœç´¢ã€åˆ†å‰²æˆ–æ›¿æ¢å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;h5 id="example-find-a-middle-intial">Example: find a middle intial
&lt;/h5>&lt;hr>
&lt;p>æˆ‘ä»¬ä»ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­å¼€å§‹ï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºæŸ¥æ‰¾ç‰¹å®šçš„åç§°ï¼Œä½†ä½¿ç”¨é€šé…ç¬¦æ¥åŒ¹é…ä¸­é—´åã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// We use &amp;#39;unwrap()&amp;#39; here because it would be a bug in our program if the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// pattern failed to compile to a regex. Panicking in the presence of a bug
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// is okay.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Homer (.)\. Simpson&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Homer J. Simpson&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> Some(caps) &lt;span style="color:#f92672">=&lt;/span> re.captures(hay) &lt;span style="color:#66d9ef">else&lt;/span> { &lt;span style="color:#66d9ef">return&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;J&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>caps[&lt;span style="color:#ae81ff">1&lt;/span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ç¬¬ä¸€ä¸ªä¾‹å­æœ‰äº›å€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>.&lt;/code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ¨¡å¼å…ƒå­—ç¬¦ï¼Œè¡¨ç¤ºâ€œåŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ï¼Œé™¤äº†æ¢è¡Œç¬¦ã€‚â€ï¼ˆæ›´ç²¾ç¡®åœ°è¯´ï¼Œåœ¨è¿™ä¸ª crate ä¸­ï¼Œè¡¨ç¤ºâ€œåŒ¹é…ä»»ä½• UTF-8 ç¼–ç çš„ä»»ä½• Unicode æ ‡é‡å€¼ï¼Œé™¤äº† \nã€‚â€ï¼‰&lt;/li>
&lt;li>æˆ‘ä»¬å¯ä»¥ç”¨è½¬ä¹‰å­—ç¬¦æ¥åŒ¹é…å®é™…çš„ç‚¹å·ï¼Œå³&lt;code> \.&lt;/code>ã€‚&lt;/li>
&lt;li>æˆ‘ä»¬ä½¿ç”¨ Rust çš„åŸå§‹å­—ç¬¦ä¸²æ¥é¿å…åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼è¯­æ³•å’Œ Rust çš„å­—ç¬¦ä¸²å­—é¢é‡è¯­æ³•ä¸­å¤„ç†è½¬ä¹‰åºåˆ—ã€‚å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨&lt;code>\\.&lt;/code>å»åŒ¹é…å­—ç¬¦&lt;code>.&lt;/code>ã€‚&lt;code>r&amp;quot;\.&amp;quot;&lt;/code>å’Œ&lt;code>\\.&lt;/code>æ˜¯ç­‰æ•ˆçš„æ¨¡å¼ã€‚&lt;/li>
&lt;li>æˆ‘ä»¬å°†é€šé…ç¬¦&lt;code> \.&lt;/code> æŒ‡ä»¤æ”¾åœ¨æ‹¬å·ä¸­ã€‚è¿™äº›æ‹¬å·å…·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œè¡¨ç¤ºâ€œå°† haystack ä¸­ä¸è¿™äº›æ‹¬å·åŒ¹é…çš„éƒ¨åˆ†ä½œä¸ºæ•è·ç»„å¯ç”¨â€ã€‚æ‰¾åˆ°åŒ¹é…åï¼Œæˆ‘ä»¬ä½¿ç”¨ &amp;amp;caps[1] è®¿é—®æ­¤æ•è·ç»„ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦åˆ™ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code>re.captures(hay) &lt;/code>æ‰§è¡Œæœç´¢ï¼Œå¹¶åœ¨æ²¡æœ‰åŒ¹é…æ—¶ä»æˆ‘ä»¬çš„å‡½æ•°ä¸­è¿”å›ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡è¯¢é—®ä¸æ•è·ç»„ç´¢å¼•ä¸º&lt;code>1&lt;/code>çš„éƒ¨åˆ†åŒ¹é…çš„haystackçš„é‚£ä¸€éƒ¨åˆ†æ¥å¼•ç”¨ä¸­é—´åã€‚ï¼ˆç´¢å¼•ä¸º0çš„æ•è·ç»„æ˜¯éšå¼çš„ï¼Œæ€»æ˜¯å¯¹åº”æ•´ä¸ªåŒ¹é…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‚£å°±æ˜¯&lt;code>Homer J. Simpson&lt;/code>ã€‚ï¼‰&lt;/p>
&lt;h5 id="example-named-capture-groups">Example: named capture groups
&lt;/h5>&lt;hr>
&lt;p>åœ¨æˆ‘ä»¬ä¸Šé¢çš„ä¸­é—´åˆå§‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®è°ƒæ•´ä¸€ä¸‹æ¨¡å¼ï¼Œç»™åŒ¹é…ä¸­é—´åˆå§‹çš„ç»„å‘½åï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Note that (?P&amp;lt;middle&amp;gt;.) is a different way to spell the same thing.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Homer (?&amp;lt;middle&amp;gt;.)\. Simpson&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Homer J. Simpson&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> Some(caps) &lt;span style="color:#f92672">=&lt;/span> re.captures(hay) &lt;span style="color:#66d9ef">else&lt;/span> {&lt;span style="color:#66d9ef">return&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;J&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>caps[&lt;span style="color:#e6db74">&amp;#34;middle&amp;#34;&lt;/span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»™ä¸€ç»„å‘½ååœ¨æ¨¡å¼ä¸­æœ‰å¤šä¸ªç»„æ—¶å¾ˆæœ‰ç”¨ã€‚å®ƒä½¿å¼•ç”¨è¿™äº›ç»„çš„ä»£ç æ›´å®¹æ˜“ç†è§£ã€‚&lt;/p>
&lt;h5 id="example-validating-a-particular-date-format">Example: validating a particular date format
&lt;/h5>&lt;hr>
&lt;p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ç¡®è®¤ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆhaystackï¼‰æ˜¯å¦å®Œå…¨åŒ¹é…æŸä¸ªç‰¹å®šçš„æ—¥æœŸæ ¼å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;^\d{4}-\d{2}-\d{2}$&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert!&lt;/span>(re.is_match(&lt;span style="color:#e6db74">&amp;#34;2010-03-14&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ &lt;code>^&lt;/code> å’Œ &lt;code>$&lt;/code> é”šç‚¹çš„ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªcrateä¸­ï¼Œæ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼æœç´¢éƒ½ä¼šåœ¨å…¶æ¨¡å¼çš„å¼€å¤´éšå¼åœ°åŠ ä¸Š&lt;code>(?s:.)*?&lt;/code>ï¼Œè¿™ä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åœ¨haystackçš„ä»»ä½•ä½ç½®è¿›è¡ŒåŒ¹é…ã€‚æ­£å¦‚ä¸Šé¢æ‰€æåˆ°çš„ï¼Œé”šç‚¹å¯ä»¥ç”¨æ¥ç¡®ä¿æ•´ä¸ªhaystackåŒ¹é…ä¸€ä¸ªæ¨¡å¼ã€‚&lt;/p>
&lt;p>è¿™ä¸ª crate é»˜è®¤æ˜¯ Unicode æ„ŸçŸ¥çš„ï¼Œè¿™æ„å‘³ç€ &lt;code>\d &lt;/code>å¯èƒ½ä¼šåŒ¹é…ä½ å¯èƒ½é¢„æœŸçš„æ›´å¤šå†…å®¹ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;^\d{4}-\d{2}-\d{2}$&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert!&lt;/span>(re.is_match(&lt;span style="color:#e6db74">&amp;#34;ğŸšğŸ˜ğŸ™ğŸ˜-ğŸ˜ğŸ›-ğŸ™ğŸœ&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¦ä»…åŒ¹é…ASCIIåè¿›åˆ¶æ•°å­—ï¼Œä»¥ä¸‹æ‰€æœ‰å†…å®¹éƒ½æ˜¯ç­‰æ•ˆçš„ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>[0-9]&lt;/code>&lt;/li>
&lt;li>&lt;code>[?-u:\d]&lt;/code>&lt;/li>
&lt;li>&lt;code>[[:digit:]]&lt;/code>&lt;/li>
&lt;li>&lt;code>[\d&amp;amp;&amp;amp;\p{ascii}]&lt;/code>&lt;/li>
&lt;/ul>
&lt;h5 id="example-find-dates-in-a-haystack">Example: find dates in a haystack
&lt;/h5>&lt;hr>
&lt;p>åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•éªŒè¯æ•´ä¸ªhaystackæ˜¯å¦å¯¹åº”äºç‰¹å®šçš„æ—¥æœŸæ ¼å¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä»ä¸€å¤§å †æ•°æ®ä¸­æå–å‡ºç‰¹å®šæ ¼å¼çœ‹èµ·æ¥åƒæ—¥æœŸçš„æ‰€æœ‰ä¸œè¥¿ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿè¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¿­ä»£å™¨APIæ¥æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…é¡¹ï¼ˆè¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»ç§»é™¤äº†é”šç‚¹å¹¶åˆ‡æ¢åˆ°æŸ¥æ‰¾ä»…åŒ…å«ASCIIå­—ç¬¦çš„æ•°å­—ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;[0-9]{4}-[0-9]{2}-[0-9]{2}&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;What do 1865-04-14, 1881-07-02, 1901-09-06 and 1963-11-22 have in common?&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// &amp;#39;m&amp;#39; is a &amp;#39;Match&amp;#39;, and &amp;#39;as_str()&amp;#39; returns the matching part of the haystack.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> dates: Vec&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> re.find_iter(hay).map(&lt;span style="color:#f92672">|&lt;/span>m&lt;span style="color:#f92672">|&lt;/span> m.as_str()).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(dates, &lt;span style="color:#a6e22e">vec!&lt;/span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;1865-04-14&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;1881-07-02&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;1901-09-06&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;1963-11-22&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥éå†æ•è·å€¼ï¼ˆ&lt;code>Captures&lt;/code>ï¼‰è€Œä¸æ˜¯åŒ¹é…å€¼ï¼ˆ&lt;code>Match&lt;/code>ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡æ•è·ç»„è®¿é—®æ—¥æœŸçš„æ¯ä¸ªç»„ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&amp;lt;&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>pattern)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ•è·ç»„çš„æ¨¡å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ•è·ç»„çš„åç§°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å‘½åè¯­æ³•çš„å¼€å§‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ•è·ç»„çš„å¼€å§‹&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?&amp;lt;y&amp;gt;[0-9]{4})-(?&amp;lt;m&amp;gt;[0-9]{2})-(?&amp;lt;d&amp;gt;[0-9]{2})&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;What do 1865-04-14, 1881-07-02, 1901-09-06 and 1963-11-22 have in common?&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// &amp;#39;m&amp;#39; is a &amp;#39;Match&amp;#39;, and &amp;#39;as_str()&amp;#39; returns the matching part of the haystack.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> dates: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> re.captures_iter(hay).map(&lt;span style="color:#f92672">|&lt;/span>caps&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// The unwraps are okay because every capture group must match if the whole
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// regex matches, and in this context, we know we have a match.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// Note that we use `caps.name(&amp;#34;y&amp;#34;).unwrap().as_str()` instead of
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// `&amp;amp;caps[&amp;#34;y&amp;#34;]` because the lifetime of the former is the same as the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// lifetime of `hay` above, but the lifetime of the latter is tied to the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// lifetime of `caps` due to how the `Index` trait is defined.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> year &lt;span style="color:#f92672">=&lt;/span> caps.name(&lt;span style="color:#e6db74">&amp;#34;y&amp;#34;&lt;/span>).unwrap().as_str();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> month &lt;span style="color:#f92672">=&lt;/span> caps.name(&lt;span style="color:#e6db74">&amp;#34;m&amp;#34;&lt;/span>).unwrap().as_str();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> day &lt;span style="color:#f92672">=&lt;/span> caps.name(&lt;span style="color:#e6db74">&amp;#34;d&amp;#34;&lt;/span>).unwrap().as_str();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (year, month, day)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(dates, &lt;span style="color:#a6e22e">vec!&lt;/span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1865&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;04&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;14&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1881&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;07&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;02&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1901&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;09&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;06&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1963&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;11&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;22&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="example-simpler-capture-group-extraction">Example: simpler capture group extraction
&lt;/h5>&lt;hr>
&lt;p>å¯ä»¥ä½¿ç”¨&lt;code> Captures::extract&lt;/code> å°†å‰ä¸€ä¸ªç¤ºä¾‹ä¸­çš„ä»£ç ç®€åŒ–ä¸€äº›ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;([0-9]{4})-([0-9]{2})-([0-9]{2})&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;What do 1865-04-14, 1881-07-02, 1901-09-06 and 1963-11-22 have in common?&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> dates: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> re.captures_iter(hay).map(&lt;span style="color:#f92672">|&lt;/span>caps&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (_, [year, month, day]) &lt;span style="color:#f92672">=&lt;/span> caps.extract();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (year, month, day)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(dates, &lt;span style="color:#a6e22e">vec!&lt;/span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1865&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;04&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;14&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1881&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;07&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;02&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1901&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;09&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;06&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1963&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;11&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;22&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Captures::extract&lt;/code> é€šè¿‡ç¡®ä¿åŒ¹é…çš„ç»„æ•°ä¸é€šè¿‡ &lt;code>[year, month, day] &lt;/code>è¯­æ³•è¯·æ±‚çš„ç»„æ•°åŒ¹é…æ¥å·¥ä½œã€‚å¦‚æœå®ƒä»¬åŒ¹é…ï¼Œé‚£ä¹ˆæ¯ä¸ªå¯¹åº”æ•è·ç»„çš„å­å­—ç¬¦ä¸²å°†è‡ªåŠ¨ä»¥é€‚å½“å¤§å°çš„æ•°ç»„è¿”å›ã€‚Rust çš„æ•°ç»„æ¨¡å¼åŒ¹é…è¯­æ³•è´Ÿè´£å…¶ä½™éƒ¨åˆ†ã€‚&lt;/p>
&lt;h5 id="replacement-with-named-capture-groups">replacement with named capture groups
&lt;/h5>&lt;hr>
&lt;p>åœ¨ä¹‹å‰çš„ä¾‹å­åŸºç¡€ä¸Šï¼Œä¹Ÿè®¸æˆ‘ä»¬æƒ³é‡æ–°æ’åˆ—æ—¥æœŸæ ¼å¼ã€‚å¯ä»¥é€šè¿‡æ‰¾åˆ°æ¯ä¸ªåŒ¹é…é¡¹å¹¶ç”¨ä¸åŒçš„å†…å®¹æ›¿æ¢å®ƒæ¥å®ç°ã€‚&lt;code>Regex::replace_all&lt;/code> è¿™ä¸ªå‡½æ•°æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼ŒåŒ…æ‹¬æ”¯æŒåœ¨æ›¿æ¢å­—ç¬¦ä¸²ä¸­å¼•ç”¨å‘½åç»„ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?&amp;lt;y&amp;gt;\d{4})-(?&amp;lt;m&amp;gt;\d{2})-(?&amp;lt;d&amp;gt;\d{2})&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> before &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;1973-01-05, 1975-08-25 and 1980-10-18&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> after &lt;span style="color:#f92672">=&lt;/span> re.replace_all(before, &lt;span style="color:#e6db74">&amp;#34;$m/$d/$y&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(after, &lt;span style="color:#e6db74">&amp;#34;01/05/1973, 08/25/1975 and 10/18/1980&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ›¿æ¢æ–¹æ³•å®é™…ä¸Šåœ¨æ›¿æ¢ä¸­æ˜¯å¤šæ€çš„ï¼Œè¿™æä¾›äº†æ¯”è¿™é‡Œçœ‹åˆ°çš„æ›´å¤šçš„çµæ´»æ€§ã€‚ï¼ˆæœ‰å…³ &lt;code>Regex::replace&lt;/code> çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ–‡æ¡£ã€‚ï¼‰&lt;/p>
&lt;h5 id="example-verbose-mode">Example: verbose mode
&lt;/h5>&lt;hr>
&lt;p>å½“ä½ çš„æ­£åˆ™è¡¨è¾¾å¼å˜å¾—å¤æ‚æ—¶ï¼Œä½ å¯èƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨å…¶ä»–å·¥å…·ï¼Œè€Œä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åšæŒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code>x&lt;/code> æ ‡å¿—å¯ç”¨ä¸æ˜¾ç€çš„ç©ºç™½æ¨¡å¼æˆ–â€œè¯¦ç»†æ¨¡å¼â€ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç©ºç™½è¢«è§†ä¸ºä¸æ˜¾ç€ï¼Œå¯ä»¥ç¼–å†™æ³¨é‡Šã€‚è¿™å¯èƒ½ä¼šä½¿ä½ çš„æ¨¡å¼æ›´æ˜“äºç†è§£ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?x)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> (?P&amp;lt;y&amp;gt;\d{4}) # the year, including all Unicode digits
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> -
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> (?P&amp;lt;m&amp;gt;\d{2}) # the month, including all Unicode digits
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> -
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> (?P&amp;lt;d&amp;gt;\d{2}) # the day, including all Unicode digits
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> before &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;1973-01-05, 1975-08-25 and 1980-10-18&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> after &lt;span style="color:#f92672">=&lt;/span> re.replace_all(before, &lt;span style="color:#e6db74">&amp;#34;$m/$d/$y&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(after, &lt;span style="color:#e6db74">&amp;#34;01/05/1973, 08/25/1975 and 10/18/1980&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä½ å¸Œæœ›åœ¨è¿™ç§æ¨¡å¼ä¸‹åŒ¹é…ç©ºç™½å­—ç¬¦ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨ &lt;code>\s&lt;/code>, &lt;code>\n&lt;/code>, &lt;code>\t&lt;/code> ç­‰ã€‚è¦è½¬ä¹‰å•ä¸ªç©ºæ ¼å­—ç¬¦ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code>\&lt;/code>ï¼Œä½¿ç”¨å…¶åå…­è¿›åˆ¶å­—ç¬¦ä»£ç  &lt;code>\x20&lt;/code> æˆ–æš‚æ—¶ç¦ç”¨&lt;code> x&lt;/code> æ ‡å¿—ï¼Œä¾‹å¦‚ï¼Œ&lt;code>(?-x: )&lt;/code>ã€‚&lt;/p>
&lt;h5 id="example-match-multiple-regular-expressions-simultaneously">Example: match multiple regular expressions simultaneously
&lt;/h5>&lt;p>è¿™å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ &lt;code>RegexSet&lt;/code> åœ¨ä¸€æ¬¡æ‰«æä¸­åŒ¹é…å¤šä¸ªï¼ˆå¯èƒ½é‡å çš„ï¼‰æ­£åˆ™è¡¨è¾¾å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::RegexSet;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> set &lt;span style="color:#f92672">=&lt;/span> RegexSet::new(&lt;span style="color:#f92672">&amp;amp;&lt;/span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\w+&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\d+&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\pL+&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;foo&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;bar&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;barfoo&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;foobar&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Iterate over and collect all of the matches. Each match corresponds to the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ID of the matching pattern.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> matches: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> set.matches(&lt;span style="color:#e6db74">&amp;#34;foobar&amp;#34;&lt;/span>).into_iter().collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(matches, &lt;span style="color:#a6e22e">vec!&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>, &lt;span style="color:#ae81ff">6&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// You can also test whether a particular regex matched:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> matches &lt;span style="color:#f92672">=&lt;/span> set.matches(&lt;span style="color:#e6db74">&amp;#34;foobar&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert!&lt;/span>(&lt;span style="color:#f92672">!&lt;/span>matches.matched(&lt;span style="color:#ae81ff">5&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert!&lt;/span>(matches.matched(&lt;span style="color:#ae81ff">6&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="performance">Performance
&lt;/h4>&lt;hr>
&lt;p>æœ¬èŠ‚ç®€è¦è®¨è®ºäº†æ­£åˆ™è¡¨è¾¾å¼åœ¨é€Ÿåº¦å’Œèµ„æºä½¿ç”¨æ–¹é¢çš„å‡ ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;h5 id="only-ask-for-what-you-need">Only ask for what you need
&lt;/h5>&lt;hr>
&lt;p>åœ¨ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢æ—¶ï¼Œé€šå¸¸å¯ä»¥è¯·æ±‚ä¸‰ç§ä¸åŒç±»å‹çš„ä¿¡æ¯ï¼š&lt;/p>
&lt;ol>
&lt;li>æ­£åˆ™è¡¨è¾¾å¼åœ¨haystackä¸­åŒ¹é…å—ï¼Ÿ&lt;/li>
&lt;li>æ­£åˆ™è¡¨è¾¾å¼åœ¨haystackåŒ¹é…çš„ä½ç½®ï¼Ÿ&lt;/li>
&lt;li>æ¯ä¸ªæ•è·ç»„åœ¨haystackä¸­åŒ¹é…çš„ä½ç½®åœ¨å“ªé‡Œï¼Ÿ&lt;/li>
&lt;/ol>
&lt;p>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªåº“å¯ä»¥æä¾›ä¸€ä¸ªå‡½æ•°æ¥å›ç­”#3ï¼Œè¿™ä¼šè‡ªåŠ¨åŒ…å«#1å’Œ#2ã€‚ç„¶è€Œï¼Œè®¡ç®—æ•è·ç»„åŒ¹é…ä½ç½®å¯èƒ½ä¼šæ˜¾è‘—æ›´æ˜‚è´µï¼Œæ‰€ä»¥å¦‚æœä½ ä¸éœ€è¦çš„è¯æœ€å¥½ä¸è¦è¿™æ ·åšã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œåªéœ€è¦è¯·æ±‚ä½ éœ€è¦çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åªéœ€è¦æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦åŒ¹é…ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸è¦ä½¿ç”¨&lt;code>Regex::find&lt;/code>ã€‚è€Œæ˜¯ä½¿ç”¨&lt;code>Regex::is_match&lt;/code>ã€‚&lt;/p>
&lt;h5 id="unicode-can-impact-usage-and-search-speed">Unicode can impact usage and search speed
&lt;/h5>&lt;hr>
&lt;p>è¿™ä¸ªcrateå¯¹Unicodeæœ‰ä¸€çº§æ”¯æŒå¹¶é»˜è®¤å¯ç”¨ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä¸ºäº†æ”¯æŒå®ƒæ‰€éœ€çš„é¢å¤–å†…å­˜å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå¹¶ä¸”é€šå¸¸ä¸ä¼šå½±å“æœç´¢é€Ÿåº¦ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½ä¼šæœ‰å½±å“ã€‚&lt;/p>
&lt;p>åœ¨å†…å­˜ä½¿ç”¨æ–¹é¢ï¼ŒUnicodeçš„ä¸»è¦å½±å“ä¸»è¦é€šè¿‡Unicodeå­—ç¬¦ç±»ä½“ç°ã€‚Unicodeå­—ç¬¦ç±»é€šå¸¸ç›¸å½“å¤§ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ\wåŒ¹é…å¤§çº¦14ä¸‡ä¸ªä¸åŒçš„ä»£ç ç‚¹ã€‚è¿™éœ€è¦é¢å¤–çš„å†…å­˜ï¼Œå¹¶ä¸”é€šå¸¸ä¼šå‡æ…¢æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘çš„é€Ÿåº¦ã€‚è™½ç„¶è¿™é‡Œå¶å°”ä½¿ç”¨ä¸€ä¸ª\wé€šå¸¸ä¸ä¼šè¢«æ³¨æ„åˆ°ï¼Œä½†å†™\w{100}ä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªç›¸å½“å¤§çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å®é™…ä¸Šï¼Œ\wæ¯”å…¶ä»…é™ASCIIçš„ç‰ˆæœ¬å¤§å¾—å¤šï¼Œå› æ­¤å¦‚æœæ‚¨çš„éœ€æ±‚ä»…é™äºASCIIï¼Œé‚£ä¹ˆä½¿ç”¨ASCIIç±»å¯èƒ½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ä»…é™ASCIIçš„\wå¯ä»¥ä»¥å¤šç§æ–¹å¼æ‹¼å†™ã€‚ä»¥ä¸‹æ‰€æœ‰å†…å®¹éƒ½æ˜¯ç­‰ä»·çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>[0-9A-Za-z_]&lt;/code>&lt;/li>
&lt;li>&lt;code>(?-u:\w)&lt;/code>&lt;/li>
&lt;li>&lt;code>[[:word:]]&lt;/code>&lt;/li>
&lt;li>&lt;code>[\w&amp;amp;&amp;amp;\p{ascii}]&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åœ¨æœç´¢é€Ÿåº¦æ–¹é¢ï¼ŒUnicodeé€šå¸¸èƒ½å¤Ÿå¾ˆå¥½åœ°å¤„ç†ï¼Œå³ä½¿åœ¨ä½¿ç”¨å¤§å‹Unicodeå­—ç¬¦ç±»æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç„¶è€Œï¼Œä¸€äº›æ›´å¿«çš„å†…éƒ¨æ­£åˆ™è¡¨è¾¾å¼å¼•æ“æ— æ³•å¤„ç†Unicodeæ„ŸçŸ¥çš„å•è¯è¾¹ç•Œæ–­è¨€ã€‚å› æ­¤ï¼Œå¦‚æœä½ ä¸éœ€è¦Unicodeæ„ŸçŸ¥çš„å•è¯è¾¹ç•Œæ–­è¨€ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨(?-u:\b)ä»£æ›¿\bï¼Œå…¶ä¸­å‰è€…ä½¿ç”¨ASCII-onlyçš„å•è¯å­—ç¬¦å®šä¹‰ã€‚&lt;/p>
&lt;h5 id="literals-might-accelerate-searches">Literals might accelerate searches
&lt;/h5>&lt;hr>
&lt;p>è¿™ä¸ªcrateåœ¨è¯†åˆ«æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­çš„å­—é¢é‡å¹¶ä½¿ç”¨å®ƒä»¬åŠ é€Ÿæœç´¢æ–¹é¢é€šå¸¸è¡¨ç°è‰¯å¥½ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œåœ¨ä½ çš„æ¨¡å¼ä¸­åŒ…å«æŸç§å­—é¢é‡å¯èƒ½ä¼šä½¿æœç´¢æ˜¾è‘—åŠ å¿«ã€‚ä¾‹å¦‚ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ \w+@\w+ ä¸­ï¼Œå¼•æ“ä¼šæŸ¥æ‰¾ @ çš„å‡ºç°ï¼Œç„¶åå°è¯•åå‘åŒ¹é… \w+ æ¥æ‰¾åˆ°èµ·å§‹ä½ç½®ã€‚&lt;/p>
&lt;h5 id="avoid-re-compiling-regexes-especially-in-a-loop">Avoid re-compiling regexes, especially in a loop
&lt;/h5>&lt;hr>
&lt;p>åœ¨å¾ªç¯ä¸­ç¼–è¯‘ç›¸åŒçš„æ¨¡å¼æ˜¯ä¸€ç§åæ¨¡å¼ï¼Œå› ä¸ºæ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘é€šå¸¸å¾ˆæ˜‚è´µã€‚ï¼ˆç¼–è¯‘æ—¶é—´å–å†³äºæ¨¡å¼çš„å¤§å°ï¼Œå¯èƒ½ä»å‡ å¾®ç§’åˆ°å‡ æ¯«ç§’ä¸ç­‰ã€‚ï¼‰ä¸ä»…ç¼–è¯‘æœ¬èº«æ˜‚è´µï¼Œè€Œä¸”è¿™è¿˜ä¼šé˜»æ­¢æ­£åˆ™è¡¨è¾¾å¼å¼•æ“å†…éƒ¨é‡ç”¨åˆ†é…çš„ä¼˜åŒ–ã€‚&lt;/p>
&lt;p>åœ¨ Rust ä¸­ï¼Œå¦‚æœæ­£åˆ™è¡¨è¾¾å¼åœ¨è¾…åŠ©å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œä¼ é€’å®ƒä»¬å¯èƒ½ä¼šæœ‰äº›éº»çƒ¦ã€‚ç›¸åï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ &lt;code>std::sync::LazyLock&lt;/code> æˆ– &lt;code>once_cell&lt;/code> crateï¼Œå¦‚æœä½ ä¸èƒ½ä½¿ç”¨æ ‡å‡†åº“ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ &lt;code>std::sync::LazyLock&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::sync::LazyLock;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">some_helper_function&lt;/span>(haystack: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">RE&lt;/span>: &lt;span style="color:#a6e22e">LazyLock&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Regex&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> LazyLock::new(&lt;span style="color:#f92672">||&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;...&amp;#34;&lt;/span>).unwrap());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">RE&lt;/span>.is_match(haystack)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert!&lt;/span>(some_helper_function(&lt;span style="color:#e6db74">&amp;#34;abc&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert!&lt;/span>(&lt;span style="color:#f92672">!&lt;/span>some_helper_function(&lt;span style="color:#e6db74">&amp;#34;ac&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…·ä½“æ¥è¯´ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è¿›è¡Œç¼–è¯‘ã€‚åœ¨åç»­ä½¿ç”¨ä¸­ï¼Œå®ƒä¼šé‡ç”¨ä¹‹å‰æ„å»ºçš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æ³¨æ„å¦‚ä½•å°†æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰ä¸ºç‰¹å®šå‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚&lt;/p>
&lt;h5 id="sharing-a-regex-across-threads-can-resule-in-contention">Sharing a regex across threads can resule in contention
&lt;/h5>&lt;hr>
&lt;p>è™½ç„¶å•ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åŒæ—¶ä»å¤šä¸ªçº¿ç¨‹è‡ªç”±ä½¿ç”¨ï¼Œä½†å¿…é¡»æ”¯ä»˜ä¸€å®šçš„åŒæ­¥æˆæœ¬ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œé™¤éæ¯ä¸ªçº¿ç¨‹çš„ä¸»è¦ä»»åŠ¡æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢ï¼Œå¹¶ä¸”å¤§å¤šæ•°æœç´¢éƒ½åœ¨è¾ƒçŸ­çš„å­—ç¬¦ä¸²ä¸­è¿›è¡Œï¼Œå¦åˆ™ä¸ä¼šè§‚å¯Ÿåˆ°è¿™ç§æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…±äº«èµ„æºçš„å†…éƒ¨ç«äº‰å¯èƒ½ä¼šæ¿€å¢ï¼Œå¢åŠ å»¶è¿Ÿï¼Œä»è€Œå¯èƒ½å‡æ…¢æ¯ä¸ªå•ç‹¬çš„æœç´¢ã€‚&lt;/p>
&lt;p>å¯ä»¥é€šè¿‡åœ¨å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¹‹å‰å…‹éš†æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å…‹éš†çš„æ­£åˆ™è¡¨è¾¾å¼ä»ç„¶ä¼šå…±äº«å…¶ç¼–è¯‘çŠ¶æ€çš„ç›¸åŒå†…éƒ¨åªè¯»éƒ¨åˆ†ï¼ˆå®ƒæ˜¯å¼•ç”¨è®¡æ•°çš„ï¼‰ï¼Œä½†æ¯ä¸ªçº¿ç¨‹å°†è·å¾—å¯¹è¿è¡Œæœç´¢æ—¶ä½¿ç”¨çš„å¯å˜ç©ºé—´çš„ä¼˜åŒ–è®¿é—®ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ ·åšä¸ä¼šå¢åŠ é¢å¤–çš„å†…å­˜æˆæœ¬ã€‚å”¯ä¸€çš„æˆæœ¬æ˜¯éœ€è¦æ˜¾å¼å…‹éš†æ­£åˆ™è¡¨è¾¾å¼æ‰€å¢åŠ çš„ä»£ç å¤æ‚æ€§ã€‚ï¼ˆå¦‚æœä½ åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«åŒä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯ä¸ªçº¿ç¨‹ä»ç„¶ä¼šè·å¾—è‡ªå·±çš„å¯å˜ç©ºé—´ï¼Œä½†è®¿é—®è¯¥ç©ºé—´ä¼šæ›´æ…¢ã€‚ï¼‰&lt;/p>
&lt;h4 id="unicode">Unicode
&lt;/h4>&lt;hr>
&lt;p>æœ¬èŠ‚è®¨è®ºäº†è¯¥æ­£åˆ™è¡¨è¾¾å¼åº“å¯¹Unicodeçš„æ”¯æŒæƒ…å†µã€‚åœ¨å±•ç¤ºä¸€äº›ç¤ºä¾‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ€»ç»“ä¸€ä¸‹ç›¸å…³è¦ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>è¿™ä¸ª crate å‡ ä¹å®Œå…¨å®ç°äº† Unicode æŠ€æœ¯æ ‡å‡† #18 ä¸­è§„å®šçš„â€œåŸºæœ¬ Unicode æ”¯æŒâ€ï¼ˆçº§åˆ« 1ï¼‰ã€‚æ”¯æŒçš„è¯¦ç»†ä¿¡æ¯åœ¨ regex crate ä»“åº“çš„æ ¹ç›®å½•ä¸‹çš„ UNICODE.md æ–‡ä»¶ä¸­æœ‰è¯¦ç»†è¯´æ˜ã€‚å‡ ä¹ä¸æ”¯æŒ Unicode æŠ€æœ¯æ ‡å‡† #18 ä¸­è§„å®šçš„â€œæ‰©å±• Unicode æ”¯æŒâ€ï¼ˆçº§åˆ« 2ï¼‰ã€‚&lt;/li>
&lt;li>é¡¶çº§æ­£åˆ™è¡¨è¾¾å¼åƒè¿­ä»£éå†haystackä¸­çš„æ¯ä¸ªä»£ç ç‚¹ä¸€æ ·è¿è¡Œæœç´¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒ¹é…çš„åŸºæœ¬åŸå­æ˜¯ä¸€ä¸ªå•ä¸€çš„ä»£ç ç‚¹ã€‚&lt;/li>
&lt;li>&lt;code>bytes::Regex&lt;/code> åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½å…è®¸ç¦ç”¨ Unicode æ¨¡å¼ï¼Œå¯¹æ•´ä¸ªæ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼è¿›è¡Œç¦ç”¨ã€‚å½“ Unicode æ¨¡å¼è¢«ç¦ç”¨æ—¶ï¼Œæœç´¢ä¼šåƒéå† haystack ä¸­çš„æ¯ä¸ªå­—èŠ‚ä¸€æ ·è¿›è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒ¹é…çš„åŸºæœ¬å•å…ƒæ˜¯ä¸€ä¸ªå­—èŠ‚ã€‚ï¼ˆé¡¶çº§ Regex ä¹Ÿå…è®¸ç¦ç”¨ Unicodeï¼Œä»è€Œåƒé€å­—èŠ‚åŒ¹é…ä¸€æ ·è¿›è¡ŒåŒ¹é…ï¼Œä½†ä»…åœ¨è¿™æ ·åšä¸ä¼šå…è®¸åŒ¹é…æ— æ•ˆçš„ UTF-8 æ—¶ã€‚ï¼‰&lt;/li>
&lt;li>å½“Unicodeæ¨¡å¼å¯ç”¨ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰æ—¶ï¼Œ&lt;code>.&lt;/code>å°†åŒ¹é…ä¸€ä¸ªå®Œæ•´çš„Unicodeæ ‡é‡å€¼ï¼Œå³ä½¿å®ƒä½¿ç”¨å¤šä¸ªå­—èŠ‚è¿›è¡Œç¼–ç ã€‚å½“Unicodeæ¨¡å¼ç¦ç”¨ï¼ˆä¾‹å¦‚ï¼Œ(?-u:.ï¼‰ï¼‰æ—¶ï¼Œ&lt;code>.&lt;/code>å°†å§‹ç»ˆåŒ¹é…ä¸€ä¸ªå­—èŠ‚ã€‚&lt;/li>
&lt;li>å­—ç¬¦ç±» &lt;code>\w&lt;/code>, &lt;code>\d&lt;/code> å’Œ &lt;code>\s&lt;/code> é»˜è®¤æ˜¯ Unicode æ„ŸçŸ¥çš„ã€‚ä½¿ç”¨&lt;code> (?-u:\w)&lt;/code>, &lt;code>(?-u:\d) &lt;/code>å’Œ &lt;code>(?-u:\s)&lt;/code> å¯ä»¥è·å–å®ƒä»¬çš„ ASCII ä»…å®šä¹‰ã€‚&lt;/li>
&lt;li>åŒæ ·ï¼Œ&lt;code>\b&lt;/code> å’Œ &lt;code>\B&lt;/code> ä½¿ç”¨ Unicode å®šä¹‰çš„â€œå•è¯â€å­—ç¬¦ã€‚è¦è·å–ä»…é™ ASCII çš„å•è¯è¾¹ç•Œï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>(?-u:\b)&lt;/code> å’Œ &lt;code>(?-u:\B)&lt;/code>ã€‚è¿™ä¹Ÿé€‚ç”¨äºç‰¹æ®Šçš„å•è¯è¾¹ç•Œæ–­è¨€ã€‚ï¼ˆå³ &lt;code>\b{start}&lt;/code>ï¼Œ&lt;code>\b{end}&lt;/code>ï¼Œ&lt;code>\b{start-half}&lt;/code>ï¼Œ&lt;code>\b{end-half}&lt;/code>ã€‚ï¼‰&lt;/li>
&lt;li>åœ¨å¤šè¡Œæ¨¡å¼ä¸‹ï¼Œ&lt;code>^ &lt;/code>å’Œ&lt;code> $&lt;/code> ä¸æ˜¯ Unicode æ„ŸçŸ¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬åªè¯†åˆ«&lt;code> \n&lt;/code>ï¼ˆå‡è®¾æœªå¯ç”¨ CRLF æ¨¡å¼ï¼‰ï¼Œè€Œä¸è¯†åˆ« Unicode å®šä¹‰çš„å…¶ä»–ä»»ä½•è¡Œç»ˆæ­¢ç¬¦ã€‚&lt;/li>
&lt;li>ä¸åŒºåˆ†å¤§å°å†™çš„æœç´¢æ˜¯Unicodeæ„ŸçŸ¥çš„ï¼Œå¹¶ä½¿ç”¨ç®€å•çš„å¤§å°å†™æŠ˜å ã€‚&lt;/li>
&lt;li>Unicodeé€šç”¨ç±»åˆ«ã€è„šæœ¬å’Œè®¸å¤šå¸ƒå°”å±æ€§å¯ä»¥é€šè¿‡é»˜è®¤çš„\p{å±æ€§åç§°}è¯­æ³•è®¿é—®ã€‚&lt;/li>
&lt;li>åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼ŒåŒ¹é…éƒ½æ˜¯ä½¿ç”¨å­—èŠ‚åç§»é‡æŠ¥å‘Šçš„ã€‚æ›´ç²¾ç¡®åœ°è¯´ï¼Œæ˜¯ä½¿ç”¨UTF-8ä»£ç å•å…ƒåç§»é‡ã€‚è¿™å…è®¸å¯¹haystackè¿›è¡Œå¸¸æ•°æ—¶é—´çš„ç´¢å¼•å’Œåˆ‡ç‰‡ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ¨¡å¼æœ¬èº«ä»…è¢«è§£é‡Šä¸ºUnicodeæ ‡é‡å€¼çš„åºåˆ—ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä½ çš„æ¨¡å¼ä¸­ç›´æ¥ä½¿ç”¨Unicodeå­—ç¬¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?i)Î”+&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;Î”Î´Î”&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>((&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">6&lt;/span>), (m.start(), m.end()));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// alternatively:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">6&lt;/span>, m.range());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚ä¸Šæ‰€è¿°ï¼ŒUnicodeé€šç”¨ç±»åˆ«ã€è„šæœ¬ã€è„šæœ¬æ‰©å±•ã€ç‰ˆæœ¬ä»¥åŠä¸€äº›å¸ƒå°”å±æ€§éƒ½å¯ä»¥ä½œä¸ºå­—ç¬¦ç±»ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åŒ¹é…ä¸€ä¸²æ•°å­—ã€å¸Œè…Šå­—æ¯æˆ– Cherokee å­—æ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;[\pN\p{Greek}\p{Cherokee}]+&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;abcÎ”á Î²â… á´Î³Î´â…¡xyz&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">23&lt;/span>, m.range());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="opt-out-of-unicode-support">Opt out of Unicode support
&lt;/h5>&lt;hr>
&lt;p>&lt;code>bytes::Regex&lt;/code>ç±»å‹å¯ä»¥æœç´¢&lt;code>&amp;amp;[u8]&lt;/code>haystackã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œhaystacks é€šå¸¸åƒä¸» &lt;code>Regex&lt;/code> ç±»å‹ä¸€æ ·è¢«å½“ä½œ UTF-8 å¤„ç†ã€‚ç„¶è€Œï¼Œå¯ä»¥é€šè¿‡å…³é—­&lt;code>u&lt;/code>æ ‡å¿—æ¥ç¦ç”¨æ­¤è¡Œä¸ºï¼Œå³ä½¿è¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´åŒ¹é…æ— æ•ˆçš„UTF-8ã€‚ä¾‹å¦‚ï¼Œå½“å…³é—­&lt;code>u&lt;/code>æ ‡å¿—æ—¶ï¼Œ&lt;code>.&lt;/code>å°†åŒ¹é…ä»»ä½•å­—èŠ‚è€Œä¸æ˜¯ä»»ä½•Unicodeæ ‡é‡å€¼ã€‚&lt;/p>
&lt;p>ç¦ç”¨ &lt;code>u&lt;/code> æ ‡å¿—ä¹Ÿå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ &lt;code>&amp;amp;str&lt;/code> åŸºäºçš„ Regex ç±»å‹ï¼Œä½†ä»…åœ¨ç»´æŠ¤ UTF-8 ä¸å˜æ€§çš„æƒ…å†µä¸‹å…è®¸ã€‚ä¾‹å¦‚ï¼Œ&lt;code>(?-u:\w)&lt;/code> æ˜¯ä¸€ä¸ªä»…åŒ…å« ASCII å­—ç¬¦çš„ \w å­—ç¬¦ç±»ï¼Œå¹¶ä¸”åœ¨ &lt;code>&amp;amp;str&lt;/code> åŸºäºçš„ Regex ä¸­æ˜¯åˆæ³•çš„ï¼Œä½† &lt;code>(?-u:\W)&lt;/code>å°†å°è¯•åŒ¹é…ä¸åœ¨&lt;code>(?-u:\w)&lt;/code>ä¸­çš„ä»»ä½•å­—èŠ‚ï¼Œè¿™åè¿‡æ¥åŒ…æ‹¬æ— æ•ˆçš„ UTF-8 å­—èŠ‚ã€‚åŒæ ·ï¼Œ&lt;code>(?-u:\xFF)&lt;/code>å°†å°è¯•åŒ¹é…åŸå§‹å­—èŠ‚ &lt;code>\xFF&lt;/code>ï¼ˆè€Œä¸æ˜¯ U+00FFï¼‰ï¼Œè¿™æ˜¯æ— æ•ˆçš„ UTF-8ï¼Œå› æ­¤åœ¨ &lt;code>&amp;amp;str&lt;/code> åŸºäºçš„æ­£åˆ™è¡¨è¾¾å¼ä¸­æ˜¯éæ³•çš„ã€‚&lt;/p>
&lt;p>æœ€åï¼Œç”±äºUnicodeæ”¯æŒéœ€è¦æ‰“åŒ…å¤§å‹Unicodeæ•°æ®è¡¨ï¼Œè¯¥crateæä¾›äº†æ§åˆ¶å°å¼€å…³æ¥ç¦ç”¨è¿™äº›æ•°æ®è¡¨çš„ç¼–è¯‘ï¼Œè¿™åœ¨ç¼©å°äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°å’Œå‡å°‘ç¼–è¯‘æ—¶é—´æ–¹é¢å¯èƒ½å¾ˆæœ‰ç”¨ã€‚æœ‰å…³å¦‚ä½•å®ç°è¿™ä¸€ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…crateåŠŸèƒ½éƒ¨åˆ†ã€‚&lt;/p>
&lt;h4 id="syntax">Syntax
&lt;/h4>&lt;hr>
&lt;p>æœ¬åº“æ”¯æŒçš„è¯­æ³•å¦‚ä¸‹ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼Œæ­£åˆ™è¡¨è¾¾å¼è§£æå™¨å’ŒæŠ½è±¡è¯­æ³•åœ¨å•ç‹¬çš„ crate &lt;code>regex-syntax&lt;/code> ä¸­æš´éœ²ã€‚&lt;/p>
&lt;h5 id="matching-one-character">Matching one character
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-tcl" data-lang="tcl">&lt;span style="display:flex;">&lt;span>. é™¤äº†æ¢è¡Œç¬¦&lt;span style="color:#960050;background-color:#1e0010">ï¼ˆ&lt;/span>åŒ…æ‹¬å¸¦æœ‰ s æ ‡å¿—çš„æ¢è¡Œç¬¦&lt;span style="color:#960050;background-color:#1e0010">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">[&lt;/span>0-9&lt;span style="color:#66d9ef">]&lt;/span> ä»»ä½• ASCII æ•°å­—
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>d æ•°å­— &lt;span style="color:#66d9ef">(&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p&lt;span style="color:#66d9ef">{&lt;/span>Nd&lt;span style="color:#66d9ef">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>D éæ•°å­—
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>pX ç”±ä¸€ä¸ªå­—æ¯åç§°æ ‡è¯†çš„Unicodeå­—ç¬¦ç±»
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p&lt;span style="color:#66d9ef">{&lt;/span>Greek&lt;span style="color:#66d9ef">}&lt;/span> Unicodeå­—ç¬¦ç±»&lt;span style="color:#960050;background-color:#1e0010">ï¼ˆ&lt;/span>é€šç”¨ç±»åˆ«æˆ–è„šæœ¬&lt;span style="color:#960050;background-color:#1e0010">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>PX ç”±ä¸€ä¸ªå­—æ¯åç§°æ ‡è¯†çš„å¦å®šUnicodeå­—ç¬¦ç±»
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>P&lt;span style="color:#66d9ef">{&lt;/span>Greek&lt;span style="color:#66d9ef">}&lt;/span> å¦å®šçš„Unicodeå­—ç¬¦ç±»&lt;span style="color:#960050;background-color:#1e0010">ï¼ˆ&lt;/span>é€šç”¨ç±»åˆ«æˆ–è„šæœ¬&lt;span style="color:#960050;background-color:#1e0010">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="character-classes">Character classes
&lt;/h5>&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>[xyz] A character class matching either x, y or z (&lt;span style="color:#66d9ef">union&lt;/span>).
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#f92672">^&lt;/span>xyz] A character class matching any character except x, y and z.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[a&lt;span style="color:#f92672">-&lt;/span>z] A character class matching any character &lt;span style="color:#66d9ef">in&lt;/span> range a&lt;span style="color:#f92672">-&lt;/span>z.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">alpha&lt;/span>:]] &lt;span style="color:#66d9ef">ASCII&lt;/span> character class ([A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#f92672">^&lt;/span>alpha:]] Negated &lt;span style="color:#66d9ef">ASCII&lt;/span> character class ([&lt;span style="color:#f92672">^&lt;/span>A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[x[&lt;span style="color:#f92672">^&lt;/span>xyz]] Nested&lt;span style="color:#f92672">/&lt;/span>grouping character class (matching any character except y and z)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[a&lt;span style="color:#f92672">-&lt;/span>y&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span>xyz] Intersection (matching x or y)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span>[&lt;span style="color:#f92672">^&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>]] Subtraction using intersection and negation (matching &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span> except &lt;span style="color:#ae81ff">4&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#f92672">--&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>] Direct subtraction (matching &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span> except &lt;span style="color:#ae81ff">4&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[a&lt;span style="color:#f92672">-&lt;/span>g&lt;span style="color:#f92672">~~&lt;/span>b&lt;span style="color:#f92672">-&lt;/span>h] Symmetric difference (matching &lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>a&lt;span style="color:#960050;background-color:#1e0010">`&lt;/span> and &lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>h&lt;span style="color:#960050;background-color:#1e0010">`&lt;/span> only)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>[&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>]] Escaping &lt;span style="color:#66d9ef">in&lt;/span> character classes (matching [ or ])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[a&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span>b] An empty character class matching nothing
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»»ä½•å‘½åå­—ç¬¦ç±»éƒ½å¯ä»¥å‡ºç°åœ¨æ–¹æ‹¬å·&lt;code> [... ]&lt;/code> å­—ç¬¦ç±»ä¸­ã€‚ä¾‹å¦‚ï¼Œ&lt;code>[\p{Greek}[:digit:]]&lt;/code> åŒ¹é…ä»»ä½• ASCII æ•°å­—æˆ–å¸Œè…Šå­—æ¯è¡¨ä¸­çš„ä»»ä½•ä»£ç ç‚¹ã€‚&lt;code>[\p{Greek}&amp;amp;&amp;amp;\pL]&lt;/code> åŒ¹é…å¸Œè…Šå­—æ¯ã€‚&lt;/p>
&lt;p>å­—ç¬¦ç±»ä¸­çš„ä¼˜å…ˆçº§ï¼Œä»æœ€ç»‘å®šåˆ°æœ€ä¸ç»‘å®šï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>èŒƒå›´ï¼š&lt;code>[a-cd]&lt;/code> == &lt;code>[[a-c]d]&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¹¶é›†ï¼š&lt;code>[ab&amp;amp;&amp;amp;bc]&lt;/code> == &lt;code>[[ab]&amp;amp;&amp;amp;[bc]]&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>äº¤é›†ã€å·®é›†ã€å¯¹ç§°å·®é›†ã€‚è¿™ä¸‰ç§è¿ç®—ç¬¦å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼Œå¹¶æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºè¿›è¡Œè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œ&lt;code>[\pL--\p{Greek}&amp;amp;&amp;amp;\p{Uppercase}]&lt;/code> == &lt;code>[[\pL--\p{Greek}]&amp;amp;&amp;amp;\p{Uppercase}]&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦å®šï¼š&lt;code>[^a-z&amp;amp;&amp;amp;b]&lt;/code> == &lt;code>[^[a-z&amp;amp;&amp;amp;b]]&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h5 id="composites">Composites
&lt;/h5>&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>xy concatenation (x followed by y)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">|&lt;/span>y alternation (x or y, prefer x)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> haystack &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;samwise&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// If &amp;#39;samwise&amp;#39; comes first in our alternation, then it is
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// preferred as a match, even if the regex engine could
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// technically detect that &amp;#39;sam&amp;#39; led to a match earlier.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;samwise|sam&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;samwise&amp;#34;&lt;/span>, re.find(haystack).unwrap().as_str());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// But if &amp;#39;sam&amp;#39; comes first, then it will match instead.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// In this case, it is impossible for &amp;#39;samwise&amp;#39; to match
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// because &amp;#39;sam&amp;#39; is a prefix of it.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;sam|samwise&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;sam&amp;#34;&lt;/span>, re.find(haystack).unwrap().as_str());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="repetitions">Repetitions
&lt;/h5>&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">*&lt;/span> zero or more of x (greedy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">+&lt;/span> one or more of x (greedy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">?&lt;/span> zero or one of x (greedy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">*?&lt;/span> zero or more of x (ungreedy&lt;span style="color:#f92672">/&lt;/span>lazy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">+?&lt;/span> one or more of x (ungreedy&lt;span style="color:#f92672">/&lt;/span>lazy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">??&lt;/span> zero or one of x (ungreedy&lt;span style="color:#f92672">/&lt;/span>lazy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n,m} at least n x and at most m x (greedy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n,} at least n x (greedy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n} exactly n x
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n,m}&lt;span style="color:#f92672">?&lt;/span> at least n x and at most m x (ungreedy&lt;span style="color:#f92672">/&lt;/span>lazy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n,}&lt;span style="color:#f92672">?&lt;/span> at least n x (ungreedy&lt;span style="color:#f92672">/&lt;/span>lazy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n}&lt;span style="color:#f92672">?&lt;/span> exactly n x
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="empty-matches">Empty Matches
&lt;/h5>&lt;hr>
&lt;p>ç©ºæ­£åˆ™è¡¨è¾¾å¼æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”åŒ¹é…ç©ºå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œç©ºæ­£åˆ™è¡¨è¾¾å¼åœ¨ä½ç½®0ã€1ã€2å’Œ3å¤„åŒ¹é…abcã€‚åœ¨ä½¿ç”¨é¡¶çº§&lt;code>Regex&lt;/code>å¯¹&lt;code>&amp;amp;str&lt;/code> haystacksè¿›è¡ŒåŒ¹é…æ—¶ï¼Œç©ºåŒ¹é…ä¼šåˆ†å‰²ä»£ç ç‚¹ï¼Œå› æ­¤æ°¸è¿œä¸ä¼šè¿”å›ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨&lt;code>bytes::Regex&lt;/code>æ—¶ï¼Œå…è®¸è¿™æ ·çš„åŒ¹é…ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> regex::Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> ranges: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> re.find_iter(&lt;span style="color:#e6db74">&amp;#34;ğŸ’©&amp;#34;&lt;/span>).map(&lt;span style="color:#f92672">|&lt;/span>m&lt;span style="color:#f92672">|&lt;/span> m.range()).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(ranges, &lt;span style="color:#a6e22e">vec!&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> regex::bytes::Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> ranges: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> re.find_iter(&lt;span style="color:#e6db74">&amp;#34;ğŸ’©&amp;#34;&lt;/span>.as_bytes()).map(&lt;span style="color:#f92672">|&lt;/span>m&lt;span style="color:#f92672">|&lt;/span> m.range()).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(ranges, &lt;span style="color:#a6e22e">vec!&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ï¼Œç©ºæ­£åˆ™è¡¨è¾¾å¼ä¸æ°¸è¿œæ— æ³•åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸åŒçš„ã€‚ä¾‹å¦‚ï¼Œæ­£åˆ™è¡¨è¾¾å¼ [a&amp;amp;&amp;amp;b] æ˜¯ä¸€ä¸ªå­—ç¬¦ç±»ï¼Œè¡¨ç¤º a å’Œ b çš„äº¤é›†ã€‚è¿™ä¸ªäº¤é›†æ˜¯ç©ºçš„ï¼Œè¿™æ„å‘³ç€å­—ç¬¦ç±»æ˜¯ç©ºçš„ã€‚ç”±äºç©ºé›†ä¸­æ²¡æœ‰ä¸œè¥¿ï¼Œ[a&amp;amp;&amp;amp;b] ä¸åŒ¹é…ä»»ä½•ä¸œè¥¿ï¼Œç”šè‡³ä¸åŒ¹é…ç©ºå­—ç¬¦ä¸²ã€‚&lt;/p>
&lt;h5 id="grouping-and-flags">Grouping and flags
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>(exp) &lt;span style="color:#960050;background-color:#1e0010">ç¼–å·æ•è·ç»„ï¼ˆæŒ‰æ‰“å¼€æ‹¬å·ç´¢å¼•ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&lt;/span>P&lt;span style="color:#f92672">&amp;lt;&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>exp) &lt;span style="color:#960050;background-color:#1e0010">å‘½åï¼ˆä¹Ÿå¯ç¼–å·ï¼‰æ•è·ç»„ï¼ˆåç§°å¿…é¡»ä¸ºå­—æ¯æ•°å­—ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&amp;lt;&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>exp) &lt;span style="color:#960050;background-color:#1e0010">å‘½åï¼ˆä¹Ÿå¯ç¼–å·ï¼‰æ•è·ç»„ï¼ˆåç§°å¿…é¡»ä¸ºå­—æ¯æ•°å­—ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&lt;/span>:&lt;span style="color:#a6e22e">exp&lt;/span>) &lt;span style="color:#960050;background-color:#1e0010">éæ•è·ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&lt;/span>flags) &lt;span style="color:#960050;background-color:#1e0010">åœ¨å½“å‰ç»„å†…è®¾ç½®æ ‡å¿—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&lt;/span>flags:&lt;span style="color:#a6e22e">exp&lt;/span>) &lt;span style="color:#960050;background-color:#1e0010">è®¾ç½®&lt;/span>expçš„æ ‡å¿—&lt;span style="color:#960050;background-color:#1e0010">ï¼ˆéæ•è·ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ•è·ç»„åç§°å¿…é¡»æ˜¯ä»»ä½•ç”±å­—æ¯ã€æ•°å­—å’Œ Unicode ä»£ç ç‚¹ç»„æˆçš„åºåˆ—ï¼Œæ­¤å¤–è¿˜å¯ä»¥åŒ…å« &lt;code>.&lt;/code>ã€&lt;code>_&lt;/code>ã€&lt;code>[&lt;/code> å’Œ&lt;code> ]&lt;/code>ã€‚åç§°å¿…é¡»ä»¥ &lt;code>_&lt;/code> æˆ–å­—æ¯ä»£ç ç‚¹å¼€å¤´ã€‚å­—æ¯ç ç‚¹å¯¹åº”äºå­—æ¯Unicodeå±æ€§ï¼Œè€Œæ•°å­—ç ç‚¹å¯¹åº”äºåè¿›åˆ¶æ•°å­—ã€å­—æ¯æ•°å­—å’Œå…¶ä»–æ•°å­—é€šç”¨ç±»åˆ«çš„å¹¶é›†ã€‚&lt;/p>
&lt;p>æ ‡å¿—æ˜¯å•ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ&lt;code>(?x)&lt;/code> è®¾ç½®æ ‡å¿— &lt;code>x&lt;/code>ï¼Œ&lt;code>(?-x)&lt;/code> æ¸…é™¤æ ‡å¿— &lt;code>x&lt;/code>ã€‚å¯ä»¥åŒæ—¶è®¾ç½®æˆ–æ¸…é™¤å¤šä¸ªæ ‡å¿—ï¼š&lt;code>(?xy)&lt;/code> åŒæ—¶è®¾ç½®æ ‡å¿— &lt;code>x&lt;/code> å’Œ &lt;code>y&lt;/code>ï¼Œ&lt;code>(?x-y)&lt;/code> è®¾ç½®æ ‡å¿— &lt;code>x&lt;/code> å¹¶æ¸…é™¤æ ‡å¿— &lt;code>y&lt;/code>ã€‚&lt;/p>
&lt;p>æ‰€æœ‰æ ‡å¿—é»˜è®¤æƒ…å†µä¸‹æ˜¯ç¦ç”¨çš„ï¼Œé™¤éå¦æœ‰è¯´æ˜ã€‚å®ƒä»¬æ˜¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>i &lt;span style="color:#960050;background-color:#1e0010">ä¸åŒºåˆ†å¤§å°å†™ï¼šå­—æ¯åŒ¹é…å¤§å°å†™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>m &lt;span style="color:#960050;background-color:#1e0010">å¤šè¡Œæ¨¡å¼ï¼š&lt;/span>&lt;span style="color:#f92672">^&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å’Œ&lt;/span> &lt;span style="color:#75715e">$&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">åŒ¹é…è¡Œçš„å¼€å§‹&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">ç»“æŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>s &lt;span style="color:#960050;background-color:#1e0010">å…è®¸&lt;/span> . &lt;span style="color:#960050;background-color:#1e0010">åŒ¹é…&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>n
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>R &lt;span style="color:#960050;background-color:#1e0010">å¯ç”¨&lt;/span>CRLFæ¨¡å¼&lt;span style="color:#960050;background-color:#1e0010">ï¼šå½“å¯ç”¨å¤šè¡Œæ¨¡å¼æ—¶ï¼Œä½¿ç”¨\&lt;/span>r&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>n
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>U &lt;span style="color:#960050;background-color:#1e0010">äº¤æ¢&lt;/span> x&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å’Œ&lt;/span> x&lt;span style="color:#f92672">*?&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">çš„å«ä¹‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>u Unicode &lt;span style="color:#960050;background-color:#1e0010">æ”¯æŒï¼ˆé»˜è®¤å¯ç”¨ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x &lt;span style="color:#960050;background-color:#1e0010">è¯¦ç»†æ¨¡å¼ï¼Œå¿½ç•¥ç©ºç™½å­—ç¬¦å¹¶å…è®¸è¡Œæ³¨é‡Šï¼ˆä»¥&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>#&lt;span style="color:#960050;background-color:#1e0010">`&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å¼€å§‹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¯¦ç»†æ¨¡å¼ä¸‹ï¼Œç©ºç™½å­—ç¬¦åœ¨ä»»ä½•åœ°æ–¹éƒ½ä¼šè¢«å¿½ç•¥ï¼ŒåŒ…æ‹¬åœ¨å­—ç¬¦ç±»ä¸­ã€‚è¦æ’å…¥ç©ºç™½å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨å…¶è½¬ä¹‰å½¢å¼æˆ–åå…­è¿›åˆ¶å­—é¢é‡ã€‚ä¾‹å¦‚ï¼Œ&lt;code>\ &lt;/code> æˆ– &lt;code>\x20&lt;/code> ç”¨äºè¡¨ç¤º ASCII ç©ºæ ¼ã€‚&lt;/p>
&lt;p>åœ¨æ¨¡å¼ä¸­å¯ä»¥åˆ‡æ¢æ ‡å¿—ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå‰åŠéƒ¨åˆ†ä¸åŒºåˆ†å¤§å°å†™ï¼ŒååŠéƒ¨åˆ†åŒºåˆ†å¤§å°å†™ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">&amp;#34;r(?i)a+(?-i)b+&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;AaAaAabbBBBb&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(m.as_str(), &lt;span style="color:#e6db74">&amp;#34;AaAaAabb&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ï¼Œ&lt;code>a+&lt;/code> åŒ¹é…&lt;code>a&lt;/code> æˆ–&lt;code>A&lt;/code>ï¼Œä½† &lt;code>b+&lt;/code> åªåŒ¹é… &lt;code>b&lt;/code>ã€‚&lt;/p>
&lt;p>å¤šè¡Œæ¨¡å¼æ„å‘³ç€ ^ å’Œ $ ä¸å†ä»…åŒ¹é…è¾“å…¥çš„å¼€å§‹/ç»“æŸä½ç½®ï¼Œè¿˜åŒ¹é…è¡Œçš„å¼€å§‹/ç»“æŸä½ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?m)^line \d+&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;line one&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">line 2&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(m.as_str(), &lt;span style="color:#e6db74">&amp;#34;line 2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ ^ åŒ¹é…åœ¨æ–°è¡Œä¹‹åï¼Œå³ä½¿åœ¨è¾“å…¥çš„æœ«å°¾ä¹Ÿæ˜¯å¦‚æ­¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?m)^&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find_iter(&lt;span style="color:#e6db74">&amp;#34;test&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>).last().unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>((m.start(), m.end()), (&lt;span style="color:#ae81ff">5&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“åŒæ—¶å¯ç”¨CRLFæ¨¡å¼å’Œå¤šè¡Œæ¨¡å¼æ—¶ï¼Œ&lt;code>^&lt;/code>å’Œ&lt;code>$&lt;/code>å°†åŒ¹é…&lt;code>\r&lt;/code>æˆ–&lt;code>\n&lt;/code>ï¼Œä½†æ°¸è¿œä¸ä¼šåœ¨&lt;code>\r\n&lt;/code>ä¸­é—´ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?mR)^foo$&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\r\n&lt;/span>&lt;span style="color:#e6db74">foo&lt;/span>&lt;span style="color:#ae81ff">\r\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(m.as_str(), &lt;span style="color:#e6db74">&amp;#34;foo&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Unicodeæ¨¡å¼ä¹Ÿå¯ä»¥é€‰æ‹©æ€§åœ°ç¦ç”¨ï¼Œå°½ç®¡åªæœ‰åœ¨ç»“æœä¸ä¼šåŒ¹é…æ— æ•ˆçš„UTF-8æ—¶æ‰è¿™æ ·åšã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ä½¿ç”¨ASCIIå•è¯è¾¹ç•Œè€Œä¸æ˜¯Unicodeå•è¯è¾¹ç•Œï¼Œè¿™å¯èƒ½ä¼šä½¿æŸäº›æ­£åˆ™è¡¨è¾¾å¼æœç´¢è¿è¡Œå¾—æ›´å¿«ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?-u:\b).+(?-u:\b)&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;$$abc$$&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(m.as_str(), &lt;span style="color:#e6db74">&amp;#34;abc&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="escape-sequences">Escape sequences
&lt;/h5>&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">*&lt;/span> literal &lt;span style="color:#f92672">*&lt;/span>, applies to all &lt;span style="color:#66d9ef">ASCII&lt;/span> except [&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>a bell (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x07)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>f form feed (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x0C)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>t horizontal tab
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>n new line
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>r carriage &lt;span style="color:#66d9ef">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>v vertical tab (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x0B)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>A matches at the beginning of a haystack
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>z matches at the end of a haystack
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>b word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>B negated word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>b{start}, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span> start&lt;span style="color:#f92672">-&lt;/span>of&lt;span style="color:#f92672">-&lt;/span>word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>b{end}, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> end&lt;span style="color:#f92672">-&lt;/span>of&lt;span style="color:#f92672">-&lt;/span>word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>b{start&lt;span style="color:#f92672">-&lt;/span>half} half of a start&lt;span style="color:#f92672">-&lt;/span>of&lt;span style="color:#f92672">-&lt;/span>word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>b{end&lt;span style="color:#f92672">-&lt;/span>half} half of a end&lt;span style="color:#f92672">-&lt;/span>of&lt;span style="color:#f92672">-&lt;/span>word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">123&lt;/span> octal character code, up to three digits (when enabled)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x7F hex character code (exactly two digits)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x{&lt;span style="color:#ae81ff">10&lt;/span>FFFF} any hex character code corresponding to a Unicode code point
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u007F hex character code (exactly four digits)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u{&lt;span style="color:#ae81ff">7&lt;/span>F} any hex character code corresponding to a Unicode code point
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#66d9ef">U0000007F&lt;/span> hex character code (exactly eight digits)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>U{&lt;span style="color:#ae81ff">7&lt;/span>F} any hex character code corresponding to a Unicode code point
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{Letter} Unicode character class
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>P{Letter} negated Unicode character class
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>d, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>s, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>w Perl character class
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>D, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>S, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>W negated Perl character class
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="perl-character-classes-unicode-friendly">Perl character classes (Unicode friendly)
&lt;/h5>&lt;hr>
&lt;p>è¿™äº›ç±»åŸºäºUTS#18ä¸­æä¾›çš„å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>d digit (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{Nd})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>D not digit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>s whitespace (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{White_Space})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>S not whitespace
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>w word character (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{Alphabetic} &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{M} &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>d &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{Pc} &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{Join_Control})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>W not word character
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ascii-character-classes">ASCII character classes
&lt;/h5>&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">alnum&lt;/span>:]] alphanumeric ([&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">alpha&lt;/span>:]] alphabetic ([A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">ascii&lt;/span>:]] &lt;span style="color:#66d9ef">ASCII&lt;/span> ([&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x00&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x7F])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">blank&lt;/span>:]] blank ([&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>t ])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">cntrl&lt;/span>:]] control ([&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x00&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x1F&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x7F])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">digit&lt;/span>:]] digits ([&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">graph&lt;/span>:]] graphical ([&lt;span style="color:#f92672">!-~&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">lower&lt;/span>:]] lower case ([a&lt;span style="color:#f92672">-&lt;/span>z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">print&lt;/span>:]] printable ([ &lt;span style="color:#f92672">-~&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">punct&lt;/span>:]] punctuation ([&lt;span style="color:#f92672">!-/&lt;/span>:&lt;span style="color:#f92672">-@&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>{&lt;span style="color:#f92672">-~&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">space&lt;/span>:]] whitespace ([&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>t&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>n&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>v&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>f&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>r ])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">upper&lt;/span>:]] upper case ([A&lt;span style="color:#f92672">-&lt;/span>Z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">word&lt;/span>:]] word characters ([&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z_])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">xdigit&lt;/span>:]] hex digit ([&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>A&lt;span style="color:#f92672">-&lt;/span>Fa&lt;span style="color:#f92672">-&lt;/span>f])
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>[åŸåœ°å€][https://docs.rs/regex/latest/regex/ ]&lt;/p>
&lt;hr>
&lt;h4 id="å•è¯">å•è¯
&lt;/h4>&lt;ul>
&lt;li>&lt;code>verbose&lt;/code>:
&lt;ul>
&lt;li>&lt;code>adj.&lt;/code> å†—é•¿çš„ï¼Œå•°å—¦çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>routine&lt;/code>:
&lt;ul>
&lt;li>&lt;code>n.&lt;/code> å¸¸è§„ï¼Œ æ— èŠ&lt;/li>
&lt;li>&lt;code>adj.&lt;/code> å¸¸è§„çš„ï¼Œæ— èŠçš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>subsequent&lt;/code>ï¼š
&lt;ul>
&lt;li>&lt;code>adj.&lt;/code>éšåçš„ï¼Œåæ¥çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>wildcard&lt;/code>:
&lt;ul>
&lt;li>&lt;code>n.&lt;/code>é€šé…ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>tweak&lt;/code>
&lt;ul>
&lt;li>&lt;code>adj.&lt;/code>ç¨å¾®è°ƒæ•´ï¼Œæ‹§ï¼Œæ‰¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>polymorphic&lt;/code>
&lt;ul>
&lt;li>&lt;code>adj.&lt;/code>å¤šæ€çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>insignificant&lt;/code>
&lt;ul>
&lt;li>&lt;code>adj.&lt;/code>å¾®ä¸è¶³é“çš„ï¼›æ— è¶³è½»é‡çš„ï¼›æ— æ„ä¹‰çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>comprehend&lt;/code>
&lt;ul>
&lt;li>&lt;code>vt.&lt;/code>ç†è§£ï¼Œé¢†æ‚Ÿï¼ŒåŒ…å«&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>simultaneously&lt;/code>
&lt;ul>
&lt;li>&lt;code>adv.&lt;/code>åŒæ—¶åœ°ï¼ŒåŒæ­¥åœ°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>overlap&lt;/code>
&lt;ul>
&lt;li>&lt;code>vt.&lt;/code>ä¸&amp;hellip;é‡å ï¼›æœ‰é‡å &lt;/li>
&lt;li>&lt;code>n.&lt;/code>é‡å éƒ¨åˆ†&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>concern&lt;/code>
&lt;ul>
&lt;li>&lt;code>n.&lt;/code>å…³å¿ƒï¼Œæ‹…å¿ƒ&lt;/li>
&lt;li>&lt;code>vt.&lt;/code>ä½¿æ‹…å¿ƒï¼Œæ¶‰åŠ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="contention">&lt;code>contention&lt;/code>
&lt;/h2>&lt;/li>
&lt;/ul></description></item><item><title>ç‰ˆæœ¬è¿­ä»£å¼å­¦ä¹ é¡¹ç›®æºç </title><link>https://www.dust-zed.site/tutorials/%E7%89%88%E6%9C%AC%E8%BF%AD%E4%BB%A3%E5%BC%8F%E5%AD%A6%E4%B9%A0%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81/</link><pubDate>Sun, 21 Sep 2025 13:21:34 +0800</pubDate><guid>https://www.dust-zed.site/tutorials/%E7%89%88%E6%9C%AC%E8%BF%AD%E4%BB%A3%E5%BC%8F%E5%AD%A6%E4%B9%A0%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81/</guid><description>&lt;h4 id="1-çœ‹é‡Œç¨‹ç¢‘ç‰ˆæœ¬">1. çœ‹é‡Œç¨‹ç¢‘ç‰ˆæœ¬
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å…ˆçœ‹æ ‡ç­¾å†å²ï¼Œæ‰¾é‡è¦ç‰ˆæœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git tag --sort&lt;span style="color:#f92672">=&lt;/span>-version:refname | head -20
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è¾“å‡ºå¯èƒ½æ˜¯è¿™æ ·ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 13.0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 12.1.0 &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 12.0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 11.0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 0.1.0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é‡ç‚¹çœ‹è¿™äº›ç‰ˆæœ¬ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout 0.1.0 &lt;span style="color:#75715e"># æœ€åˆç‰ˆæœ¬ - ç†è§£æ ¸å¿ƒæ€æƒ³&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout 0.5.0 &lt;span style="color:#75715e"># æ—©æœŸç¨³å®šç‰ˆ - åŸºæœ¬åŠŸèƒ½å®Œæ•´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout 1.0.0 &lt;span style="color:#75715e"># ç¬¬ä¸€ä¸ªå¤§ç‰ˆæœ¬ - è®¾è®¡æˆå‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout 5.0.0 &lt;span style="color:#75715e"># ä¸­æœŸç‰ˆæœ¬ - æ€§èƒ½ä¼˜åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout 13.0.0 &lt;span style="color:#75715e"># æœ€æ–°ç‰ˆæœ¬ - å¯¹æ¯”æ¼”è¿›&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="2-çœ‹å…³é”®æäº¤">2. çœ‹å…³é”®æäº¤
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æœç´¢é‡è¦çš„è®¾è®¡å†³ç­–æäº¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline --grep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;refactor&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline --grep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;performance&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline --grep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;rewrite&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline --author&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;BurntSushi&amp;#34;&lt;/span> --grep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;initial&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># çœ‹æ–‡ä»¶å˜åŒ–æœ€å¤§çš„æäº¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline --stat | grep -A5 -B1 &lt;span style="color:#e6db74">&amp;#34;files changed.*insertions.*deletions&amp;#34;&lt;/span> | head -20
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="3-æŒ‰åŠŸèƒ½æ¨¡å—å­¦ä¹ ">3. æŒ‰åŠŸèƒ½æ¨¡å—å­¦ä¹ 
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># çœ‹ç‰¹å®šæ–‡ä»¶çš„æ¼”è¿›å†å²&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline src/main.rs | tail -10 &lt;span style="color:#75715e"># main å‡½æ•°çš„æ¼”è¿›&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline src/search.rs | tail -5 &lt;span style="color:#75715e"># æœç´¢é€»è¾‘çš„æ¼”è¿› &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline Cargo.toml | tail -5 &lt;span style="color:#75715e"># ä¾èµ–çš„æ¼”è¿›&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># çœ‹æŸä¸ªåŠŸèƒ½çš„å¼•å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline --grep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;SIMD&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline --grep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;regex&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline --grep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;parallel&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ¨èçš„å­¦ä¹ è·¯å¾„">æ¨èçš„å­¦ä¹ è·¯å¾„
&lt;/h4>&lt;h5 id="ç¬¬ä¸€é˜¶æ®µç†è§£æ ¸å¿ƒè®¾è®¡">ç¬¬ä¸€é˜¶æ®µï¼šç†è§£æ ¸å¿ƒè®¾è®¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git checkout 0.1.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># çœ‹è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç ç»“æ„ï¼Œç†è§£æœ€åŸºæœ¬çš„å®ç°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä»£ç é‡å°ï¼Œå®¹æ˜“ç†è§£æ ¸å¿ƒæ€è·¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout 0.10.0 &lt;span style="color:#75715e"># è·³è·ƒå¼åœ°çœ‹å‡ ä¸ªæ—©æœŸç‰ˆæœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git checkout 1.0.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ç¬¬äºŒé˜¶æ®µå…³é”®æ¼”è¿›ç‚¹">ç¬¬äºŒé˜¶æ®µï¼šå…³é”®æ¼”è¿›ç‚¹
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æœç´¢é‡è¦çš„æäº¤ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline --grep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;rewrite&amp;#34;&lt;/span> | head -5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git log --oneline --grep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;performance&amp;#34;&lt;/span> | head -5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ‰‹åŠ¨é€‰æ‹©å‡ ä¸ªå…³é”®æäº¤çœ‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git show &amp;lt;é‡è¦æäº¤å“ˆå¸Œ&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ç¬¬ä¸‰é˜¶æ®µå¯¹æ¯”å­¦ä¹ ">ç¬¬ä¸‰é˜¶æ®µï¼šå¯¹æ¯”å­¦ä¹ 
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git checkout main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¯¹æ¯”æœ€æ–°ç‰ˆæœ¬å’Œæ—©æœŸç‰ˆæœ¬çš„å·®å¼‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git diff 0.1.0..main src/main.rs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Gitå‘½ä»¤ç§¯ç´¯</title><link>https://www.dust-zed.site/tutorials/git%E5%91%BD%E4%BB%A4%E7%A7%AF%E7%B4%AF/</link><pubDate>Sun, 21 Sep 2025 11:08:27 +0800</pubDate><guid>https://www.dust-zed.site/tutorials/git%E5%91%BD%E4%BB%A4%E7%A7%AF%E7%B4%AF/</guid><description>&lt;h5 id="git-log---oneline--tail--20">&lt;code>git log --oneline | tail -20&lt;/code>
&lt;/h5>&lt;ul>
&lt;li>&lt;code>git log&lt;/code>ç°å®æäº¤å†å²&lt;/li>
&lt;li>&lt;code>--oneline&lt;/code>å°†æ¯ä¸ªæäº¤å‹ç¼©ä¸ºä¸€è¡Œæ˜¾ç¤º&lt;/li>
&lt;li>&lt;code>|&lt;/code>ï¼Œç®¡é“ç¬¦ï¼Œ å°†å‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤è¾“å…¥&lt;/li>
&lt;li>&lt;code>tail -20&lt;/code>,æ˜¾ç¤ºè¾“å…¥æˆ–æ–‡ä»¶æœ«å°¾éƒ¨åˆ†ï¼Œ&lt;code>-20&lt;/code>å‚æ•°è¡¨ç¤ºæ˜¾ç¤ºæœ€åä¸€è¡Œ&lt;/li>
&lt;/ul></description></item><item><title>Tokioæ ¸å¿ƒæ¨¡å‹è§£æ</title><link>https://www.dust-zed.site/rust/tokio/tokio%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9E%8B%E8%A7%A3%E6%9E%90/</link><pubDate>Fri, 19 Sep 2025 13:50:29 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/tokio%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9E%8B%E8%A7%A3%E6%9E%90/</guid><description>&lt;h1 id="tokio-æ ¸å¿ƒæ¨¡å‹è§£æ">Tokio æ ¸å¿ƒæ¨¡å‹è§£æ
&lt;/h1>&lt;p>è®©æˆ‘ä»¬ä»é¡¶å±‚è®¾è®¡å¼€å§‹ï¼Œé€æ­¥æ·±å…¥ Tokio çš„å¼‚æ­¥è¿è¡Œæ—¶æ¨¡å‹ã€‚&lt;/p>
&lt;h2 id="1-æ ¸å¿ƒæŠ½è±¡æ¨¡å‹">1. æ ¸å¿ƒæŠ½è±¡æ¨¡å‹
&lt;/h2>&lt;pre tabindex="0">&lt;code>+-------------------------------------------------+
| Runtime (è¿è¡Œæ—¶) |
| +-------------------------------------------+ |
| | Reactor (ååº”å™¨) | |
| | - I/O å¤šè·¯å¤ç”¨ (epoll/kqueue/IOCP) | |
| | - å¤„ç† I/O äº‹ä»¶é€šçŸ¥ | |
| +-------------------------------------------+ |
| |
| +-------------------------------------------+ |
| | Scheduler (è°ƒåº¦å™¨) | |
| | - å¤šçº¿ç¨‹å·¥ä½œçªƒå–è°ƒåº¦ | |
| | - ä»»åŠ¡é˜Ÿåˆ—ç®¡ç† | |
| +-------------------------------------------+ |
| |
| +-------------------------------------------+ |
| | Timer (å®šæ—¶å™¨) | |
| | - ç®¡ç†å®šæ—¶ä»»åŠ¡ | |
| | - åŸºäºæ—¶é—´è½®çš„å®šæ—¶å™¨å®ç° | |
| +-------------------------------------------+ |
+-------------------------------------------------+
&lt;/code>&lt;/pre>&lt;h2 id="2-ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸæ¨¡å‹">2. ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸæ¨¡å‹
&lt;/h2>&lt;h3 id="21-ä»»åŠ¡çŠ¶æ€æœº">2.1 ä»»åŠ¡çŠ¶æ€æœº
&lt;/h3>&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">stateDiagram-v2
[*] --&amp;gt; Created: åˆ›å»º
Created --&amp;gt; Scheduled: è°ƒåº¦
Scheduled --&amp;gt; Running: æ‰§è¡Œ
Running --&amp;gt; Pending: ç­‰å¾…I/O
Pending --&amp;gt; Scheduled: I/Oå°±ç»ª
Running --&amp;gt; Complete: å®Œæˆ
Running --&amp;gt; Panicked: ææ…Œ
Running --&amp;gt; Cancelled: å–æ¶ˆ
Pending --&amp;gt; Cancelled: å–æ¶ˆ
Panicked --&amp;gt; [*]
Complete --&amp;gt; [*]
Cancelled --&amp;gt; [*]
&lt;/code>&lt;/pre>&lt;h3 id="22-çŠ¶æ€ä½è¡¨ç¤º">2.2 çŠ¶æ€ä½è¡¨ç¤º
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// çŠ¶æ€ä½åŸŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">RUNNING&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b0001&lt;/span>; &lt;span style="color:#75715e">// ä»»åŠ¡æ­£åœ¨æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">COMPLETE&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b0010&lt;/span>; &lt;span style="color:#75715e">// ä»»åŠ¡å·²å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">NOTIFIED&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b0100&lt;/span>; &lt;span style="color:#75715e">// ä»»åŠ¡å·²é€šçŸ¥è°ƒåº¦å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">JOIN_INTEREST&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b1000&lt;/span>; &lt;span style="color:#75715e">// æœ‰ä»»åŠ¡åœ¨ç­‰å¾…Join
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">JOIN_WAKER&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b1_0000&lt;/span>; &lt;span style="color:#75715e">// å·²è®¾ç½®Join Waker
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">CANCELLED&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b10_0000&lt;/span>; &lt;span style="color:#75715e">// ä»»åŠ¡å·²å–æ¶ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="3-æ ¸å¿ƒæ•°æ®ç»“æ„">3. æ ¸å¿ƒæ•°æ®ç»“æ„
&lt;/h2>&lt;h3 id="31-ä»»åŠ¡ç»“æ„-rawtask">3.1 ä»»åŠ¡ç»“æ„ (RawTask)
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">RawTask&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> header: &lt;span style="color:#a6e22e">Header&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡å¤´ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> scheduler: &lt;span style="color:#a6e22e">Scheduler&lt;/span>, &lt;span style="color:#75715e">// è°ƒåº¦å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> state: &lt;span style="color:#a6e22e">State&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> future: &lt;span style="color:#a6e22e">Future&lt;/span>, &lt;span style="color:#75715e">// è¦æ‰§è¡Œçš„Future
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> output: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Output&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// Futureçš„è¾“å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="32-è°ƒåº¦å™¨æ¨¡å‹">3.2 è°ƒåº¦å™¨æ¨¡å‹
&lt;/h3>&lt;pre tabindex="0">&lt;code>+----------------+ +----------------+ +----------------+
| Local Queue | &amp;lt;-&amp;gt; | Global Queue | &amp;lt;-&amp;gt; | Worker Threads |
+----------------+ +----------------+ +----------------+
^ ^ ^
| | |
v v v
+----------------+ +----------------+ +----------------+
| Task Producer | | Work Stealing | | Task Consumer |
| (spawn) | | (è´Ÿè½½å‡è¡¡) | | (poll) |
+----------------+ +----------------+ +----------------+
&lt;/code>&lt;/pre>&lt;h2 id="4-æ‰§è¡Œæµç¨‹">4. æ‰§è¡Œæµç¨‹
&lt;/h2>&lt;h3 id="41-ä»»åŠ¡åˆ›å»ºä¸è°ƒåº¦">4.1 ä»»åŠ¡åˆ›å»ºä¸è°ƒåº¦
&lt;/h3>&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">sequenceDiagram
participant A as ç”¨æˆ·ä»£ç 
participant B as Runtime
participant C as è°ƒåº¦å™¨
participant D as å·¥ä½œçº¿ç¨‹
A-&amp;gt;&amp;gt;B: spawn(future)
B-&amp;gt;&amp;gt;C: åˆ›å»ºä»»åŠ¡å¹¶åŠ å…¥é˜Ÿåˆ—
C-&amp;gt;&amp;gt;D: å·¥ä½œçº¿ç¨‹çªƒå–ä»»åŠ¡
D-&amp;gt;&amp;gt;D: æ‰§è¡Œfuture.poll()
alt Futureè¿”å›Pending
D-&amp;gt;&amp;gt;B: æ³¨å†ŒWaker
else Futureè¿”å›Ready
D-&amp;gt;&amp;gt;B: è®¾ç½®è¾“å‡ºç»“æœ
end
&lt;/code>&lt;/pre>&lt;h3 id="42-io-å°±ç»ªå¤„ç†">4.2 I/O å°±ç»ªå¤„ç†
&lt;/h3>&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">sequenceDiagram
participant A as Reactor
participant B as è°ƒåº¦å™¨
participant C as ä»»åŠ¡
A-&amp;gt;&amp;gt;B: I/O å°±ç»ªäº‹ä»¶
B-&amp;gt;&amp;gt;C: å”¤é†’å…³è”çš„Waker
C-&amp;gt;&amp;gt;B: å°†ä»»åŠ¡åŠ å…¥å°±ç»ªé˜Ÿåˆ—
B-&amp;gt;&amp;gt;C: è°ƒåº¦æ‰§è¡Œ
&lt;/code>&lt;/pre>&lt;h2 id="5-å…³é”®ä¼˜åŒ–æŠ€æœ¯">5. å…³é”®ä¼˜åŒ–æŠ€æœ¯
&lt;/h2>&lt;h3 id="51-æ— é”é˜Ÿåˆ—">5.1 æ— é”é˜Ÿåˆ—
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨crossbeamçš„æ— é”é˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">TaskQueue&lt;/span> &lt;span style="color:#f92672">=&lt;/span> crossbeam_deque::Worker&lt;span style="color:#f92672">&amp;lt;&lt;/span>Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>Task&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="52-å·¥ä½œçªƒå–">5.2 å·¥ä½œçªƒå–
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å·¥ä½œçº¿ç¨‹å°è¯•ä»å…¶ä»–é˜Ÿåˆ—çªƒå–ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">steal_work&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Task&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éšæœºé€‰æ‹©å—å®³è€…é˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> len &lt;span style="color:#f92672">=&lt;/span> self.workers.len();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> start &lt;span style="color:#f92672">=&lt;/span> self.rng.&lt;span style="color:#66d9ef">usize&lt;/span>(&lt;span style="color:#f92672">..&lt;/span>len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#66d9ef">in&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">..&lt;/span>len {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> idx &lt;span style="color:#f92672">=&lt;/span> (start &lt;span style="color:#f92672">+&lt;/span> i) &lt;span style="color:#f92672">%&lt;/span> len;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(task) &lt;span style="color:#f92672">=&lt;/span> self.workers[idx].steal() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(task);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="53-é›¶æˆæœ¬æŠ½è±¡">5.3 é›¶æˆæœ¬æŠ½è±¡
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨æ³›å‹å’Œç¼–è¯‘æœŸå¤šæ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">spawn&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>F, T&lt;span style="color:#f92672">&amp;gt;&lt;/span>(future: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">JoinHandle&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">where&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> F: &lt;span style="color:#a6e22e">Future&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Output &lt;span style="color:#f92672">=&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T: Send &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç¼–è¯‘æ—¶ç”Ÿæˆç‰¹å®šç±»å‹çš„ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="6-å†…å­˜æ¨¡å‹">6. å†…å­˜æ¨¡å‹
&lt;/h2>&lt;h3 id="61-ä»»åŠ¡åˆ†é…">6.1 ä»»åŠ¡åˆ†é…
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è‡ªå®šä¹‰å†…å­˜åˆ†é…å™¨ä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> layout &lt;span style="color:#f92672">=&lt;/span> Layout::new::&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .extend(Layout::new::&lt;span style="color:#f92672">&amp;lt;&lt;/span>Scheduler&lt;span style="color:#f92672">&amp;gt;&lt;/span>())&lt;span style="color:#f92672">?&lt;/span>.&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .extend(Layout::new::&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>())&lt;span style="color:#f92672">?&lt;/span>.&lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> ptr &lt;span style="color:#f92672">=&lt;/span> alloc(layout);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="62-å¼•ç”¨è®¡æ•°">6.2 å¼•ç”¨è®¡æ•°
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨åŸå­å¼•ç”¨è®¡æ•°ç®¡ç†ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Task&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> header: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Drop &lt;span style="color:#66d9ef">for&lt;/span> Task {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">drop&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> Arc::strong_count(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self.header) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœ€åä¸€ä¸ªå¼•ç”¨ï¼Œé‡Šæ”¾èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="7-è°ƒè¯•ä¸è¿½è¸ª">7. è°ƒè¯•ä¸è¿½è¸ª
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[cfg(tokio_unstable)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">TaskMeta&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&amp;#39;static &lt;span style="color:#66d9ef">str&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> location: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&amp;#39;static &lt;span style="color:#a6e22e">std&lt;/span>::panic::Location&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;static&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="8-ä½¿ç”¨æ¨¡å‹">8. ä½¿ç”¨æ¨¡å‹
&lt;/h2>&lt;h3 id="81-åŸºæœ¬ä½¿ç”¨">8.1 åŸºæœ¬ä½¿ç”¨
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[tokio::main]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> handle &lt;span style="color:#f92672">=&lt;/span> tokio::spawn(&lt;span style="color:#66d9ef">async&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¼‚æ­¥ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Hello, Tokio!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç­‰å¾…ä»»åŠ¡å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> result &lt;span style="color:#f92672">=&lt;/span> handle.&lt;span style="color:#66d9ef">await&lt;/span>.unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="82-ä»»åŠ¡é—´é€šä¿¡">8.2 ä»»åŠ¡é—´é€šä¿¡
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨é€šé“è¿›è¡Œä»»åŠ¡é—´é€šä¿¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> (tx, &lt;span style="color:#66d9ef">mut&lt;/span> rx) &lt;span style="color:#f92672">=&lt;/span> tokio::sync::mpsc::channel(&lt;span style="color:#ae81ff">32&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç”Ÿäº§è€…ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>tokio::spawn(&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">move&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tx.send(&lt;span style="color:#e6db74">&amp;#34;Hello&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">await&lt;/span>.unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¶ˆè´¹è€…ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>tokio::spawn(&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">move&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(message) &lt;span style="color:#f92672">=&lt;/span> rx.recv().&lt;span style="color:#66d9ef">await&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;received: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, message);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="9-æ€§èƒ½è€ƒé‡">9. æ€§èƒ½è€ƒé‡
&lt;/h2>&lt;ol>
&lt;li>&lt;strong>ä»»åŠ¡å¤§å°&lt;/strong>ï¼šä¿æŒä»»åŠ¡å°å·§é«˜æ•ˆ&lt;/li>
&lt;li>&lt;strong>é¿å…é˜»å¡&lt;/strong>ï¼šä¸è¦åœ¨å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œé˜»å¡æ“ä½œ&lt;/li>
&lt;li>&lt;strong>æ‰¹é‡å¤„ç†&lt;/strong>ï¼šåˆå¹¶å°çš„I/Oæ“ä½œä¸ºæ‰¹é‡æ“ä½œ&lt;/li>
&lt;li>&lt;strong>åˆç†ä½¿ç”¨spawn&lt;/strong>ï¼šé¿å…åˆ›å»ºè¿‡å¤šä»»åŠ¡&lt;/li>
&lt;/ol>
&lt;h2 id="10-è°ƒè¯•æŠ€å·§">10. è°ƒè¯•æŠ€å·§
&lt;/h2>&lt;ol>
&lt;li>å¯ç”¨ &lt;code>tokio_unstable&lt;/code> ç‰¹æ€§è·å–æ›´å¤šè°ƒè¯•ä¿¡æ¯&lt;/li>
&lt;li>ä½¿ç”¨ &lt;code>tracing&lt;/code> è¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ª&lt;/li>
&lt;li>ç›‘æ§è¿è¡Œæ—¶æŒ‡æ ‡ï¼ˆä»»åŠ¡æ•°ã€é˜Ÿåˆ—é•¿åº¦ç­‰ï¼‰&lt;/li>
&lt;/ol>
&lt;p>è¿™ä¸ªæ¨¡å‹å±•ç¤ºäº† Tokio å¦‚ä½•é«˜æ•ˆåœ°ç®¡ç†å¼‚æ­¥ä»»åŠ¡ã€‚ç†è§£è¿™äº›æ ¸å¿ƒæ¦‚å¿µåï¼Œæ‚¨å¯ä»¥æ›´æ·±å…¥åœ°ç ”ç©¶ç‰¹å®šç»„ä»¶çš„å®ç°ç»†èŠ‚ã€‚&lt;/p></description></item><item><title>Tokioä»»åŠ¡ç³»ç»Ÿè§£æ</title><link>https://www.dust-zed.site/rust/tokio/tokio%E4%BB%BB%E5%8A%A1%E7%B3%BB%E7%BB%9F%E8%A7%A3%E6%9E%90/</link><pubDate>Fri, 19 Sep 2025 12:38:14 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/tokio%E4%BB%BB%E5%8A%A1%E7%B3%BB%E7%BB%9F%E8%A7%A3%E6%9E%90/</guid><description>&lt;p>Tokioçš„ä»»åŠ¡ç³»ç»Ÿæ˜¯å…¶å¼‚æ­¥è¿è¡Œæ—¶çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£è°ƒåº¦å’Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚è®©æˆ‘ä»¬æ·±å…¥åˆ†æå…¶è®¾è®¡å’Œå®ç°ã€‚&lt;/p>
&lt;h3 id="1-æ ¸å¿ƒç»„ä»¶">1. æ ¸å¿ƒç»„ä»¶
&lt;/h3>&lt;h4 id="11-ä»»åŠ¡è¡¨ç¤º">1.1 ä»»åŠ¡è¡¨ç¤º
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Task&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>S: &amp;#39;static&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> raw: &lt;span style="color:#a6e22e">RawTask&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _p: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>S&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>RawTask&lt;/code>ï¼šå®é™…çš„ä»»åŠ¡æ•°æ®ï¼ŒåŒ…å«ä»»åŠ¡çŠ¶æ€ã€è°ƒåº¦å™¨ç­‰ã€‚&lt;/li>
&lt;li>&lt;code>PhantomData&amp;lt;S&amp;gt;&lt;/code>ï¼šå…³è”è°ƒåº¦å™¨ç±»å‹ï¼Œç”¨äºç±»å‹å®‰å…¨&lt;/li>
&lt;/ul>
&lt;h4 id="12-ä»»åŠ¡å¤´header">1.2 ä»»åŠ¡å¤´(Header)
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Header&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state: &lt;span style="color:#a6e22e">State&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> queue_next: &lt;span style="color:#a6e22e">UnsafeCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;..&lt;/span>.&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡é˜Ÿåˆ—æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> vtable: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&amp;#39;static &lt;span style="color:#a6e22e">Vtable&lt;/span>, &lt;span style="color:#75715e">// è™šå‡½æ•°è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> owner_id: &lt;span style="color:#a6e22e">UnsafeCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;..&lt;/span>.&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡æ‰€æœ‰è€…ID
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="2-ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ">2. ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ
&lt;/h4>&lt;h4 id="21-åˆ›å»ºä»»åŠ¡">2.1 åˆ›å»ºä»»åŠ¡
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">new_task&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, S&lt;span style="color:#f92672">&amp;gt;&lt;/span>(task: &lt;span style="color:#a6e22e">T&lt;/span>, scheduler: &lt;span style="color:#a6e22e">S&lt;/span>, id: &lt;span style="color:#a6e22e">Id&lt;/span>) -&amp;gt; (Task&lt;span style="color:#f92672">&amp;lt;&lt;/span>S&lt;span style="color:#f92672">&amp;gt;&lt;/span>, Notified&lt;span style="color:#f92672">&amp;lt;&lt;/span>S&lt;span style="color:#f92672">&amp;gt;&lt;/span>, JoinHandle&lt;span style="color:#f92672">&amp;lt;&lt;/span>T::Output&lt;span style="color:#f92672">&amp;gt;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">where&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T: &lt;span style="color:#a6e22e">Future&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> S: &lt;span style="color:#a6e22e">Schedule&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> raw &lt;span style="color:#f92672">=&lt;/span> RawTask::new::&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, S&lt;span style="color:#f92672">&amp;gt;&lt;/span>(task, scheduler, id, spawned_at);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºä¸‰ç§å¥æŸ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> task &lt;span style="color:#f92672">=&lt;/span> Task { raw, _p: &lt;span style="color:#a6e22e">PhantomData&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> notified &lt;span style="color:#f92672">=&lt;/span> Notified(Task { raw, _p: &lt;span style="color:#a6e22e">PhantomData&lt;/span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> join &lt;span style="color:#f92672">=&lt;/span> JoinHandle::new(raw);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (task, notified, join)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>RawTask&lt;/code>å®ç°äº†Copyï¼Œæ•…è¿™é‡Œå¯ä»¥è¿™æ ·åšï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦çŸ¥é“&lt;code>RawTask&lt;/code>çš„åˆå§‹å¼•ç”¨è®¡æ•°çŠ¶æ€ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">super&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">new&lt;/span>() -&amp;gt; &lt;span style="color:#a6e22e">State&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> val: &lt;span style="color:#a6e22e">AtomicUsize&lt;/span>::new(&lt;span style="color:#66d9ef">INTIAL_STATE&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆå§‹çŠ¶æ€è®¾ç½®ä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">INITIAL_STATE&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#66d9ef">REF_ONE&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>) &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#66d9ef">JOIN_INTEREST&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#66d9ef">NOTIFIED&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ„å‘³ç€ï¼š&lt;/p>
&lt;ol>
&lt;li>åˆå§‹å¼•ç”¨è®¡æ•°æ˜¯&lt;code>REF_ONE * 3&lt;/code>&lt;/li>
&lt;li>åŒæ—¶è®¾ç½®äº† &lt;code>JOIN_INTEREST&lt;/code> å’Œ &lt;code>NOTIFIED&lt;/code> æ ‡å¿—ä½&lt;/li>
&lt;/ol>
&lt;p>ä¸€ä¸ªä»»åŠ¡åˆ›å»ºä¼šè¿”å›ä¸‰ä¸ªå¥æŸ„ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>Task&lt;/code>ï¼šç”¨äºå–æ¶ˆæˆ–é‡Šæ”¾ä»»åŠ¡&lt;/li>
&lt;li>&lt;code>Notified&lt;/code>ï¼šè¡¨ç¤ºä»»åŠ¡å·²å‡†å¤‡å¥½æ‰§è¡Œ&lt;/li>
&lt;li>&lt;code>JoinHandle&lt;/code>ï¼šç”¨äºç­‰å¾…ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ&lt;/li>
&lt;/ol>
&lt;h3 id="3-æ ¸å¿ƒæœºåˆ¶">3. æ ¸å¿ƒæœºåˆ¶
&lt;/h3>&lt;h4 id="31-ä»»åŠ¡è°ƒåº¦">3.1 ä»»åŠ¡è°ƒåº¦
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åœ¨è°ƒåº¦å™¨ä¸­çš„æ‰§è¡Œå¾ªç¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> task &lt;span style="color:#f92672">=&lt;/span> self.next_task(); &lt;span style="color:#75715e">// è·å–ä¸‹ä¸€ä¸ªå°±ç»ªä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> task.run(); &lt;span style="color:#75715e">// æ‰§è¡Œä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="32-å”¤é†’æœºåˆ¶">3.2 å”¤é†’æœºåˆ¶
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Waker å®ç°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Waker&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> header: &lt;span style="color:#a6e22e">NonNull&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> std::task::Wake &lt;span style="color:#66d9ef">for&lt;/span> Waker {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">wake&lt;/span>(self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.wake_by_ref();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">wake_by_ref&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°†ä»»åŠ¡æ ‡è®°ä¸ºå°±ç»ªå¹¶é‡æ–°è°ƒåº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">unsafe&lt;/span> { (self.header.as_ref().vtable.schedule)(self.header) };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="4-å†…å­˜ç®¡ç†">4. å†…å­˜ç®¡ç†
&lt;/h3>&lt;h4 id="41-ä»»åŠ¡åˆ†é…">4.1 ä»»åŠ¡åˆ†é…
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T: &lt;span style="color:#a6e22e">Future&lt;/span>, S: &lt;span style="color:#a6e22e">Schedule&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> RawTask&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, S&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">new&lt;/span>(future: &lt;span style="color:#a6e22e">T&lt;/span>, scheduler: &lt;span style="color:#a6e22e">S&lt;/span>, id: &lt;span style="color:#a6e22e">Id&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">NonNull&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. è®¡ç®—å†…å­˜å¸ƒå±€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// 2. åˆ†é…å†…å­˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// 3. åˆå§‹åŒ– Header å’Œ Future
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// 4. è¿”å›æŒ‡å‘ Header çš„æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="42-å†…å­˜å¸ƒå±€">4.2 å†…å­˜å¸ƒå±€
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> Header &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// åŒ…å«ä»»åŠ¡å…ƒæ•°æ®å’Œè™šå‡½æ•°è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> Scheduler (S) &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// è°ƒåº¦å™¨å®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> Future (T) &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// å®é™…çš„ Future
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> Output Slot &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// å­˜å‚¨ Future çš„è¾“å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> Traces &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// è°ƒè¯•å’Œè·Ÿè¸ªä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="5-å¹¶å‘æ§åˆ¶">5. å¹¶å‘æ§åˆ¶
&lt;/h3>&lt;h4 id="51-çŠ¶æ€ç®¡ç†">5.1 çŠ¶æ€ç®¡ç†
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">State&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨åŸå­æ“ä½œç®¡ç†çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// - è¿è¡Œä¸­æ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// - å®Œæˆæ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// - å–æ¶ˆæ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// - å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> value: &lt;span style="color:#a6e22e">AtomicUsize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…·ä½“æ¥è¯´ï¼š&lt;/p>
&lt;ul>
&lt;li>é«˜ä½çš„æ¯”ç‰¹ä½ç”¨äºå¼•ç”¨è®¡æ•°(&lt;code>REF_COUNT_MASK&lt;/code>)&lt;/li>
&lt;li>ä½ä½çš„æ¯”ç‰¹ä½ç”¨äºä»»åŠ¡çŠ¶æ€(&lt;code>STATE_MASK&lt;/code>)&lt;/li>
&lt;/ul>
&lt;h4 id="52-é”ä¼˜åŒ–">5.2 é”ä¼˜åŒ–
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨æ— é”ç®—æ³•ä¼˜åŒ–çƒ­ç‚¹è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">transition_to_running&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">TransitionToRunning&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨åŸå­æ“ä½œæ›´æ–°çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// é¿å…ä½¿ç”¨äº’æ–¥é”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="7-è®¾è®¡æ¨¡å¼">7. è®¾è®¡æ¨¡å¼
&lt;/h3>&lt;h4 id="71-ç±»å‹æ“¦é™¤">7.1 ç±»å‹æ“¦é™¤
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨è™šå‡½æ•°è¡¨å®ç°ç±»å‹æ“¦é™¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Vtable&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> poll: &lt;span style="color:#a6e22e">unsafe&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span>(NonNull&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dealloc: &lt;span style="color:#a6e22e">unsafe&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span>(NonNull&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="72-é›¶æˆæœ¬æŠ½è±¡">7.2 é›¶æˆæœ¬æŠ½è±¡
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨æ³›å‹å’Œç¼–è¯‘æœŸå¤šæ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, S&lt;span style="color:#f92672">&amp;gt;&lt;/span> Task&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, S&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é›¶æˆæœ¬æŠ½è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>PhantomDataçš„ä½œç”¨</title><link>https://www.dust-zed.site/rust/phantomdata%E7%9A%84%E4%BD%9C%E7%94%A8/</link><pubDate>Fri, 19 Sep 2025 10:20:18 +0800</pubDate><guid>https://www.dust-zed.site/rust/phantomdata%E7%9A%84%E4%BD%9C%E7%94%A8/</guid><description>&lt;p>&lt;code>PhantomData&lt;/code>åœ¨Rustä¸­æ˜¯ä¸ºæ³›å‹æä¾›é€»è¾‘ä¸Šçš„è¡¥å……ï¼Œå®ƒå¸®åŠ©ç¼–è¯‘å™¨ç†è§£å’ŒéªŒè¯æ³›å‹å‚æ•°çš„ä½¿ç”¨æ–¹å¼ã€‚&lt;/p>
&lt;h4 id="æ ¸å¿ƒä½œç”¨">æ ¸å¿ƒä½œç”¨
&lt;/h4>&lt;p>&lt;code>PhantomData&lt;/code>æ˜¯ä¸€ä¸ªé›¶ç±»å‹å¤§å°ï¼ˆZSTï¼‰ï¼Œå®ƒä¸ä¼šåœ¨è¿è¡Œæ—¶å ç”¨ä»»ä½•å†…å­˜ï¼Œä½†åœ¨ç¼–è¯‘æœŸæä¾›é‡è¦ä¿¡æ¯ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç±»å‹æ ‡è®°&lt;/strong>ï¼šå‘Šè¯‰ç¼–è¯‘å™¨â€œè¿™ä¸ªç±»å‹é€»è¾‘ä¸Šæ‹¥æœ‰&lt;code>T&lt;/code>â€&lt;/li>
&lt;li>&lt;strong>ç”Ÿå‘½å‘¨æœŸè¿½è¸ª&lt;/strong>ï¼šå¸®ç»„ç¼–è¯‘å™¨éªŒè¯ç”Ÿå‘½å‘¨æœŸçš„æ­£ç¡®æ€§&lt;/li>
&lt;li>&lt;strong>å˜ä½“æ§åˆ¶&lt;/strong>:å½±å“æ³›å‹å‚æ•°çš„åå˜/é€†å˜è¡Œä¸º&lt;/li>
&lt;li>&lt;strong>Dropæ£€æŸ¥&lt;/strong>ï¼šå½±å“&lt;code>Drop&lt;/code>æ£€æŸ¥å™¨çš„è¡Œä¸º&lt;/li>
&lt;/ol>
&lt;p>åœ¨&lt;code>JoinHandle&amp;lt;T&amp;gt;&lt;/code>ä¸­çš„å…·ä½“ä½œç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">JoinHandle&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> raw: &lt;span style="color:#a6e22e">RawTask&lt;/span>, &lt;span style="color:#75715e">// åŸå§‹ä»»åŠ¡æŒ‡é’ˆï¼Œä¸ç›´æ¥åŒ…å« T
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> _p: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// é€»è¾‘ä¸Šè¡¨ç¤ºè¿™ä¸ªå¥æŸ„æ‹¥æœ‰ T çš„æ‰€æœ‰æƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œ&lt;code>PhantomData&amp;lt;T&amp;gt;&lt;/code>è¡¨ç¤ºï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>æ‰€æœ‰æƒæ ‡è®°&lt;/strong>: &lt;code>JoinHandle&amp;lt;T&amp;gt;&lt;/code>é€»è¾‘ä¸Šâ€œæ‹¥æœ‰â€ä¸€ä¸ª&lt;code>T&lt;/code>ç±»å‹çš„å€¼&lt;/li>
&lt;li>&lt;strong>ç±»å‹å…³è”&lt;/strong>: å°†&lt;code>RawTask&lt;/code>ä¸è¿”å›ç±»å‹&lt;code>T&lt;/code>å…³è”èµ·æ¥&lt;/li>
&lt;li>&lt;strong>Dropæ£€æŸ¥&lt;/strong>ï¼š ç¡®ä¿å½“&lt;code>JoinHandle&amp;lt;T&amp;gt;&lt;/code>è¢«dropæ—¶ï¼Œ&lt;code>T&lt;/code>çš„ææ„å‡½æ•°ä¼šè¢«æ­£ç¡®è°ƒç”¨&lt;/li>
&lt;/ol>
&lt;h4 id="å…¶ä»–å¸¸è§ä½¿ç”¨åœºæ™¯">å…¶ä»–å¸¸è§ä½¿ç”¨åœºæ™¯
&lt;/h4>&lt;h5 id="1-ä¸å®‰å…¨çš„ä»£ç ä¸­æ ‡è®°æ‰€æœ‰æƒ">1. ä¸å®‰å…¨çš„ä»£ç ä¸­æ ‡è®°æ‰€æœ‰æƒï¼š
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">MyPtr&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr: &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> &lt;span style="color:#66d9ef">u8&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _marker: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//é€»è¾‘ä¸Šæ‹¥æœ‰T
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-ç”Ÿå‘½å‘¨æœŸæ ‡è®°">2. ç”Ÿå‘½å‘¨æœŸæ ‡è®°
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Slice&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;a&lt;/span>, T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data: &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> T,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> len: &lt;span style="color:#66d9ef">usize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _marker: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;a&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// è¡¨ç¤ºåŒ…å«å¯¹ T çš„ç”Ÿå‘½å‘¨æœŸ &amp;#39;a çš„å¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-å˜ä½“æ§åˆ¶">3. å˜ä½“æ§åˆ¶
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Producer&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data: &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> (),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _marker: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">fn&lt;/span>() -&amp;gt; &lt;span style="color:#a6e22e">T&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// ä½¿ T åå˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-ç±»å‹å®‰å…¨æŠ½è±¡">4. ç±»å‹å®‰å…¨æŠ½è±¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Token&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _private: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// åˆ›å»ºç±»å‹çº§åˆ«çš„æ ‡è®°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ€»ç»“">æ€»ç»“
&lt;/h4>&lt;p>&lt;code>PhantomData&lt;/code>æ˜¯Rustç±»å‹ç³»ç»Ÿä¸­ä¸€ä¸ªå¼ºå¤§å·¥å…·ï¼Œå®ƒå…è®¸åœ¨ä¸å®é™…å­˜å‚¨å€¼çš„æƒ…å†µä¸‹ï¼Œè¡¨è¾¾ç±»å‹ä¹‹é—´çš„å…³ç³»å’Œçº¦æŸã€‚&lt;/p></description></item><item><title>å¯¹Callbackçš„ç†è§£</title><link>https://www.dust-zed.site/rust/%E5%AF%B9callback%E7%9A%84%E7%90%86%E8%A7%A3/</link><pubDate>Fri, 12 Sep 2025 03:02:50 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E5%AF%B9callback%E7%9A%84%E7%90%86%E8%A7%A3/</guid><description>&lt;p>ä¸ªäººç†è§£ï¼šå›è°ƒçš„æœ¬è´¨å°±æ˜¯å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œè€Œå‡½æ•° è¿‘ä¼¼ &lt;strong>æ“ä½œ&lt;/strong>ã€‚æ‰€ä»¥, æœ‰åˆ«äºæ™®é€šå‚æ•°ä¼ é€’çš„æ˜¯&lt;strong>æ•°æ®&lt;/strong>ï¼Œ&lt;code>Callback&lt;/code>ä¼ é€’çš„æ˜¯&lt;strong>æ“ä½œ&lt;/strong>æˆ–&lt;strong>é€»è¾‘&lt;/strong>&lt;/p>
&lt;h4 id="ä¼˜åŠ¿">ä¼˜åŠ¿
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>è§£è€¦&lt;/strong>: å®Œæˆé€»è¾‘çš„åˆ†ç¦»,è¦&lt;strong>åšä»€ä¹ˆ(è°ƒç”¨è€…)&lt;strong>ä¸&lt;/strong>ä½•æ—¶åšåˆ†ç¦»(è¢«è°ƒç”¨è€…)&lt;/strong>&lt;/li>
&lt;li>&lt;strong>å†…å­˜é«˜æ•ˆ&lt;/strong>ï¼šé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†æµå¼æ•°æ®æˆ–å¤§é‡æ•°æ®(ä¾‹å¦‚é¿å…æ”¾åˆ°é›†åˆåœ¨éå†)&lt;/li>
&lt;li>&lt;strong>çµæ´»æ€§&lt;/strong>ï¼šå…è®¸è°ƒç”¨è€…è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œæé«˜ä»£ç å¤ç”¨æ€§&lt;/li>
&lt;li>&lt;strong>å®æ—¶å¤„ç†&lt;/strong>ï¼šæ•°æ®å¯ä»¥ç«‹å³å¤„ç†ï¼Œé™ä½å»¶è¿Ÿ&lt;/li>
&lt;li>&lt;strong>èµ„æºæ§åˆ¶&lt;/strong>ï¼šå¯ä»¥è½»æ¾å®ç°æå‰ç»ˆæ­¢ã€é”™è¯¯å¤„ç†ç­‰æ§åˆ¶æµ&lt;/li>
&lt;li>&lt;strong>ç»„åˆæ€§&lt;/strong>ï¼šå¯ä»¥æ–¹ä¾¿åœ°ç»„åˆå¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå®ç°å¤æ‚çš„æ•°æ®å¤„ç†ç®¡é“&lt;/li>
&lt;li>&lt;strong>äº‹ä»¶é©±åŠ¨&lt;/strong>ï¼šå¤©ç„¶é€‚åˆäº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹æ¨¡å¼&lt;/li>
&lt;li>&lt;strong>æ¥å£ä¸€è‡´æ€§&lt;/strong>ï¼šæä¾›ç»Ÿä¸€çš„æ¥å£å¤„ç†ä¸åŒç±»å‹çš„æ“ä½œ&lt;/li>
&lt;/ol>
&lt;h4 id="æ§åˆ¶åè½¬">æ§åˆ¶åè½¬
&lt;/h4>&lt;ul>
&lt;li>æ™®é€šå‡½æ•°è°ƒç”¨ï¼šè°ƒç”¨è€…æ§åˆ¶æ‰§è¡Œæµç¨‹&lt;/li>
&lt;li>å›è°ƒï¼šè¢«è°ƒç”¨è€…å†³å®šä½•æ—¶æ‰§è¡Œæ“ä½œ&lt;/li>
&lt;li>æ§åˆ¶æƒä»è°ƒç”¨è€…è½¬ç§»åˆ°è¢«è°ƒç”¨è€…&lt;/li>
&lt;/ul></description></item><item><title>æ—¶é—´è½®ç®—æ³•</title><link>https://www.dust-zed.site/rust/tokio/%E6%97%B6%E9%97%B4%E8%BD%AE%E7%AE%97%E6%B3%95/</link><pubDate>Thu, 11 Sep 2025 21:51:21 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/%E6%97%B6%E9%97%B4%E8%BD%AE%E7%AE%97%E6%B3%95/</guid><description>&lt;p>æ—¶é—´è½®(Time Wheel)æ˜¯Tokioå®šæ—¶å™¨å®ç°çš„æ ¸å¿ƒç®—æ³•ï¼Œå®ƒé€šè¿‡åˆ†å±‚çš„æ–¹å¼é«˜æ•ˆç®¡ç†å¤§é‡å®šæ—¶å™¨ã€‚&lt;/p>
&lt;h3 id="1-åŸºæœ¬æ¦‚å¿µ">1. åŸºæœ¬æ¦‚å¿µ
&lt;/h3>&lt;h4 id="11-wheelç»“æ„ä¸å±‚çº§å…³ç³»">1.1 Wheelç»“æ„ä¸å±‚çº§å…³ç³»
&lt;/h4>&lt;h5 id="111-æ—¶é—´è½®ç»“æ„">1.1.1 æ—¶é—´è½®ç»“æ„
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Wheel&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">///å½“å‰æ—¶é—´è½®å·²è¿‡å»çš„æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> elapsed: &lt;span style="color:#66d9ef">u64&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">///æ—¶é—´è½®çš„åˆ†å±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> levels: Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>[Level; &lt;span style="color:#66d9ef">NUM_LEVELS&lt;/span>]&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">///Entries queued for firing
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> pending: &lt;span style="color:#a6e22e">EntryList&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="112-å±‚çº§">1.1.2 å±‚çº§
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Level&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> slot: [EntryList; &lt;span style="color:#66d9ef">LEVEL_MULT&lt;/span>], &lt;span style="color:#75715e">//æ§½ä½æ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> level: &lt;span style="color:#66d9ef">usize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> occupied: &lt;span style="color:#66d9ef">u64&lt;/span>, &lt;span style="color:#75715e">// bit fieldæŒ‡ç¤ºslotæ˜¯å¦å ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="113-æ§½ä½">1.1.3 æ§½ä½
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Slot&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> head: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>NonNull&lt;span style="color:#f92672">&amp;lt;&lt;/span>TimerShared&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="12-åˆ†å±‚è®¾è®¡">1.2 åˆ†å±‚è®¾è®¡
&lt;/h4>&lt;p>Tokioä½¿ç”¨å¤šçº§æ—¶é—´è½®ï¼ˆé€šå¸¸ä¸º6çº§ï¼‰ï¼Œæ¯çº§åŒ…å«å›ºå®šæ•°é‡çš„æ§½ä½ï¼Œæ¯çº§åŒ…å«å›ºå®šæ•°é‡çš„æ§½ä½(slots)ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¬¬0çº§ï¼š64ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^0æ¯«ç§’&lt;/li>
&lt;li>ç¬¬1çº§ï¼š64ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^1æ¯«ç§’&lt;/li>
&lt;li>ç¬¬2çº§ï¼š32ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^2æ¯«ç§’&lt;/li>
&lt;li>ç¬¬3çº§ï¼š32ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^3æ¯«ç§’&lt;/li>
&lt;li>ç¬¬4çº§ï¼š32ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^4æ¯«ç§’&lt;/li>
&lt;li>ç¬¬5çº§ï¼š32ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^5æ¯«ç§’&lt;/li>
&lt;/ul>
&lt;h4 id="æ—¶é—´è½®çš„å·¥ä½œæµç¨‹">æ—¶é—´è½®çš„å·¥ä½œæµç¨‹
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>æ·»åŠ ä¸€ä¸ª500msåè§¦å‘çš„å®šæ—¶å™¨&lt;/strong>ï¼š
&lt;ul>
&lt;li>ç¬¬0çº§ï¼š500 &amp;gt; 64ms â†’ ä¸é€‚ç”¨&lt;/li>
&lt;li>ç¬¬1çº§ï¼š500 / 64 = 7.8 â†’ æ”¾å…¥ç¬¬7ä¸ªæ§½ä½&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>æ—¶é—´æ¨è¿›&lt;/strong>ï¼š
&lt;ul>
&lt;li>æ¯æ¯«ç§’æ£€æŸ¥ç¬¬0çº§&lt;/li>
&lt;li>æ¯64msæ£€æŸ¥ç¬¬1çº§&lt;/li>
&lt;li>ä¾æ­¤ç±»æ¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é™çº§&lt;/strong>ï¼š
&lt;ul>
&lt;li>å½“é«˜å±‚çº§çš„æ—¶é—´è½®è½¬åŠ¨æ—¶ï¼Œå°†å®šæ—¶å™¨é‡æ–°åˆ†é…åˆ°æ›´ç²¾ç¡®çš„å±‚çº§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>è¿™ç§å¤šçº§è®¾è®¡ä½¿å¾—tokioèƒ½å¤Ÿï¼š&lt;/p>
&lt;ul>
&lt;li>ç²¾ç¡®å¤„ç†çŸ­æœŸå®šæ—¶å™¨(æ¯«ç§’çº§)&lt;/li>
&lt;li>é«˜æ•ˆç®¡ç†é•¿æœŸå®šæ—¶å™¨( å¹´)&lt;/li>
&lt;li>ä¿æŒè¾ƒä½çš„å†…å­˜å ç”¨å’Œè®¡ç®—å¼€é”€&lt;/li>
&lt;li>æ ¹æ®&lt;code>elapsed&lt;/code>ç¡®å®šéœ€è¦æ£€æŸ¥çš„æ—¶é—´è½®å±‚çº§å’Œæ§½ä½&lt;/li>
&lt;/ul>
&lt;p>æ—¶é—´è½®å’Œæ—¶è‹±é’Ÿï¼ˆæ—¶é’ˆã€åˆ†é’ˆã€ç§’é’ˆï¼‰å¯ä»¥è¿›è¡Œç±»æ¯”ç†è§£ã€‚&lt;/p></description></item><item><title>Timeçš„é˜…è¯»å­¦ä¹ è®°å½•</title><link>https://www.dust-zed.site/rust/tokio/time%E7%9A%84%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</link><pubDate>Thu, 11 Sep 2025 16:20:08 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/time%E7%9A%84%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</guid><description>&lt;h4 id="sourcers">source.rs
&lt;/h4>&lt;ul>
&lt;li>ç”¨äºç®¡ç†æ—¶é—´æˆ³è½¬æ¢&lt;/li>
&lt;li>&lt;code>start_time&lt;/code>è®°å½•è¿è¡Œæ—¶å¯åŠ¨çš„ç»å¯¹æ—¶é—´ç‚¹&lt;/li>
&lt;/ul>
&lt;h4 id="entryrs">entry.rs
&lt;/h4>&lt;h5 id="1-æ ¸å¿ƒæ•°æ®ç»“æ„">1. æ ¸å¿ƒæ•°æ®ç»“æ„
&lt;/h5>&lt;ul>
&lt;li>&lt;code>TimerEntry&lt;/code>ï¼šè¡¨ç¤ºä¸€ä¸ªå®šæ—¶å™¨æ¡ç›®&lt;/li>
&lt;li>&lt;code>TimerShared&lt;/code>ï¼šå®šæ—¶å™¨çš„å…±äº«çŠ¶æ€ï¼ŒåŒ…å«å¹¶å‘æ§åˆ¶é€»è¾‘&lt;/li>
&lt;li>&lt;code>StateCell&lt;/code>ï¼šç®¡ç†å®šæ—¶å™¨çŠ¶æ€çš„åŸå­æ“ä½œå°è£…&lt;/li>
&lt;/ul>
&lt;h5 id="2-ä¸»è¦åŠŸèƒ½">2. ä¸»è¦åŠŸèƒ½
&lt;/h5>&lt;h6 id="å®šæ—¶å™¨çŠ¶æ€ç®¡ç†">å®šæ—¶å™¨çŠ¶æ€ç®¡ç†
&lt;/h6>&lt;ul>
&lt;li>ä½¿ç”¨åŸå­æ“ä½œå®ç°æ— é”çŠ¶æ€è½¬æ¢&lt;/li>
&lt;li>æ”¯æŒå®šæ—¶å™¨çš„æ³¨å†Œã€å–æ¶ˆå’Œè§¦å‘&lt;/li>
&lt;li>&lt;code>StateCell&lt;/code>æœ‰ä¸‰ç§çŠ¶æ€
&lt;ul>
&lt;li>å…·ä½“çš„è¿‡æœŸæ—¶é—´æˆ³ï¼ˆå®šæ—¶å™¨å·²è°ƒåº¦ï¼Œå¾…è§¦å‘ï¼‰&lt;/li>
&lt;li>&lt;code>STATE_PENDING_FIRE&lt;/code>ï¼ˆå®šæ—¶å™¨å·²åˆ°æœŸï¼Œæ­£å‡†å¤‡è§¦å‘ï¼‰&lt;/li>
&lt;li>&lt;code>STATE_DEREGISTERED&lt;/code>(å·²å–æ¶ˆ/å®Œæˆ)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#960050;background-color:#1e0010">å·²è°ƒåº¦&lt;/span>] &lt;span style="color:#f92672">--&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ—¶é—´åˆ°&lt;/span> &lt;span style="color:#f92672">-&lt;/span>-&amp;gt; [&lt;span style="color:#960050;background-color:#1e0010">å¾…è§¦å‘&lt;/span>] &lt;span style="color:#f92672">--&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">è§¦å‘å®Œæˆ&lt;/span> &lt;span style="color:#f92672">-&lt;/span>-&amp;gt; [&lt;span style="color:#960050;background-color:#1e0010">å·²å–æ¶ˆ&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">^&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">+------------------&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å–æ¶ˆ&lt;/span> &lt;span style="color:#f92672">-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>TimerShared&lt;/code>è´Ÿè´£ç®¡ç†å®šæ—¶å™¨çš„å…±äº«çŠ¶æ€å’Œå¹¶å‘å®‰å…¨ï¼Œåˆ†ç¦»äº†å®šæ—¶å™¨çš„æ³¨å†Œæ—¶é—´ï¼Œç”¨äºæ—¶é—´è½®è°ƒåº¦&lt;/li>
&lt;li>&lt;code>TimerEntry&lt;/code>æ˜¯ç”¨æˆ·å¯è§çš„å¥æŸ„ï¼ŒåŒ…å«å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/li>
&lt;/ul>
&lt;h4 id="modrs">mod.rs
&lt;/h4>&lt;p>è´Ÿè´£ç®¡ç†æ‰€æœ‰ä¸æ—¶é—´ç›¸å…³çš„åŠŸèƒ½&lt;/p>
&lt;h5 id="æ ¸å¿ƒç»“æ„">æ ¸å¿ƒç»“æ„
&lt;/h5>&lt;ul>
&lt;li>Driverç»“æ„ä½“ï¼Œæ—¶é—´é©±åŠ¨çš„ä¸»è¦å®ç°ï¼Œè´Ÿè´£
&lt;ul>
&lt;li>ç®¡ç†æ—¶é—´è½®ï¼ˆtime wheelï¼‰å®ä¾‹&lt;/li>
&lt;li>å¤„ç†å®šæ—¶å™¨çš„æ³¨å†Œã€å–æ¶ˆå’Œè§¦å‘&lt;/li>
&lt;li>ä¸I/Oé©±åŠ¨ååŒå·¥ä½œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Inner&lt;/code>å’Œ&lt;code>InnerState&lt;/code>
&lt;ul>
&lt;li>åŒ…å«æ—¶é—´è½®å®ä¾‹&lt;/li>
&lt;li>ç®¡ç†é©±åŠ¨çŠ¶æ€ï¼ˆå¦‚æ˜¯å¦å·²å…³é—­ï¼‰&lt;/li>
&lt;li>æä¾›çº¿ç¨‹å®‰å…¨çš„å†…éƒ¨çŠ¶æ€è®¿é—®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="å…³é”®æ–¹æ³•">å…³é”®æ–¹æ³•
&lt;/h5>&lt;p>process_at_timeæ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>å¤„ç†å½“å‰æ—¶é—´ç‚¹æ‰€æœ‰åˆ°æœŸçš„å®šæ—¶å™¨&lt;/li>
&lt;li>å¤„ç†ç³»ç»Ÿæ—¶é—´å›é€€çš„æƒ…å†µ&lt;/li>
&lt;li>æ‰¹é‡å”¤é†’ç­‰å¾…çš„ä»»åŠ¡&lt;/li>
&lt;/ul>
&lt;p>reregisteræ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>é‡æ–°æ³¨å†Œå®šæ—¶å™¨åˆ°æ–°çš„æ—¶é—´ç‚¹&lt;/li>
&lt;li>çº¿ç¨‹å®‰å…¨çš„æ›´æ–°å®šæ—¶å™¨&lt;/li>
&lt;li>å¤„ç†é©±åŠ¨å…³é—­çš„æƒ…å†µ&lt;/li>
&lt;/ul></description></item><item><title>Park çº¿ç¨‹æŒ‚èµ·çš„å®ç°</title><link>https://www.dust-zed.site/rust/tokio/park-%E7%BA%BF%E7%A8%8B%E6%8C%82%E8%B5%B7%E7%9A%84%E5%AE%9E%E7%8E%B0/</link><pubDate>Wed, 10 Sep 2025 10:04:26 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/park-%E7%BA%BF%E7%A8%8B%E6%8C%82%E8%B5%B7%E7%9A%84%E5%AE%9E%E7%8E%B0/</guid><description>&lt;p>&lt;code>park.rs&lt;/code>æ˜¯Tokioè¿è¡Œæ—¶ä¸­ç”¨äºçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤çš„æ ¸å¿ƒã€‚&lt;/p>
&lt;h4 id="æ ¸å¿ƒç»“æ„">æ ¸å¿ƒç»“æ„
&lt;/h4>&lt;h5 id="parkthread-å’Œ-unparkthread">ParkThread å’Œ UnParkThread
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">ParkThread&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inner: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Inner&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">UnParkThread&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inner: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Inner&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹ä¸€çœ‹ï¼Œè¿™ä¸¤æ ¹æœ¬å°±æ˜¯ç›¸åŒçš„ç»“æ„ï¼Œä½†æ˜¯å®ƒä»¬æ˜¯ç”¨åœ¨ä¸åŒåœ°æ–¹çš„ï¼Œä»¥åŠimplå—æœ‰åŒºåˆ«ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">tokio_thread_local!&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">CURRENT_PARKER&lt;/span>: &lt;span style="color:#a6e22e">ParkThread&lt;/span> &lt;span style="color:#f92672">=&lt;/span> ParkThread::new();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯æœ€é‡è¦çš„åŒºåˆ«ï¼Œ&lt;code>ParkThread&lt;/code>ç”¨åœ¨äº†çº¿ç¨‹å±€éƒ¨å˜é‡ä¸Šï¼Œè€Œ&lt;code>UnParkThread&lt;/code>æ²¡æœ‰çº¿ç¨‹å±€éƒ¨é™åˆ¶ï¼Œå¦å¤–&lt;code>UnParkThread&lt;/code>åªå®ç°äº†&lt;code>unpark&lt;/code>æ–¹æ³•ï¼Œç›®çš„æ˜¯è®©å…¶ä»–çº¿ç¨‹åªèƒ½å”¤é†’ã€‚&lt;/p>
&lt;h5 id="inner">Inner
&lt;/h5>&lt;p>&lt;code>Inner&lt;/code>ç»“æ„ä½“ä½¿ç”¨åŸå­æ“ä½œç®¡ç†çº¿ç¨‹çŠ¶æ€ï¼Œè¿™ç§çŠ¶æ€ç®¡ç†æ˜¯æ„å»ºæ— é”å¹¶å‘åŸè¯­çš„åŸºç¡€ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">EMPTY&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#75715e">//åˆå§‹çŠ¶æ€æˆ–unparkçŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">PARKED&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; &lt;span style="color:#75715e">//çº¿ç¨‹å·²æŒ‚èµ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">NOTIFIED&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>; &lt;span style="color:#75715e">//çº¿ç¨‹å·²è¢«é€šçŸ¥å”¤é†’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Inner&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state: &lt;span style="color:#a6e22e">AtomicUsize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mutex: &lt;span style="color:#a6e22e">Mutex&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>()&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> condvar: &lt;span style="color:#a6e22e">Condvar&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¸ºä»€ä¹ˆç›´æ¥ç”¨&lt;code>Mutex&amp;lt;Usize&amp;gt;&lt;/code>è€Œæ˜¯å¤šç”¨äº†ä¸€ä¸ª&lt;code>AtomicUsize&lt;/code>
&lt;ul>
&lt;li>&lt;code>AtomicUsize&lt;/code>æ˜¯æ— é”çš„ï¼Œæ¯”è·å– &lt;code>Mutex&lt;/code>å¿«&lt;/li>
&lt;li>å†…å­˜é¡ºåºä¿è¯&lt;/li>
&lt;li>çŠ¶æ€æ›´æ–°ä½¿ç”¨åŸå­æ“ä½œï¼Œå‡å°‘é”çš„æŒæœ‰æ—¶é—´&lt;/li>
&lt;li>é”ç²’åº¦æ§åˆ¶ï¼Œ&lt;code>Mutex&lt;/code>åªä¿æŠ¤æ¡ä»¶å˜é‡çš„ç­‰å¾…/é€šçŸ¥æ—¶æœº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="å…·ä½“åŠŸèƒ½çš„å®ç°">å…·ä½“åŠŸèƒ½çš„å®ç°
&lt;/h4>&lt;h5 id="park">park()
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">park&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .state
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .compare_exchange(&lt;span style="color:#66d9ef">NOTIFIED&lt;/span>, &lt;span style="color:#66d9ef">EMPTY&lt;/span>, SeqCst, SeqCst)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .is_ok() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>; &lt;span style="color:#75715e">// â€œè™šå‡å”¤é†’â€ä¿æŠ¤ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹unparkï¼Œæ­¤çº¿ç¨‹åˆparkï¼Œé¿å…äº†æ²¡å¿…è¦çš„çº¿ç¨‹æŒ‚èµ·å’Œå”¤é†’æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è·å–é”,å¹¶ä¿®æ”¹çŠ¶æ€è‡³parked
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> m: &lt;span style="color:#a6e22e">std&lt;/span>::sync::MutexGuard&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_, ()&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> self.mutex.lock();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self.state.compare_exchange(&lt;span style="color:#66d9ef">EMPTY&lt;/span>, &lt;span style="color:#66d9ef">PARKED&lt;/span>, SeqCst, SeqCst) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(_) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(&lt;span style="color:#66d9ef">NOTIFIED&lt;/span>) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> old &lt;span style="color:#f92672">=&lt;/span> self.state.swap(&lt;span style="color:#66d9ef">EMPTY&lt;/span>, SeqCst);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">debug_assert_eq!&lt;/span>(old, &lt;span style="color:#66d9ef">NOTIFIED&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;park state changed unexpectedly&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(actual) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">panic!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;inconsistent park state; actual = &lt;/span>&lt;span style="color:#e6db74">{actual}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> m &lt;span style="color:#f92672">=&lt;/span> self.condvar.wait(m).unwrap(); &lt;span style="color:#75715e">//é‡Šæ”¾é”å¹¶æŒ‚èµ·çº¿ç¨‹ç­‰å¾…notify
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .state
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .compare_exchange(&lt;span style="color:#66d9ef">NOTIFIED&lt;/span>, &lt;span style="color:#66d9ef">EMPTY&lt;/span>, SeqCst, SeqCst)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .is_ok()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>; &lt;span style="color:#75715e">//ç¡®ä¿æœ‰æ•ˆå”¤é†’ï¼ŒNOTIFIED -&amp;gt; EMPTY,å¿½ç•¥é”™è¯¯å”¤é†’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="åŒé‡æ£€æŸ¥æ¨¡å¼">åŒé‡æ£€æŸ¥æ¨¡å¼
&lt;/h6>&lt;ul>
&lt;li>ç¬¬ä¸€æ¬¡æ£€æŸ¥é¿å…ä¸å¿…è¦çš„é”è·å–&lt;/li>
&lt;li>ç¬¬äºŒæ¬¡æ£€æŸ¥å¤„ç†ç«æ€æ¡ä»¶&lt;/li>
&lt;/ul>
&lt;h6 id="è™šå‡å”¤é†’å¤„ç†">è™šå‡å”¤é†’å¤„ç†
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> m &lt;span style="color:#f92672">=&lt;/span> self.condvar.wait(m).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self.state.compare_exchange(&lt;span style="color:#66d9ef">NOTIFIED&lt;/span>, &lt;span style="color:#66d9ef">EMPTY&lt;/span>, SeqCst, SeqCst).is_ok() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå¾ªç¯ç¡®ä¿åªæœ‰æ”¶åˆ°çœŸæ­£çš„é€šçŸ¥æ‰ä¼šè¿”å›ï¼Œå¤„ç†äº†æ¡ä»¶å˜é‡çš„è™šå‡å”¤é†’é—®é¢˜ã€‚&lt;/p>
&lt;h5 id="unpark">unpark
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">unpark&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//æ— è®ºä»€ä¹ˆçŠ¶æ€éƒ½ç½®ä¸ºNOTIFIED
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.state.swap(&lt;span style="color:#66d9ef">NOTIFIED&lt;/span>, SeqCst) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">EMPTY&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">NOTIFIED&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">PARKED&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _ &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">panic!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;inconsistent state in unpark&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//é€šè¿‡lockç¡®ä¿ç›®æ ‡çº¿ç¨‹å·²ç»æ˜¯PARKEDäº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> drop(self.mutex.lock());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.condvar.notify_one();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡æ§åˆ¶ParkThreadå’ŒUnParkThreadçš„æ–¹æ³•ï¼Œå®Œæˆäº†åŠŸèƒ½åˆ†ç¦»ï¼Œé…åˆä¹‹å‰çš„&lt;code>ThreadLocal&lt;/code>,å®Œæˆäº†çº¿ç¨‹è‡ªå·±æŒ‚èµ·ï¼Œç„¶åå…¶ä»–çº¿ç¨‹å¯ä»¥å”¤é†’æ­¤çº¿ç¨‹çš„åŠŸèƒ½ã€‚åŒæ—¶UnParkThreadä¹Ÿå¯ä»¥è½¬ä¸º&lt;code>Waker&lt;/code>ã€‚&lt;/p>
&lt;h5 id="shutdown">shutdown
&lt;/h5>&lt;p>é€šçŸ¥çº¿ç¨‹è¯¥é†’äº†ï¼Œå…·ä½“çš„shutdownæ“ä½œç”±è°ƒç”¨è€…å¤„ç†ã€‚&lt;/p>
&lt;h5 id="cachedparkthread">CachedParkThread
&lt;/h5>&lt;ol>
&lt;li>ç¼“å­˜&lt;code>Waker&lt;/code>é¿å…é‡å¤åˆ†é…&lt;/li>
&lt;li>æä¾›&lt;code>block_on&lt;/code>æ–¹æ³•ï¼Œè¿™æ˜¯è¿è¡Œæ—¶æ‰§è¡Œfutureçš„åŸºç¡€&lt;/li>
&lt;li>é€šè¿‡çº¿ç¨‹å±€éƒ¨å­˜å‚¨ç®¡ç†æ¯ä¸ªçº¿ç¨‹çš„parker&lt;/li>
&lt;li>&lt;code>_anchor: PhantomData&amp;lt;Rc&amp;lt;()&amp;gt;&amp;gt;&lt;/code>éšå«äº†&lt;code>!Send + !Sync&lt;/code>ï¼ŒCachedParkThread ä¸å¯è·¨çº¿ç¨‹ã€‚&lt;/li>
&lt;/ol></description></item><item><title>Vscodeé«˜æ•ˆå…‰æ ‡ç§»åŠ¨</title><link>https://www.dust-zed.site/tutorials/vscode%E9%AB%98%E6%95%88%E5%85%89%E6%A0%87%E7%A7%BB%E5%8A%A8/</link><pubDate>Mon, 08 Sep 2025 14:00:04 +0800</pubDate><guid>https://www.dust-zed.site/tutorials/vscode%E9%AB%98%E6%95%88%E5%85%89%E6%A0%87%E7%A7%BB%E5%8A%A8/</guid><description>&lt;h4 id="åŸºç¡€ç§»åŠ¨">åŸºç¡€ç§»åŠ¨
&lt;/h4>&lt;ul>
&lt;li>&lt;code>Option + â†/â†’&lt;/code> - æŒ‰å•è¯ç§»åŠ¨&lt;/li>
&lt;li>&lt;code>Cmd + â†/â†’&lt;/code> - è¡Œé¦–/è¡Œå°¾&lt;/li>
&lt;li>&lt;code>Cmd + â†‘/â†“&lt;/code> - æ–‡ä»¶å¼€å¤´/ç»“å°¾&lt;/li>
&lt;li>&lt;code>Cmd + G&lt;/code> - è·³è½¬åˆ°æŒ‡å®šè¡Œå·&lt;/li>
&lt;li>&lt;code>Cmd + P&lt;/code> - å¿«é€Ÿæ‰“å¼€æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;h4 id="é«˜çº§ç§»åŠ¨">é«˜çº§ç§»åŠ¨
&lt;/h4>&lt;ul>
&lt;li>&lt;code>Option + â†‘/â†“ &lt;/code> - ç§»åŠ¨å½“å‰è¡Œ&lt;/li>
&lt;/ul></description></item><item><title>Macç»ˆç«¯ç¾åŒ–é…ç½®</title><link>https://www.dust-zed.site/tutorials/mac%E7%BB%88%E7%AB%AF%E7%BE%8E%E5%8C%96%E9%85%8D%E7%BD%AE/</link><pubDate>Mon, 08 Sep 2025 12:19:22 +0800</pubDate><guid>https://www.dust-zed.site/tutorials/mac%E7%BB%88%E7%AB%AF%E7%BE%8E%E5%8C%96%E9%85%8D%E7%BD%AE/</guid><description>&lt;h1 id="macç»ˆç«¯ç¾åŒ–å®Œæ•´é…ç½®æŒ‡å—">Macç»ˆç«¯ç¾åŒ–å®Œæ•´é…ç½®æŒ‡å—
&lt;/h1>&lt;h2 id="æ­¥éª¤ä¸€å®‰è£…-iterm2">æ­¥éª¤ä¸€ï¼šå®‰è£… iTerm2
&lt;/h2>&lt;h3 id="11-ä¸‹è½½å¹¶å®‰è£…-iterm2">1.1 ä¸‹è½½å¹¶å®‰è£… iTerm2
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ–¹æ³•ä¸€ï¼šç›´æ¥ä¸‹è½½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è®¿é—® https://iterm2.com ä¸‹è½½æœ€æ–°ç‰ˆæœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ–¹æ³•äºŒï¼šä½¿ç”¨ Homebrewï¼ˆæ¨èï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å…ˆå®‰è£… Homebrewï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/bin/bash -c &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä½¿ç”¨ Homebrew å®‰è£… iTerm2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>brew install --cask iterm2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="12-å¯åŠ¨-iterm2">1.2 å¯åŠ¨ iTerm2
&lt;/h3>&lt;ul>
&lt;li>åœ¨åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ° iTerm2&lt;/li>
&lt;li>åŒå‡»å¯åŠ¨ï¼Œç¬¬ä¸€æ¬¡å¯èƒ½éœ€è¦æˆæƒ&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="æ­¥éª¤äºŒç¡®è®¤å¹¶åˆ‡æ¢åˆ°-zsh">æ­¥éª¤äºŒï¼šç¡®è®¤å¹¶åˆ‡æ¢åˆ° Zsh
&lt;/h2>&lt;h3 id="21-æ£€æŸ¥å½“å‰-shell">2.1 æ£€æŸ¥å½“å‰ Shell
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>echo $SHELL
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœæ˜¾ç¤º &lt;code>/bin/zsh&lt;/code>ï¼Œå¯ä»¥è·³è¿‡åˆ‡æ¢æ­¥éª¤&lt;/p>
&lt;h3 id="22-åˆ‡æ¢åˆ°-zshå¦‚æœéœ€è¦">2.2 åˆ‡æ¢åˆ° Zshï¼ˆå¦‚æœéœ€è¦ï¼‰
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŸ¥çœ‹ç³»ç»Ÿå¯ç”¨çš„ Shell&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cat /etc/shells
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆ‡æ¢é»˜è®¤ Shell ä¸º Zsh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chsh -s /bin/zsh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é‡å¯ç»ˆç«¯ä½¿è®¾ç½®ç”Ÿæ•ˆ&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 id="æ­¥éª¤ä¸‰å®‰è£…-oh-my-zsh">æ­¥éª¤ä¸‰ï¼šå®‰è£… Oh My Zsh
&lt;/h2>&lt;h3 id="31-å®‰è£…-oh-my-zsh">3.1 å®‰è£… Oh My Zsh
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sh -c &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="32-éªŒè¯å®‰è£…">3.2 éªŒè¯å®‰è£…
&lt;/h3>&lt;p>å®‰è£…å®Œæˆåï¼Œç»ˆç«¯ä¼šè‡ªåŠ¨é‡å¯ï¼Œä½ ä¼šçœ‹åˆ°å½©è‰²çš„æç¤ºç¬¦ï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚&lt;/p>
&lt;hr>
&lt;h2 id="æ­¥éª¤å››å®‰è£…-powerlevel10k-ä¸»é¢˜">æ­¥éª¤å››ï¼šå®‰è£… Powerlevel10k ä¸»é¢˜
&lt;/h2>&lt;h3 id="41-å®‰è£…ä¸»é¢˜">4.1 å®‰è£…ä¸»é¢˜
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git clone --depth&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> https://github.com/romkatv/powerlevel10k.git &lt;span style="color:#e6db74">${&lt;/span>ZSH_CUSTOM&lt;span style="color:#66d9ef">:-&lt;/span>$HOME/.oh-my-zsh/custom&lt;span style="color:#e6db74">}&lt;/span>/themes/powerlevel10k
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="42-ä¿®æ”¹é…ç½®æ–‡ä»¶">4.2 ä¿®æ”¹é…ç½®æ–‡ä»¶
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¼–è¾‘ zsh é…ç½®æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nano ~/.zshrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰¾åˆ° &lt;code>ZSH_THEME&lt;/code> è¡Œï¼Œä¿®æ”¹ä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ZSH_THEME&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;powerlevel10k/powerlevel10k&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="43-é‡æ–°åŠ è½½é…ç½®">4.3 é‡æ–°åŠ è½½é…ç½®
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>source ~/.zshrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="44-é…ç½®-powerlevel10k">4.4 é…ç½® Powerlevel10k
&lt;/h3>&lt;p>é‡æ–°åŠ è½½åä¼šè‡ªåŠ¨å¯åŠ¨é…ç½®å‘å¯¼ï¼ŒæŒ‰ç…§æç¤ºé€‰æ‹©ï¼š&lt;/p>
&lt;ol>
&lt;li>å­—ä½“å®‰è£…ï¼šé€‰æ‹© &amp;ldquo;Yes&amp;rdquo; å®‰è£… MesloLGS NF å­—ä½“&lt;/li>
&lt;li>æ ·å¼é€‰æ‹©ï¼šé€‰æ‹©ä½ å–œæ¬¢çš„æ ·å¼ï¼ˆæ¨è Rainbow æˆ– Leanï¼‰&lt;/li>
&lt;li>å›¾æ ‡æ˜¾ç¤ºï¼šé€‰æ‹©æ˜¯å¦æ˜¾ç¤ºå„ç§å›¾æ ‡&lt;/li>
&lt;li>å®Œæˆé…ç½®&lt;/li>
&lt;/ol>
&lt;p>å¦‚æœæ²¡æœ‰è‡ªåŠ¨å¯åŠ¨é…ç½®å‘å¯¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>p10k configure
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 id="æ­¥éª¤äº”å®‰è£…å¢å¼ºæ’ä»¶">æ­¥éª¤äº”ï¼šå®‰è£…å¢å¼ºæ’ä»¶
&lt;/h2>&lt;h3 id="51-å®‰è£…è‡ªåŠ¨å»ºè®®æ’ä»¶">5.1 å®‰è£…è‡ªåŠ¨å»ºè®®æ’ä»¶
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git clone git@github.com:zsh-users/zsh-autosuggestions.git &lt;span style="color:#e6db74">${&lt;/span>ZSH_CUSTOM&lt;span style="color:#66d9ef">:-&lt;/span>~/.oh-my-zsh/custom&lt;span style="color:#e6db74">}&lt;/span>/plugins/zsh-autosuggestions
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="52-å®‰è£…è¯­æ³•é«˜äº®æ’ä»¶">5.2 å®‰è£…è¯­æ³•é«˜äº®æ’ä»¶
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git clone git@github.com:zsh-users/zsh-syntax-highlighting.git &lt;span style="color:#e6db74">${&lt;/span>ZSH_CUSTOM&lt;span style="color:#66d9ef">:-&lt;/span>~/.oh-my-zsh/custom&lt;span style="color:#e6db74">}&lt;/span>/plugins/zsh-syntax-highlighting
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="53-ä¿®æ”¹æ’ä»¶é…ç½®">5.3 ä¿®æ”¹æ’ä»¶é…ç½®
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim ~/.zshrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰¾åˆ° &lt;code>plugins=&lt;/code> è¡Œï¼Œæ›¿æ¢ä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>plugins&lt;span style="color:#f92672">=(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> git &lt;span style="color:#75715e"># Gitå‘½ä»¤è¡¥å…¨å’Œåˆ«å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> zsh-autosuggestions &lt;span style="color:#75715e"># å‘½ä»¤å†å²å»ºè®®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> zsh-syntax-highlighting &lt;span style="color:#75715e"># å‘½ä»¤è¯­æ³•é«˜äº®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> web-search &lt;span style="color:#75715e"># å¿«é€Ÿæœç´¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> copypath &lt;span style="color:#75715e"># å¤åˆ¶å½“å‰è·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> copyfile &lt;span style="color:#75715e"># å¤åˆ¶æ–‡ä»¶å†…å®¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> colored-man-pages &lt;span style="color:#75715e"># å½©è‰²mané¡µé¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> extract &lt;span style="color:#75715e"># æ™ºèƒ½è§£å‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="54-é‡æ–°åŠ è½½é…ç½®">5.4 é‡æ–°åŠ è½½é…ç½®
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>source ~/.zshrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 id="æ­¥éª¤å…­iterm2-ä¼˜åŒ–è®¾ç½®">æ­¥éª¤å…­ï¼šiTerm2 ä¼˜åŒ–è®¾ç½®
&lt;/h2>&lt;h3 id="61-å­—ä½“è®¾ç½®">6.1 å­—ä½“è®¾ç½®
&lt;/h3>&lt;ol>
&lt;li>æ‰“å¼€ iTerm2 åå¥½è®¾ç½® (âŒ˜ + ,)&lt;/li>
&lt;li>é€‰æ‹© Profiles â†’ Text&lt;/li>
&lt;li>å­—ä½“æ”¹ä¸ºï¼šMesloLGS NF (å¦‚æœæŒ‰ç…§å‘å¯¼å®‰è£…äº†çš„è¯)&lt;/li>
&lt;li>å­—ä½“å¤§å°ï¼š14-16&lt;/li>
&lt;/ol>
&lt;h3 id="62-é¢œè‰²ä¸»é¢˜">6.2 é¢œè‰²ä¸»é¢˜
&lt;/h3>&lt;ol>
&lt;li>åœ¨ Profiles â†’ Colors&lt;/li>
&lt;li>Color Presets é€‰æ‹©ï¼š
&lt;ul>
&lt;li>Solarized Darkï¼ˆç»å…¸ï¼‰&lt;/li>
&lt;li>Draculaï¼ˆæŠ¤çœ¼ï¼‰&lt;/li>
&lt;li>æˆ–å¯¼å…¥å…¶ä»–ä¸»é¢˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="63-çª—å£è®¾ç½®">6.3 çª—å£è®¾ç½®
&lt;/h3>&lt;ol>
&lt;li>åœ¨ Profiles â†’ Window&lt;/li>
&lt;li>è°ƒæ•´é€æ˜åº¦ï¼ˆå¯é€‰ï¼‰&lt;/li>
&lt;li>è®¾ç½®çª—å£å¤§å°&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="æ­¥éª¤ä¸ƒå®‰è£…å®ç”¨å·¥å…·å¯é€‰">æ­¥éª¤ä¸ƒï¼šå®‰è£…å®ç”¨å·¥å…·ï¼ˆå¯é€‰ï¼‰
&lt;/h2>&lt;h3 id="71-å®‰è£…ç°ä»£åŒ–å‘½ä»¤å·¥å…·">7.1 å®‰è£…ç°ä»£åŒ–å‘½ä»¤å·¥å…·
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ›´å¥½çš„ ls&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>brew install exa
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ›´å¥½çš„ cat&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>brew install bat
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ›´å¥½çš„ find&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>brew install fd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ›´å¥½çš„ grep&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>brew install ripgrep
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="72-æ·»åŠ åˆ«å">7.2 æ·»åŠ åˆ«å
&lt;/h3>&lt;p>åœ¨ &lt;code>~/.zshrc&lt;/code> æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç°ä»£åŒ–å‘½ä»¤åˆ«å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias ls&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;exa --icons&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias ll&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;exa -l --icons&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias la&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;exa -la --icons&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias cat&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;bat&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias find&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;fd&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias grep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;rg&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å®ç”¨åˆ«å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias zshconfig&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;vim ~/.zshrc&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias ohmyzsh&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;vim ~/.oh-my-zsh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias reload&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;source ~/.zshrc&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 id="æ­¥éª¤å…«æœ€ç»ˆæµ‹è¯•">æ­¥éª¤å…«ï¼šæœ€ç»ˆæµ‹è¯•
&lt;/h2>&lt;h3 id="81-é‡æ–°åŠ è½½æ‰€æœ‰é…ç½®">8.1 é‡æ–°åŠ è½½æ‰€æœ‰é…ç½®
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>source ~/.zshrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="82-æµ‹è¯•åŠŸèƒ½">8.2 æµ‹è¯•åŠŸèƒ½
&lt;/h3>&lt;ol>
&lt;li>&lt;strong>è‡ªåŠ¨å»ºè®®&lt;/strong>ï¼šè¾“å…¥ &lt;code>git&lt;/code> ç„¶åçœ‹æ˜¯å¦æœ‰ç°è‰²å»ºè®®&lt;/li>
&lt;li>&lt;strong>è¯­æ³•é«˜äº®&lt;/strong>ï¼šè¾“å…¥æ­£ç¡®/é”™è¯¯çš„å‘½ä»¤çœ‹é¢œè‰²å˜åŒ–&lt;/li>
&lt;li>&lt;strong>Tabè¡¥å…¨&lt;/strong>ï¼šè¾“å…¥ &lt;code>ls ~/&lt;/code> æŒ‰Tabçœ‹è¡¥å…¨æ•ˆæœ&lt;/li>
&lt;li>&lt;strong>GitçŠ¶æ€&lt;/strong>ï¼šåœ¨Gitä»“åº“ä¸­æŸ¥çœ‹åˆ†æ”¯æ˜¾ç¤º&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="å¸¸è§é—®é¢˜è§£å†³">å¸¸è§é—®é¢˜è§£å†³
&lt;/h2>&lt;h3 id="å­—ä½“é—®é¢˜">å­—ä½“é—®é¢˜
&lt;/h3>&lt;p>å¦‚æœçœ‹åˆ°ä¹±ç æˆ–æ–¹å—ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é‡æ–°é…ç½® Powerlevel10k&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>p10k configure
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ’ä»¶ä¸å·¥ä½œ">æ’ä»¶ä¸å·¥ä½œ
&lt;/h3>&lt;p>æ£€æŸ¥æ’ä»¶æ˜¯å¦æ­£ç¡®å®‰è£…ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ls ~/.oh-my-zsh/custom/plugins/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é…ç½®é‡ç½®">é…ç½®é‡ç½®
&lt;/h3>&lt;p>å¦‚æœé…ç½®å‡ºé”™ï¼Œå¯ä»¥é‡æ–°é…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é‡æ–°é…ç½®ä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>p10k configure
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æˆ–è€…é‡æ–°å®‰è£… Oh My Zsh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sh -c &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>å†…å­˜æ’åº</title><link>https://www.dust-zed.site/rust/%E5%86%85%E5%AD%98%E6%8E%92%E5%BA%8F/</link><pubDate>Mon, 08 Sep 2025 11:16:22 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E5%86%85%E5%AD%98%E6%8E%92%E5%BA%8F/</guid><description>&lt;h4 id="1-ä¸ºä»€ä¹ˆéœ€è¦å†…å­˜æ’åº">1. ä¸ºä»€ä¹ˆéœ€è¦å†…å­˜æ’åº
&lt;/h4>&lt;p>åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¼šè¿›è¡Œå„ç§ä¼˜åŒ–(å¦‚æŒ‡ä»¤é‡æ’åº)æ¥æä¾›æ€§èƒ½ã€‚å†…å­˜æ’åºå®šä¹‰äº†è¿™äº›ä¼˜åŒ–åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„è¡Œä¸ºã€‚&lt;/p>
&lt;h4 id="rustä¸­çš„å†…å­˜æ’åºçº§åˆ«">Rustä¸­çš„å†…å­˜æ’åºçº§åˆ«
&lt;/h4>&lt;p>Rusté€šè¿‡&lt;code>std::sync::atomic::Ordering&lt;/code>æä¾›äº†å‡ ç§å†…å­˜æ’åºçº§åˆ«ï¼š&lt;/p>
&lt;h5 id="21-relaxed">2.1 Relaxed
&lt;/h5>&lt;ul>
&lt;li>æœ€å¼±çš„å†…å­˜æ’åº&lt;/li>
&lt;li>åªä¿è¯å½“å‰æ“ä½œçš„åŸå­æ€§&lt;/li>
&lt;li>ä¸ä¿è¯æ“ä½œä¹‹é—´çš„é¡ºåº&lt;/li>
&lt;li>é€‚ç”¨åœºæ™¯ï¼šç®€å•çš„è®¡æ•°å™¨ã€ç»Ÿè®¡ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::sync::atomic::{AtomicUsize, Ordering};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> counter &lt;span style="color:#f92672">=&lt;/span> AtomicUsize::new(&lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>counter.fetch_add(&lt;span style="color:#ae81ff">1&lt;/span>, Ordering::Relaxed);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="22-releaseå’Œacquire">2.2 Releaseå’ŒAcquire
&lt;/h5>&lt;ul>
&lt;li>&lt;code>Release&lt;/code>ï¼š
&lt;ul>
&lt;li>&lt;strong>å†™å±éšœ&lt;/strong>ï¼Œç¡®ä¿Releaseæ“ä½œä¹‹å‰çš„æ‰€æœ‰å†…å­˜æ“ä½œï¼ˆè¯»/å†™ï¼‰éƒ½å®Œæˆ&lt;/li>
&lt;li>&lt;strong>å¯è§æ€§ä¿è¯&lt;/strong>ï¼Œç¡®ä¿è¿™äº›ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹å¯è§&lt;/li>
&lt;li>å‘å¸ƒæ•°æ®åˆ°å…±äº«å†…å­˜ï¼Œæ ‡è®°æ•°æ®å‡†å¤‡å°±ç»ª&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Acquire&lt;/code>
&lt;ul>
&lt;li>&lt;strong>è¯»å±éšœ&lt;/strong>ï¼šç¡®ä¿åœ¨Acquireæ“ä½œä¹‹åçš„æ‰€æœ‰å†…å­˜æ“ä½œï¼ˆè¯»/å†™ï¼‰éƒ½èƒ½çœ‹åˆ°ä¹‹å‰Releaseæ“ä½œçš„æ‰€æœ‰ä¿®æ”¹&lt;/li>
&lt;li>&lt;strong>å¯è§æ€§ä¿è¯&lt;/strong>ï¼šç¡®ä¿çœ‹åˆ°å…¶ä»–çº¿ç¨‹Releaseæ“ä½œä¹‹å‰çš„æ‰€æœ‰ä¿®æ”¹&lt;/li>
&lt;li>ä»å…±äº«å†…å­˜è¯»å–æ•°æ®ï¼Œæ£€æŸ¥æ•°æ®æ˜¯å¦å°±ç»ª&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="23-acqrel">2.3 AcqRel
&lt;/h5>&lt;ul>
&lt;li>ç»„åˆè¯­ä¹‰ï¼ŒåŒæ—¶å…·æœ‰&lt;code>Release&lt;/code>å’Œ&lt;code>Acquire&lt;/code>çš„è¯­ä¹‰&lt;/li>
&lt;/ul>
&lt;h5 id="24-seqcst">2.4 Seqcst
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>æœ€å¼ºä¿è¯&lt;/strong>ï¼šé™¤äº†&lt;code>Acquire/Release&lt;/code>å¤–ï¼Œè¿˜ä¿è¯å…¨å±€ä¸€è‡´æ€§&lt;/li>
&lt;li>&lt;strong>é¢å¤–ä¿è¯&lt;/strong>ï¼š
&lt;ul>
&lt;li>æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ“ä½œé¡ºåºä¸€è‡´ï¼Œæ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ“ä½œé¡ºåºæ˜¯ä¸€è‡´çš„
&lt;ul>
&lt;li>è¦ä¹ˆçœ‹åˆ° (3) -&amp;gt; (1) -&amp;gt; (4) -&amp;gt; (2)&lt;/li>
&lt;li>è¦ä¹ˆçœ‹åˆ° (1) -&amp;gt; (3) -&amp;gt; (2) -&amp;gt; (4)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å»ºç«‹å…¨å±€æ“ä½œé¡ºåº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="å°ç»“">å°ç»“
&lt;/h4>&lt;p>&lt;code>Relaxed&lt;/code>æ˜¯åªé’ˆå¯¹åŸå­å˜é‡çš„ï¼Œå…¶ä»–å†…å­˜æ’åºæ˜¯é’ˆå¯¹å…±äº«å†…å­˜çš„ï¼Œå……å½“ç€å†…å­˜å±éšœçš„ä½œç”¨ã€‚&lt;/p></description></item><item><title>Runtimeçš„æ ¸å¿ƒæ¦‚å¿µ</title><link>https://www.dust-zed.site/rust/tokio/runtime%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/</link><pubDate>Sat, 06 Sep 2025 18:53:34 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/runtime%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/</guid><description>&lt;h4 id="1-runtimeåŸºæœ¬æ¶æ„">1. RuntimeåŸºæœ¬æ¶æ„
&lt;/h4>&lt;p>Tokioçš„runtimeæ˜¯å¼‚æ­¥åº”ç”¨çš„æ ¸å¿ƒï¼Œä¸»è¦è´Ÿè´£ï¼š&lt;/p>
&lt;ul>
&lt;li>ä»»åŠ¡è°ƒåº¦&lt;/li>
&lt;li>I/Oäº‹ä»¶å¾ªç¯&lt;/li>
&lt;li>å®šæ—¶å™¨ç®¡ç†&lt;/li>
&lt;li>çº¿ç¨‹æ± ç®¡ç†&lt;/li>
&lt;/ul>
&lt;p>è®©æˆ‘ä»¬çœ‹çœ‹runtimeçš„ä¸»è¦ç»„ä»¶ï¼š&lt;/p>
&lt;h5 id="11-runtimeç»“æ„ä½“">1.1 Runtimeç»“æ„ä½“
&lt;/h5>&lt;p>&lt;code>Runtime&lt;/code>ç»“æ„ä½“æ˜¯æ•´ä¸ªå¼‚æ­¥è¿è¡Œæ—¶çš„å…¥å£ç‚¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Runtime&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Task scheduler
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> scheduler: &lt;span style="color:#a6e22e">Scheduler&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// handles to runtime, also contains driver handles
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> handle: &lt;span style="color:#a6e22e">Handle&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Blocking pool handle, used to signal shutdown
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> blocking_pool: &lt;span style="color:#a6e22e">BlockingPool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="2-æ ¸å¿ƒç»„ä»¶">2. æ ¸å¿ƒç»„ä»¶
&lt;/h4>&lt;h5 id="21-scheduler">2.1 scheduler
&lt;/h5>&lt;p>&lt;strong>ä½œç”¨ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>è´Ÿè´£ä»»åŠ¡çš„è°ƒåº¦å’Œæ‰§è¡Œ&lt;/li>
&lt;li>ç®¡ç†ä»»åŠ¡é˜Ÿåˆ—å’Œä»»åŠ¡çŠ¶æ€&lt;/li>
&lt;li>å†³å®šä»»åŠ¡çš„æ‰§è¡Œé¡ºåº&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è®¾è®¡åŸå› &lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å°†è°ƒåº¦é€»è¾‘ä¸è¿è¡Œæ—¶å…¶ä»–éƒ¨åˆ†è§£è€¦&lt;/li>
&lt;li>æ”¯æŒä¸åŒçš„è°ƒåº¦ç­–ç•¥ï¼ˆå•çº¿ç¨‹/å¤šçº¿ç¨‹ï¼‰&lt;/li>
&lt;li>ä½¿è°ƒåº¦å™¨å¯ä»¥ç‹¬ç«‹æµ‹è¯•å’Œä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;h5 id="22-handle">2.2 handle
&lt;/h5>&lt;p>&lt;strong>ä½œç”¨ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æä¾›å¯¹è¿è¡Œæ—¶çš„è½»é‡çº§å¼•ç”¨&lt;/li>
&lt;li>å…è®¸åœ¨è¿è¡Œæ—¶å¤–éƒ¨åˆ†å‘ä»»åŠ¡&lt;/li>
&lt;li>åŒ…å«å¯¹I/Oé©±åŠ¨ã€å®šæ—¶å™¨ç­‰ç»„ä»¶çš„è®¿é—®&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è®¾è®¡åŸå› &lt;/strong>&lt;/p>
&lt;ul>
&lt;li>é¿å…ç›´æ¥æš´éœ²&lt;code>Runtime&lt;/code>çš„æ‰€æœ‰æƒ&lt;/li>
&lt;li>å…è®¸å¤šä¸ªåœ°æ–¹æŒæœ‰å¯¹è¿è¡Œæ—¶çš„å¼•ç”¨&lt;/li>
&lt;li>æ”¯æŒè·¨çº¿ç¨‹å‘é€ä»»åŠ¡&lt;/li>
&lt;li>ä¾¿äºåœ¨å¼‚æ­¥ä»£ç ä¸­è·å–å½“å‰è¿è¡Œæ—¶&lt;/li>
&lt;/ul>
&lt;h5 id="23-blockingpool">2.3 BlockingPool
&lt;/h5>&lt;p>&lt;strong>ä½œç”¨ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ç®¡ç†é˜»å¡æ“ä½œçš„å·¥ä½œçº¿ç¨‹æ± &lt;/li>
&lt;li>æ‰§è¡Œå¯èƒ½é˜»å¡çš„æ“ä½œï¼Œå¦‚æ–‡ä»¶I/Oæˆ–CPUå¯†é›†å‹è®¡ç®—&lt;/li>
&lt;li>é˜²æ­¢é˜»å¡æ“ä½œå½±å“å¼‚æ­¥ä»»åŠ¡è°ƒåº¦&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è®¾è®¡åŸå› &lt;/strong>&lt;/p>
&lt;ul>
&lt;li>éš”ç¦»é˜»å¡æ“ä½œï¼Œé¿å…å½±å“äº‹ä»¶å¾ªç¯&lt;/li>
&lt;li>æä¾›æ˜ç¡®çš„APIæ¥å¤„ç†é˜»å¡æ“ä½œ&lt;/li>
&lt;li>å…è®¸æ§åˆ¶é˜»å¡æ“ä½œçš„å¹¶å‘åº¦&lt;/li>
&lt;/ul>
&lt;h4 id="3-æ•´ä½“è®¾è®¡è€ƒé‡">3. æ•´ä½“è®¾è®¡è€ƒé‡
&lt;/h4>&lt;h5 id="1-å…³æ³¨ç‚¹åˆ†ç¦»">1. å…³æ³¨ç‚¹åˆ†ç¦»
&lt;/h5>&lt;ul>
&lt;li>&lt;code>scheduler&lt;/code>å¤„ç†ä»»åŠ¡è°ƒåº¦&lt;/li>
&lt;li>&lt;code>handle&lt;/code>æä¾›è¿è¡Œæ—¶è®¿é—®&lt;/li>
&lt;li>&lt;code>blocking_pool&lt;/code>å¤„ç†é˜»å¡æ“ä½œ&lt;/li>
&lt;/ul>
&lt;h5 id="2-æ‰€æœ‰æƒç®¡ç†">2. æ‰€æœ‰æƒç®¡ç†
&lt;/h5>&lt;ul>
&lt;li>&lt;code>Runtime&lt;/code>æ‹¥æœ‰æ‰€æœ‰èµ„æºçš„æ‰€æœ‰æƒ&lt;/li>
&lt;li>&lt;code>Handle&lt;/code>æä¾›äº†å…±äº«è®¿é—®çš„æ–¹å¼&lt;/li>
&lt;li>èµ„æºåœ¨&lt;code>Runtime&lt;/code>è¢«dropæ—¶æ­£ç¡®æ¸…ç†&lt;/li>
&lt;/ul>
&lt;h5 id="3-æ€§èƒ½ä¼˜åŒ–">3. æ€§èƒ½ä¼˜åŒ–
&lt;/h5>&lt;ul>
&lt;li>è½»é‡çº§çš„&lt;code>Handle&lt;/code>å¯ä»¥å¤§é‡å¤åˆ¶&lt;/li>
&lt;li>é˜»å¡æ“ä½œä¸ä¼šé˜»å¡äº‹ä»¶å¾ªç¯&lt;/li>
&lt;li>è°ƒåº¦å™¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©å•çº¿ç¨‹æˆ–å¤šçº¿ç¨‹å®ç°&lt;/li>
&lt;/ul>
&lt;h5 id="4-çµæ´»æ€§">4. çµæ´»æ€§
&lt;/h5>&lt;ul>
&lt;li>æ”¯æŒä¸åŒçš„è¿è¡Œæ—¶é…ç½®&lt;/li>
&lt;li>å¯ä»¥æ‰©å±•æ–°çš„è°ƒåº¦ç­–ç•¥&lt;/li>
&lt;li>ä¾¿äºæµ‹è¯•å’Œæ¨¡æ‹Ÿ&lt;/li>
&lt;/ul>
&lt;h4 id="handleä¸ºä»€ä¹ˆæ˜¯runtimeçš„è½»é‡çº§å¼•ç”¨">Handleä¸ºä»€ä¹ˆæ˜¯Runtimeçš„è½»é‡çº§å¼•ç”¨
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>&lt;code>Runtime&lt;/code>ä¸­çš„&lt;code>scheduler&lt;/code>å­—æ®µ&lt;/p>
&lt;ul>
&lt;li>è¿™æ˜¯ä¸»è¦çš„&lt;code>Scheduler&lt;/code>å®ä¾‹&lt;/li>
&lt;li>å®ƒæ‹¥æœ‰ä»»åŠ¡é˜Ÿåˆ—å’Œå…¶ä»–èµ„æº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Handle&lt;/code>ä¸­çš„å¼•ç”¨&lt;/p>
&lt;ul>
&lt;li>ä¸æ˜¯å¼•ç”¨&lt;code>Scheduler&lt;/code>æœ¬èº«&lt;/li>
&lt;li>è€Œæ˜¯å¼•ç”¨&lt;code>Scheduler&lt;/code>å†…éƒ¨çš„å…±äº«çŠ¶æ€&lt;/li>
&lt;li>è¿™äº›çŠ¶æ€é€šå¸¸æ˜¯é€šè¿‡&lt;code>Arc&lt;/code>åŒ…è£…çš„ç‹¬ç«‹ç»“æ„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å…·ä½“å®ç°&lt;/p>
&lt;ul>
&lt;li>&lt;code>CurrentThread&lt;/code>è°ƒåº¦å™¨å¯èƒ½ä½¿ç”¨&lt;code>Rc&amp;lt;RefCell&amp;lt;...&amp;gt;&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>MultiThread&lt;/code>è°ƒåº¦å™¨ä½¿ç”¨&lt;code>Arc&lt;/code>è¿›è¡Œçº¿ç¨‹é—´å…±äº«&lt;/li>
&lt;li>è¿™äº›å†…éƒ¨ç»“æ„åœ¨&lt;code>Scheduler&lt;/code>åˆå§‹åŒ–åˆ›å»º&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æ‰€æœ‰æƒå…³ç³»&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">CurrentThread&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å†…éƒ¨ä½¿ç”¨ Rc å…±äº«çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> shared: &lt;span style="color:#a6e22e">Rc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Shared&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Handle&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…±äº«ç›¸åŒçš„ Rc&amp;lt;Shared&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> shared: &lt;span style="color:#a6e22e">Rc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Shared&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºHandleæ—¶ï¼Œä¼šå…‹éš†&lt;code>Arc/Rc&lt;/code>å¢åŠ å¼•ç”¨è®¡æ•°&lt;/li>
&lt;li>è¿™æ ·çš„è®¾è®¡ä½“ç°äº†&lt;code>Scheduler&lt;/code>æ˜¯&lt;code>Runtime&lt;/code>çš„æ ¸å¿ƒ&lt;/li>
&lt;/ul>
&lt;h4 id="æ–‡ä»¶ioä¸ºä»€ä¹ˆä½¿ç”¨é˜»å¡çº¿ç¨‹æ± ">æ–‡ä»¶I/Oä¸ºä»€ä¹ˆä½¿ç”¨é˜»å¡çº¿ç¨‹æ± 
&lt;/h4>&lt;ul>
&lt;li>ç½‘ç»œI/Oï¼šç°ä»£æ“ä½œç³»ç»Ÿæä¾›äº†ä¸“é—¨çš„éé˜»å¡APIï¼ˆå¦‚Linuxçš„epollï¼ŒmacOSçš„kqueueï¼‰&lt;/li>
&lt;li>æ–‡ä»¶I/Oï¼šå¤§å¤šæ•°æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»ŸAPIåº•å±‚ä»ç„¶æ˜¯é˜»å¡çš„&lt;/li>
&lt;li>æ€§èƒ½è€ƒé‡ï¼šæ–‡ä»¶æ“ä½œé€šå¸¸æ¯”ç½‘ç»œæ“ä½œå¿«å¾—å¤šï¼›ä½¿ç”¨éé˜»å¡APIåè€Œå¢åŠ å¼€é”€ï¼›ç£ç›˜I/Oçš„å»¶è¿Ÿé€šå¸¸æ¯”ç½‘ç»œI/Oæ›´å¯é¢„æµ‹ã€‚&lt;/li>
&lt;/ul></description></item><item><title>Wakerå’ŒContextæœºåˆ¶</title><link>https://www.dust-zed.site/rust/tokio/waker%E5%92%8Ccontext%E6%9C%BA%E5%88%B6/</link><pubDate>Fri, 05 Sep 2025 18:51:54 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/waker%E5%92%8Ccontext%E6%9C%BA%E5%88%B6/</guid><description>&lt;h4 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Context&lt;/strong>ï¼šæä¾›å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæœ€é‡è¦çš„æ˜¯åŒ…å«Waker&lt;/li>
&lt;li>&lt;strong>Waker&lt;/strong>ï¼šç”¨äºå”¤é†’è¢«æŒ‚èµ·çš„å¼‚æ­¥ä»»åŠ¡çš„æœºåˆ¶&lt;/li>
&lt;li>&lt;strong>Poll&lt;/strong>ï¼šFutureçš„è½®è¯¢çŠ¶æ€, &lt;code>Ready&lt;/code>æˆ–&lt;code>Pending&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="contextçš„å®šä¹‰">Contextçš„å®šä¹‰
&lt;/h4>&lt;p>&lt;code>Context&lt;/code> æ˜¯Rustæ ‡å‡†åº“ä¸­&lt;code>std::task&lt;/code>æ¨¡å—æä¾›çš„ç»“æ„ä½“ï¼Œå®ƒä¸»è¦åŒ…å«ï¼š&lt;/p>
&lt;ol>
&lt;li>å¯¹&lt;code>Waker&lt;/code>çš„å¼•ç”¨&lt;/li>
&lt;li>å¯é€‰çš„ä»»åŠ¡æœ¬åœ°å­˜å‚¨&lt;/li>
&lt;/ol>
&lt;p>åœ¨Tokioä¸­ï¼Œ&lt;code>Context&lt;/code>ä¸»è¦ç”¨äºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Future &lt;span style="color:#66d9ef">for&lt;/span> MyFuture {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> ();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">poll&lt;/span>(self: &lt;span style="color:#a6e22e">Pin&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> Self&lt;span style="color:#f92672">&amp;gt;&lt;/span>, cx: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> Context&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">Poll&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Self::Output&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨ cx.waker() è·å– Waker
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// å½“ I/O æœªå°±ç»ªæ—¶ï¼Œä¿å­˜ Waker ä»¥ä¾¿åç»­å”¤é†’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="wakerçš„æ ¸å¿ƒå®ç°">Wakerçš„æ ¸å¿ƒå®ç°
&lt;/h4>&lt;p>åœ¨Tokioä¸­ï¼Œ&lt;code>Waker&lt;/code>æ˜¯å¼‚æ­¥ä»»åŠ¡é€šçŸ¥æœºåˆ¶çš„æ ¸å¿ƒã€‚å…ˆçœ‹çœ‹Tokioä¸­çš„å…³é”®å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">super&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">WakerRef&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;a&lt;/span>, S: &amp;#39;static&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> waker: &lt;span style="color:#a6e22e">ManuallyDrop&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Waker&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _p: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;a&lt;/span> Header, S)&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="wakerçš„åˆ›å»º">Wakerçš„åˆ›å»º
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">raw_waker&lt;/span>(header: &lt;span style="color:#a6e22e">NonNull&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">RawWaker&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> ptr &lt;span style="color:#f92672">=&lt;/span> header.as_ptr() &lt;span style="color:#66d9ef">as&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RawWaker::new(ptr, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">WAKER_VTABLE&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="wakerçš„vtable">Wakerçš„VTable
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">WAKER_VTABLE&lt;/span>: &lt;span style="color:#a6e22e">RawWakerVTable&lt;/span> &lt;span style="color:#f92672">=&lt;/span> RawWakerVTable::new(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> clone_waker, &lt;span style="color:#75715e">// å…‹éš† Waker
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> wake_by_val, &lt;span style="color:#75715e">// æ¶ˆè´¹ Waker å¹¶å”¤é†’ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> wake_by_ref, &lt;span style="color:#75715e">// ä¸æ¶ˆè´¹ Waker çš„æƒ…å†µä¸‹å”¤é†’ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> drop_waker, &lt;span style="color:#75715e">// é‡Šæ”¾ Waker èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="wakerçš„ç”Ÿå‘½å‘¨æœŸ">wakerçš„ç”Ÿå‘½å‘¨æœŸ
&lt;/h5>&lt;ol>
&lt;li>åˆ›å»ºï¼š å½“ä»»åŠ¡è¢«åˆ›å»ºæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Waker&lt;/li>
&lt;li>å”¤é†’ï¼šå½“I/Oäº‹ä»¶å°±ç»ªæˆ–å®šæ—¶å™¨è§¦å‘&lt;/li>
&lt;li>æ¶ˆè´¹ï¼šä»»åŠ¡è¢«å”¤é†’åï¼ŒWakerä¼šè¢«æ¶ˆè´¹æ‰&lt;/li>
&lt;li>é‡å»ºï¼šå¦‚æœéœ€è¦å†æ¬¡å”¤é†’ä»»åŠ¡ï¼Œéœ€è¦é‡æ–°åˆ›å»ºWaker&lt;/li>
&lt;/ol>
&lt;h4 id="å·¥ä½œæµç¨‹ç¤ºä¾‹">å·¥ä½œæµç¨‹ç¤ºä¾‹
&lt;/h4>&lt;p>ç®€æ˜“çš„ä»»åŠ¡å”¤é†’æµç¨‹ï¼š&lt;/p>
&lt;h5 id="1-ä»»åŠ¡åˆ›å»º">1. ä»»åŠ¡åˆ›å»º
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> task &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">async&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¼‚æ­¥ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tokio::spawn(task);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-wakeråˆ›å»º">2. Wakeråˆ›å»º
&lt;/h5>&lt;ul>
&lt;li>Tokioè¿è¡Œæ—¶ä¸ºä»»åŠ¡åˆ›å»ºWaker&lt;/li>
&lt;li>WakeråŒ…å«æŒ‡å‘ä»»åŠ¡çŠ¶æ€çš„æŒ‡é’ˆ&lt;/li>
&lt;/ul>
&lt;h5 id="3-ioæ³¨å†Œ">3. I/Oæ³¨å†Œ
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å½“è°ƒç”¨ç±»ä¼¼ TcpStream::read æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> ready &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">ready!&lt;/span>(self.io.poll_read_ready(cx)&lt;span style="color:#f92672">?&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-ä»»åŠ¡æŒ‚èµ·">4. ä»»åŠ¡æŒ‚èµ·
&lt;/h5>&lt;ul>
&lt;li>å¦‚æœI/Oæœªå°±ç»ªï¼Œä¿å­˜Waker&lt;/li>
&lt;li>è¿”å›&lt;code>Poll::Pending&lt;/code>&lt;/li>
&lt;/ul>
&lt;h5 id="5-äº‹ä»¶å°±ç»ª">5. äº‹ä»¶å°±ç»ª
&lt;/h5>&lt;ul>
&lt;li>I/Oäº‹ä»¶å°±ç»ªï¼Œä¿å­˜Waker&lt;/li>
&lt;li>äº‹ä»¶å¾ªç¯è°ƒç”¨ä¿å­˜çš„Wakerçš„&lt;code>wake()&lt;/code>æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;h5 id="6-ä»»åŠ¡æ¢å¤">6. ä»»åŠ¡æ¢å¤
&lt;/h5>&lt;ul>
&lt;li>Wakerå°†ä»»åŠ¡æ”¾å›å°±ç»ªé˜Ÿåˆ—&lt;/li>
&lt;li>è°ƒåº¦å™¨å†æ¬¡è½®è¯¢è¯¥ä»»åŠ¡&lt;/li>
&lt;/ul></description></item><item><title>æ™®é€šå¯¹è±¡å’Œtraitå¯¹è±¡</title><link>https://www.dust-zed.site/rust/%E6%99%AE%E9%80%9A%E5%AF%B9%E8%B1%A1%E5%92%8Ctrait%E5%AF%B9%E8%B1%A1/</link><pubDate>Fri, 05 Sep 2025 18:49:07 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E6%99%AE%E9%80%9A%E5%AF%B9%E8%B1%A1%E5%92%8Ctrait%E5%AF%B9%E8%B1%A1/</guid><description>&lt;h4 id="æ™®é€šå¯¹è±¡çš„å†…å­˜ç»“æ„">æ™®é€šå¯¹è±¡çš„å†…å­˜ç»“æ„
&lt;/h4>&lt;ul>
&lt;li>åªåŒ…å«æ•°æ®æˆå‘˜&lt;/li>
&lt;li>æ–¹æ³•ä¸å ç”¨å†…å­˜ç©ºé—´&lt;/li>
&lt;li>æ–¹æ³•è°ƒç”¨æ˜¯é™æ€åˆ†å‘çš„ï¼Œæ–¹æ³•å­˜å‚¨åœ¨ä»£ç æ®µä¸­ï¼Œè°ƒç”¨æ—¶ç›´æ¥è·³è½¬åˆ°å›ºå®šåœ°å€&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Point&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x: &lt;span style="color:#66d9ef">i32&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> y: &lt;span style="color:#66d9ef">i32&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">///å†…å­˜ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span>&lt;span style="color:#f92672">+------+------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> x: &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#f92672">|&lt;/span> y: &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// 8 å­—èŠ‚ (i32 æ˜¯ 4 å­—èŠ‚)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+------+------+&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="traitå¯¹è±¡å†…å­˜ç»“æ„">traitå¯¹è±¡å†…å­˜ç»“æ„
&lt;/h4>&lt;ul>
&lt;li>ç”±ä¸¤ä¸ªæŒ‡é’ˆç»„æˆ
&lt;ul>
&lt;li>æ•°æ®æŒ‡é’ˆï¼šæŒ‡å‘å®é™…æ•°æ®çš„æŒ‡é’ˆ&lt;/li>
&lt;li>è™šè¡¨æŒ‡é’ˆï¼šæŒ‡å‘è™šè¡¨çš„æŒ‡é’ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>è™šè¡¨åŒ…å«
&lt;ul>
&lt;li>ææ„å‡½æ•°æŒ‡é’ˆ&lt;/li>
&lt;li>ç±»å‹å¤§å°å’Œå¯¹é½ä¿¡æ¯&lt;/li>
&lt;li>traitä¸­æ‰€æœ‰æ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">trait&lt;/span> Shape {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">area&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">f64&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">scale&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, factor: &lt;span style="color:#66d9ef">f64&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Circle&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> radius: &lt;span style="color:#66d9ef">f64&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Shape &lt;span style="color:#66d9ef">for&lt;/span> Circle {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">area&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">f64&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std::&lt;span style="color:#66d9ef">f64&lt;/span>::consts::&lt;span style="color:#66d9ef">PI&lt;/span> &lt;span style="color:#f92672">*&lt;/span> self.radius &lt;span style="color:#f92672">*&lt;/span> self.radius
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">scale&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, factor: &lt;span style="color:#66d9ef">f64&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.radius &lt;span style="color:#f92672">*=&lt;/span> factor;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> circle: Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> Shape&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> Box::new(Circle { radius: &lt;span style="color:#ae81ff">1.0&lt;/span> });
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å†…å­˜å¸ƒå±€">å†…å­˜å¸ƒå±€
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+------------------+&lt;/span> &lt;span style="color:#f92672">+------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ•°æ®æŒ‡é’ˆ&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">-&lt;/span>-&amp;gt; &lt;span style="color:#f92672">|&lt;/span> radius: &lt;span style="color:#66d9ef">f64&lt;/span> &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+------------------+&lt;/span> &lt;span style="color:#f92672">+------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">è™šè¡¨æŒ‡é’ˆ&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">-&lt;/span>-&amp;gt; &lt;span style="color:#f92672">+------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+------------------+&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æŒ‡å‘&lt;/span> Circle &lt;span style="color:#960050;background-color:#1e0010">çš„è™šè¡¨&lt;/span> &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">+------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">|&lt;/span> drop_in_place &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// ææ„å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">|&lt;/span> size &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// ç±»å‹å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">|&lt;/span> align &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// å¯¹é½æ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">|&lt;/span> area() &lt;span style="color:#960050;background-color:#1e0010">å‡½æ•°æŒ‡é’ˆ&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// ç¬¬ä¸€ä¸ª trait æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">|&lt;/span> scale() &lt;span style="color:#960050;background-color:#1e0010">å‡½æ•°æŒ‡é’ˆ&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// ç¬¬äºŒä¸ª trait æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">+------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ–¹æ³•è°ƒç”¨è¿‡ç¨‹">æ–¹æ³•è°ƒç”¨è¿‡ç¨‹
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>æ™®é€šå¯¹è±¡æ–¹æ³•&lt;/strong>: æ™®é€šå¯¹è±¡æ–¹æ³•å­˜å‚¨åœ¨ä»£ç æ®µä¸­ï¼Œä¸å ç”¨å¯¹è±¡å†…å­˜ï¼Œè°ƒç”¨æ—¶ç›´æ¥è·³è½¬åˆ°å›ºå®šåœ°å€ã€‚&lt;/li>
&lt;li>&lt;strong>traitå¯¹è±¡æ–¹æ³•&lt;/strong>ï¼š
&lt;ul>
&lt;li>è·å–è™šè¡¨æŒ‡é’ˆ&lt;/li>
&lt;li>ä»è™šè¡¨ä¸­è·å–å‡½æ•°æŒ‡é’ˆ&lt;/li>
&lt;li>è°ƒç”¨å‡½æ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>Rustä¸­åŸºç¡€ç½‘ç»œç¼–ç¨‹</title><link>https://www.dust-zed.site/rust/rust%E4%B8%AD%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</link><pubDate>Fri, 05 Sep 2025 02:04:09 +0800</pubDate><guid>https://www.dust-zed.site/rust/rust%E4%B8%AD%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</guid><description>&lt;h3 id="rust-ç½‘ç»œç¼–ç¨‹åŸºç¡€tcp-ä¸-udp">Rust ç½‘ç»œç¼–ç¨‹åŸºç¡€ï¼šTCP ä¸ UDP
&lt;/h3>&lt;h4 id="tcp-ä¸-udp-åŸºç¡€æ¦‚å¿µ">TCP ä¸ UDP åŸºç¡€æ¦‚å¿µ
&lt;/h4>&lt;h5 id="tcp-ä¼ è¾“æ§åˆ¶åè®®">TCP (ä¼ è¾“æ§åˆ¶åè®®)
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>é¢å‘è¿æ¥&lt;/strong>ï¼šé€šä¿¡å‰éœ€è¦å»ºç«‹è¿æ¥ï¼Œä½¿ç”¨ &lt;code>TcpStream&lt;/code> è¡¨ç¤ºè¿æ¥&lt;/li>
&lt;li>&lt;strong>å¯é æ€§&lt;/strong>ï¼šä¿è¯æ•°æ®æŒ‰åºåˆ°è¾¾ï¼Œè‡ªåŠ¨å¤„ç†ä¸¢åŒ…é‡ä¼ &lt;/li>
&lt;li>&lt;strong>æµå¼åè®®&lt;/strong>ï¼šæ•°æ®æ²¡æœ‰æ˜ç¡®è¾¹ç•Œï¼Œéœ€è¦åº”ç”¨å±‚å¤„ç†æ¶ˆæ¯åˆ†å¸§&lt;/li>
&lt;li>&lt;strong>æµé‡æ§åˆ¶&lt;/strong>ï¼šå†…ç½®æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶æœºåˆ¶&lt;/li>
&lt;li>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šæ–‡ä»¶ä¼ è¾“ã€ç½‘é¡µæµè§ˆã€ç”µå­é‚®ä»¶ç­‰éœ€è¦å¯é ä¼ è¾“çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;h4 id="udp-ç”¨æˆ·æ•°æ®æŠ¥åè®®">UDP (ç”¨æˆ·æ•°æ®æŠ¥åè®®)
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>æ— è¿æ¥&lt;/strong>ï¼šæ¯ä¸ªæ•°æ®åŒ…ç‹¬ç«‹å‘é€ï¼Œä½¿ç”¨ &lt;code>UdpSocket&lt;/code> è¿›è¡Œé€šä¿¡&lt;/li>
&lt;li>&lt;strong>ä¸å¯é &lt;/strong>ï¼šä¸ä¿è¯æ•°æ®åŒ…é¡ºåºå’Œå¯è¾¾æ€§&lt;/li>
&lt;li>&lt;strong>æ•°æ®æŠ¥&lt;/strong>ï¼šæ¯ä¸ªæ•°æ®åŒ…æœ‰æ˜ç¡®è¾¹ç•Œ&lt;/li>
&lt;li>&lt;strong>ä½å»¶è¿Ÿ&lt;/strong>ï¼šæ²¡æœ‰è¿æ¥å»ºç«‹å’Œç¡®è®¤å¼€é”€&lt;/li>
&lt;li>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šå®æ—¶éŸ³è§†é¢‘ã€åœ¨çº¿æ¸¸æˆã€DNS æŸ¥è¯¢ç­‰å¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨&lt;/li>
&lt;/ul>
&lt;h3 id="rust-ä¸­çš„-tcp-ç¼–ç¨‹">Rust ä¸­çš„ TCP ç¼–ç¨‹
&lt;/h3>&lt;h4 id="æœåŠ¡ç«¯">æœåŠ¡ç«¯
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> tokio::net::{TcpListener, TcpStream};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">server&lt;/span>(addr: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>(), Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> std::error::Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> listener &lt;span style="color:#f92672">=&lt;/span> TcpListener::bind(addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Server listening on &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (&lt;span style="color:#66d9ef">mut&lt;/span> stream, addr) &lt;span style="color:#f92672">=&lt;/span> listener.accept().&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Client connected from: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºæ–°ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> tokio::spawn(&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">move&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†è¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> handle_connection(stream).&lt;span style="color:#66d9ef">await&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> tokio::net::TcpStream;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">client&lt;/span>(addr: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>(), Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> std::error::Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> stream &lt;span style="color:#f92672">=&lt;/span> TcpStream::connect(addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Connected to server at &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‘é€å’Œæ¥æ”¶æ•°æ®...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="rust-ä¸­çš„-udp-ç¼–ç¨‹">Rust ä¸­çš„ UDP ç¼–ç¨‹
&lt;/h3>&lt;h4 id="æœåŠ¡ç«¯-1">æœåŠ¡ç«¯
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> tokio::net::UdpSocket;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">server&lt;/span>(addr: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>(), Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> std::error::Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> socket &lt;span style="color:#f92672">=&lt;/span> UdpSocket::bind(addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;UDP server listening on &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> buf &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">vec!&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#66d9ef">u8&lt;/span>; &lt;span style="color:#ae81ff">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (len, addr) &lt;span style="color:#f92672">=&lt;/span> socket.recv_from(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> buf).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Received &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74"> bytes from &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, len, addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ•°æ®å¹¶å›å¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> socket.send_to(&lt;span style="color:#f92672">&amp;amp;&lt;/span>buf[&lt;span style="color:#f92672">..&lt;/span>len], &lt;span style="color:#f92672">&amp;amp;&lt;/span>addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å®¢æˆ·ç«¯-1">å®¢æˆ·ç«¯
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> tokio::net::UdpSocket;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::net::SocketAddr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">client&lt;/span>(server_addr: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>(), Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> std::error::Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç»‘å®šåˆ°ä»»æ„å¯ç”¨ç«¯å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> bind_addr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> server_addr.contains(&lt;span style="color:#e6db74">&amp;#39;:&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;[::]:0&amp;#34;&lt;/span> &lt;span style="color:#75715e">// IPv6
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;0.0.0.0:0&amp;#34;&lt;/span> &lt;span style="color:#75715e">// IPv4
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> socket &lt;span style="color:#f92672">=&lt;/span> UdpSocket::bind(bind_addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> server_addr: &lt;span style="color:#a6e22e">SocketAddr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> server_addr.parse()&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¯é€‰ï¼šè¿æ¥åˆ°æœåŠ¡å™¨åœ°å€ï¼Œä¹‹åå¯ä»¥ä½¿ç”¨ send/recv è€Œé send_to/recv_from
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> socket.connect(&lt;span style="color:#f92672">&amp;amp;&lt;/span>server_addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‘é€æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> socket.send(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Hello, UDP!&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¥æ”¶å“åº”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> buf &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#66d9ef">u8&lt;/span>; &lt;span style="color:#ae81ff">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> len &lt;span style="color:#f92672">=&lt;/span> socket.recv(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> buf).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Received: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, String::from_utf8_lossy(&lt;span style="color:#f92672">&amp;amp;&lt;/span>buf[&lt;span style="color:#f92672">..&lt;/span>len]));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å…³é”®åŒºåˆ«æ€»ç»“">å…³é”®åŒºåˆ«æ€»ç»“
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>è¿æ¥å¤„ç†&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>TCP éœ€è¦æ˜¾å¼æ¥å—è¿æ¥ (&lt;code>accept&lt;/code>)&lt;/li>
&lt;li>UDP ç›´æ¥å‘é€/æ¥æ”¶æ•°æ®æŠ¥&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ•°æ®è¾¹ç•Œ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>TCP æ˜¯æµå¼åè®®ï¼Œéœ€è¦åº”ç”¨å±‚å¤„ç†æ¶ˆæ¯è¾¹ç•Œ&lt;/li>
&lt;li>UDP ä¿æŒæ¶ˆæ¯è¾¹ç•Œï¼Œæ¯ä¸ª &lt;code>recv_from&lt;/code> å¯¹åº”ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¯é æ€§&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>TCP ä¿è¯å¯é ä¼ è¾“&lt;/li>
&lt;li>UDP ä¸ä¿è¯ï¼Œéœ€è¦åº”ç”¨å±‚å¤„ç†ä¸¢åŒ…å’Œä¹±åº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ€§èƒ½&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>TCP æœ‰è¿æ¥å»ºç«‹å’Œç¡®è®¤å¼€é”€&lt;/li>
&lt;li>UDP å»¶è¿Ÿæ›´ä½ï¼Œé€‚åˆå®æ—¶åº”ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="ç«¯å£å’Œè¿æ¥">ç«¯å£å’Œè¿æ¥
&lt;/h4>&lt;h5 id="1-ç›‘å¬ç«¯å£">1. ç›‘å¬ç«¯å£
&lt;/h5>&lt;ul>
&lt;li>ä¸€ä¸ªç«¯å£åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ç›‘å¬&lt;/li>
&lt;/ul>
&lt;h5 id="2-è¿æ¥ä¸ç«¯å£çš„å…³ç³»">2. è¿æ¥ä¸ç«¯å£çš„å…³ç³»
&lt;/h5>&lt;ul>
&lt;li>ä¸€ä¸ªç«¯å£å¯ä»¥æ‰¿è½½å¤šä¸ªè¿æ¥&lt;/li>
&lt;li>æ¯ä¸ªè¿æ¥ç”±å››å…ƒç»„å”¯ä¸€æ ‡è¯†
&lt;ul>
&lt;li>æºIP&lt;/li>
&lt;li>æºç«¯å£&lt;/li>
&lt;li>ç›®æ ‡IP&lt;/li>
&lt;li>ç›®æ ‡ç«¯å£&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="å¥—æ¥å­—ä¸è¿æ¥">å¥—æ¥å­—ä¸è¿æ¥
&lt;/h5>&lt;ul>
&lt;li>æ¯ä¸ªTcpè¿æ¥å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„å¥—æ¥å­—&lt;/li>
&lt;li>ç›‘å¬å¥—æ¥å­—è´Ÿè´£æ¥å—æ–°è¿æ¥&lt;/li>
&lt;li>å·²è¿æ¥å¥—æ¥å­—å¤„ç†å…·ä½“çš„ä¼ è¾“&lt;/li>
&lt;li>Tcpçš„â€œæœ‰è¿æ¥â€æœ¬è´¨æ˜¯æŒ‡&lt;strong>é€šä¿¡åŒæ–¹ç»´æŠ¤å…±åŒçš„çŠ¶æ€ä¿¡æ¯&lt;/strong>ï¼Œè€ŒUdpçš„â€œæ— è¿æ¥â€æ˜¯æŒ‡&lt;strong>æ¯ä¸ªæ•°æ®åŒ…éƒ½æ˜¯ç‹¬ç«‹å¤„ç†çš„&lt;/strong>ï¼Œä¸ä¾èµ–ä¹‹å‰çš„é€šä¿¡çŠ¶æ€ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="é€‰æ‹©å»ºè®®">é€‰æ‹©å»ºè®®
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>é€‰æ‹© TCP å½“ï¼š&lt;/p>
&lt;ul>
&lt;li>éœ€è¦å¯é çš„æ•°æ®ä¼ è¾“&lt;/li>
&lt;li>æ•°æ®ä¼ è¾“çš„å®Œæ•´æ€§æ¯”å®æ—¶æ€§æ›´é‡è¦&lt;/li>
&lt;li>ä¼ è¾“å¤§é‡æ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>é€‰æ‹© UDP å½“ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½å»¶è¿Ÿæ¯”å¯é æ€§æ›´é‡è¦&lt;/li>
&lt;li>å¯ä»¥å®¹å¿å°‘é‡æ•°æ®ä¸¢å¤±&lt;/li>
&lt;li>éœ€è¦å¹¿æ’­æˆ–å¤šæ’­åŠŸèƒ½&lt;/li>
&lt;li>ä¼ è¾“å°æ•°æ®åŒ…ä¸”é¢‘ç¹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸¤ç§åè®®å„æœ‰ä¼˜åŠ¿ï¼Œé€‰æ‹©å“ªç§å–å†³äºæ‚¨çš„å…·ä½“åº”ç”¨éœ€æ±‚ã€‚&lt;/p></description></item><item><title>Pinå’ŒUnpin</title><link>https://www.dust-zed.site/rust/tokio/pin%E5%92%8Cunpin/</link><pubDate>Thu, 04 Sep 2025 15:03:11 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/pin%E5%92%8Cunpin/</guid><description>&lt;h4 id="pinå’Œunpinçš„åŸºæœ¬æ¦‚å¿µ">Pinå’ŒUnpinçš„åŸºæœ¬æ¦‚å¿µ
&lt;/h4>&lt;h5 id="pinçš„ä½œç”¨">Pinçš„ä½œç”¨
&lt;/h5>&lt;p>&lt;code>Pin&amp;lt;P&amp;gt;&lt;/code>æ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œç”¨äºå›ºå®š(pin)å†…å­˜ä¸­çš„å€¼ï¼Œé˜²æ­¢å®ƒè¢«ç§»åŠ¨ã€‚è¿™å¯¹äºè‡ªå¼•ç”¨ç»“æ„ä½“å’Œå¼‚æ­¥ç¼–ç¨‹ä¸­çš„Futureç‰¹åˆ«é‡è¦ã€‚&lt;/p>
&lt;h5 id="unpinçš„ç‰¹è´¨">Unpinçš„ç‰¹è´¨
&lt;/h5>&lt;p>&lt;code>Unpin&lt;/code>æ˜¯ä¸€ä¸ªè‡ªåŠ¨æ´¾ç”Ÿçš„æ ‡è®°traitï¼Œè¡¨ç¤ºç±»å‹å¯ä»¥å®‰å…¨åœ°ç§»å‡º&lt;code>Pin&lt;/code>ã€‚å¤§å¤šæ•°ç±»å‹éƒ½è‡ªåŠ¨å®ç°äº†&lt;code>Unpin&lt;/code>ã€‚å®ç°äº†&lt;code>Unpin&lt;/code>çš„ç±»å‹å¯ä»¥å®‰å…¨åœ°ä»&lt;code>Pin&lt;/code>ä¸­ç§»å‡ºã€‚&lt;/p>
&lt;h4 id="asyncawaitä¸ºä½•éœ€è¦pin">async/awaitä¸ºä½•éœ€è¦Pin
&lt;/h4>&lt;ul>
&lt;li>&lt;code>async&lt;/code>å—å¯èƒ½åŒ…å«è‡ªå¼•ç”¨ï¼Œ&lt;code>async&lt;/code>è½¬å˜ä¸º&lt;code>Future&lt;/code>ç»“æ„ä½“,å®ƒæ˜¯ä¸€ä¸ªçŠ¶æ€æœº&lt;/li>
&lt;li>å½“&lt;code>.await&lt;/code>æš‚åœæ‰§è¡Œæ—¶ï¼Œå±€éƒ¨å˜é‡ä¼šä¿å­˜åœ¨ç”Ÿæˆçš„Futureä¸­&lt;/li>
&lt;li>å¦‚æœè¿™äº›å˜é‡ç›¸äº’å¼•ç”¨ï¼Œç§»åŠ¨Futureä¼šå¯¼è‡´æ‚¬å‚æŒ‡é’ˆ&lt;/li>
&lt;/ul>
&lt;h4 id="ç”Ÿå‘½å‘¨æœŸç®¡ç†å±‚æ¬¡">ç”Ÿå‘½å‘¨æœŸç®¡ç†å±‚æ¬¡
&lt;/h4>&lt;h5 id="1-å˜é‡çº§åˆ«">1. å˜é‡çº§åˆ«
&lt;/h5>&lt;ul>
&lt;li>å±€éƒ¨å˜é‡è¢«ç§»åŠ¨åˆ°FutureçŠ¶æ€æœºä¸­&lt;/li>
&lt;li>ç”Ÿå‘½å‘¨æœŸä¸Futureå®ä¾‹ç»‘å®š&lt;/li>
&lt;/ul>
&lt;h5 id="2-futureçº§åˆ«">2. Futureçº§åˆ«
&lt;/h5>&lt;ul>
&lt;li>ç”±æ‰§è¡Œå™¨æ‹¥æœ‰å’Œç®¡ç†&lt;/li>
&lt;li>æ‰§è¡Œå™¨å†³å®šä½•æ—¶pollï¼Œä½•æ—¶drop&lt;/li>
&lt;/ul>
&lt;h5 id="3-æ‰§è¡Œå™¨çº§åˆ«">3. æ‰§è¡Œå™¨çº§åˆ«
&lt;/h5>&lt;ul>
&lt;li>ç®¡ç†æ‰€æœ‰Futureçš„ç”Ÿå‘½å‘¨æœŸ&lt;/li>
&lt;li>è´Ÿè´£è°ƒåº¦å’Œç®¡ç†&lt;/li>
&lt;/ul>
&lt;h5 id="4-æ ˆå¸§ä¸çŠ¶æ€æœº">4. æ ˆå¸§ä¸çŠ¶æ€æœº
&lt;/h5>&lt;ul>
&lt;li>åŒæ­¥ï¼šå˜é‡ç”Ÿå‘½å‘¨æœŸç”±æ ˆå¸§ç®¡ç†&lt;/li>
&lt;li>å¼‚æ­¥ï¼šå˜é‡ç”Ÿå‘½å‘¨æœŸç”±çŠ¶æ€æœºç®¡ç†&lt;/li>
&lt;/ul>
&lt;h4 id="ä»»åŠ¡é˜Ÿåˆ—ä¸future">ä»»åŠ¡é˜Ÿåˆ—ä¸Future
&lt;/h4>&lt;h5 id="ä¸€æ¬¡æ€§ç§»åŠ¨">ä¸€æ¬¡æ€§ç§»åŠ¨
&lt;/h5>&lt;ul>
&lt;li>Futureè¢«ç§»åŠ¨åˆ°æ‰§è¡Œå™¨åï¼Œç”±Pinä¿è¯ä¸ä¼šå†æ¬¡ç§»åŠ¨&lt;/li>
&lt;li>æ‰§è¡Œå™¨å†…éƒ¨ä½¿ç”¨æŒ‡é’ˆæ¥å¼•ç”¨Future&lt;/li>
&lt;/ul>
&lt;h5 id="ä»»åŠ¡é˜Ÿåˆ—çš„å®ç°">ä»»åŠ¡é˜Ÿåˆ—çš„å®ç°
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¼ªä»£ç ï¼šä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ Future
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Task&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future: &lt;span style="color:#a6e22e">Pin&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> Future&lt;span style="color:#f92672">&amp;lt;&lt;/span>Output &lt;span style="color:#f92672">=&lt;/span> ()&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä»»åŠ¡é˜Ÿåˆ—å­˜å‚¨çš„æ˜¯ Box&amp;lt;Task&amp;gt;ï¼Œè€Œä¸æ˜¯ç›´æ¥å­˜å‚¨ Future
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> task_queue: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>Task&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">..&lt;/span>.;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å·¥ä½œçªƒå–è°ƒåº¦">å·¥ä½œçªƒå–è°ƒåº¦
&lt;/h5>&lt;ul>
&lt;li>å½“ä»»åŠ¡åœ¨çº¿ç¨‹é—´è½¬ç§»æ—¶ï¼Œè½¬ç§»çš„æ˜¯&lt;code>Box&amp;lt;Task&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>Box&lt;/code>çš„ç§»åŠ¨ä¸ä¼šå½±å“å†…éƒ¨Futureçš„å†…å­˜åœ°å€&lt;/li>
&lt;li>Pin ä¿è¯çš„æ˜¯ &lt;code>Box&lt;/code> å†…éƒ¨çš„ Future ä¸ä¼šè¢«ç§»å‡º&lt;/li>
&lt;/ul></description></item><item><title>ä¸ºä½•æŠ½è±¡</title><link>https://www.dust-zed.site/rust/%E4%B8%BA%E4%BD%95%E6%8A%BD%E8%B1%A1/</link><pubDate>Wed, 03 Sep 2025 22:56:23 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E4%B8%BA%E4%BD%95%E6%8A%BD%E8%B1%A1/</guid><description>&lt;h4 id="æŠ½è±¡çš„æ ¸å¿ƒç›®çš„">æŠ½è±¡çš„æ ¸å¿ƒç›®çš„
&lt;/h4>&lt;p>æŠ½è±¡çš„ä¸»è¦ç›®çš„æ˜¯&lt;strong>ç®¡ç†å˜åŒ–&lt;/strong>ï¼Œå…·ä½“æ¥è¯´ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>è¯†åˆ«å˜åŒ–ç‚¹&lt;/strong>ï¼šç¡®å®šå“ªäº›éƒ¨åˆ†å¯èƒ½ä¼šå˜åŒ–&lt;/li>
&lt;li>&lt;strong>éš”ç¦»å˜åŒ–&lt;/strong>ï¼šå°†å˜åŒ–é™åˆ¶åœ¨å±€éƒ¨&lt;/li>
&lt;li>&lt;strong>ç»Ÿä¸€æ¥å£&lt;/strong>ï¼šä¸ºä¸åŒçš„å®ç°æä¾›ä¸€è‡´çš„äº¤äº’æ–¹å¼&lt;/li>
&lt;/ol>
&lt;h4 id="æŠ½è±¡çš„æ ¸å¿ƒä»·å€¼">æŠ½è±¡çš„æ ¸å¿ƒä»·å€¼
&lt;/h4>&lt;p>åœ¨å˜åŒ–ä¸­å¯»æ±‚å¹³è¡¡ç¨³å®š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç¨³å®šå±‚&lt;/strong>ï¼šæŠ½è±¡å®šä¹‰â€œåšä»€ä¹ˆâ€ï¼ˆæ¥å£/å¥‘çº¦ï¼‰&lt;/li>
&lt;li>&lt;strong>å˜åŒ–å±‚&lt;/strong>ï¼šå®ç°å¤„ç†â€œæ€ä¹ˆåšâ€ï¼ˆå…·ä½“ç»†èŠ‚ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="solidåŸåˆ™">SOLIDåŸåˆ™
&lt;/h4>&lt;h5 id="1-å•ä¸€èŒè´£åŸåˆ™">1. å•ä¸€èŒè´£åŸåˆ™
&lt;/h5>&lt;p>ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› &lt;/p>
&lt;ul>
&lt;li>æ¯ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€é¡¹èŒè´£&lt;/li>
&lt;li>å°†ä¸åŒçš„åŠŸèƒ½åˆ†ç¦»åˆ°ä¸åŒçš„ç±»ä¸­&lt;/li>
&lt;/ul>
&lt;h5 id="2-å¼€é—­åŸåˆ™">2. å¼€é—­åŸåˆ™
&lt;/h5>&lt;p>è½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ï¼‰åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡æ·»åŠ æ–°ä»£ç å¼€æ‰©å±•åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰ä»£ç &lt;/li>
&lt;li>ä½¿ç”¨æŠ½è±¡æ¥å®šä¹‰å¥‘çº¦&lt;/li>
&lt;/ul>
&lt;h5 id="3-é‡Œæ°æ›¿æ¢åŸåˆ™">3. é‡Œæ°æ›¿æ¢åŸåˆ™
&lt;/h5>&lt;p>å­ç±»å‹å¿…é¡»èƒ½å¤Ÿæ›¿æ¢å…¶çˆ¶ç±»å‹è€Œä¸å½±å“ç¨‹åºçš„æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;ul>
&lt;li>å­ç±»åº”è¯¥æ‰©å±•çˆ¶ç±»çš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯æ”¹å˜å®ƒ&lt;/li>
&lt;li>å­ç±»ä¸åº”è¯¥åŠ å¼ºå‰ç½®æ¡ä»¶æˆ–å‰Šå¼±åç½®æ¡ä»¶&lt;/li>
&lt;li>å­ç±»ä¸åº”è¯¥æŠ›å‡ºçˆ¶ç±»ä¸ä¼šæŠ›å‡ºçš„å¼‚å¸¸&lt;/li>
&lt;/ul>
&lt;h5 id="4-æ¥å£éš”ç¦»åŸåˆ™">4. æ¥å£éš”ç¦»åŸåˆ™
&lt;/h5>&lt;p>å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–ä»–ä»¬ä¸ä½¿ç”¨çš„æ¥å£&lt;/p>
&lt;ul>
&lt;li>å°†å¤§æ¥å£æ‹†åˆ†ä¸ºæ›´å°ã€æ›´å…·ä½“çš„æ¥å£&lt;/li>
&lt;li>ç±»ä¸åº”è¯¥å®ç°ä»–ä»¬ä¸éœ€è¦çš„æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;h5 id="5-ä¾èµ–å€’ç½®">5. ä¾èµ–å€’ç½®
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">é«˜å±‚æ¨¡å—&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">ä¾èµ–&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æŠ½è±¡æ¥å£&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å®ç°&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">ä½å±‚æ¨¡å—&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Tokioæ•´ä½“ç»“æ„</title><link>https://www.dust-zed.site/rust/tokio/tokio%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84/</link><pubDate>Wed, 03 Sep 2025 12:28:49 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/tokio%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84/</guid><description>&lt;h3 id="tokioæ¶æ„è®¾è®¡">Tokioæ¶æ„è®¾è®¡
&lt;/h3>&lt;p>Tokioæ˜¯ä¸€ä¸ªåŸºäºRustçš„ä¸€æ­¥è¿è¡Œæ—¶ï¼Œå…¶è®¾è®¡éå¸¸ç²¾å¦™ã€‚&lt;/p>
&lt;h4 id="1-æ ¸å¿ƒç»„ä»¶">1. æ ¸å¿ƒç»„ä»¶
&lt;/h4>&lt;h5 id="11-reactorååº”å™¨">1.1 Reactorï¼ˆååº”å™¨ï¼‰
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>I/Oå¤šè·¯å¤ç”¨&lt;/strong>ï¼šåŸºäºæ“ä½œç³»ç»Ÿæä¾›çš„epoll/kqueue/IOCPç­‰æœºåˆ¶&lt;/li>
&lt;li>&lt;strong>äº‹ä»¶å¾ªç¯&lt;/strong>ï¼š è´Ÿè´£ç›‘å¬å’Œåˆ†å‘I/Oäº‹ä»¶&lt;/li>
&lt;li>&lt;strong>éé˜»å¡I/O&lt;/strong>ï¼šæ‰€æœ‰I/Oæ“ä½œéƒ½æ˜¯éé˜»å¡çš„&lt;/li>
&lt;/ul>
&lt;h5 id="12-scheduler">1.2 Scheduler
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>å·¥ä½œçªƒå–&lt;/strong>ï¼šä½¿ç”¨å·¥ä½œçªƒå–ç®—æ³•åœ¨å¤šçº¿ç¨‹é—´åˆ†é…ä»»åŠ¡&lt;/li>
&lt;li>&lt;strong>å¤šçº¿ç¨‹æ‰§è¡Œå™¨&lt;/strong>ï¼š é»˜è®¤ä½¿ç”¨å¤šçº¿ç¨‹æ‰§è¡Œå™¨æé«˜å¹¶å‘æ€§èƒ½&lt;/li>
&lt;li>&lt;strong>ä»»åŠ¡è°ƒåº¦&lt;/strong>ï¼š è´Ÿè´£ä»»åŠ¡çš„è°ƒåº¦å’Œæ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;h5 id="13-å¼‚æ­¥ä»»åŠ¡">1.3 å¼‚æ­¥ä»»åŠ¡
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>FutureæŠ½è±¡&lt;/strong>ï¼šåŸºäºRustçš„Future trait&lt;/li>
&lt;li>&lt;strong>é›¶æˆæœ¬æŠ½è±¡&lt;/strong>ï¼šåˆ©ç”¨Rustçš„æ‰€æœ‰æƒç³»ç»Ÿå®ç°é›¶æˆæœ¬æŠ½è±¡&lt;/li>
&lt;li>&lt;strong>ä»»åŠ¡çªƒå–&lt;/strong>ï¼š ä»»åŠ¡å¯ä»¥åœ¨ä¸åŒçº¿ç¨‹é—´è¿ç§»ä»¥å¹³è¡¡è´Ÿè½½&lt;/li>
&lt;/ul>
&lt;h4 id="2-è®¾è®¡å“²å­¦">2. è®¾è®¡å“²å­¦
&lt;/h4>&lt;h5 id="21-é›¶æˆæœ¬æŠ½è±¡">2.1 é›¶æˆæœ¬æŠ½è±¡
&lt;/h5>&lt;ul>
&lt;li>ä½¿ç”¨Rustçš„é›¶æˆæœ¬æŠ½è±¡åŸåˆ™&lt;/li>
&lt;li>è¿è¡Œæ—¶æ£€æŸ¥è½¬å˜ä¸ºç¼–è¯‘æ—¶æ£€æŸ¥&lt;/li>
&lt;li>æœ€å°åŒ–è¿è¡Œæ—¶å¼€é”€&lt;/li>
&lt;/ul>
&lt;h5 id="22-æ¨¡å—åŒ–è®¾è®¡">2.2 æ¨¡å—åŒ–è®¾è®¡
&lt;/h5>&lt;ul>
&lt;li>æ ¸å¿ƒç»„ä»¶è§£è€¦&lt;/li>
&lt;li>å¯æŒ‰éœ€é€‰æ‹©åŠŸèƒ½&lt;/li>
&lt;li>å¯æ‰©å±•æ€§å¼º&lt;/li>
&lt;/ul>
&lt;h5 id="23-æ€§èƒ½ä¼˜å…ˆ">2.3 æ€§èƒ½ä¼˜å…ˆ
&lt;/h5>&lt;ul>
&lt;li>æ— é”æ•°æ®ç»“æ„&lt;/li>
&lt;li>æœ€å°åŒ–å†…å­˜åˆ†é…&lt;/li>
&lt;li>æ‰¹å¤„ç†ç³»ç»Ÿè°ƒç”¨&lt;/li>
&lt;/ul>
&lt;h4 id="3-å…³é”®å®ç°ç»†èŠ‚">3. å…³é”®å®ç°ç»†èŠ‚
&lt;/h4>&lt;h5 id="31-ä»»åŠ¡è°ƒåº¦">3.1 ä»»åŠ¡è°ƒåº¦
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç®€åŒ–çš„ä»»åŠ¡ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Task&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»»åŠ¡çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> state: &lt;span style="color:#a6e22e">AtomicUsize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»»åŠ¡æ‰§è¡Œä½“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> future: &lt;span style="color:#a6e22e">Mutex&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Pin&lt;span style="color:#f92672">&amp;lt;&lt;/span>Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> Future&lt;span style="color:#f92672">&amp;lt;&lt;/span>Output &lt;span style="color:#f92672">=&lt;/span> ()&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»»åŠ¡é˜Ÿåˆ—ç›¸å…³
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> next: &lt;span style="color:#a6e22e">UnsafeCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;*&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> Task&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="32-ioé©±åŠ¨">3.2 I/Oé©±åŠ¨
&lt;/h5>&lt;ul>
&lt;li>ä½¿ç”¨mioåº“æä¾›è·¨å¹³å°I/Oå¤šè·¯å¤ç”¨&lt;/li>
&lt;li>åŸºäºreadinessæ¨¡å‹&lt;/li>
&lt;li>é›¶æ‹·è´æ”¯æŒ&lt;/li>
&lt;/ul>
&lt;h4 id="4-é«˜çº§ç‰¹æ€§">4. é«˜çº§ç‰¹æ€§
&lt;/h4>&lt;h5 id="41-å¼‚æ­¥ç­‰å¾…">4.1 å¼‚æ­¥ç­‰å¾…
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¼‚æ­¥å‡½æ•°ç¤ºä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">process&lt;/span>(socket: &lt;span style="color:#a6e22e">TcpStream&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">io&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>()&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> buf &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#ae81ff">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¼‚æ­¥è¯»å–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> n &lt;span style="color:#f92672">=&lt;/span> socket.read(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> buf).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ•°æ®...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="42-å®šæ—¶å™¨">4.2 å®šæ—¶å™¨
&lt;/h5>&lt;ul>
&lt;li>åˆ†å±‚æ—¶é—´è½®å®ç°&lt;/li>
&lt;li>é«˜ç²¾åº¦å®šæ—¶å™¨&lt;/li>
&lt;li>ä½å¼€é”€&lt;/li>
&lt;/ul>
&lt;h4 id="5-æ€§èƒ½ä¼˜åŒ–">5. æ€§èƒ½ä¼˜åŒ–
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>é›¶æˆæœ¬æŠ½è±¡&lt;/strong>ï¼šåˆ©ç”¨Rustçš„æ‰€æœ‰æƒç³»ç»Ÿ&lt;/li>
&lt;li>&lt;strong>æ— é”ç¼–ç¨‹&lt;/strong>ï¼š å‡å°‘é”äº‰ç”¨&lt;/li>
&lt;li>&lt;strong>æ‰¹å¤„ç†&lt;/strong>ï¼šåˆå¹¶ç³»ç»Ÿè°ƒç”¨&lt;/li>
&lt;li>&lt;strong>å†…å­˜æ± &lt;/strong>ï¼šå‡å°‘å†…å­˜åˆ†é…&lt;/li>
&lt;/ol>
&lt;h4 id="6-ç”Ÿæ€ç³»ç»Ÿ">6. ç”Ÿæ€ç³»ç»Ÿ
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>tokio-util&lt;/strong>ï¼šå®ç”¨å·¥å…·&lt;/li>
&lt;li>&lt;strong>tokio-stream&lt;/strong>ï¼šæµå¤„ç†&lt;/li>
&lt;li>&lt;strong>tokio-tungstenite&lt;/strong>: WebSocket&lt;/li>
&lt;li>&lt;strong>tonic&lt;/strong>: gRPCå®ç°&lt;/li>
&lt;/ul>
&lt;h4 id="7è®¾è®¡å–èˆ">7.è®¾è®¡å–èˆ
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>å¤æ‚æ€§&lt;/strong>ï¼šä¸ºäº†æ€§èƒ½æ¥æ”¶æ›´é«˜çš„å®ç°å¤æ‚åº¦&lt;/li>
&lt;li>&lt;strong>å­¦ä¹ æ›²çº¿&lt;/strong>ï¼š éœ€è¦ç†è§£Rustå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹&lt;/li>
&lt;li>&lt;strong>è°ƒè¯•éš¾åº¦&lt;/strong>ï¼š å¼‚æ­¥è°ƒè¯•ç›¸å¯¹å›°éš¾&lt;/li>
&lt;/ol>
&lt;h4 id="8æœ€ä½³å®è·µ">8.æœ€ä½³å®è·µ
&lt;/h4>&lt;ol>
&lt;li>é¿å…åœ¨å¼‚æ­¥ä»£ç ä¸­æ‰§è¡Œé˜»å¡æ“ä½œ&lt;/li>
&lt;li>åˆç†ä½¿ç”¨&lt;code>spawn_blocking&lt;/code>&lt;/li>
&lt;li>æ³¨æ„ä»»åŠ¡å–æ¶ˆå’Œæ¸…ç†&lt;/li>
&lt;li>åˆç†è®¾ç½®å·¥ä½œçº¿ç¨‹&lt;/li>
&lt;/ol>
&lt;p>Tokio çš„è®¾è®¡ä½“ç°äº† Rust è¯­è¨€çš„æ ¸å¿ƒç†å¿µï¼šé›¶æˆæœ¬æŠ½è±¡ã€å†…å­˜å®‰å…¨å’Œå¹¶å‘å®‰å…¨ã€‚å®ƒçš„æ¶æ„è®¾è®¡ä½¿å…¶æˆä¸ºæ„å»ºé«˜æ€§èƒ½ã€å¯é ç½‘ç»œåº”ç”¨çš„ç†æƒ³é€‰æ‹©ã€‚&lt;/p>
&lt;hr>
&lt;h4 id="å¼‚æ­¥æ¦‚å¿µ">å¼‚æ­¥æ¦‚å¿µ
&lt;/h4>&lt;h5 id="future-traitåŸºç¡€">Future TraitåŸºç¡€
&lt;/h5>&lt;p>&lt;code>Future&lt;/code>æ˜¯Rustå¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒtraitï¼Œå®šä¹‰åœ¨æ ‡å‡†åº“&lt;code>std::future&lt;/code>ä¸­ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">trait&lt;/span> Future {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">poll&lt;/span>(self: &lt;span style="color:#a6e22e">Pin&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> Self&lt;span style="color:#f92672">&amp;gt;&lt;/span>, cx: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> Context&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">Poll&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Self::Output&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="å…³é”®ç‚¹">å…³é”®ç‚¹
&lt;/h6>&lt;ul>
&lt;li>&lt;code>Output&lt;/code>ï¼šFutureå®Œæˆæ—¶äº§ç”Ÿçš„å€¼ç±»å‹&lt;/li>
&lt;li>&lt;code>poll&lt;/code>ï¼šæ£€æŸ¥Futureæ˜¯å¦å®Œæˆ
&lt;ul>
&lt;li>è¿”å›&lt;code>Poll::Ready(Output)&lt;/code>ï¼šå®Œæˆå¹¶è¿”å›ç»“æœ&lt;/li>
&lt;li>è¿”å›&lt;code>Poll::Pending&lt;/code>ï¼šæœªå®Œæˆï¼Œç¨åéœ€è¦å†æ¬¡è½®è¯¢&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="asyncawaitè¯­æ³•ç³–">Async/Awaitè¯­æ³•ç³–
&lt;/h5>&lt;p>&lt;code>async/await&lt;/code>æ˜¯Rustæä¾›çš„è¯­æ³•ç³–ï¼Œè®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ï¼š&lt;/p>
&lt;h6 id="1-åŸºæœ¬ç”¨æ³•">1. åŸºæœ¬ç”¨æ³•
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">fetch_data&lt;/span>() -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, io::Error&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¼‚æ­¥æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> data &lt;span style="color:#f92672">=&lt;/span> read_from_network().&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="2-å±•å¼€å½¢å¼">2. å±•å¼€å½¢å¼
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">FetchDataFuture&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state: &lt;span style="color:#a6e22e">State&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">State&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Start,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> AwaitingRead(ReadFuture),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Done,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Future &lt;span style="color:#66d9ef">for&lt;/span> FetchDataFuture {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, io::Error&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">poll&lt;/span>(&lt;span style="color:#66d9ef">mut&lt;/span> self: &lt;span style="color:#a6e22e">Pin&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> Self&lt;span style="color:#f92672">&amp;gt;&lt;/span>, cx: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> Context&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">Poll&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Self::Output&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self.state {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State::Start &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> read_fut &lt;span style="color:#f92672">=&lt;/span> read_from_network();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.state &lt;span style="color:#f92672">=&lt;/span> State::AwaitingRead(read_fut);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State::AwaitingRead(&lt;span style="color:#66d9ef">ref&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> fut) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> Pin::new(fut).poll(cx) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Poll::Ready(Ok(data)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Poll::Ready(Ok(data));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Poll::Ready(Err(e)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Poll::Ready(Err(e));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Poll::Pending &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Poll::Pending;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State::Done &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">panic!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;poll called after completion&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å…³é”®æ¦‚å¿µ">å…³é”®æ¦‚å¿µ
&lt;/h4>&lt;h6 id="1-é›¶æˆæœ¬æŠ½è±¡">1. é›¶æˆæœ¬æŠ½è±¡
&lt;/h6>&lt;ul>
&lt;li>å¼‚æ­¥ä»£ç åœ¨ç¼–è¯‘æ—¶è½¬æ¢ä¸ºçŠ¶æ€æœº&lt;/li>
&lt;li>æ²¡æœ‰è¿è¡Œæ—¶å¼€é”€ï¼Œä¸æ‰‹å†™çš„å›è°ƒä»£ç æ€§èƒ½ç›¸å½“&lt;/li>
&lt;/ul>
&lt;h6 id="2-æ‰§è¡Œå™¨executor">2. æ‰§è¡Œå™¨(Executor)
&lt;/h6>&lt;ul>
&lt;li>è´Ÿè´£è°ƒåº¦å’Œæ‰§è¡ŒFuture&lt;/li>
&lt;li>Tokioæä¾›äº†é«˜æ€§èƒ½çš„æ‰§è¡Œå™¨å®ç°&lt;/li>
&lt;/ul>
&lt;h6 id="3-wakeræœºåˆ¶">3. Wakeræœºåˆ¶
&lt;/h6>&lt;ul>
&lt;li>å½“Futureè¿”å›&lt;code>Poll::Pending&lt;/code>æ—¶ï¼Œä¼šæ³¨å†Œä¸€ä¸ªWaker&lt;/li>
&lt;li>å½“Futureå¯ä»¥ç»§ç»­æ‰§è¡Œæ—¶ï¼Œé€šè¿‡Wakeré€šçŸ¥æ‰§è¡Œå™¨&lt;/li>
&lt;/ul>
&lt;h6 id="4-taskä¸future">4. Taskä¸Future
&lt;/h6>&lt;ul>
&lt;li>&lt;code>Task&lt;/code>æ˜¯æ‰§è¡Œå•å…ƒï¼Œæ˜¯Tokioè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè´Ÿè´£æ‰§è¡Œä¸€ä¸ªé¡¶å±‚çš„Futureåˆ°å®Œæˆ&lt;/li>
&lt;li>&lt;code>Future&lt;/code>æ˜¯è®¡ç®—å•å…ƒï¼Œä»£è¡¨ä¸€ä¸ªå¼‚æ­¥è®¡ç®—ï¼Œä¸€ä¸ªTaskå¯ä»¥åŒ…å«å¤šä¸ªåµŒå¥—çš„Futureï¼Œè¿™äº›åµŒå¥—çš„Futureå…±äº«åŒä¸€ä¸ªTaskçš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚&lt;/li>
&lt;/ul></description></item><item><title>Androidäº‹ä»¶åˆ†å‘æœºåˆ¶è¯¦è§£</title><link>https://www.dust-zed.site/android-develop/android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/</link><pubDate>Tue, 02 Sep 2025 21:41:39 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/</guid><description>&lt;h4 id="1-äº‹ä»¶åˆ†å‘çš„åŸºæœ¬æµç¨‹">1. äº‹ä»¶åˆ†å‘çš„åŸºæœ¬æµç¨‹
&lt;/h4>&lt;h5 id="11-äº‹ä»¶ä¼ é€’é¡ºåº">1.1 äº‹ä»¶ä¼ é€’é¡ºåº
&lt;/h5>&lt;p>äº‹ä»¶ä»Activityå¼€å§‹ï¼ŒæŒ‰ç…§ä¸€ä¸‹é¡ºåºä¼ é€’ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>Activity -&amp;gt; &lt;span style="color:#a6e22e">Window&lt;/span> -&amp;gt; &lt;span style="color:#a6e22e">DecorView&lt;/span> -&amp;gt; &lt;span style="color:#a6e22e">ViewGroup&lt;/span> -&amp;gt; &lt;span style="color:#a6e22e">View&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="12-æ ¸å¿ƒæ–¹æ³•">1.2 æ ¸å¿ƒæ–¹æ³•
&lt;/h5>&lt;ol>
&lt;li>&lt;strong>dispatchTouchEvent&lt;/strong>
&lt;ul>
&lt;li>è´Ÿè´£äº‹ä»¶çš„åˆ†å‘&lt;/li>
&lt;li>è¿”å›trueè¡¨ç¤ºäº‹ä»¶è¢«æ¶ˆè´¹ï¼Œfalseè¡¨ç¤ºæœªæ¶ˆè´¹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>onInterceptTouchEvent&lt;/strong>
&lt;ul>
&lt;li>åªæœ‰ViewGroupæ‰æœ‰çš„æ–¹æ³•&lt;/li>
&lt;li>ç”¨äºæ‹¦æˆªäº‹ä»¶ï¼Œè¿”å›trueè¡¨ç¤ºæ‹¦æˆªäº‹ä»¶&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>onTouchEvent&lt;/strong>
&lt;ul>
&lt;li>å¤„ç†ç‚¹å‡»äº‹ä»¶&lt;/li>
&lt;li>è¿”å›trueè¡¨ç¤ºäº‹ä»¶è¢«æ¶ˆè´¹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="2-æºç åˆ†æ">2. æºç åˆ†æ
&lt;/h4>&lt;h5 id="21-activityçš„dispatchtouchevent">2.1 Activityçš„dispatchTouchEvent
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">dispatchTouchEvent&lt;/span>(MotionEvent ev) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ev.&lt;span style="color:#a6e22e">getAction&lt;/span>() &lt;span style="color:#f92672">==&lt;/span> MotionEvent.&lt;span style="color:#a6e22e">ACTION_DOWN&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> onUserInteraction(); &lt;span style="color:#75715e">// ç©ºæ–¹æ³•ï¼Œå¯ä»¥é‡å†™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (getWindow().&lt;span style="color:#a6e22e">superDispatchTouchEvent&lt;/span>(ev)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>; &lt;span style="color:#75715e">// äº‹ä»¶è¢«æ¶ˆè´¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> onTouchEvent(ev); &lt;span style="color:#75715e">// å¦‚æœæ‰€æœ‰Viewéƒ½æ²¡æœ‰å¤„ç†ï¼Œåˆ™è°ƒç”¨Activityçš„onTouchEvent&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="22-viewgroupçš„dispatchtouchevent">2.2 ViewGroupçš„dispatchTouchEvent
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">dispatchTouchEvent&lt;/span>(MotionEvent ev) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. æ£€æŸ¥æ˜¯å¦æ‹¦æˆª&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> intercepted;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (actionMasked &lt;span style="color:#f92672">==&lt;/span> MotionEvent.&lt;span style="color:#a6e22e">ACTION_DOWN&lt;/span> &lt;span style="color:#f92672">||&lt;/span> mFirstTouchTarget &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> disallowIntercept &lt;span style="color:#f92672">=&lt;/span> (mGroupFlags &lt;span style="color:#f92672">&amp;amp;&lt;/span> FLAG_DISALLOW_INTERCEPT) &lt;span style="color:#f92672">!=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>disallowIntercept) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intercepted &lt;span style="color:#f92672">=&lt;/span> onInterceptTouchEvent(ev);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ev.&lt;span style="color:#a6e22e">setAction&lt;/span>(action); &lt;span style="color:#75715e">// æ¢å¤actionï¼Œé˜²æ­¢è¢«ä¿®æ”¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intercepted &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ²¡æœ‰ç›®æ ‡å¤„ç†è¯¥äº‹ä»¶ï¼Œä¹Ÿä¸æ‹¦æˆª&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intercepted &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. å¦‚æœä¸æ‹¦æˆªï¼Œåˆ™å¯»æ‰¾å¯ä»¥å¤„ç†äº‹ä»¶çš„å­View&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>canceled &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>intercepted) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éå†å­Viewï¼Œå¯»æ‰¾å¯ä»¥å¤„ç†äº‹ä»¶çš„View&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> childrenCount &lt;span style="color:#f92672">-&lt;/span> 1; i &lt;span style="color:#f92672">&amp;gt;=&lt;/span> 0; i&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> View child &lt;span style="color:#f92672">=&lt;/span> children&lt;span style="color:#f92672">[&lt;/span>i&lt;span style="color:#f92672">]&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (child.&lt;span style="color:#a6e22e">dispatchTouchEvent&lt;/span>(ev)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰¾åˆ°å¯ä»¥å¤„ç†äº‹ä»¶çš„å­View&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mFirstTouchTarget &lt;span style="color:#f92672">=&lt;/span> addTouchTarget(child, idBitsToAssign);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. åˆ†å‘äº‹ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (mFirstTouchTarget &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ²¡æœ‰å­Viewå¤„ç†äº‹ä»¶ï¼Œè°ƒç”¨çˆ¶ç±»çš„dispatchTouchEvent&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handled &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">super&lt;/span>.&lt;span style="color:#a6e22e">dispatchTouchEvent&lt;/span>(ev);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°†äº‹ä»¶åˆ†å‘ç»™ç›®æ ‡View&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TouchTarget target &lt;span style="color:#f92672">=&lt;/span> mFirstTouchTarget;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (target &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> View child &lt;span style="color:#f92672">=&lt;/span> target.&lt;span style="color:#a6e22e">child&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (child.&lt;span style="color:#a6e22e">dispatchTouchEvent&lt;/span>(ev)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handled &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> target &lt;span style="color:#f92672">=&lt;/span> target.&lt;span style="color:#a6e22e">next&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> handled;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="å®é™…æ‰§è¡Œæµç¨‹">å®é™…æ‰§è¡Œæµç¨‹
&lt;/h6>&lt;ol>
&lt;li>&lt;strong>DOWNäº‹ä»¶&lt;/strong>:
&lt;ul>
&lt;li>&lt;code>mFirstTouchTarget == null&lt;/code>ï¼Œè¿›å…¥å¯»æ‰¾ç›®æ ‡Viewçš„å¾ªç¯&lt;/li>
&lt;li>è°ƒç”¨&lt;code>child.dispatchTouchEvent(ev)&lt;/code>ï¼ˆç¬¬ä¸€æ¬¡ï¼‰&lt;/li>
&lt;li>å¦‚æœæŸä¸ªå­Viewè¿”å›trueï¼Œè®¾ç½®&lt;code>mFirstTouchTarget&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>MOVE/UPäº‹ä»¶&lt;/strong>:
&lt;ul>
&lt;li>&lt;code>mFirstTouchTarget != null&lt;/code>ï¼Œç›´æ¥è¿›å…¥åˆ†å‘æµç¨‹&lt;/li>
&lt;li>è°ƒç”¨&lt;code>target.child.dispatchTouchEvent(ev)&lt;/code>ï¼ˆç¬¬äºŒæ¬¡ï¼‰&lt;/li>
&lt;li>ä¸ä¼šå†æ¬¡è¿›å…¥å¯»æ‰¾ç›®æ ‡Viewçš„å¾ªç¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>TouchTarget&lt;/strong>
&lt;ul>
&lt;li>TouchTargetæ˜¯é“¾è¡¨ç»“æ„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ”¯æŒå¤šç‚¹è§¦æ§&lt;/li>
&lt;li>ä» &lt;code>mFirstTouchTarget&lt;/code> å¼€å§‹éå†é“¾è¡¨&lt;/li>
&lt;li>æ£€æŸ¥æ¯ä¸ª &lt;code>TouchTarget&lt;/code> çš„ &lt;code>pointerIdBits&lt;/code> æ˜¯å¦ä¸å½“å‰äº‹ä»¶çš„ &lt;code>desiredPointerIdBits&lt;/code> åŒ¹é…&lt;/li>
&lt;li>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„ &lt;code>TouchTarget&lt;/code>ï¼Œåˆ™å°†äº‹ä»¶åˆ†å‘ç»™å¯¹åº”çš„å­View&lt;/li>
&lt;li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ &lt;code>TouchTarget&lt;/code>ï¼Œåˆ™è¿”å›false&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h6 id="ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡">ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡
&lt;/h6>&lt;ol>
&lt;li>&lt;strong>æ€§èƒ½ä¼˜åŒ–&lt;/strong>ï¼šé¿å…æ¯æ¬¡äº‹ä»¶éƒ½éå†æ‰€æœ‰å­View&lt;/li>
&lt;li>&lt;strong>äº‹ä»¶ä¸€è‡´æ€§&lt;/strong>ï¼šç¡®ä¿åŒä¸€äº‹ä»¶åºåˆ—ç”±åŒä¸€Viewå¤„ç†&lt;/li>
&lt;li>&lt;strong>æ­£ç¡®æ€§&lt;/strong>ï¼šé˜²æ­¢äº‹ä»¶åºåˆ—è¢«æ‹†åˆ†åˆ°ä¸åŒViewå¤„ç†&lt;/li>
&lt;/ol>
&lt;h5 id="23-viewçš„dispatchtouchevent">2.3 Viewçš„dispatchTouchEvent
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">dispatchTouchEvent&lt;/span>(MotionEvent event) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. é¦–å…ˆæ£€æŸ¥OnTouchListener&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ListenerInfo li &lt;span style="color:#f92672">=&lt;/span> mListenerInfo;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (li &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> li.&lt;span style="color:#a6e22e">mOnTouchListener&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> (mViewFlags &lt;span style="color:#f92672">&amp;amp;&lt;/span> ENABLED_MASK) &lt;span style="color:#f92672">==&lt;/span> ENABLED
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> li.&lt;span style="color:#a6e22e">mOnTouchListener&lt;/span>.&lt;span style="color:#a6e22e">onTouch&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>, event)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. ç„¶åè°ƒç”¨onTouchEvent&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (onTouchEvent(event)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="3-äº‹ä»¶åˆ†å‘çš„å…³é”®ç‚¹">3. äº‹ä»¶åˆ†å‘çš„å…³é”®ç‚¹
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>äº‹ä»¶åºåˆ—&lt;/strong>ï¼šä»ACTION_DOWNå¼€å§‹ï¼Œåˆ°ACTION_UPæˆ–ACTION_CANCELç»“æŸçš„ä¸€äº›åˆ—äº‹ä»¶&lt;/li>
&lt;li>&lt;strong>äº‹ä»¶æ‹¦æˆª&lt;/strong>ï¼šViewGroupå¯ä»¥é€šè¿‡onIterceptTouchEventæ‹¦æˆªäº‹ä»¶&lt;/li>
&lt;li>&lt;strong>äº‹ä»¶æ¶ˆè´¹&lt;/strong>ï¼šViewå¯ä»¥é€šè¿‡onTouchEventæˆ–OnTouchListeneræ¶ˆè´¹äº‹ä»¶&lt;/li>
&lt;li>&lt;strong>äº‹ä»¶ä¼ é€’&lt;/strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹ä»¶ä¼šä»ä¸Šåˆ°ä¸‹ä¼ é€’ï¼Œç›´åˆ°è¢«æ¶ˆè´¹&lt;/li>
&lt;/ol>
&lt;h4 id="4-å¸¸è§é¢è¯•é¢˜">4. å¸¸è§é¢è¯•é¢˜
&lt;/h4>&lt;h5 id="41-äº‹ä»¶åˆ†å‘çš„æµç¨‹æ˜¯æ€æ ·çš„">4.1 äº‹ä»¶åˆ†å‘çš„æµç¨‹æ˜¯æ€æ ·çš„
&lt;/h5>&lt;ul>
&lt;li>ä»Activityçš„dispatchTouchEventå¼€å§‹&lt;/li>
&lt;li>ç»è¿‡Windowã€DecorViewã€ViewGroup&lt;/li>
&lt;li>æœ€ç»ˆåˆ°è¾¾å…·ä½“çš„View&lt;/li>
&lt;li>å¦‚æœæ²¡æœ‰ä»»ä½•Viewæ¶ˆè´¹äº‹ä»¶ï¼Œäº‹ä»¶ä¼šå›ä¼ åˆ°Activityçš„onTouchEvent&lt;/li>
&lt;/ul>
&lt;h5 id="42-ontouchå’Œontoucheventçš„åŒºåˆ«">4.2 onTouchå’ŒonTouchEventçš„åŒºåˆ«
&lt;/h5>&lt;ul>
&lt;li>onTouchæ˜¯View.OnTouchListeneræ¥å£ä¸­çš„æ–¹æ³•&lt;/li>
&lt;li>onTouchEventæ˜¯Viewçš„æ–¹æ³•&lt;/li>
&lt;li>onTouchçš„ä¼˜å…ˆçº§é«˜äºonTouchEvent&lt;/li>
&lt;li>å¦‚æœonTouchè¿”å›trueï¼Œåˆ™onTouchä¸ä¼šè¢«è°ƒç”¨&lt;/li>
&lt;/ul>
&lt;h5 id="43-å¦‚ä½•è§£å†³æ»‘åŠ¨å†²çª">4.3 å¦‚ä½•è§£å†³æ»‘åŠ¨å†²çª
&lt;/h5>&lt;ol>
&lt;li>å¤–éƒ¨æ‹¦æˆªæ³•ï¼šé‡å†™çˆ¶å®¹å™¨çš„onInterceptTouchEventæ–¹æ³•&lt;/li>
&lt;li>å†…éƒ¨æ‹¦æˆªæ³•ï¼š é‡å†™å­å…ƒç´ çš„dispatchTouchEventæ–¹æ³•ï¼Œç»“åˆrequestDisallowInterceptTouchEventæ–¹æ³•&lt;/li>
&lt;/ol>
&lt;h4 id="5-å®é™…åº”ç”¨ç¤ºä¾‹">5. å®é™…åº”ç”¨ç¤ºä¾‹
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è‡ªå®šä¹‰ViewGroupï¼Œå¤„ç†å·¦å³æ»‘åŠ¨å†²çª&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">CustomViewPager&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> ViewGroup {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">float&lt;/span> mLastX;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">float&lt;/span> mLastY;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">onInterceptTouchEvent&lt;/span>(MotionEvent ev) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> intercepted &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">float&lt;/span> x &lt;span style="color:#f92672">=&lt;/span> ev.&lt;span style="color:#a6e22e">getX&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">float&lt;/span> y &lt;span style="color:#f92672">=&lt;/span> ev.&lt;span style="color:#a6e22e">getY&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (ev.&lt;span style="color:#a6e22e">getAction&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> MotionEvent.&lt;span style="color:#a6e22e">ACTION_DOWN&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mLastX &lt;span style="color:#f92672">=&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mLastY &lt;span style="color:#f92672">=&lt;/span> y;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intercepted &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> MotionEvent.&lt;span style="color:#a6e22e">ACTION_MOVE&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">float&lt;/span> deltaX &lt;span style="color:#f92672">=&lt;/span> Math.&lt;span style="color:#a6e22e">abs&lt;/span>(x &lt;span style="color:#f92672">-&lt;/span> mLastX);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">float&lt;/span> deltaY &lt;span style="color:#f92672">=&lt;/span> Math.&lt;span style="color:#a6e22e">abs&lt;/span>(y &lt;span style="color:#f92672">-&lt;/span> mLastY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¨ªå‘æ»‘åŠ¨è·ç¦»å¤§äºçºµå‘æ»‘åŠ¨è·ç¦»æ—¶æ‹¦æˆªäº‹ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (deltaX &lt;span style="color:#f92672">&amp;gt;&lt;/span> deltaY) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intercepted &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intercepted &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> MotionEvent.&lt;span style="color:#a6e22e">ACTION_UP&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> intercepted &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mLastX &lt;span style="color:#f92672">=&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mLastY &lt;span style="color:#f92672">=&lt;/span> y;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> intercepted;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Reqwestæ¨¡å—æ¶æ„è§£æ</title><link>https://www.dust-zed.site/rust/reqwest/reqwest%E6%A8%A1%E5%9D%97%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90/</link><pubDate>Tue, 02 Sep 2025 16:42:46 +0800</pubDate><guid>https://www.dust-zed.site/rust/reqwest/reqwest%E6%A8%A1%E5%9D%97%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90/</guid><description>&lt;p>ä»é¡¶å±‚ç»“æ„æ¥ç†è§£reqwestçš„æ¨¡å—ç»„ç»‡ï¼š&lt;/p>
&lt;h4 id="æ ¸å¿ƒæ¨¡å—">æ ¸å¿ƒæ¨¡å—
&lt;/h4>&lt;h5 id="1-async_impl">1. async_impl/
&lt;/h5>&lt;ul>
&lt;li>å¼‚æ­¥HTTPå®¢æˆ·ç«¯å®ç°&lt;/li>
&lt;li>åŒ…å«&lt;code>Client&lt;/code>ã€&lt;code>Reqwest&lt;/code>ã€&lt;code>Response&lt;/code>ç­‰æ ¸å¿ƒç±»å‹&lt;/li>
&lt;li>åŸºäº&lt;code>hyper&lt;/code>åº“å®ç°&lt;/li>
&lt;/ul>
&lt;h5 id="2-blocking">2. blocking/
&lt;/h5>&lt;ul>
&lt;li>åŒæ­¥HTTPå®¢æˆ·ç«¯&lt;/li>
&lt;li>å†…éƒ¨ä½¿ç”¨&lt;code>std::thread&lt;/code>å°è£…å¼‚æ­¥è°ƒç”¨&lt;/li>
&lt;li>æä¾›é˜»å¡å¼API&lt;/li>
&lt;/ul>
&lt;h5 id="3-dns">3. dns/
&lt;/h5>&lt;ul>
&lt;li>DNSè§£æåŠŸèƒ½&lt;/li>
&lt;li>æ”¯æŒç³»ç»ŸDNSå’Œè‡ªå®šä¹‰è§£æå™¨&lt;/li>
&lt;li>åŒ…å«&lt;code>GaiResolver&lt;/code>ç­‰å®ç°&lt;/li>
&lt;/ul>
&lt;h5 id="4-proxy">4. proxy/
&lt;/h5>&lt;ul>
&lt;li>ä»£ç†æ”¯æŒ&lt;/li>
&lt;li>å¤„ç†HTTP/HTTPS/SOCKSä»£ç†&lt;/li>
&lt;li>ä»£ç†è‡ªåŠ¨å‘ç°å’Œè®¤è¯&lt;/li>
&lt;/ul>
&lt;h5 id="5-tls">5. tls
&lt;/h5>&lt;ul>
&lt;li>å®‰å…¨ä¼ è¾“å±‚å®ç°&lt;/li>
&lt;li>æ”¯æŒnative-tlså’Œrustls&lt;/li>
&lt;li>è¯ä¹¦å’Œèº«ä»½ç®¡ç†&lt;/li>
&lt;/ul>
&lt;h5 id="6-redirect">6. redirect/
&lt;/h5>&lt;ul>
&lt;li>é‡å®šå‘å¤„ç†&lt;/li>
&lt;li>æ”¯æŒè‡ªå®šä¹‰é‡å®šå‘ç­–ç•¥&lt;/li>
&lt;li>å¤„ç†3xxçŠ¶æ€ç &lt;/li>
&lt;/ul>
&lt;h5 id="7-wasm">7. wasm/
&lt;/h5>&lt;ul>
&lt;li>WebAssemblyå¹³å°ç‰¹å®šå®ç°&lt;/li>
&lt;li>ä½¿ç”¨æµè§ˆå™¨Fetch API&lt;/li>
&lt;li>é’ˆå¯¹Webç¯å¢ƒä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;h4 id="è¾…åŠ©æ¨¡å—">è¾…åŠ©æ¨¡å—
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>cookie/&lt;/strong> - Cookieç®¡ç†&lt;/li>
&lt;li>&lt;strong>multipart/&lt;/strong> - å¤šéƒ¨åˆ†è¡¨å•æ•°æ®å¤„ç†&lt;/li>
&lt;li>&lt;strong>retry/&lt;/strong> - è¯·æ±‚é‡è¯•æœºåˆ¶&lt;/li>
&lt;li>&lt;strong>util/&lt;/strong> - å·¥å…·å‡½æ•°å’Œè¾…åŠ©ç±»å‹&lt;/li>
&lt;/ul>
&lt;h4 id="ç‰¹æ€§å¼€å…³">ç‰¹æ€§å¼€å…³
&lt;/h4>&lt;p>é€šè¿‡Cargo featuresæ§åˆ¶åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>default-tls&lt;/code> - é»˜è®¤TLSå®ç°&lt;/li>
&lt;li>&lt;code>native-tls&lt;/code> - ä½¿ç”¨ç³»ç»ŸåŸç”ŸTLS&lt;/li>
&lt;li>&lt;code>rustls&lt;/code> - ä½¿ç”¨rustlsçº¯Rustå®ç°&lt;/li>
&lt;li>&lt;code>blocking&lt;/code> - å¯ç”¨åŒæ­¥API&lt;/li>
&lt;li>&lt;code>cookies&lt;/code> - Cookieæ”¯æŒ&lt;/li>
&lt;li>&lt;code>json&lt;/code> - JSONåºåˆ—åŒ–æ”¯æŒ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//lib.rs
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#[cfg(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;blocking&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">mod&lt;/span> blocking;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[cfg(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;cookies&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">mod&lt;/span> cookie;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ &lt;code>Cargo.toml&lt;/code> ä¸­é€šè¿‡ features æ§åˆ¶å“ªäº›å®ç°è¢«ç¼–è¯‘ã€‚&lt;/p></description></item><item><title>RustçŸ¥è¯†é—®ç­”</title><link>https://www.dust-zed.site/rust/rust%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94/</link><pubDate>Mon, 01 Sep 2025 17:16:28 +0800</pubDate><guid>https://www.dust-zed.site/rust/rust%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94/</guid><description>&lt;h5 id="ä¸ºä»€ä¹ˆfnonceåªèƒ½è°ƒç”¨ä¸€æ¬¡">ä¸ºä»€ä¹ˆFnOnceåªèƒ½è°ƒç”¨ä¸€æ¬¡
&lt;/h5>&lt;h6 id="æºç åˆ†æ">æºç åˆ†æ
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">trait&lt;/span> FnOnce&lt;span style="color:#f92672">&amp;lt;&lt;/span>Args&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">extern&lt;/span> &lt;span style="color:#e6db74">&amp;#34;rust-call&amp;#34;&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">call_once&lt;/span>(self, args: &lt;span style="color:#a6e22e">Args&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">Self&lt;/span>::Output;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>&lt;code>self&lt;/code>çš„å«ä¹‰
&lt;ul>
&lt;li>æ¥æ”¶å®ç°äº†&lt;code>FnOnce&lt;/code>çš„å…·ä½“ç±»å‹çš„å€¼&lt;/li>
&lt;li>è¿™ä¸ªå€¼ä¼šè¢«ç§»åŠ¨(move)è¿›æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h6 id="å…·ä½“ä¾‹å­">å…·ä½“ä¾‹å­
&lt;/h6>&lt;p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé—­åŒ…:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> s &lt;span style="color:#f92672">=&lt;/span> String::from(&lt;span style="color:#e6db74">&amp;#34;hello&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> f &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">||&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, s); &lt;span style="color:#75715e">// è·å– s çš„æ‰€æœ‰æƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> s.len()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“è¿™ä¸ªé—­åŒ…å®ç°&lt;code>FnOnce&lt;/code>æ—¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ç±»ä¼¼è¿™æ ·ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Closure&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s: String, &lt;span style="color:#75715e">// æ•è·çš„ç¯å¢ƒå˜é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> FnOnce&lt;span style="color:#f92672">&amp;lt;&lt;/span>()&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> Closure {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">usize&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">call_once&lt;/span>(self, _args: ()) -&amp;gt; &lt;span style="color:#66d9ef">usize&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, self.s);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.s.len()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="è°ƒç”¨ç¤ºä¾‹">è°ƒç”¨ç¤ºä¾‹
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> result &lt;span style="color:#f92672">=&lt;/span> f(); &lt;span style="color:#75715e">// ç­‰ä»·äº FnOnce::call_once(f, ())
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿™é‡Œä¸èƒ½å†è°ƒç”¨ f()ï¼Œå› ä¸º f å·²ç»è¢«ç§»åŠ¨
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€ç»ˆfæ‰€æœ‰æƒè¢«è½¬ç§»è¿›&lt;code>call_once&lt;/code>ï¼Œå¹¶éšç€call_onceçš„ç»“æŸè€Œ&lt;code>drop&lt;/code>äº†ï¼Œfè¢«é‡Šæ”¾äº†ï¼Œå†…éƒ¨æ•è·çš„æ‰€æœ‰æƒè‡ªç„¶ä¹Ÿè¢«é‡Šæ”¾ã€‚&lt;/p>
&lt;p>&lt;code>FnOnce&lt;/code>ã€&lt;code>FnMut&lt;/code>ã€&lt;code>Fn&lt;/code>è¿™äº›æ˜¯æ ¹æ®å¦‚ä½•æ•è·ç¯å¢ƒè€ŒåŒºåˆ†çš„ï¼Œå¹¶ä¸å½±å“å‡½æ•°ç­¾åï¼Œ&lt;code>FnMut&lt;/code>ä¹Ÿå¯ä»¥æ¥æ”¶&lt;strong>æ‰€æœ‰æƒå‚æ•°&lt;/strong>&lt;/p>
&lt;h5 id="ä»€ä¹ˆæ˜¯é›¶æˆæœ¬æŠ½è±¡">ä»€ä¹ˆæ˜¯é›¶æˆæœ¬æŠ½è±¡
&lt;/h5>&lt;p>é›¶æˆæœ¬æŠ½è±¡çš„æ ¸å¿ƒå°±æ˜¯ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç¼–è¯‘æœŸå®Œæˆå·¥ä½œ&lt;/strong>ï¼šç±»å‹æ£€æŸ¥ã€æ³›å‹å•æ€åŒ–ã€å†…è”ä¼˜åŒ–ç­‰åœ¨ç¼–è¯‘æ—¶å®Œæˆ&lt;/li>
&lt;li>&lt;strong>é›¶è¿è¡Œæ—¶å¼€é”€&lt;/strong>ï¼šä¸å¼•å…¥é¢å¤–çš„è¿è¡Œæ—¶æ£€æŸ¥æˆ–é—´æ¥è°ƒç”¨&lt;/li>
&lt;li>&lt;strong>æ— é¢å¤–å†…å­˜åˆ†é…&lt;/strong>ï¼šé¿å…ä¸å¿…è¦çš„å †åˆ†é…ï¼Œå°½å¯èƒ½ä½¿ç”¨æ ˆå†…å­˜&lt;/li>
&lt;li>&lt;strong>é€æ˜ä¼˜åŒ–&lt;/strong>ï¼šé«˜çº§æŠ½è±¡åœ¨ç¼–è¯‘åç”Ÿæˆçš„æœºå™¨ç ä¸æ‰‹å†™åº•å±‚ä»£ç ç›¸å½“&lt;/li>
&lt;/ol>
&lt;p>è¿™æ­£æ˜¯ Rust èƒ½åœ¨æä¾›é«˜çº§è¯­è¨€ç‰¹æ€§çš„åŒæ—¶ï¼Œä»èƒ½ä¿æŒä¸ C/C++ ç›¸åª²ç¾çš„æ€§èƒ½çš„å…³é”®æ‰€åœ¨ã€‚&lt;/p></description></item><item><title>æ–‡ä»¶ç³»ç»Ÿ</title><link>https://www.dust-zed.site/rust/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</link><pubDate>Mon, 01 Sep 2025 17:12:26 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</guid><description>&lt;h4 id="æ–‡ä»¶ç³»ç»Ÿ">æ–‡ä»¶ç³»ç»Ÿ
&lt;/h4>&lt;ul>
&lt;li>&lt;code>metadata&lt;/code>:æœ¬è´¨ä¸Šå°±æ˜¯æè¿°æ–‡ä»¶ä¿¡æ¯çš„æ•°æ®&lt;/li>
&lt;li>ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶
&lt;ul>
&lt;li>é…ç½®æ–‡ä»¶ï¼šå­˜å‚¨&lt;strong>é»˜è®¤é…ç½®&lt;/strong>æˆ–&lt;strong>é™æ€é…ç½®&lt;/strong>&lt;/li>
&lt;li>ç¯å¢ƒå˜é‡ï¼šæä¾›&lt;strong>åŠ¨æ€è¦†ç›–&lt;/strong>æˆ–&lt;strong>ç¯å¢ƒç‰¹å®šé…ç½®&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>æŒ‚è½½ï¼ˆMountï¼‰&lt;/strong>ï¼š å°†&lt;strong>å­˜å‚¨è®¾å¤‡&lt;/strong>æˆ–&lt;strong>æ–‡ä»¶ç³»ç»Ÿ&lt;/strong>è¿æ¥åˆ°æ“ä½œç³»ç»Ÿç›®å½•æ ‘ä¸­ç‰¹å®šä½ç½®çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿æ¥ç‚¹ç§°ä¸º&lt;strong>æŒ‚è½½ç‚¹ï¼ˆMount Pointï¼‰&lt;/strong>ã€‚ç±»æ¯”é—¨å’Œä»“åº“çš„å…³ç³»ã€‚&lt;/li>
&lt;li>æ–‡ä»¶è®¾å¤‡å·&lt;/li>
&lt;/ul></description></item><item><title>æ¶æ„è®¾è®¡</title><link>https://www.dust-zed.site/rust/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/</link><pubDate>Mon, 01 Sep 2025 17:05:55 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/</guid><description>&lt;h4 id="å¦‚ä½•åšå¥½èŒè´£åˆ†ç¦»">å¦‚ä½•åšå¥½èŒè´£åˆ†ç¦»
&lt;/h4>&lt;ul>
&lt;li>ä»â€œæ€ä¹ˆå®ç°â€åˆ°â€œæ€ä¹ˆç»„åˆâ€
&lt;ul>
&lt;li>ä¸€ä½“å¼æ€ç»´ï¼šå†™ä¸€ä¸ªå‡½æ•°å®Œæˆæ‰€æœ‰åŠŸèƒ½&lt;/li>
&lt;li>åˆ†ç¦»å¼æ€ç»´ï¼šè¦è®¾è®¡å‡ ä¸ªç»„ä»¶ï¼Œç„¶åç»„åˆå®ƒä»¬å®ç°åŠŸèƒ½&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä»â€œåŠŸèƒ½ä¼˜å…ˆâ€åˆ°â€œæµ‹è¯•ä¼˜å…ˆâ€
&lt;ul>
&lt;li>ä¸€ä½“å¼æ€ç»´ï¼šå…ˆå®ç°åŠŸèƒ½ï¼Œå†è€ƒè™‘æµ‹è¯•&lt;/li>
&lt;li>åˆ†ç¦»å¼æ€ç»´ï¼šå…ˆè€ƒè™‘æ€ä¹ˆæµ‹è¯•ï¼Œå€’æ¨å‡ºèŒè´£åˆ†ç¦»&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>ripgrep&lt;/code>çš„åˆ†ç¦»å¼æ¶æ„
&lt;ul>
&lt;li>cliå‚æ•° â†’ &lt;code>LowArgs&lt;/code> â†’ &lt;code>HiArgs&lt;/code>&lt;/li>
&lt;li>æœç´¢ç›®æ ‡ï¼šåˆ†ä¸ºæ–‡ä»¶å‘ç°å’Œç›®æ ‡æœç´¢&lt;/li>
&lt;li>æ–‡ä»¶éå†å†æ¬¡åˆ†ç¦»ï¼šWalkDirï¼ˆè´Ÿè´£ç›®å½•æ ‘å½¢ç»“æ„è½¬ä¸ºçº¿æ€§çš„Iterï¼‰â†’ WalkEventDirï¼ˆè´Ÿè´£å‘é€äº‹ä»¶ï¼‰â†’ Walkï¼ˆæ·»åŠ å¿½ç•¥è§„åˆ™ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr></description></item><item><title>è¯­æ³•é€ŸæŸ¥</title><link>https://www.dust-zed.site/rust/%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5/</link><pubDate>Mon, 01 Sep 2025 16:22:39 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5/</guid><description>&lt;h4 id="é›†åˆæˆ–è¿­ä»£å™¨">é›†åˆæˆ–è¿­ä»£å™¨
&lt;/h4>&lt;ul>
&lt;li>&lt;code>drain()&lt;/code>æ–¹æ³•ï¼šæ ¸å¿ƒåŠŸèƒ½æ˜¯ç§»é™¤é›†åˆä¸­æŒ‡å®šèŒƒå›´çš„å…ƒç´ ï¼ŒåŒæ—¶ä¿æŒé›†åˆçš„è¿ç»­æ€§ï¼Œæ˜¯ä¸€ç§æ¯”**å¤šæ¬¡è°ƒç”¨remove()**æ›´é«˜æ•ˆçš„æ‰¹é‡å¤„ç†æ–¹å¼&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="æ‰€æœ‰æƒ">æ‰€æœ‰æƒ
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>æ‰€æœ‰æƒ&lt;/strong>å’Œ&lt;strong>å¯å˜æ€§&lt;/strong>æ˜¯ç‹¬ç«‹çš„&lt;/li>
&lt;li>&lt;strong>æ‰€æœ‰æƒå®Œæ•´æ€§&lt;/strong>ä¿æŠ¤é’ˆå¯¹é›†åˆ
&lt;ul>
&lt;li>é›†åˆéœ€è¦ä¿è¯æ‰€æœ‰å…ƒç´ ä½ç½®æœ‰æ•ˆ&lt;/li>
&lt;li>é›†åˆåœ¨å†…å­˜ä¸­æ˜¯è¿ç»­çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç»“æ„ä½“å…è®¸&lt;strong>å­—æ®µè¢«è½¬ç§»èµ°æ‰€æœ‰æƒ&lt;/strong>
&lt;ul>
&lt;li>ç»“æ„ä½“å­—æ®µå…·æœ‰ç‹¬ç«‹æ€§ï¼Œå¸ƒå±€åœ¨ç¼–è¯‘æ—¶å¯çŸ¥&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸï¼Œå€¼å°†è¢«ä¸¢å¼ƒ&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="å˜é‡å’Œç±»å‹">å˜é‡å’Œç±»å‹
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>&lt;code>ref&lt;/code>å’Œ&lt;code>&amp;amp;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&amp;amp;ç”¨äºåˆ›å»ºå¼•ç”¨&lt;/li>
&lt;li>&amp;amp;ç”¨äºæ¨¡å¼åŒ¹é…æ—¶ï¼Œè¡Œä½¿çš„æ˜¯è§£æ„æ“ä½œï¼ˆä¸€èˆ¬ä½œç”¨æ˜¯éšå¼è§£å¼•ç”¨ï¼‰&lt;/li>
&lt;li>refç”¨äºæ¨¡å¼åŒ¹é…ï¼Œè·å–å¼•ç”¨è€Œä¸æ˜¯è·å–æ‰€æœ‰æƒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>'a : 'b&lt;/code>è¡¨ç¤º &lt;code>'a&lt;/code> &amp;gt;= &lt;code>'b&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>T: 'static&lt;/code>:è¡¨ç¤ºç±»å‹&lt;strong>Tå†…éƒ¨å­—æ®µ&lt;/strong>è¦ä¹ˆæ²¡æœ‰å¼•ç”¨ï¼Œè¦ä¹ˆå¼•ç”¨éƒ½æ˜¯&lt;code>'static&lt;/code>çš„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>trait My Trait: 'static&lt;/code>æˆ–&lt;code>Box&amp;lt;dyn MyTrait + 'static&amp;gt;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å®ç°ç±»å‹&lt;/strong>å¿…é¡»æ»¡è¶³ï¼š&lt;code>Self: 'static&lt;/code>æˆ–è€…æ²¡æœ‰å¼•ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>(PathBuf, Path)&lt;/code>ã€&lt;code>(String, str)&lt;/code>å’Œ&lt;code>(BytesMut/Vec&amp;lt;u8&amp;gt;, &amp;amp;[u8]&lt;/code>&lt;/p>
&lt;ul>
&lt;li>Pathï¼Œstréƒ½æ˜¯DSTç±»å‹&lt;/li>
&lt;li>PathBufå’ŒStringéƒ½æ˜¯æ‹¥æœ‰æ‰€æœ‰æƒçš„&lt;/li>
&lt;li>æ–‡ä»¶è·¯å¾„é•¿åº¦å’Œå­—ç¬¦ä¸²é•¿åº¦åœ¨ç¼–è¯‘æ—¶æœªçŸ¥&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>&amp;amp;buf&lt;/code>å’Œ&lt;code>&amp;amp;buf[..]&lt;/code>çš„åŒºåˆ«&lt;/p>
&lt;ul>
&lt;li>&lt;code>&amp;amp;buf&lt;/code>è·å–æ•´ä¸ªæ•°ç»„çš„å¼•ç”¨ï¼Œç±»å‹æ˜¯&lt;code>&amp;amp;[u8; N]&lt;/code>æˆ–&lt;code>&amp;amp;Vec&amp;lt;u8&amp;gt;&lt;/code>ï¼ˆå›ºå®šå¤§å°æ•°ç»„ï¼‰&lt;/li>
&lt;li>&lt;code>&amp;amp;buf[..]&lt;/code>è·å–æ•°ç»„çš„åˆ‡ç‰‡å¼•ç”¨ï¼Œç±»å‹æ˜¯&lt;code>&amp;amp;[u8]&lt;/code>ï¼ˆåŠ¨æ€å¤§å°åˆ‡ç‰‡ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æ ¼å¼åŒ–è¾“å‡ºè¯­æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>{[&lt;span style="color:#960050;background-color:#1e0010">å‚æ•°ç´¢å¼•&lt;/span>]:[&lt;span style="color:#960050;background-color:#1e0010">å¡«å……å­—ç¬¦&lt;/span>][&lt;span style="color:#960050;background-color:#1e0010">å¯¹é½æ–¹å¼&lt;/span>][&lt;span style="color:#960050;background-color:#1e0010">å®½åº¦&lt;/span>][.&lt;span style="color:#960050;background-color:#1e0010">ç²¾åº¦&lt;/span>][&lt;span style="color:#960050;background-color:#1e0010">ç±»å‹&lt;/span>]}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>fmt::Formatter&lt;/code>æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ ¼å¼åŒ–ç¼“å†²åŒºï¼Œå¯ä»¥è¾“å‡ºåˆ°å­—ç¬¦ä¸²ã€stdoutã€æ–‡ä»¶ç­‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="ç»“æ„ä½“">ç»“æ„ä½“
&lt;/h4>&lt;ul>
&lt;li>Rustä¸å…è®¸å°†structä¸­æŸä¸ªå­—æ®µæ ‡è®°ä¸ºå¯å˜&lt;/li>
&lt;li>Rustä¸­æºæ–‡ä»¶ï¼ˆ&lt;code>.rs&lt;/code>ï¼‰éšæ€§çš„è§†ä¸ºä¸€ä¸ªæ¨¡å—ï¼ŒåŒºåˆ«äº&lt;code>mod&lt;/code>çš„æ˜¾å¼å£°æ˜&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="é—­åŒ…">é—­åŒ…
&lt;/h4>&lt;ul>
&lt;li>æ ¹æ®é—­åŒ…æ•è·ç¯å¢ƒæ–¹å¼å¯åˆ†ä¸ºä¸‰ç§ï¼Œæ³¨æ„åŒºåˆ†é—­åŒ… &lt;strong>æ•è·çš„ç¯å¢ƒå˜é‡&lt;/strong>å’Œ&lt;strong>é—­åŒ…çš„å‚æ•°&lt;/strong>
&lt;ul>
&lt;li>&lt;code>FnOnce&lt;/code>è·å–æ‰€æœ‰æƒ&lt;/li>
&lt;li>&lt;code>FnMut&lt;/code>è·å–å¯å˜å¼•ç”¨&lt;/li>
&lt;li>&lt;code>Fn&lt;/code>è·å–ä¸å¯å˜å¼•ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="å¹¶å‘ç¼–ç¨‹">å¹¶å‘ç¼–ç¨‹
&lt;/h4>&lt;ul>
&lt;li>å¹¶å‘ç¼–ç¨‹ä¸»è¦æœ‰ä¸¤ç§æ ¸å¿ƒèŒƒå¼ï¼š&lt;strong>å…±äº«çŠ¶æ€å¹¶å‘&lt;/strong>å’Œ&lt;strong>æ¶ˆæ¯ä¼ é€’å¹¶å‘&lt;/strong>&lt;/li>
&lt;li>&lt;code>std::thread::scope&lt;/code>
&lt;ul>
&lt;li>ç›¸å½“äº&lt;code>thread::spwan&lt;/code> + &lt;code>thread::join&lt;/code>ï¼Œä½†æ˜¯å®ƒä»¬åªèƒ½å€Ÿç”¨&lt;code>'static&lt;/code>æˆ–è€…&lt;code>move&lt;/code>å˜é‡&lt;/li>
&lt;li>&lt;code>scope&lt;/code>æ²¡æœ‰ä»¥ä¸Šé™åˆ¶ï¼Œæœ‰ç¼–è¯‘å™¨çš„æ”¯æŒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Mutex&lt;/code>å’Œ&lt;code>MutexGuard&lt;/code>
&lt;ul>
&lt;li>&lt;code>Mutex&lt;/code>æ˜¯äº’æ–¥é”æœ¬èº«&lt;/li>
&lt;li>&lt;code>MutexGuard&lt;/code>æŒ‡è®¿é—®å—äº’æ–¥é”ä¿æŠ¤æ•°æ®çš„â€œè®¸å¯è¯â€æˆ–â€œé’¥åŒ™â€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>park()/unpark&lt;/code>å’Œ&lt;code>sleep()&lt;/code>
&lt;ul>
&lt;li>&lt;code>park()/unpark()&lt;/code>ç²¾å‡†çš„æ§åˆ¶çº¿ç¨‹çš„ç¡çœ ï¼ˆparkï¼‰ä¸å”¤é†’ï¼ˆunparkï¼‰&lt;/li>
&lt;li>&lt;code>sleep()&lt;/code>åŸºäºæ—¶é—´è‡ªåŠ¨å”¤é†’ï¼Œæ— æ³•æå‰å”¤é†’&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>Option</title><link>https://www.dust-zed.site/rust/std/option/</link><pubDate>Mon, 01 Sep 2025 10:59:09 +0800</pubDate><guid>https://www.dust-zed.site/rust/std/option/</guid><description>&lt;p>æ ‡å‡†åº“&lt;code>Option&lt;/code>æºç å­¦ä¹ &lt;/p>
&lt;h4 id="åŸºç¡€ç»“æ„">åŸºç¡€ç»“æ„
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[derive(Copy, PartialEq, PartialOrd, Eq, Ord, Debug, Hash)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[rustc_diagnostic_item = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;Option&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">enum&lt;/span> Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// No value
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#75715e">#[lang = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;None&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Some value `T`
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#75715e">#[lang = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;Some&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span> T),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>&lt;code>#[lang = &amp;quot;...&amp;quot;]&lt;/code>å±æ€§è¡¨ç¤ºè¿™æ˜¯è¯­è¨€é¡¹&lt;/li>
&lt;li>æ³›å‹å‚æ•°Tæ”¯æŒä»»ä½•ç±»å‹&lt;/li>
&lt;li>è‡ªåŠ¨æ´¾ç”Ÿå¤šä¸ªtrait(&lt;code>Copy&lt;/code>ï¼Œ&lt;code>PartialEq&lt;/code>ç­‰)&lt;/li>
&lt;/ul>
&lt;h4 id="2-æ ¸å¿ƒæ–¹æ³•mapå’Œmap_or">2. æ ¸å¿ƒæ–¹æ³•:&lt;code>map&lt;/code>å’Œ&lt;code>map_or&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">map&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; &lt;span style="color:#a6e22e">U&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, f: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Some(f(x)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">map_or&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; &lt;span style="color:#a6e22e">U&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, default: &lt;span style="color:#a6e22e">U&lt;/span>, f: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">U&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(t) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> f(t),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> default,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-1">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>mapä¿ç•™Some/Noneç»“æ„&lt;/li>
&lt;li>map_oræä¾›é»˜è®¤å€¼&lt;/li>
&lt;li>ä½¿ç”¨FnOnceå› ä¸ºé—­åŒ…æœ€å¤šè¢«è°ƒç”¨ä¸€æ¬¡&lt;/li>
&lt;/ul>
&lt;h4 id="3è§£å¼•ç”¨å®ç°">3.è§£å¼•ç”¨å®ç°
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T: &lt;span style="color:#a6e22e">Deref&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> Deref &lt;span style="color:#66d9ef">for&lt;/span> Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Target&lt;/span> &lt;span style="color:#f92672">=&lt;/span> Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T::Target&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">deref&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Self&lt;/span>::Target {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(t) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Some(t.deref()),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-2">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>ä¸º&lt;code>Option&amp;lt;Box&amp;lt;T&amp;gt;&amp;gt;&lt;/code>ç­‰ç±»å‹æä¾›è‡ªåŠ¨è§£å¼•ç”¨&lt;/li>
&lt;li>å®ç°&lt;code>Deref&lt;/code>è€Œä¸æ˜¯ç›´æ¥å®ç°æ–¹æ³•ï¼Œä¿æŒä¸€è‡´æ€§&lt;/li>
&lt;/ul>
&lt;h4 id="4-and_thenå’Œor_else">4. &lt;code>and_then&lt;/code>å’Œ&lt;code>or_else&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">and_then&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>(self, f: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> f(x),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">or_else&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>F: FnOnce() -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>(self, f: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Some(x),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> f(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-3">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>&lt;code>and_then&lt;/code>ç”¨äºé“¾å¼æ“ä½œ&lt;/li>
&lt;li>&lt;code>or_else&lt;/code>æä¾›å›é€€é€»è¾‘&lt;/li>
&lt;li>é—­åŒ…&lt;code>F&lt;/code>åªåœ¨éœ€è¦æ—¶è°ƒç”¨&lt;/li>
&lt;/ul>
&lt;h4 id="5-transposeæ–¹æ³•">5. &lt;code>transpose&lt;/code>æ–¹æ³•
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;transpose_result&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.33.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">transpose&lt;/span>(self) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Ok(ok)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(Some(ok)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Err(err)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Err(err),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(None),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-4">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>åœ¨&lt;code>Option&lt;/code>å’Œ&lt;code>Result&lt;/code>ä¹‹é—´è½¬æ¢&lt;/li>
&lt;li>ä¿æŒé”™è¯¯ä¼ æ’­è¯­ä¹‰&lt;/li>
&lt;/ul>
&lt;h4 id="6-zipå’Œzip_with">6. &lt;code>zip&lt;/code>å’Œ&lt;code>zip_with&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;option_zip_option&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.46.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">zip&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, other: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>(T, U)&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> (self, other) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (Some(a), Some(b)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Some((a, b)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _ &lt;span style="color:#f92672">=&amp;gt;&lt;/span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[unstable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;option_zip&amp;#34;&lt;/span>&lt;span style="color:#75715e">, issue = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;70086&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">zip_with&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>(self, f: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> f(x),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-5">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>&lt;code>zip&lt;/code>ç»„åˆä¸¤ä¸ª&lt;code>Option&lt;/code>å€¼&lt;/li>
&lt;li>&lt;code>zip_with&lt;/code>æä¾›æ›´çµæ´»çš„è½¬æ¢&lt;/li>
&lt;li>ä½¿ç”¨å…ƒç»„æ¨¡å¼åŒ¹é…å¤„ç†ç»„åˆé€»è¾‘&lt;/li>
&lt;/ul>
&lt;h4 id="7-æ€§èƒ½ä¼˜åŒ–optiont">7. æ€§èƒ½ä¼˜åŒ–ï¼š&lt;code>Option&amp;lt;&amp;amp;T&amp;gt;&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¼–è¯‘å™¨å¯¹ Option&amp;lt;&amp;amp;T&amp;gt; æœ‰ç‰¹æ®Šä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// size_of::&amp;lt;Option&amp;lt;&amp;amp;T&amp;gt;&amp;gt;() == size_of::&amp;lt;&amp;amp;T&amp;gt;()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> Option&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">copied&lt;/span>(self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">where&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T: Copy,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.map(&lt;span style="color:#f92672">|&amp;amp;&lt;/span>t&lt;span style="color:#f92672">|&lt;/span> t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">cloned&lt;/span>(self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">where&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T: Clone,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.map(&lt;span style="color:#f92672">|&lt;/span>t&lt;span style="color:#f92672">|&lt;/span> t.clone())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-6">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>é›¶æˆæœ¬æŠ½è±¡&lt;/li>
&lt;li>ä¸ºå¼•ç”¨ç±»å‹æä¾›ç‰¹åŒ–å®ç°&lt;/li>
&lt;li>&lt;code>Copy&lt;/code>å’Œ&lt;code>Clone&lt;/code>çš„åŒºåˆ«å¤„ç†&lt;/li>
&lt;/ul></description></item><item><title>Result</title><link>https://www.dust-zed.site/rust/std/result/</link><pubDate>Mon, 01 Sep 2025 10:21:06 +0800</pubDate><guid>https://www.dust-zed.site/rust/std/result/</guid><description>&lt;p>æ ‡å‡†åº“çš„&lt;code>Result&lt;/code>æºç å­¦ä¹ ã€‚&lt;/p>
&lt;h4 id="1-åŸºç¡€ç»“æ„">1. åŸºç¡€ç»“æ„
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[must_use = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;this `Result` may be an `Err` variant, which should be handled&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">enum&lt;/span> Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Contains the success value
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#75715e">#[lang = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;Ok&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span> T),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Contains the error value
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#75715e">#[lang = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;Err&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span> E),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>&lt;code>#[must_use]&lt;/code>å±æ€§ç¡®ä¿å¼€å‘è€…å¿…é¡»å¤„ç†å¯èƒ½çš„é”™è¯¯&lt;/li>
&lt;li>ä½¿ç”¨æ³›å‹&lt;code>T&lt;/code>å’Œ&lt;code>E&lt;/code>æ”¯æŒä»»ä½•ç±»å‹&lt;/li>
&lt;li>&lt;code>#[lang]&lt;/code>å±æ€§è¡¨ç¤ºè¿™æ˜¯è¯­è¨€é¡¹(lang item)&lt;/li>
&lt;/ul>
&lt;h4 id="2-åŸºç¡€æ–¹æ³•is_okå’Œis_err">2. åŸºç¡€æ–¹æ³•ï¼š&lt;code>is_ok&lt;/code>å’Œ&lt;code>is_err&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_ok&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">matches!&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>self, Ok(_))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-1">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>&lt;code>#[inline]&lt;/code>æç¤ºç¼–è¯‘å™¨å†…è”ä¼˜åŒ–&lt;/li>
&lt;li>&lt;code>const fn&lt;/code> è¡¨ç¤ºç¼–è¯‘æœŸå¯æ±‚å€¼&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>matches!&lt;/code>å®è¿›è¡Œæ¨¡å¼åŒ¹é…&lt;/li>
&lt;/ul>
&lt;h4 id="3-æ‰€æœ‰æƒç®¡ç†as_ref">3. æ‰€æœ‰æƒç®¡ç†ï¼š&lt;code>as_ref&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">as_ref&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>T, &lt;span style="color:#f92672">&amp;amp;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> &lt;span style="color:#f92672">*&lt;/span>self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(&lt;span style="color:#66d9ef">ref&lt;/span> x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(x),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(&lt;span style="color:#66d9ef">ref&lt;/span> x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Err(x),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-2">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>è¿”å›å¼•ç”¨é¿å…æ‰€æœ‰æƒè½¬ç§»&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>ref&lt;/code>æ¨¡å¼åŒ¹é…è·å–å¼•ç”¨&lt;/li>
&lt;li>ä¿æŒåŸå§‹&lt;code>Result&lt;/code>ä¸å˜&lt;/li>
&lt;/ul>
&lt;h4 id="4-ç»„åˆå­map">4. ç»„åˆå­ï¼š&lt;code>map&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">map&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; &lt;span style="color:#a6e22e">U&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, op: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(t) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(op(t)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(e) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Err(e),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-3">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>é«˜é˜¶å‡½æ•°çš„ä½¿ç”¨&lt;/li>
&lt;li>&lt;code>FnOnce&lt;/code> trait boundå…è®¸æ¶ˆè´¹å€¼çš„é—­åŒ…&lt;/li>
&lt;li>æ¨¡å¼åŒ¹é…è§£æ„&lt;code>self&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="5-é“¾å¼è°ƒç”¨and_then">5. é“¾å¼è°ƒç”¨ï¼š&lt;code>and_then&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">and_then&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, E&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>(self, op: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(t) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> op(t),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(e) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Err(e),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-4">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>é”™è¯¯ä¼ æ’­æ¨¡å¼&lt;/li>
&lt;li>é—­åŒ…ä½œä¸ºå‚æ•°&lt;/li>
&lt;li>ç»„åˆæ“ä½œçš„ä¼˜é›…æ–¹å¼&lt;/li>
&lt;/ul>
&lt;h4 id="6-æ“ä½œç¬¦">6. &lt;code>?&lt;/code>æ“ä½œç¬¦
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[unstable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;try_trait_v2&amp;#34;&lt;/span>&lt;span style="color:#75715e">, issue = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;84277&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[rustc_const_unstable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;const_convert&amp;#34;&lt;/span>&lt;span style="color:#75715e">, issue = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;88674&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> ops::Try &lt;span style="color:#66d9ef">for&lt;/span> Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> T;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Residual&lt;/span> &lt;span style="color:#f92672">=&lt;/span> Result&lt;span style="color:#f92672">&amp;lt;!&lt;/span>, E&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">from_output&lt;/span>(output: &lt;span style="color:#a6e22e">Self&lt;/span>::Output) -&amp;gt; &lt;span style="color:#a6e22e">Self&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(output)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">branch&lt;/span>(self) -&amp;gt; &lt;span style="color:#a6e22e">ControlFlow&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Self::Residual, Self::Output&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(v) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> ControlFlow::Continue(v),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(e) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> ControlFlow::Break(Err(e)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-5">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>æ“ä½œç¬¦é‡è½½&lt;/li>
&lt;li>æ§åˆ¶æµæŠ½è±¡&lt;/li>
&lt;li>ç¼–è¯‘å™¨é­”æ³•èƒŒåçš„å®ç°&lt;/li>
&lt;/ul>
&lt;h4 id="7-è¿­ä»£å™¨é›†æˆ">7. è¿­ä»£å™¨é›†æˆ
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> IntoIterator &lt;span style="color:#66d9ef">for&lt;/span> Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Item&lt;/span> &lt;span style="color:#f92672">=&lt;/span> T;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">IntoIter&lt;/span> &lt;span style="color:#f92672">=&lt;/span> IntoIter&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">into_iter&lt;/span>(self) -&amp;gt; &lt;span style="color:#a6e22e">IntoIter&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> IntoIter { inner: &lt;span style="color:#a6e22e">self&lt;/span>.ok() }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-6">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>è¿­ä»£å™¨æ¨¡å¼&lt;/li>
&lt;li>ç±»å‹è½¬æ¢&lt;/li>
&lt;li>é›¶æˆæœ¬æŠ½è±¡&lt;/li>
&lt;/ul></description></item><item><title>ripgrepçš„å®Œæ•´æ¶æ„</title><link>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84%E5%AE%8C%E6%95%B4%E6%9E%B6%E6%9E%84/</link><pubDate>Wed, 27 Aug 2025 10:28:07 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84%E5%AE%8C%E6%95%B4%E6%9E%B6%E6%9E%84/</guid><description>&lt;h3 id="å®Œæ•´çš„æ•°æ®æµ">å®Œæ•´çš„æ•°æ®æµ
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">å‘½ä»¤è¡Œå‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (parse.rs, defs.rs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">ç»“æ„åŒ–é…ç½®&lt;/span> (HiArgs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (hiargs.rs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">æ‰§è¡Œç»„ä»¶æ„å»º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> WalkBuilder (&lt;span style="color:#960050;background-color:#1e0010">æ–‡ä»¶å‘ç°&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> SearchWorker (&lt;span style="color:#960050;background-color:#1e0010">å†…å®¹æœç´¢&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> Printer (&lt;span style="color:#960050;background-color:#1e0010">ç»“æœè¾“å‡º&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">å¹¶è¡Œæ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (WalkParallel &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å·¥ä½œçªƒå–é˜Ÿåˆ—&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">æ–‡ä»¶å‘ç°æµ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (ignore &lt;span style="color:#960050;background-color:#1e0010">è§„åˆ™è¿‡æ»¤&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Haystack &lt;span style="color:#960050;background-color:#1e0010">æµ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (Searcher &lt;span style="color:#960050;background-color:#1e0010">ç­–ç•¥é€‰æ‹©&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">æœç´¢ç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (Printer &lt;span style="color:#960050;background-color:#1e0010">æ ¼å¼åŒ–&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">ç”¨æˆ·è¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ–‡ä»¶å‘ç°ä¸æ–‡ä»¶æœç´¢">æ–‡ä»¶å‘ç°ä¸æ–‡ä»¶æœç´¢
&lt;/h3>&lt;h5 id="å•çº¿ç¨‹æ¨¡å¼">å•çº¿ç¨‹æ¨¡å¼ï¼š
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ–‡ä»¶å‘ç°é˜¶æ®µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> unsorted &lt;span style="color:#f92672">=&lt;/span> args.walk_builder()&lt;span style="color:#f92672">?&lt;/span>.build()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .filter_map(&lt;span style="color:#f92672">|&lt;/span>result&lt;span style="color:#f92672">|&lt;/span> haystack_builder.build_from_result(result));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> haystacks &lt;span style="color:#f92672">=&lt;/span> args.sort(unsorted);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æœç´¢é˜¶æ®µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">for&lt;/span> haystack &lt;span style="color:#66d9ef">in&lt;/span> haystacks {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> search_result &lt;span style="color:#f92672">=&lt;/span> searcher.search(&lt;span style="color:#f92672">&amp;amp;&lt;/span>haystack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å¹¶è¡Œæ¨¡å¼">å¹¶è¡Œæ¨¡å¼
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>args.walk_builder()&lt;span style="color:#f92672">?&lt;/span>.build_parallel().run(&lt;span style="color:#f92672">||&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Box::new(&lt;span style="color:#66d9ef">move&lt;/span> &lt;span style="color:#f92672">|&lt;/span>result&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> haystack &lt;span style="color:#f92672">=&lt;/span> haystack_builder.build_from_result(result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> search_result &lt;span style="color:#f92672">=&lt;/span> searcher.search(&lt;span style="color:#f92672">&amp;amp;&lt;/span>haystack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ç¼“å†²æœºåˆ¶åˆ†æ">ç¼“å†²æœºåˆ¶åˆ†æ
&lt;/h4>&lt;h5 id="å•çº¿ç¨‹æ¨¡å¼-1">å•çº¿ç¨‹æ¨¡å¼
&lt;/h5>&lt;ul>
&lt;li>å®Œæ•´ç¼“å†²ï¼šæ‰€æœ‰æ–‡ä»¶å…ˆå‘ç°å®Œæ¯•ï¼Œå­˜å‚¨åœ¨haystacksé›†åˆä¸­&lt;/li>
&lt;li>æ’åºæ”¯æŒï¼šæ”¯æŒ &amp;ndash;sorté€‰é¡¹ï¼Œå› ä¸ºæœ‰å®Œæ•´çš„æ–‡ä»¶åˆ—è¡¨&lt;/li>
&lt;li>å†…å­˜ä½¿ç”¨ï¼šæ–‡ä»¶è·¯å¾„å…¨éƒ¨åœ¨å†…å­˜ä¸­&lt;/li>
&lt;/ul>
&lt;h5 id="å¹¶è¡Œæ¨¡å¼-1">å¹¶è¡Œæ¨¡å¼
&lt;/h5>&lt;ul>
&lt;li>æµå¼å¤„ç†ï¼š æ–‡ä»¶å‘ç°å’Œæœç´¢åŒæ—¶è¿›è¡Œ&lt;/li>
&lt;li>æ— ç¼“å†²ï¼š æ²¡å‘ç°ä¸€ä¸ªæ–‡ä»¶ç«‹å³æœç´¢ï¼Œä¸ç­‰å¾…å…¶ä»–æ–‡ä»¶&lt;/li>
&lt;li>å·¥ä½œçªƒå–ï¼š å¤šä¸ªçº¿ç¨‹&lt;strong>å¹¶è¡Œå‘ç°&lt;/strong>å’Œ&lt;strong>æœç´¢æ–‡ä»¶&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h4 id="æœç´¢å†…éƒ¨çš„ç¼“å†²æœºåˆ¶">æœç´¢å†…éƒ¨çš„ç¼“å†²æœºåˆ¶
&lt;/h4>&lt;p>åœ¨&lt;code>Searcher&lt;/code>å†…éƒ¨æœ‰å¤šç§ç¼“å†²ç­–ç•¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Searcher&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> line_buffer: &lt;span style="color:#a6e22e">RefCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>LineBuffer&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> multi_line_buffer: &lt;span style="color:#a6e22e">RefCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u8&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> decode_buffer: &lt;span style="color:#a6e22e">RefCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u8&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ä¸‰ç§æœç´¢ç­–ç•¥">ä¸‰ç§æœç´¢ç­–ç•¥
&lt;/h5>&lt;ol>
&lt;li>å†…å­˜æ˜ å°„ï¼šé›¶æ‹·è´ï¼Œç›´æ¥è®¿é—®æ–‡ä»¶å†…å®¹&lt;/li>
&lt;li>æµå¼è¯»å–ï¼šå›ºå®šå¤§å°ç¼“å†²åŒºï¼Œé€è¡Œå¤„ç†&lt;/li>
&lt;li>å…¨æ–‡ç¼“å†²ï¼šå¤šè¡Œæœç´¢æ—¶ï¼Œæ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜&lt;/li>
&lt;/ol>
&lt;h5 id="å…³é”®è®¾è®¡å†³ç­–">å…³é”®è®¾è®¡å†³ç­–
&lt;/h5>&lt;h6 id="ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡">ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡
&lt;/h6>&lt;ol>
&lt;li>æ€§èƒ½ä¼˜åŒ–ï¼šå¹¶è¡Œæ¨¡å¼é¿å…äº†æ–‡ä»¶åˆ—è¡¨çš„å†…å­˜å¼€é”€&lt;/li>
&lt;li>å†…å­˜æ§åˆ¶ï¼šæµå¼å¤„ç†æ”¯æŒä»»æ„å¤§å°çš„æ–‡ä»¶&lt;/li>
&lt;li>ç”¨æˆ·ä½“éªŒï¼šç»“æœå¯ä»¥ç«‹å³è¾“å‡ºï¼Œä¸éœ€è¦ç­‰å¾…æ‰€æœ‰æ–‡ä»¶æ‰«æå®Œæˆ&lt;/li>
&lt;/ol>
&lt;h6 id="ç¼“å†²åŒºå¤§å°æ§åˆ¶">ç¼“å†²åŒºå¤§å°æ§åˆ¶
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// LineBuffer é»˜è®¤é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>capacity: &lt;span style="color:#ae81ff">64&lt;/span> &lt;span style="color:#f92672">*&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>), &lt;span style="color:#75715e">//64kb è¡Œç¼“å†²
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ€»ç»“">æ€»ç»“
&lt;/h4>&lt;ol>
&lt;li>ä¸æ˜¯ä¸€å‘ç°ä¸€æœç´¢ï¼šripgrepæœ‰ä¸¤ç§æ¨¡å¼
&lt;ul>
&lt;li>å•çº¿ç¨‹ï¼š å…ˆå‘ç°æ‰€æœ‰æ–‡ä»¶ â†’ ç¼“å†²æ’åº â†’ é€ä¸ªæœç´¢&lt;/li>
&lt;li>å¹¶è¡Œï¼š å‘ç°å’Œæœç´¢åŒæ—¶è¿›è¡Œï¼Œæ— æ–‡ä»¶çº§ç¼“å†²&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç¼“å†²åŒºå­˜åœ¨äºå¤šä¸ªå±‚æ¬¡ï¼š
&lt;ul>
&lt;li>æ–‡ä»¶åˆ—è¡¨çº§ï¼šå•çº¿ç¨‹æ¨¡å¼æœ‰å®Œæ•´ç¼“å†²&lt;/li>
&lt;li>æ–‡ä»¶å†…å®¹çº§ï¼šæ¯ä¸ªæ–‡ä»¶å†…éƒ¨æœ‰è¡Œç¼“å†²ï¼ˆ64KBï¼‰&lt;/li>
&lt;li>è¾“å‡ºçº§ï¼šå¹¶è¡Œæ¨¡å¼æœ‰è¾“å‡ºç¼“å†²åŒº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h5 id="æ ¸å¿ƒæ¶æ„å¯¹æ¯”">æ ¸å¿ƒæ¶æ„å¯¹æ¯”
&lt;/h5>&lt;h6 id="å•çº¿ç¨‹æ¨¡å¼æœ‰ç¼“å†²">å•çº¿ç¨‹æ¨¡å¼ï¼ˆæœ‰ç¼“å†²ï¼‰
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">æ–‡ä»¶å‘ç°&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> [&lt;span style="color:#960050;background-color:#1e0010">æ–‡ä»¶åˆ—è¡¨ç¼“å†²&lt;/span>] &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ’åº&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">é€ä¸ªæœç´¢&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">è¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>æ”¯æŒ &lt;code>--sort&lt;/code> é€‰é¡¹&lt;/li>
&lt;li>å†…å­˜ä½¿ç”¨ï¼šO(æ–‡ä»¶æ•°é‡)&lt;/li>
&lt;/ul>
&lt;h6 id="å¹¶è¡Œæ¨¡å¼æµå¼å¤„ç†">å¹¶è¡Œæ¨¡å¼ï¼ˆæµå¼å¤„ç†ï¼‰
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">æ–‡ä»¶å‘ç°&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">âŸ·&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æœç´¢&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> [&lt;span style="color:#960050;background-color:#1e0010">è¾“å‡ºç¼“å†²&lt;/span>] &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">è¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å®æ—¶å¤„ç†ï¼Œä½å†…å­˜å ç”¨&lt;/li>
&lt;li>å·¥ä½œçªƒå–é˜Ÿåˆ—åè°ƒå¤šçº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;h4 id="æ€§èƒ½å½±å“">æ€§èƒ½å½±å“
&lt;/h4>&lt;p>&lt;strong>ä¼˜åŠ¿&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å¹¶è¡Œæ¨¡å¼&lt;/strong>ï¼šå†…å­˜æ•ˆç‡é«˜ï¼Œç»“æœè¾“å‡ºå¿«&lt;/li>
&lt;li>&lt;strong>å•çº¿ç¨‹æ¨¡å¼&lt;/strong>ï¼šæ”¯æŒæ’åºï¼Œé€‚åˆå°è§„æ¨¡æœç´¢&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æƒè¡¡&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>å¹¶è¡Œæ¨¡å¼ç‰ºç‰²äº†æ’åºèƒ½åŠ›æ¢å–æ€§èƒ½&lt;/li>
&lt;li>å•çº¿ç¨‹æ¨¡å¼éœ€è¦æ›´å¤šå†…å­˜ä½†è¾“å‡ºæœ‰åº&lt;/li>
&lt;/ul></description></item><item><title>Walkæ•´ä½“æ¶æ„</title><link>https://www.dust-zed.site/rust/ripgrep/walk%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/</link><pubDate>Wed, 27 Aug 2025 09:07:07 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/walk%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/</guid><description>&lt;h3 id="walkæ•´ä½“æ¶æ„è®¾è®¡è¯¦è§£">Walkæ•´ä½“æ¶æ„è®¾è®¡è¯¦è§£
&lt;/h3>&lt;p>è®©æˆ‘ä»¬ä»æœ€æ ¸å¿ƒçš„è®¾è®¡ç†å¿µå¼€å§‹ï¼Œç³»ç»Ÿåœ°è§£é‡Šwalkçš„æ•´ä½“å·¥ä½œæœºåˆ¶ã€‚&lt;/p>
&lt;h5 id="1-æ ¸å¿ƒæ¶æ„ä¸‰å±‚è®¾è®¡æ¨¡å¼">1. æ ¸å¿ƒæ¶æ„ï¼šä¸‰å±‚è®¾è®¡æ¨¡å¼
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¬¬ä¸€å±‚ï¼šæ„å»ºå™¨ - é…ç½®æ”¶é›†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>WalkBuilder::new(&lt;span style="color:#e6db74">&amp;#34;/path/to/search&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .max_depth(Some(&lt;span style="color:#ae81ff">5&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .follow_links(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .threads(&lt;span style="color:#ae81ff">4&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¬¬äºŒå±‚ï¼šæ‰§è¡Œå™¨ - ä¸¤ç§æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .build() &lt;span style="color:#75715e">// â†’ Walk (å•çº¿ç¨‹è¿­ä»£å™¨)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .build_parallel() &lt;span style="color:#75715e">// â†’ WalkParallel (å¹¶è¡Œæ‰§è¡Œå™¨)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¬¬ä¸‰å±‚ï¼šæ•°æ®æŠ½è±¡ - ç»Ÿä¸€è¡¨ç¤º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// â†’ Iterator&amp;lt;Item = Result&amp;lt;DirEntry, Error&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-äº‹ä»¶é©±åŠ¨çš„éå†æ¨¡å‹">2. äº‹ä»¶é©±åŠ¨çš„éå†æ¨¡å‹
&lt;/h5>&lt;p>Walkçš„æ ¸å¿ƒåˆ›æ–°æ˜¯æŠŠç›®å½•éå†æŠ½è±¡ä¸º&lt;strong>äº‹ä»¶æµ&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">WalkEvent&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Dir(walkdir::DirEntry), &lt;span style="color:#75715e">// è¿›å…¥ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> File(walkdir::DirEntry), &lt;span style="color:#75715e">// å‘ç°æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Exit &lt;span style="color:#75715e">// é€€å‡ºç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å·¥ä½œæµç¨‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">/&lt;/span>root&lt;span style="color:#f92672">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> file1.txt &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::File(file1.txt)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> dir1&lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::Dir(dir1)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> file2.txt &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::File(file2.txt)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> subdir&lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::Dir(subdir)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> file3.txt &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::File(file3.txt)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::Exit (subdir)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::Exit (dir1)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> file4.txt &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::File(file4.txt)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-walk-vs-walkparallelçš„è®¾è®¡å·®å¼‚">3. Walk vs WalkParallelçš„è®¾è®¡å·®å¼‚
&lt;/h5>&lt;p>&lt;strong>Walk&lt;/strong> - æ ‡å‡†è¿­ä»£å™¨æ¨¡å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Iterator &lt;span style="color:#66d9ef">for&lt;/span> Walk {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">next&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>DirEntry, Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. ä» WalkEventIter è·å–ä¸‹ä¸€ä¸ªäº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> ev &lt;span style="color:#f92672">=&lt;/span> self.it.as_mut().and_then(&lt;span style="color:#f92672">|&lt;/span>it&lt;span style="color:#f92672">|&lt;/span> it.next());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> ev {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(WalkEvent::Dir(ent)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. æ£€æŸ¥æ˜¯å¦åº”è¯¥è·³è¿‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> self.skip_entry(&lt;span style="color:#f92672">&amp;amp;&lt;/span>ent)&lt;span style="color:#f92672">?&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.it.skip_current_dir(); &lt;span style="color:#75715e">// å‰ªæ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. æ›´æ–° ignore è§„åˆ™ä¸Šä¸‹æ–‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> (ig_new, err) &lt;span style="color:#f92672">=&lt;/span> self.ig.add_child(ent.path());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig &lt;span style="color:#f92672">=&lt;/span> ig_new;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Ok(ent));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(WalkEvent::File(ent)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.skip_entry(&lt;span style="color:#f92672">&amp;amp;&lt;/span>ent)&lt;span style="color:#f92672">?&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Ok(ent));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(WalkEvent::Exit) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. æ¢å¤çˆ¶ç›®å½•çš„ ignore ä¸Šä¸‹æ–‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.ig &lt;span style="color:#f92672">=&lt;/span> self.ig.parent().unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>WalkParallel&lt;/strong> - å·¥ä½œçªƒå–æ¨¡å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> WalkParallel {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>F&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, mkf: &lt;span style="color:#a6e22e">F&lt;/span>) &lt;span style="color:#66d9ef">where&lt;/span> F: FnMut() -&amp;gt; Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> FnMut(Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>DirEntry, Error&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">WalkState&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. åˆ›å»ºå·¥ä½œçªƒå–é˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> stacks &lt;span style="color:#f92672">=&lt;/span> Stack::new_for_each_thread(threads, stack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. å¯åŠ¨å¤šä¸ªå·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std::thread::scope(&lt;span style="color:#f92672">|&lt;/span>s&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> handles: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> stacks.into_iter().map(&lt;span style="color:#f92672">|&lt;/span>stack&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Worker {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor: &lt;span style="color:#a6e22e">mkf&lt;/span>(), &lt;span style="color:#75715e">// ç”¨æˆ·å›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> stack, &lt;span style="color:#75715e">// å·¥ä½œé˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> quit_now, &lt;span style="color:#75715e">// å…¨å±€é€€å‡ºæ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> active_workers, &lt;span style="color:#75715e">// æ´»è·ƒå·¥ä½œè€…è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// ... å…¶ä»–é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).map(&lt;span style="color:#f92672">|&lt;/span>worker&lt;span style="color:#f92672">|&lt;/span> s.spawn(&lt;span style="color:#66d9ef">move&lt;/span> &lt;span style="color:#f92672">||&lt;/span> worker.run())).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> handle &lt;span style="color:#66d9ef">in&lt;/span> handles { handle.join().unwrap(); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-å…³é”®è®¾è®¡æ¨¡å¼">4. å…³é”®è®¾è®¡æ¨¡å¼
&lt;/h5>&lt;p>&lt;strong>çŠ¶æ€ç®¡ç†&lt;/strong>ï¼šIgnoreè§„åˆ™çš„å±‚æ¬¡åŒ–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Walk&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ig_root: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">// æ ¹ç›®å½•è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ig: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">// å½“å‰ç›®å½•è§„åˆ™ (éšéå†åŠ¨æ€å˜åŒ–)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿›å…¥å­ç›®å½•æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> (ig_new, err) &lt;span style="color:#f92672">=&lt;/span> self.ig.add_child(child_path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>self.ig &lt;span style="color:#f92672">=&lt;/span> ig_new; &lt;span style="color:#75715e">// ç»§æ‰¿çˆ¶ç›®å½•è§„åˆ™ + å­ç›®å½•è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é€€å‡ºç›®å½•æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>self.ig &lt;span style="color:#f92672">=&lt;/span> self.ig.parent().unwrap(); &lt;span style="color:#75715e">// æ¢å¤çˆ¶ç›®å½•è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ—©æœŸè¿‡æ»¤ä¼˜åŒ–&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">skip_entry&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self, ent: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">DirEntry&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">bool&lt;/span>, Error&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¼˜å…ˆçº§é¡ºåº (ä»å¿«åˆ°æ…¢)ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> ent.depth() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> { &lt;span style="color:#66d9ef">return&lt;/span> Ok(&lt;span style="color:#66d9ef">false&lt;/span>); } &lt;span style="color:#75715e">// 1. æ ¹ç›®å½•æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> should_skip_entry(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self.ig, ent) { &lt;span style="color:#66d9ef">return&lt;/span> Ok(&lt;span style="color:#66d9ef">true&lt;/span>); } &lt;span style="color:#75715e">// 2. ignore è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> path_equals(ent, stdout) { &lt;span style="color:#66d9ef">return&lt;/span> Ok(&lt;span style="color:#66d9ef">true&lt;/span>); } &lt;span style="color:#75715e">// 3. stdout æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> skip_filesize(&lt;span style="color:#f92672">..&lt;/span>.) { &lt;span style="color:#66d9ef">return&lt;/span> Ok(&lt;span style="color:#66d9ef">true&lt;/span>); } &lt;span style="color:#75715e">// 4. æ–‡ä»¶å¤§å°æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>filter(ent) { &lt;span style="color:#66d9ef">return&lt;/span> Ok(&lt;span style="color:#66d9ef">true&lt;/span>); } &lt;span style="color:#75715e">// 5. è‡ªå®šä¹‰è¿‡æ»¤å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(&lt;span style="color:#66d9ef">false&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å·¥ä½œçªƒå–é˜Ÿåˆ—çš„æ™ºèƒ½ç»ˆæ­¢&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">get_work&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Work&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self.recv() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Message::Work(work)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(work),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Message::Quit) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é”®ï¼šåŸå­æ€§æ£€æŸ¥æ‰€æœ‰å·¥ä½œè€…æ˜¯å¦éƒ½ç©ºé—²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> self.deactivate_worker() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰€æœ‰å·¥ä½œè€…éƒ½ç©ºé—² = æ²¡æœ‰æ›´å¤šå·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.send_quit(); &lt;span style="color:#75715e">// å¹¿æ’­é€€å‡ºä¿¡å·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> None;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç­‰å¾…æ–°å·¥ä½œæˆ–ä»å…¶ä»–é˜Ÿåˆ—çªƒå–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.wait_for_work();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="5-æ•´ä½“å·¥ä½œæµç¨‹æ€»ç»“">5. æ•´ä½“å·¥ä½œæµç¨‹æ€»ç»“
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">ç”¨æˆ·è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WalkBuilder &lt;span style="color:#960050;background-color:#1e0010">æ”¶é›†é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">é€‰æ‹©æ‰§è¡Œæ¨¡å¼ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> Walk: &lt;span style="color:#960050;background-color:#1e0010">å•çº¿ç¨‹è¿­ä»£å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">åŸºäº&lt;/span> WalkDir &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">äº‹ä»¶è½¬æ¢&lt;/span> &lt;span style="color:#f92672">+&lt;/span> ignore &lt;span style="color:#960050;background-color:#1e0010">è¿‡æ»¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> WalkParallel: &lt;span style="color:#960050;background-color:#1e0010">å¹¶è¡Œæ‰§è¡Œå™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å·¥ä½œçªƒå–é˜Ÿåˆ—&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å¤šçº¿ç¨‹åä½œ&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ™ºèƒ½ç»ˆæ­¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">äº§ç”Ÿ&lt;/span> DirEntry &lt;span style="color:#960050;background-color:#1e0010">æµ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">ç”¨æˆ·å¤„ç†ç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ ¸å¿ƒä¼˜åŠ¿&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ç»Ÿä¸€æŠ½è±¡ï¼šæ— è®ºå•çº¿ç¨‹è¿˜æ˜¯å¹¶è¡Œï¼Œç”¨æˆ·çœ‹åˆ°çš„éƒ½æ˜¯&lt;code>DirEntry&lt;/code>æµ&lt;/li>
&lt;li>æ™ºèƒ½è¿‡æ»¤ï¼šå¤šå±‚æ¬¡ã€æ—©æœŸè¿‡æ»¤ï¼Œé¿å…ä¸å¿…è¦çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ&lt;/li>
&lt;li>åŠ¨æ€é€‚åº”ï¼š ignoreè§„åˆ™è·Ÿéšç›®å½•å±‚æ¬¡åŠ¨æ€è°ƒæ•´&lt;/li>
&lt;li>é«˜æ•ˆå¹¶è¡Œï¼š å·¥ä½œçªƒå– + æ™ºèƒ½ç»ˆæ­¢ï¼Œæœ€å¤§åŒ–CPUåˆ©ç”¨ç‡&lt;/li>
&lt;/ul>
&lt;h4 id="walkbuilderæ„å»ºæ¨¡å¼è¯¦è§£">WalkBuilderæ„å»ºæ¨¡å¼è¯¦è§£
&lt;/h4>&lt;h5 id="æ ¸å¿ƒç»“æ„è®¾è®¡">æ ¸å¿ƒç»“æ„è®¾è®¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">WalkBuilder&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> paths: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>PathBuf&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// å¤šè·¯å¾„æ”¯æŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ig_builder: &lt;span style="color:#a6e22e">IgnoreBuilder&lt;/span>, &lt;span style="color:#75715e">// ignore è§„åˆ™æ„å»ºå™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> max_depth: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">usize&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// é€’å½’æ·±åº¦é™åˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> max_filesize: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u64&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æ–‡ä»¶å¤§å°é™åˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> follow_links: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// ç¬¦å·é“¾æ¥è·Ÿéš
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> same_file_system: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> sorter: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Sorter&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æ’åºç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> threads: &lt;span style="color:#66d9ef">usize&lt;/span>, &lt;span style="color:#75715e">// çº¿ç¨‹æ•°é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> skip: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>Handle&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// stdout è·³è¿‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> filter: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Filter&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// è‡ªå®šä¹‰è¿‡æ»¤å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="æµç•…æ¥å£æ¨¡å¼çš„ä¼˜é›…å®ç°">æµç•…æ¥å£æ¨¡å¼çš„ä¼˜é›…å®ç°
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å…¸å‹çš„é“¾å¼è°ƒç”¨æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> walker &lt;span style="color:#f92672">=&lt;/span> WalkBuilder::new(&lt;span style="color:#e6db74">&amp;#34;/path/to/search&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .max_depth(Some(&lt;span style="color:#ae81ff">3&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .follow_links(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .threads(&lt;span style="color:#ae81ff">4&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .standard_filters(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .hidden(&lt;span style="color:#66d9ef">false&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .git_ignore(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .build_parallel();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å…³é”®è®¾è®¡æ¨¡å¼">å…³é”®è®¾è®¡æ¨¡å¼
&lt;/h5>&lt;h6 id="1-å§”æ‰˜æ¨¡å¼">1. å§”æ‰˜æ¨¡å¼
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// WalkBuilder å°† ignore ç›¸å…³é…ç½®å§”æ‰˜ç»™ IgnoreBuilder
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// WalkDiræ˜¯åŸºç¡€çš„æ–‡ä»¶ç³»ç»ŸBuilder
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">hidden&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, yes: &lt;span style="color:#66d9ef">bool&lt;/span>) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig_builder.hidden(yes); &lt;span style="color:#75715e">// å§”æ‰˜ç»™å†…éƒ¨æ„å»ºå™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">git_ignore&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, yes: &lt;span style="color:#66d9ef">bool&lt;/span>) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig_builder.git_ignore(yes);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="2-åˆ†ç»„é…ç½®æ¨¡å¼">2. åˆ†ç»„é…ç½®æ¨¡å¼
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">standard_filters&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, yes: &lt;span style="color:#66d9ef">bool&lt;/span>) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸€æ¬¡æ€§é…ç½®å¤šä¸ªç›¸å…³é€‰é¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.hidden(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .parents(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .ignore(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .git_ignore(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .git_global(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .git_exclude(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="3--ç­–ç•¥æ¨¡å¼çš„æ’åºè®¾è®¡">3. ç­–ç•¥æ¨¡å¼çš„æ’åºè®¾è®¡
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">Sorter&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ByName(Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> Fn(&lt;span style="color:#f92672">&amp;amp;&lt;/span>OsStr, &lt;span style="color:#f92672">&amp;amp;&lt;/span>OsStr) -&amp;gt; &lt;span style="color:#a6e22e">Ordering&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send &lt;span style="color:#f92672">+&lt;/span> Sync &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static&lt;span style="color:#f92672">&amp;gt;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ByPath(Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> Fn(&lt;span style="color:#f92672">&amp;amp;&lt;/span>Path, &lt;span style="color:#f92672">&amp;amp;&lt;/span>Path) -&amp;gt; &lt;span style="color:#a6e22e">Ordering&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send &lt;span style="color:#f92672">+&lt;/span> Sync &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static&lt;span style="color:#f92672">&amp;gt;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">sort_by_file_name&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>F&lt;span style="color:#f92672">&amp;gt;&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, cmp: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> WalkBuilder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">where&lt;/span> F: Fn(&lt;span style="color:#f92672">&amp;amp;&lt;/span>OsStr, &lt;span style="color:#f92672">&amp;amp;&lt;/span>OsStr) -&amp;gt; &lt;span style="color:#a6e22e">Ordering&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send &lt;span style="color:#f92672">+&lt;/span> Sync &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.sorter &lt;span style="color:#f92672">=&lt;/span> Some(Sorter::ByName(Arc::new(cmp)));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="æ„å»ºè¿‡ç¨‹çš„ä¸¤ä¸ªå…³é”®è½¬æ¢">æ„å»ºè¿‡ç¨‹çš„ä¸¤ä¸ªå…³é”®è½¬æ¢
&lt;/h5>&lt;h6 id="build---å•çº¿ç¨‹è¿­ä»£å™¨æ„å»º">build() - å•çº¿ç¨‹è¿­ä»£å™¨æ„å»º
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">build&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">Walk&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. ä¸ºæ¯ä¸ªè·¯å¾„åˆ›å»º WalkDir è¿­ä»£å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> its &lt;span style="color:#f92672">=&lt;/span> self.paths.iter().map(&lt;span style="color:#f92672">|&lt;/span>p&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> wd &lt;span style="color:#f92672">=&lt;/span> WalkDir::new(p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wd &lt;span style="color:#f92672">=&lt;/span> wd.follow_links(self.follow_links &lt;span style="color:#f92672">||&lt;/span> p.is_file());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wd &lt;span style="color:#f92672">=&lt;/span> wd.same_file_system(self.same_file_system);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. åº”ç”¨æ’åºç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(&lt;span style="color:#66d9ef">ref&lt;/span> sorter) &lt;span style="color:#f92672">=&lt;/span> self.sorter {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> sorter {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Sorter::ByName(cmp) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> wd &lt;span style="color:#f92672">=&lt;/span> wd.sort_by(&lt;span style="color:#66d9ef">move&lt;/span> &lt;span style="color:#f92672">|&lt;/span>a, b&lt;span style="color:#f92672">|&lt;/span> cmp(a.file_name(), b.file_name())),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Sorter::ByPath(cmp) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> wd &lt;span style="color:#f92672">=&lt;/span> wd.sort_by(&lt;span style="color:#66d9ef">move&lt;/span> &lt;span style="color:#f92672">|&lt;/span>a, b&lt;span style="color:#f92672">|&lt;/span> cmp(a.path(), b.path())),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (p.to_path_buf(), Some(WalkEventIter::from(wd)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. æ„å»º ignore è§„åˆ™æ ¹èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> ig_root &lt;span style="color:#f92672">=&lt;/span> self.ig_builder.build();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Walk { its, ig_root, &lt;span style="color:#75715e">/* ... */&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="build_parallel---å¹¶è¡Œæ‰§è¡Œå™¨æ„å»º">build_parallel() - å¹¶è¡Œæ‰§è¡Œå™¨æ„å»º
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">build_parallel&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">WalkParallel&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WalkParallel {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> paths: &lt;span style="color:#a6e22e">self&lt;/span>.paths.clone().into_iter(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ig_root: &lt;span style="color:#a6e22e">self&lt;/span>.ig_builder.build(), &lt;span style="color:#75715e">// å…±äº« ignore è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> max_depth: &lt;span style="color:#a6e22e">self&lt;/span>.max_depth,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> threads: &lt;span style="color:#a6e22e">self&lt;/span>.threads,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç›´æ¥ä¼ é€’é…ç½®ï¼Œæ— éœ€è½¬æ¢ä¸ºè¿­ä»£å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="walkbuilder-æ„å»ºæ¨¡å¼çš„æ™ºèƒ½é…ç½®ç®¡ç†">WalkBuilder æ„å»ºæ¨¡å¼çš„æ™ºèƒ½é…ç½®ç®¡ç†
&lt;/h4>&lt;h6 id="æ™ºèƒ½é»˜è®¤å€¼å¤„ç†">æ™ºèƒ½é»˜è®¤å€¼å¤„ç†
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> WalkParallel {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">threads&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">usize&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self.threads &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#75715e">// æ™ºèƒ½é»˜è®¤å€¼ï¼šæœ€å°‘2ä¸ªçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.threads
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="é…ç½®éªŒè¯å’Œä¼˜åŒ–">é…ç½®éªŒè¯å’Œä¼˜åŒ–
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">visit&lt;/span>(&lt;span style="color:#66d9ef">mut&lt;/span> self, builder: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> &lt;span style="color:#66d9ef">dyn&lt;/span> ParallelVisitorBuilder&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> threads &lt;span style="color:#f92672">=&lt;/span> self.threads();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> stack &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">vec!&lt;/span>[];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. é¢„å¤„ç†æ ¹è·¯å¾„ï¼ŒåŒºåˆ†æ–‡ä»¶å’Œç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> path &lt;span style="color:#66d9ef">in&lt;/span> paths {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (dent, root_device) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> path &lt;span style="color:#f92672">==&lt;/span> Path::new(&lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (DirEntry::new_stdin(), None) &lt;span style="color:#75715e">// ç‰¹æ®Šå¤„ç† stdin
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾å¤‡å·æ£€æŸ¥ï¼ˆsame_file_system æ”¯æŒï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> root_device &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.same_file_system {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> device_num(&lt;span style="color:#f92672">&amp;amp;&lt;/span>path) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(root_device) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Some(root_device),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é”™è¯¯å¤„ç†ï¼šå•ä¸ªè·¯å¾„å¤±è´¥ä¸å½±å“å…¶ä»–è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> visitor.visit(Err(err)).is_quit() { &lt;span style="color:#66d9ef">return&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºåˆå§‹ DirEntry
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> DirEntryRaw::from_path(&lt;span style="color:#ae81ff">0&lt;/span>, path, &lt;span style="color:#66d9ef">false&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(dent) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> (DirEntry::new_raw(dent, None), root_device),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> visitor.visit(Err(err)).is_quit() { &lt;span style="color:#66d9ef">return&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. ç”Ÿæˆåˆå§‹å·¥ä½œé¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> stack.push(Message::Work(Work {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dent,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ignore: &lt;span style="color:#a6e22e">self&lt;/span>.ig_root.clone(), &lt;span style="color:#75715e">// å…±äº«æ ¹ ignore è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> root_device,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. æ—©æœŸé€€å‡ºä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> stack.is_empty() { &lt;span style="color:#66d9ef">return&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. å¯åŠ¨å·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> stacks &lt;span style="color:#f92672">=&lt;/span> Stack::new_for_each_thread(threads, stack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å…³é”®è®¾è®¡æ¨¡å¼æ€»ç»“">å…³é”®è®¾è®¡æ¨¡å¼æ€»ç»“
&lt;/h4>&lt;h5 id="1-åˆ†å±‚å§”æ‰˜æ¨¡å¼">1. åˆ†å±‚å§”æ‰˜æ¨¡å¼
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>WalkBuilder (&lt;span style="color:#960050;background-color:#1e0010">å¤–å±‚é…ç½®&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å§”æ‰˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>IgnoreBuilder (ignore &lt;span style="color:#960050;background-color:#1e0010">è§„åˆ™é…ç½®&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ„å»º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Ignore (&lt;span style="color:#960050;background-color:#1e0010">è¿è¡Œæ—¶è§„åˆ™åŒ¹é…å™¨&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-é…ç½®æ”¶é›†ä¸å»¶è¿Ÿæ„å»º">2. é…ç½®æ”¶é›†ä¸å»¶è¿Ÿæ„å»º
&lt;/h5>&lt;ul>
&lt;li>æ”¶é›†é˜¶æ®µï¼š WalkBuilderæ”¶é›†æ‰€æœ‰é…ç½®é€‰é¡¹&lt;/li>
&lt;li>éªŒè¯é˜¶æ®µï¼šbuild()æ—¶è¿›è¡Œé…ç½®éªŒè¯å’Œè½¬æ¢&lt;/li>
&lt;li>æ‰§è¡Œé˜¶æ®µï¼šWalk/WalkParallelä½¿ç”¨æœ€ç»ˆé…ç½®æ‰§è¡Œéå†&lt;/li>
&lt;/ul>
&lt;h5 id="3-å¤šæ€æ‰§è¡Œç­–ç•¥">3. å¤šæ€æ‰§è¡Œç­–ç•¥
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">build&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">Walk&lt;/span> { &lt;span style="color:#75715e">/* å•çº¿ç¨‹ç­–ç•¥ */&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">build_parallel&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">WalkParallel&lt;/span> { &lt;span style="color:#75715e">/* å¹¶è¡Œç­–ç•¥ */&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-é”™è¯¯æ¢å¤ä¸éƒ¨åˆ†æˆåŠŸ">4. é”™è¯¯æ¢å¤ä¸éƒ¨åˆ†æˆåŠŸ
&lt;/h5>&lt;ul>
&lt;li>å•ä¸ªè·¯å¾„å¤±è´¥ä¸å½±å“å…¶ä»–è·¯å¾„çš„å¤„ç†&lt;/li>
&lt;li>ignoreæ–‡ä»¶è§£æé”™è¯¯ä¸é˜»æ­¢éå†ç»§ç»­&lt;/li>
&lt;li>æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ä½†ä¿æŒç³»ç»Ÿå¥å£®æ€§&lt;/li>
&lt;/ul>
&lt;h4 id="walkçš„æ–‡ä»¶å‘ç°ä¸éå†">Walkçš„æ–‡ä»¶å‘ç°ä¸éå†
&lt;/h4>&lt;p>&lt;code>Walk&lt;/code>å®ç°äº†&lt;code>Iterator&lt;/code>traitï¼Œå…¶æ ¸å¿ƒæ˜¯&lt;code>next()&lt;/code>æ–¹æ³•ï¼Œè´Ÿè´£æ–‡ä»¶å‘ç°å’Œéå†ã€‚&lt;code>Walk&lt;/code>åŒ…è£…äº†&lt;code>WalkEventIter&lt;/code>ï¼Œè€Œ&lt;code>WalkEventIter&lt;/code>åŒ…è£…äº†&lt;code>WalkDir&lt;/code>ã€‚&lt;code>WalkDir&lt;/code>æä¾›åŸºç¡€çš„æ–‡ä»¶ç³»ç»Ÿéå†åŠŸèƒ½ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„æ ‘å½¢ç»“æ„è½¬åŒ–ä¸ºäº†çº¿å½¢çš„Iterï¼›&lt;code>WalkEventDir&lt;/code>åˆ™æ˜¯å°†&lt;code>WalkDir&lt;/code>è½¬æ¢ä¸º&lt;code>WalkEvent&lt;/code>æµï¼›&lt;code>Walk&lt;/code>è´Ÿè´£æ·»åŠ ignoreè§„åˆ™å’Œè¿‡æ»¤é€»è¾‘ã€‚&lt;/p>
&lt;h5 id="1-æ ¸å¿ƒæ•°æ®ç»“æ„">1. æ ¸å¿ƒæ•°æ®ç»“æ„
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Walk&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> its: &lt;span style="color:#a6e22e">std&lt;/span>::vec::IntoIter&lt;span style="color:#f92672">&amp;lt;&lt;/span>(PathBuf, Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>WalkEventIter&lt;span style="color:#f92672">&amp;gt;&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//åˆå§‹è·¯å¾„è¿­ä»£å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> it: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>WalkEventIter&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//å½“å‰ç›®å½•è¿­ä»£å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ig_root: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">//æ ¹ç›®å½•çš„å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ig: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">//å½“å‰ç›®å½•çš„å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">//...å…¶ä»–å­—æ®µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2åˆå§‹åŒ–é˜¶æ®µ">2.åˆå§‹åŒ–é˜¶æ®µ
&lt;/h5>&lt;ul>
&lt;li>å¦‚æœå½“å‰è¿­ä»£å™¨itä¸ºNoneï¼Œä»itsè·å–ä¸‹ä¸€ä¸ªè·¯å¾„&lt;/li>
&lt;li>å¦‚æœitsä¹Ÿè€—å°½ï¼Œè¿”å›Noneè¡¨ç¤ºéå†ç»“æŸ&lt;/li>
&lt;/ul>
&lt;h5 id="3ä¸»å¾ªç¯ç»“æ„">3.ä¸»å¾ªç¯ç»“æ„
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">next&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>DirEntry, Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. è·å–ä¸‹ä¸€ä¸ªäº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// 2. å¤„ç†äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// 3. è¿”å›ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶/ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-äº‹ä»¶è·å–é€»è¾‘">4. äº‹ä»¶è·å–é€»è¾‘
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> ev &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.it.as_mut().and_then(&lt;span style="color:#f92672">|&lt;/span>it&lt;span style="color:#f92672">|&lt;/span> it.next()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(ev) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> ev, &lt;span style="color:#75715e">// æœ‰äº‹ä»¶åˆ™å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> { &lt;span style="color:#75715e">// å½“å‰è¿­ä»£å™¨è€—å°½
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.its.next() { &lt;span style="color:#75715e">// è·å–ä¸‹ä¸€ä¸ªè·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> None, &lt;span style="color:#75715e">// æ‰€æœ‰è·¯å¾„å¤„ç†å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Some((_, None)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Ok(DirEntry::new_stdin())), &lt;span style="color:#75715e">// æ ‡å‡†è¾“å…¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Some((path, Some(it))) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> { &lt;span style="color:#75715e">// æ–°è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.it &lt;span style="color:#f92672">=&lt;/span> Some(it);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> path.is_dir() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ›´æ–°å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> (ig, err) &lt;span style="color:#f92672">=&lt;/span> self.ig_root.add_parents(path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig &lt;span style="color:#f92672">=&lt;/span> ig;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(err) &lt;span style="color:#f92672">=&lt;/span> err {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Err(err));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig &lt;span style="color:#f92672">=&lt;/span> self.ig_root.clone(); &lt;span style="color:#75715e">// é‡ç½®ä¸ºæ ¹è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>; &lt;span style="color:#75715e">// ç»§ç»­å¤„ç†æ–°è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="5äº‹ä»¶å¤„ç†">5.äº‹ä»¶å¤„ç†
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">match&lt;/span> ev {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Err(Error::from_walkdir(err))),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€€å‡ºç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(WalkEvent::Exit) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig &lt;span style="color:#f92672">=&lt;/span> self.ig.parent().unwrap(); &lt;span style="color:#75715e">// æ¢å¤çˆ¶ç›®å½•çš„å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(WalkEvent::Dir(ent)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> de &lt;span style="color:#f92672">=&lt;/span> DirEntry::new_entry(ent, self.ig.clone());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>de.is_dir().unwrap_or(&lt;span style="color:#66d9ef">false&lt;/span>) { &lt;span style="color:#75715e">// å¯èƒ½æ˜¯ç¬¦å·é“¾æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Ok(de));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(err) &lt;span style="color:#f92672">=&lt;/span> de.into_error() { &lt;span style="color:#75715e">// æ£€æŸ¥é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Err(err));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åº”ç”¨å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.ig.add_child(&lt;span style="color:#f92672">&amp;amp;&lt;/span>de.path) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(Some((child_ig, err_opt))) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig &lt;span style="color:#f92672">=&lt;/span> child_ig; &lt;span style="color:#75715e">// æ›´æ–°ä¸ºå­ç›®å½•çš„å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(err) &lt;span style="color:#f92672">=&lt;/span> err_opt {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Err(err));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(None) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {} &lt;span style="color:#75715e">// æ— å˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Err(err)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(WalkEvent::File(ent)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> de &lt;span style="color:#f92672">=&lt;/span> DirEntry::new_entry(ent, self.ig.clone());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self.skip_entry(&lt;span style="color:#f92672">&amp;amp;&lt;/span>de).unwrap_or(&lt;span style="color:#66d9ef">false&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>; &lt;span style="color:#75715e">// è·³è¿‡è¯¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Ok(de)); &lt;span style="color:#75715e">// è¿”å›æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="walkeventiterçš„äº‹ä»¶ç”Ÿæˆ">WalkEventIterçš„äº‹ä»¶ç”Ÿæˆ
&lt;/h4>&lt;h5 id="1-æ ¸å¿ƒç»“æ„">1. æ ¸å¿ƒç»“æ„
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">WalkEventIter&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> depth: &lt;span style="color:#66d9ef">usize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> it: &lt;span style="color:#a6e22e">walkdir&lt;/span>::IntoIter,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> next: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>walkdir::DirEntry, walkdir::Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-åˆå§‹é˜¶æ®µ">2. åˆå§‹é˜¶æ®µ
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>WalkEventIter {depth: &lt;span style="color:#ae81ff">0&lt;/span>, it: &lt;span style="color:#a6e22e">it&lt;/span>.IntoIter, next: None }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-äº‹ä»¶ç”Ÿæˆ">3. äº‹ä»¶ç”Ÿæˆ
&lt;/h5>&lt;p>ä»&lt;code>it&lt;/code>è·å–&lt;code>DirEntry&lt;/code>ï¼Œ&lt;code>depth&lt;/code>è¡¨ç¤ºå½“å‰æ–‡ä»¶éå†æ·±åº¦ã€‚&lt;/p>
&lt;ol>
&lt;li>Exitäº‹ä»¶ç”Ÿæˆï¼šå½“æ£€æµ‹åˆ°æ·±åº¦å‡å°‘æ—¶ï¼ˆdent_depth &amp;lt; self.depthï¼‰ï¼Œè¡¨ç¤ºæ­£åœ¨ä»å­ç›®å½•è¿”å›&lt;/li>
&lt;li>&lt;strong>nextå­—æ®µ&lt;/strong>ï¼šä»…åœ¨ç”ŸæˆExitäº‹ä»¶æ—¶&lt;strong>ä¿å­˜å½“å‰æ¡ç›®&lt;/strong>ï¼Œç¡®ä¿ä¸‹æ¬¡å¤„ç†æ—¶èƒ½æ­£ç¡®å¤„ç†ï¼Œ
&lt;ul>
&lt;li>å› ä¸ºé€€å‡ºç›®å½•æ—¶ï¼Œæˆ‘ä»¬ç”Ÿæˆäº†Exitäº‹ä»¶ï¼Œ&lt;strong>å½“å‰æ¡ç›®è¢«å»¶è¿Ÿå¤„ç†äº†&lt;/strong>ï¼Œæ‰€ä»¥è¦ä¸´æ—¶ä¿å­˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>depthç®¡ç†ï¼š
&lt;ul>
&lt;li>è¿›å…¥å­ç›®å½•æ—¶ &lt;code>self.depth += 1&lt;/code>&lt;/li>
&lt;li>é€€å‡ºå­ç›®å½•æ—¶ &lt;code>self.depth -= 1&lt;/code>&lt;/li>
&lt;li>é‡åˆ°æ–°æ¡ç›®æ—¶æ›´æ–° &lt;code>self.depth = dent.depth()&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="walkparallel">WalkParallel
&lt;/h3>&lt;h5 id="1æ ¸å¿ƒæ„æˆ">1.æ ¸å¿ƒæ„æˆ
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">WalkParallel&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> paths: &lt;span style="color:#a6e22e">std&lt;/span>::vec::IntoIter&lt;span style="color:#f92672">&amp;lt;&lt;/span>PathBuf&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// è¦éå†çš„è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ig_root: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">// æ ¹ç›®å½•çš„å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> max_filesize: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u64&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æ–‡ä»¶å¤§å°é™åˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> max_depth: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">usize&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æœ€å¤§æ·±åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> follow_links: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ˜¯å¦è·Ÿè¸ªç¬¦å·é“¾æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> same_file_system: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ˜¯å¦é™åˆ¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> threads: &lt;span style="color:#66d9ef">usize&lt;/span>, &lt;span style="color:#75715e">// çº¿ç¨‹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> skip: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>Handle&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// è·³è¿‡è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> filter: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Filter&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// è‡ªå®šä¹‰è¿‡æ»¤å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Worker&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;s&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor: Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> ParallelVisitor&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// å¤„ç†æ–‡ä»¶/ç›®å½•çš„å›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> stack: &lt;span style="color:#a6e22e">Stack&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡æ ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> quit_now: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>AtomicBool&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æå‰ç»ˆæ­¢æ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> active_workers: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>AtomicUsize&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æ´»è·ƒå·¥ä½œçº¿ç¨‹è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// ... å…¶ä»–çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-æ„å»ºåˆå§‹åŒ–">2. æ„å»ºåˆå§‹åŒ–
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 1. åˆ›å»ºå¹¶è¡Œéå†å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> walker &lt;span style="color:#f92672">=&lt;/span> WalkBuilder::new(&lt;span style="color:#e6db74">&amp;#34;/path&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .threads(&lt;span style="color:#ae81ff">4&lt;/span>) &lt;span style="color:#75715e">// è®¾ç½®çº¿ç¨‹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .build_parallel();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 2. è¿è¡Œéå†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>walker.run(&lt;span style="color:#f92672">||&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¯ä¸ªçº¿ç¨‹çš„åˆå§‹åŒ–ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Box::new(&lt;span style="color:#f92672">|&lt;/span>result&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ¯ä¸ªæ–‡ä»¶/ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> result {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(entry) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Found: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, entry.path().display()),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">eprintln!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, err),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WalkState::Continue &lt;span style="color:#75715e">// æ§åˆ¶éå†æµç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-å…³é”®ç»„ä»¶">3. å…³é”®ç»„ä»¶
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>ParallelVisitor&lt;/strong>ï¼šå®šä¹‰å¦‚ä½•å¤„ç†éå†ç»“æœ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">trait&lt;/span> ParallelVisitor: Send {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">visit&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, entry: Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>DirEntry, Error&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">WalkState&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>Work&lt;/strong>ä»»åŠ¡å•å…ƒï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Work&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dent: &lt;span style="color:#a6e22e">DirEntry&lt;/span>, &lt;span style="color:#75715e">//ç›®å½•é¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ignore: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">//å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> root_device: &lt;span style="color:#66d9ef">u64&lt;/span>, &lt;span style="color:#75715e">//è®¾å¤‡å·ï¼ˆç”¨äºè·¨æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-æ‰§è¡Œæµç¨‹">4. æ‰§è¡Œæµç¨‹
&lt;/h5>&lt;ol>
&lt;li>åˆ›å»ºå·¥ä½œçº¿ç¨‹æ± &lt;/li>
&lt;li>å°†åˆå§‹è·¯å¾„åŠ å…¥å·¥ä½œé˜Ÿåˆ—&lt;/li>
&lt;li>æ¯ä¸ªå·¥ä½œçº¿ç¨‹ï¼š
&lt;ul>
&lt;li>ä»é˜Ÿåˆ—è·å–ä»»åŠ¡&lt;/li>
&lt;li>å¤„ç†ç›®å½•é¡¹&lt;/li>
&lt;li>å‘ç°å­ç›®å½•ç”Ÿæˆæ–°ä»»åŠ¡&lt;/li>
&lt;li>å¤„ç†ignoreè§„åˆ™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="æµç¨‹è¯¦è§£">æµç¨‹è¯¦è§£
&lt;/h4>&lt;h5 id="1-åˆå§‹åŒ–é˜¶æ®µ">1. åˆå§‹åŒ–é˜¶æ®µ
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> walker &lt;span style="color:#f92672">=&lt;/span> WalkBuilder::new(&lt;span style="color:#e6db74">&amp;#34;/path&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .threads(&lt;span style="color:#ae81ff">4&lt;/span>) &lt;span style="color:#75715e">// 4ä¸ªå·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .build_parallel();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>walker.run(&lt;span style="color:#f92672">||&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¯ä¸ªçº¿ç¨‹åˆå§‹åŒ–æ—¶æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Box::new(&lt;span style="color:#f92672">|&lt;/span>result&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ¯ä¸ªæ–‡ä»¶/ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">{:?}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, result&lt;span style="color:#f92672">?&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WalkState::Continue
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-æ ¸å¿ƒæ–¹æ³•">2. æ ¸å¿ƒæ–¹æ³•
&lt;/h5>&lt;h6 id="21-visitæ–¹æ³•">2.1 &lt;code>visit&lt;/code>æ–¹æ³•
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">visit&lt;/span>(&lt;span style="color:#66d9ef">mut&lt;/span> self, builder: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> &lt;span style="color:#66d9ef">dyn&lt;/span> ParallelVisitorBuilder&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. åˆå§‹åŒ–å·¥ä½œé˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> threads &lt;span style="color:#f92672">=&lt;/span> self.threads();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> stack &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">vec!&lt;/span>[];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. å¤„ç†åˆå§‹è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> visitor &lt;span style="color:#f92672">=&lt;/span> builder.build();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ... å¤„ç†åˆå§‹è·¯å¾„å¹¶å¡«å…… stack ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. åˆ›å»ºå·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> quit_now &lt;span style="color:#f92672">=&lt;/span> Arc::new(AtomicBool::new(&lt;span style="color:#66d9ef">false&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> active_workers &lt;span style="color:#f92672">=&lt;/span> Arc::new(AtomicUsize::new(threads));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> stacks &lt;span style="color:#f92672">=&lt;/span> Stack::new_for_each_thread(threads, stack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. å¯åŠ¨å·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std::thread::scope(&lt;span style="color:#f92672">|&lt;/span>s&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> handles: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> stacks
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .into_iter()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .map(&lt;span style="color:#f92672">|&lt;/span>stack&lt;span style="color:#f92672">|&lt;/span> Worker { &lt;span style="color:#75715e">/* ... */&lt;/span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .map(&lt;span style="color:#f92672">|&lt;/span>worker&lt;span style="color:#f92672">|&lt;/span> s.spawn(&lt;span style="color:#f92672">||&lt;/span> worker.run()))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 5. ç­‰å¾…æ‰€æœ‰å·¥ä½œçº¿ç¨‹å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> handle &lt;span style="color:#66d9ef">in&lt;/span> handles {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handle.join().unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="22-workerrunæ–¹æ³•">2.2 &lt;code>Worker::run&lt;/code>æ–¹æ³•
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>(&lt;span style="color:#66d9ef">mut&lt;/span> self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(work) &lt;span style="color:#f92672">=&lt;/span> self.get_work() { &lt;span style="color:#75715e">//è·å–å·¥ä½œé¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> WalkState::Quit &lt;span style="color:#f92672">=&lt;/span> self.run_one(work) { &lt;span style="color:#75715e">//å¤„ç†å·¥ä½œé¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.quit_now()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="23-workerrun_oneæ–¹æ³•">2.3 &lt;code>Worker::run_one&lt;/code>æ–¹æ³•
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">run_one&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, work: &lt;span style="color:#a6e22e">Work&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">WalkState&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æœæ˜¯æ–‡ä»¶æˆ–ç¬¦å·é“¾æ¥ï¼Œç›´æ¥å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> work.is_symlink() &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#f92672">!&lt;/span>work.is_dir() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> self.visitor.visit(Ok(work.dent));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¯»å–ç›®å½•å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> readdir &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> work.read_dir() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(readdir) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> readdir,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> self.visitor.visit(Err(err)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†ç›®å½•ä¸­çš„æ¯ä¸ªæ¡ç›®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> result &lt;span style="color:#66d9ef">in&lt;/span> readdir {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> state &lt;span style="color:#f92672">=&lt;/span> self.generate_work(&lt;span style="color:#75715e">/* ... */&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> state.is_quit() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> state;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WalkState::Continue
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="24-workerget_workæ–¹æ³•">2.4 &lt;code>Worker::get_work&lt;/code>æ–¹æ³•
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">get_work&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Work&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. å…ˆå°è¯•ä»è‡ªå·±çš„é˜Ÿåˆ—è·å–å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(work) &lt;span style="color:#f92672">=&lt;/span> self.stack.pop() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(work);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. å°è¯•ä»å…¶ä»–çº¿ç¨‹çªƒå–å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(work) &lt;span style="color:#f92672">=&lt;/span> self.stack.steal() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(work);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. å¦‚æœéƒ½å¤±è´¥ï¼Œç­‰å¾…å·¥ä½œæˆ–é€€å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.stack.recv()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-å·¥ä½œæµç¨‹">3. å·¥ä½œæµç¨‹
&lt;/h5>&lt;h6 id="1-åˆå§‹åŒ–é˜¶æ®µ-1">1. åˆå§‹åŒ–é˜¶æ®µ
&lt;/h6>&lt;ul>
&lt;li>åˆ›å»ºæŒ‡å®šæ•°é‡çš„å·¥ä½œçº¿ç¨‹&lt;/li>
&lt;li>å°†åˆå§‹å·¥ä½œé¡¹åˆ†é…åˆ°å·¥ä½œé˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;h6 id="2-å·¥ä½œé˜¶æ®µ">2. å·¥ä½œé˜¶æ®µ
&lt;/h6>&lt;ul>
&lt;li>æ¯ä¸ªå·¥ä½œçº¿ç¨‹ä»è‡ªå·±çš„é˜Ÿåˆ—è·å–å·¥ä½œ&lt;/li>
&lt;li>å¤„ç†æ–‡ä»¶æˆ–éå†ç›®å½•&lt;/li>
&lt;li>å°†æ–°å‘ç°çš„å·¥ä½œæ”¾å…¥é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;h6 id="3-å·¥ä½œçªƒå–">3. å·¥ä½œçªƒå–
&lt;/h6>&lt;ul>
&lt;li>å½“çº¿ç¨‹è‡ªå·±çš„é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå°è¯•ä»å…¶ä»–çº¿ç¨‹çªƒå–å·¥ä½œ&lt;/li>
&lt;li>ä½¿ç”¨åŸå­æ“ä½œä¿è¯çº¿ç¨‹å®‰å…¨&lt;/li>
&lt;/ul>
&lt;h6 id="4-ç»ˆæ­¢æ¡ä»¶">4. ç»ˆæ­¢æ¡ä»¶
&lt;/h6>&lt;ul>
&lt;li>æ‰€æœ‰å·¥ä½œé˜Ÿåˆ—ä¸ºç©ºæ—¶&lt;/li>
&lt;li>æ‰€æœ‰å·¥ä½œçº¿ç¨‹éƒ½å¤„äºç©ºé—²çŠ¶æ€&lt;/li>
&lt;li>æ”¶åˆ°é€€å‡ºä¿¡å·&lt;/li>
&lt;/ul>
&lt;h5 id="4-å…³é”®è®¾è®¡ç‚¹">4. å…³é”®è®¾è®¡ç‚¹
&lt;/h5>&lt;ol>
&lt;li>å·¥ä½œçªƒå–ï¼šä½¿ç”¨å·¥ä½œçªƒå–ç®—æ³•å®ç°è´Ÿè½½å‡è¡¡&lt;/li>
&lt;li>æ— é”è®¾è®¡ï¼šä½¿ç”¨&lt;code>channel&lt;/code>è¿›è¡Œçº¿ç¨‹é—´é€šä¿¡&lt;/li>
&lt;li>ä¼˜é›…é€€å‡ºï¼šä½¿ç”¨åŸå­å¸ƒå°”å€¼æ§åˆ¶å·¥ä½œçº¿ç¨‹é€€å‡º&lt;/li>
&lt;li>èµ„æºç®¡ç†ï¼šä½¿ç”¨&lt;code>RAII&lt;/code>ç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾&lt;/li>
&lt;/ol>
&lt;h4 id="æ€»ç»“">æ€»ç»“
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>æ–‡ä»¶å‘ç°è·å¾—æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œä¹‹åä½¿ç”¨ç»å¯¹è·¯å¾„ä¾¿å¯è¯»å–æ–‡ä»¶å†…å®¹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¤šçº¿ç¨‹æ¨¡å¼ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆéå†ï¼Œå•çº¿ç¨‹ä½¿ç”¨äº†æ·±åº¦ä¼˜å…ˆéå†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Workeræ˜¯ä»»åŠ¡è°ƒåº¦ï¼ŒWorkæ˜¯ä»»åŠ¡å®šä¹‰ï¼ŒVisitoræ˜¯ä»»åŠ¡å¤„ç†&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ignoreçš„ç»“æ„">Ignoreçš„ç»“æ„
&lt;/h3>&lt;p>ç»“æ„ä½“&lt;code>Ignore&lt;/code>è´Ÿè´£ç®¡ç†å¿½ç•¥è§„åˆ™ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">/// Ignore is a matcher useful for recursively walking one or more directories.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span>&lt;span style="color:#75715e">#[derive(Clone, Debug)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Ignore&lt;/span>(Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>IgnoreInner&lt;span style="color:#f92672">&amp;gt;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[derive(Clone, Debug)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">IgnoreInner&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// A map of all existing directories that have already been
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">/// compiled into matchers.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">///
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">/// Note that this is never used during matching, only when adding new
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">/// parent directory matchers. This avoids needing to rebuild glob sets for
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">/// parent directories if many paths are being searched.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> compiled: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>RwLock&lt;span style="color:#f92672">&amp;lt;&lt;/span>HashMap&lt;span style="color:#f92672">&amp;lt;&lt;/span>OsString, Weak&lt;span style="color:#f92672">&amp;lt;&lt;/span>IgnoreInner&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// The path to the directory that this matcher was built from.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> dir: &lt;span style="color:#a6e22e">PathBuf&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// An override matcher (default is empty).
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> overrides: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Override&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// A file type matcher.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> types: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Types&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// The parent directory to match next.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> parent: &lt;span style="color:#a6e22e">Ignore&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether this matcher should be compiled case insensitively.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> case_insensitive: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to match hidden files.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> hidden: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to read .ignore files.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> ignore: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to respect any ignore files in parent directories.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> parents: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to read git&amp;#39;s global gitignore file.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> git_global: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to read .gitignore files.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> git_ignore: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to read .git/info/exclude files.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> git_exclude: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to ignore files case insensitively
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> ignore_case_insensitive: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether a git repository must be present in order to apply any
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">/// git-related ignore rules.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> require_git: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å…³é”®ç»„ä»¶è§£æ">å…³é”®ç»„ä»¶è§£æ
&lt;/h5>&lt;ol>
&lt;li>Ignoreç»“æ„ä½“
&lt;ul>
&lt;li>ä½¿ç”¨&lt;code>Arc&lt;/code>è¿›è¡Œå¼•ç”¨è®¡æ•°ï¼Œå…è®¸å¤šçº¿ç¨‹å…±äº«&lt;/li>
&lt;li>å®é™…å®ç°åœ¨&lt;code>IgnoreInner&lt;/code>ä¸­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>IgnoreInner&lt;/code>å­—æ®µ
&lt;ul>
&lt;li>&lt;code>compiled&lt;/code>ï¼šç¼“å­˜å·²ç¼–è¯‘çš„ç›®å½•åŒ¹é…å™¨ï¼Œé¿å…é‡å¤æ„å»º&lt;/li>
&lt;li>&lt;code>dir&lt;/code>:å½“å‰åŒ¹é…å™¨å¯¹åº”çš„ç›®å½•è·¯å¾„&lt;/li>
&lt;li>&lt;code>overrides&lt;/code>ï¼šè¦†ç›–è§„åˆ™ï¼Œä¼˜å…ˆçº§æœ€é«˜&lt;/li>
&lt;li>&lt;code>types&lt;/code>ï¼šæ–‡ä»¶ç±»å‹åŒ¹é…å™¨&lt;/li>
&lt;li>&lt;code>parent&lt;/code>: çˆ¶ç›®å½•çš„åŒ¹é…å™¨ï¼Œå½¢æˆé“¾å¼ç»“æ„&lt;/li>
&lt;li>å„ç§æ ‡å¿—ä½ï¼šæ§åˆ¶å¿½ç•¥è§„åˆ™çš„è¡Œä¸º(å¦‚æ˜¯å¦å¿½ç•¥éšè—æ–‡ä»¶ã€æ˜¯å¦è¯»å–.gitignoreç­‰)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¿½ç•¥è§„åˆ™çš„ä¼˜å…ˆçº§
&lt;ul>
&lt;li>ä»é«˜åˆ°ä½
&lt;ol>
&lt;li>æ˜¾å¼è¦†ç›–è§„åˆ™(&lt;code>overrides&lt;/code>)&lt;/li>
&lt;li>å½“å‰ç›®å½•çš„.gitignore&lt;/li>
&lt;li>çˆ¶ç›®å½•çš„.gitignore&lt;/li>
&lt;li>å…¨å±€gitignore&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item><item><title>Walkå­¦ä¹ </title><link>https://www.dust-zed.site/rust/ripgrep/walk%E5%AD%A6%E4%B9%A0/</link><pubDate>Tue, 26 Aug 2025 15:01:45 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/walk%E5%AD%A6%E4%B9%A0/</guid><description>&lt;h3 id="æ ¸å¿ƒæ¶æ„åˆ†æ">æ ¸å¿ƒæ¶æ„åˆ†æ
&lt;/h3>&lt;h4 id="æ ¸å¿ƒåŠŸèƒ½">æ ¸å¿ƒåŠŸèƒ½
&lt;/h4>&lt;ul>
&lt;li>å¹¶å‘éå†(&lt;code>crossbeam_deque&lt;/code>)&lt;/li>
&lt;li>é¿å…é‡å¤å¤„ç†(&lt;code>same_file&lt;/code>)&lt;/li>
&lt;li>åŸºç¡€éå†èƒ½åŠ›(&lt;code>walkdir&lt;/code>)&lt;/li>
&lt;/ul>
&lt;h4 id="direntryçš„è®¾è®¡">DirEntryçš„è®¾è®¡
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[derive(Debug, Clone)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">DirEntry&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dent: &lt;span style="color:#a6e22e">DirEntryInner&lt;/span>, &lt;span style="color:#75715e">//å®é™…çš„ç›®å½•æ¡ç›®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> err: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Error&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//é™„åŠ çš„é”™è¯¯ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="è®¾è®¡äº®ç‚¹">è®¾è®¡äº®ç‚¹ï¼š
&lt;/h5>&lt;ul>
&lt;li>é”™è¯¯ä¸é˜»å¡ - å³ä½¿æœ‰é”™è¯¯ä¹Ÿä¿ç•™æ¡ç›®ï¼Œåªæ˜¯é™„åŠ é”™è¯¯ä¿¡æ¯&lt;/li>
&lt;li>å†…éƒ¨æŠ½è±¡ - &lt;code>DirEntryInner&lt;/code>éšè—å…·ä½“å®ç°ç»†èŠ‚&lt;/li>
&lt;/ul>
&lt;h4 id="direntryinnerçš„è®¾è®¡">DirEntryInnerçš„è®¾è®¡
&lt;/h4>&lt;p>ä»ä»£ç å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç²¾å·§çš„å¤šæ€è®¾è®¡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">DirEntryInner&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Stdin, &lt;span style="color:#75715e">//æ ‡å‡†è¾“å…¥çš„ç‰¹æ®Šå¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> WalkDir(walkdir::DirEntry), &lt;span style="color:#75715e">//æ¥è‡ªwalkdir crateçš„æ¡ç›®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Raw(DirEntryRaw), &lt;span style="color:#75715e">//è‡ªå®šä¹‰çš„åŸå§‹æ¡ç›®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ç»Ÿä¸€æ¥å£æ¨¡å¼">ç»Ÿä¸€æ¥å£æ¨¡å¼
&lt;/h5>&lt;p>æ¯ä¸ªæ–¹æ³•éƒ½é€šè¿‡æ¨¡å¼åŒ¹é…æä¾›ç»Ÿä¸€æ¥å£ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">path&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Path&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> &lt;span style="color:#f92672">*&lt;/span>self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Stdin &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Path::new(&lt;span style="color:#e6db74">&amp;#34;&amp;lt;stdin&amp;gt;&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Walkdir(&lt;span style="color:#66d9ef">ref&lt;/span> x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> x.path(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Raw(&lt;span style="color:#66d9ef">ref&lt;/span> x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> x.path(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§è®¾è®¡çš„ä»·å€¼ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç±»å‹å®‰å…¨&lt;/strong> - ç¼–è¯‘æ—¶ä¿å­˜æ‰€æœ‰å˜ä½“éƒ½è¢«å¤„ç†&lt;/li>
&lt;li>&lt;strong>æ€§èƒ½ä¼˜åŒ–&lt;/strong> - é›¶æˆæœ¬æŠ½è±¡ï¼Œè¿è¡Œæ—¶æ— è™šå‡½æ•°è°ƒç”¨å¼€é”€&lt;/li>
&lt;li>&lt;strong>æ‰©å±•æ€§&lt;/strong> - å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æ¡ç›®ç±»å‹&lt;/li>
&lt;/ol>
&lt;h4 id="direntryraw">DirEntryRaw
&lt;/h4>&lt;p>æ ¹æ®ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªé‡è¦çš„è·¨å¹³å°ä¼˜åŒ–ç­–ç•¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">DirEntryRaw&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> path: &lt;span style="color:#a6e22e">PathBuf&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ty: &lt;span style="color:#a6e22e">fileType&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> follow_link: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> depth: &lt;span style="color:#66d9ef">usize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¹³å°ç‰¹åŒ–å­—æ®µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">#[cfg(unix)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ino: &lt;span style="color:#66d9ef">u64&lt;/span>, &lt;span style="color:#75715e">//Unix: å­˜å‚¨inodeå·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[cfg(windows)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> metadata: &lt;span style="color:#a6e22e">fs&lt;/span>::Metadata, &lt;span style="color:#75715e">//Windows:å­˜å‚¨å®Œæ•´å…ƒæ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å¹³å°ä¼˜åŒ–çš„è®¾è®¡æ€è·¯">å¹³å°ä¼˜åŒ–çš„è®¾è®¡æ€è·¯
&lt;/h5>&lt;p>&lt;strong>Unixç³»ç»Ÿ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>åªå­˜å‚¨&lt;code>inode&lt;/code>å·ï¼Œå› ä¸ºUnixæ–‡ä»¶ç³»ç»Ÿæ“ä½œç›¸å¯¹ä¾¿å®œ&lt;/li>
&lt;li>éœ€è¦æ—¶å†é€šè¿‡ç³»ç»Ÿè°ƒç”¨è·å–å®Œæ•´å…ƒæ•°æ®&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Windowsç³»ç»Ÿ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>é¢„å…ˆå­˜å‚¨å®Œæ•´çš„&lt;code>metadata&lt;/code>ï¼Œå› ä¸ºWindowsæ–‡ä»¶ç³»ç»Ÿè°ƒç”¨å¼€é”€æ¯”è¾ƒå¤§&lt;/li>
&lt;li>åœ¨ç›®å½•è¯»å–æ—¶å°±è·å–å…ƒæ•°æ®ï¼Œé¿å…åç»­é‡å¤è°ƒç”¨&lt;/li>
&lt;/ul>
&lt;h5 id="ç¬¦å·é“¾æ¥å¤„ç†é€»è¾‘">ç¬¦å·é“¾æ¥å¤„ç†é€»è¾‘
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">path_is_symlink&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ty.is_symlink() &lt;span style="color:#f92672">||&lt;/span> self.follow_link
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µè®¤ä¸ºæ˜¯ç¬¦å·é“¾æ¥ï¼š&lt;/p>
&lt;ol>
&lt;li>çœŸæ­£çš„ç¬¦å·é“¾æ¥(&lt;code>self.ty.is_symlink()&lt;/code>)&lt;/li>
&lt;li>è·Ÿéšé“¾æ¥çš„æ¡ç›®(&lt;code>self.follow_link&lt;/code>)&lt;/li>
&lt;/ol>
&lt;h4 id="walkparallelçš„å¹¶å‘éå†æœºåˆ¶">WalkParallelçš„å¹¶å‘éå†æœºåˆ¶
&lt;/h4>&lt;p>ä»ä»£ç å¯ä»¥çœ‹åˆ°&lt;code>WalkParallel&lt;/code>çš„æ ¸å¿ƒè®¾è®¡ï¼š&lt;/p>
&lt;h5 id="å›è°ƒæ¨¡å¼è€Œéè¿­ä»£å™¨">å›è°ƒæ¨¡å¼è€Œéè¿­ä»£å™¨
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;s&lt;/span>, F&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, mkf: &lt;span style="color:#a6e22e">F&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">where&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> F: FnMut() -&amp;gt; &lt;span style="color:#a6e22e">FnVisitor&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;s&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªè®¿é—®å™¨ {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.visit(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> FnBuilder {builder: &lt;span style="color:#a6e22e">mkf&lt;/span>})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡åŸå› &lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å¹¶è¡Œè¿­ä»£å™¨éš¾ä»¥å®ç°&lt;code>Iterator&lt;/code>trait&lt;/li>
&lt;li>å›è°ƒæ¨¡å¼æ›´é€‚åˆå·¥ä½œçªƒå–ç®—æ³•&lt;/li>
&lt;li>æ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„è®¿é—®å™¨ï¼Œé¿å…åŒæ­¥å¼€é”€&lt;/li>
&lt;/ul>
&lt;h5 id="çº¿ç¨‹æ± å’Œå·¥ä½œåˆ†å‘">çº¿ç¨‹æ± å’Œå·¥ä½œåˆ†å‘
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">visit&lt;/span>(&lt;span style="color:#66d9ef">mut&lt;/span> self, builder: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> &lt;span style="color:#66d9ef">dyn&lt;/span> ParallelVisitorBuilder&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> threads &lt;span style="color:#f92672">=&lt;/span> self.threads();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> stack &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">vec!&lt;/span>[];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//ä¸ºæ¯ä¸ªæ ¹è·¯å¾„åˆ›å»ºåˆå§‹å·¥ä½œé¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> path &lt;span style="color:#66d9ef">in&lt;/span> paths {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (dent, root_device) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> path &lt;span style="color:#f92672">==&lt;/span> Path::new(&lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (DirEntry::new_stdin(), None)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¤„ç†æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œæ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> root_device &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.same_file_system {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> device_num(&lt;span style="color:#f92672">&amp;amp;&lt;/span>path)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œå¤„ç†">æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œå¤„ç†
&lt;/h5>&lt;p>æ³¨æ„&lt;code>same_file_system&lt;/code>çš„å¤„ç†ï¼š&lt;/p>
&lt;ul>
&lt;li>è·å–æ ¹è·¯å¾„çš„è®¾å¤‡å·(&lt;code>device_num&lt;/code>)&lt;/li>
&lt;li>éå†æ—¶æ£€æŸ¥æ˜¯å¦è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œ&lt;/li>
&lt;li>è¿™æ˜¯Unixç³»ç»Ÿä¸­çš„é‡è¦ä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;h4 id="å·¥ä½œçªƒå–å¹¶å‘æœºåˆ¶">å·¥ä½œçªƒå–å¹¶å‘æœºåˆ¶
&lt;/h4>&lt;p>ä»ä»£ç å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç²¾å·§çš„å¹¶å‘éå†å®ç°ï¼š&lt;/p>
&lt;h5 id="å·¥ä½œçªƒå–é˜Ÿåˆ—çš„è®¾è®¡">å·¥ä½œçªƒå–é˜Ÿåˆ—çš„è®¾è®¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ª LIFO é˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> deques: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>Deque&lt;span style="color:#f92672">&amp;lt;&lt;/span>Message&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std::iter::repeat_with(Deque::new_lifo).take(threads).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åˆ›å»ºçªƒå–å™¨ï¼Œè®©æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½ä»å…¶ä»–é˜Ÿåˆ—çªƒå–å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> stealers &lt;span style="color:#f92672">=&lt;/span> Arc::&lt;span style="color:#f92672">&amp;lt;&lt;/span>[Stealer&lt;span style="color:#f92672">&amp;lt;&lt;/span>Message&lt;span style="color:#f92672">&amp;gt;&lt;/span>]&lt;span style="color:#f92672">&amp;gt;&lt;/span>::from(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> deques.iter().map(Deque::stealer).collect::&lt;span style="color:#f92672">&amp;lt;&lt;/span>Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>LIFOé˜Ÿåˆ—çš„é€‰æ‹©ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æ·±åº¦ä¼˜å…ˆéå†ï¼Œå‡å°‘å†…å­˜å ç”¨&lt;/li>
&lt;li>ä¿æŒgitignoreåŒ¹é…å™¨æ•°é‡è¾ƒä½&lt;/li>
&lt;li>å¯¹äºå®½ç›®å½•æ ‘çš„æ€§èƒ½ä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;h5 id="stackçš„çªƒå–ç­–ç•¥">Stackçš„çªƒå–ç­–ç•¥
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">steal&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Message&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…¬å¹³æ€§ï¼šä» index + 1 å¼€å§‹çªƒå–ï¼Œç„¶åç¯ç»•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> (left, right) &lt;span style="color:#f92672">=&lt;/span> self.stealers.split_at(self.index);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> right &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>right[&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">..&lt;/span>]; &lt;span style="color:#75715e">// ä¸ä»è‡ªå·±çªƒå–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> right.iter().chain(left.iter())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .map(&lt;span style="color:#f92672">|&lt;/span>s&lt;span style="color:#f92672">|&lt;/span> s.steal_batch_and_pop(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self.deque))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .find_map(&lt;span style="color:#f92672">|&lt;/span>s&lt;span style="color:#f92672">|&lt;/span> s.success())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>çªƒå–ç®—æ³•ç‰¹ç‚¹ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å…¬å¹³æ€§&lt;/strong> - è½®è¯¢å…¶ä»–çº¿ç¨‹çš„é˜Ÿåˆ—&lt;/li>
&lt;li>&lt;strong>æ‰¹é‡çªƒå–&lt;/strong> - &lt;code>steal_batch_and_pop&lt;/code>ä¸€æ¬¡çªƒå–å¤šä¸ªä»»åŠ¡&lt;/li>
&lt;li>&lt;strong>é¿å…è‡ªçªƒå–&lt;/strong> - è·³è¿‡è‡ªå·±çš„é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;h5 id="workerçš„èŒè´£åˆ†ç¦»">Workerçš„èŒè´£åˆ†ç¦»
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Worker&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;s&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor: Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> ParallelVisitor &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">&amp;#39;s&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//ç”¨æˆ·å›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> stack: &lt;span style="color:#a6e22e">Stack&lt;/span>, &lt;span style="color:#75715e">//å·¥ä½œé˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> quit_now: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>AtomicBool&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//å…¨å±€é€€å‡ºä¿¡å·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> active_workers: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>AtomicUsize&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//æ´»è·ƒå·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">//...éå†é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡äº®ç‚¹&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç”Ÿäº§è€… + æ¶ˆè´¹è€…&lt;/strong> - æ—¢å¤„ç†å·¥ä½œåˆäº§ç”Ÿæ–°å·¥ä½œ&lt;/li>
&lt;li>&lt;strong>æ·±åº¦ä¼˜å…ˆ&lt;/strong> - ä½¿ç”¨æ ˆè€Œéé˜Ÿåˆ—ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨&lt;/li>
&lt;li>&lt;strong>åä½œå¼é€€å‡º&lt;/strong> - é€šè¿‡åŸå­å˜é‡åè°ƒçº¿ç¨‹é€€å‡º&lt;/li>
&lt;/ul>
&lt;h5 id="workerå¹¶å‘æ‰§è¡Œæœºåˆ¶">Workerå¹¶å‘æ‰§è¡Œæœºåˆ¶
&lt;/h5>&lt;p>&lt;strong>æ ¸å¿ƒå·¥ä½œæµç¨‹&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;code>Worker::run()&lt;/code> - ä¸»å¾ªç¯ï¼ŒæŒç»­è·å–å’Œå¤„ç†å·¥ä½œ&lt;/li>
&lt;li>&lt;code>Worker::run_one()&lt;/code> - å¤„ç†å•ä¸ªå·¥ä½œé¡¹ï¼ŒåŒ…æ‹¬ç›®å½•éå†å’Œæ–‡ä»¶è®¿é—®&lt;/li>
&lt;li>&lt;code>Worker::generate_work()&lt;/code> - ä¸ºå­ç›®å½•ç”Ÿæˆæ–°çš„å·¥ä½œé¡¹&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>å·¥ä½œçªƒå–é˜Ÿåˆ—æœºåˆ¶&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">get_work&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Work&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> self.recv(); &lt;span style="color:#75715e">// ä»æœ¬åœ°é˜Ÿåˆ—è·å–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self.is_quit_now() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">=&lt;/span> Some(Message::Quit) &lt;span style="color:#75715e">// ä¼˜å…ˆå¤„ç†é€€å‡ºä¿¡å·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> value {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Message::Work(work)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(work),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Message::Quit) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.send_quit(); &lt;span style="color:#75715e">// ä¼ æ’­é€€å‡ºä¿¡å·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> None;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é”®ï¼šå·¥ä½œè€…å»æ¿€æ´»æœºåˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> self.deactivate_worker() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰€æœ‰å·¥ä½œè€…éƒ½ç©ºé—² = æ²¡æœ‰æ›´å¤šå·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.send_quit();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> None;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç­‰å¾…æ–°å·¥ä½œæˆ–çªƒå–å…¶ä»–é˜Ÿåˆ—çš„å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(v) &lt;span style="color:#f92672">=&lt;/span> self.recv() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.activate_worker();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">=&lt;/span> Some(v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std::thread::sleep(Duration::from_millis(&lt;span style="color:#ae81ff">1&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="æ™ºèƒ½ç»ˆæ­¢æ£€æµ‹">æ™ºèƒ½ç»ˆæ­¢æ£€æµ‹
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>åŸå­è®¡æ•°å™¨&lt;/strong>&lt;code>active_workers&lt;/code>è·Ÿè¸ªæ´»è·ƒå·¥ä½œè€…æ•°é‡&lt;/li>
&lt;li>&lt;strong>éæ¿€æ´»æœºåˆ¶&lt;/strong>ï¼šå½“å·¥ä½œè€…é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒåŸå­æ€§åœ°å‡å°‘æ´»è·ƒè®¡æ•°&lt;/li>
&lt;li>&lt;strong>å…¨å±€ç»ˆæ­¢æ£€æµ‹&lt;/strong>ï¼šå½“æ‰€æœ‰å·¥ä½œè€…éƒ½éæ¿€æ´»æ—¶ï¼Œè¯´æ˜æ²¡æœ‰æ›´å¤šçš„å·¥ä½œ&lt;/li>
&lt;li>&lt;strong>é€€å‡ºä¿¡å·ä¼ æ’­&lt;/strong>ï¼šä½¿ç”¨å¤šç±³è¯ºæ•ˆåº”å”¤é†’æ‰€æœ‰ä¼‘çœ çº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;h5 id="è¿‡æ»¤å’Œå¤„ç†é€»è¾‘">è¿‡æ»¤å’Œå¤„ç†é€»è¾‘
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">generate_work&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, ig: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Ignore&lt;/span>, depth: &lt;span style="color:#66d9ef">usize&lt;/span>, root_device: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u64&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, result: Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>fs::DirEntry, io::Error&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">WalkState&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. é”™è¯¯å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> fs_dent &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> result { &lt;span style="color:#f92672">..&lt;/span>. };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. ç¬¦å·é“¾æ¥å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> self.follow_links &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> is_symlink {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ£€æŸ¥å¾ªç¯å¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Err(err) &lt;span style="color:#f92672">=&lt;/span> check_symlink_loop(ig, dent.path(), depth) { &lt;span style="color:#f92672">..&lt;/span>. }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. å¤šå±‚è¿‡æ»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> should_skip_entry(ig, &lt;span style="color:#f92672">&amp;amp;&lt;/span>dent) { &lt;span style="color:#66d9ef">return&lt;/span> WalkState::Continue; } &lt;span style="color:#75715e">// ignore è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> is_stdout { &lt;span style="color:#66d9ef">return&lt;/span> WalkState::Continue; } &lt;span style="color:#75715e">// stdout æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> should_skip_filesize { &lt;span style="color:#f92672">..&lt;/span>. } &lt;span style="color:#75715e">// æ–‡ä»¶å¤§å°è¿‡æ»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> should_skip_filtered { &lt;span style="color:#f92672">..&lt;/span>. } &lt;span style="color:#75715e">// è‡ªå®šä¹‰è¿‡æ»¤å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. ç”Ÿæˆæ–°å·¥ä½œé¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.send(Work { dent, ignore: &lt;span style="color:#a6e22e">ig&lt;/span>.clone(), root_device });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å…³é”®è®¾è®¡æ¨¡å¼">å…³é”®è®¾è®¡æ¨¡å¼
&lt;/h5>&lt;ol>
&lt;li>&lt;strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼&lt;/strong>
&lt;ul>
&lt;li>æ¯ä¸ªWorkeræ—¢æ˜¯ç”Ÿäº§è€…åˆæ˜¯æ¶ˆè´¹è€…&lt;/li>
&lt;li>ä½¿ç”¨LIFOé˜Ÿåˆ—ä¿æŒæ·±åº¦ä¼˜å…ˆéå†çš„å±€éƒ¨æ€§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ä¼˜é›…ç»ˆæ­¢æ¨¡å¼&lt;/strong>
&lt;ul>
&lt;li>ä¼˜å…ˆçº§æ¶ˆæ¯ï¼šé€€å‡ºä¿¡å·ä¼˜å…ˆäºå·¥ä½œæ¶ˆæ¯&lt;/li>
&lt;li>ä¼ æ’­æœºåˆ¶ï¼šä¸€ä¸ªçº¿ç¨‹é€€å‡ºä¼šè§¦å‘æ‰€æœ‰çº¿ç¨‹é€€å‡º&lt;/li>
&lt;li>åŸå­çŠ¶æ€ç®¡ç†ï¼š ä½¿ç”¨&lt;code>AtomicBool&lt;/code>å’Œ&lt;code>AtomicUsize&lt;/code>è¿›è¡Œçº¿ç¨‹å®‰å…¨çš„çŠ¶æ€åè°ƒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é”™è¯¯æ¢å¤ç­–ç•¥&lt;/strong>
&lt;ul>
&lt;li>å•ä¸ªæ–‡ä»¶/ç›®å½•é”™è¯¯ä¸ä¼šç»ˆæ­¢æ•´ä¸ªéå†&lt;/li>
&lt;li>é”™è¯¯é€šè¿‡visitorå›è°ƒä¼ é€’ç»™ä¸Šå±‚å¤„ç†&lt;/li>
&lt;li>ç¬¦å·é“¾æ¥å¾ªç¯æ£€æµ‹é˜²æ­¢æ— é™é€’å½’&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>è¿™ä¸ªå®ç°å±•ç¤ºäº† Rust åœ¨ç³»ç»Ÿç¼–ç¨‹ä¸­çš„å¼ºå¤§èƒ½åŠ›ï¼š&lt;strong>é›¶æˆæœ¬æŠ½è±¡&lt;/strong>ã€&lt;strong>å†…å­˜å®‰å…¨çš„å¹¶å‘&lt;/strong>ã€&lt;strong>ä¼˜é›…çš„é”™è¯¯å¤„ç†&lt;/strong>ã€‚ç‰¹åˆ«æ˜¯å·¥ä½œçªƒå–é˜Ÿåˆ—å’Œæ™ºèƒ½ç»ˆæ­¢æ£€æµ‹çš„ç»“åˆï¼Œå®ç°äº†é«˜æ•ˆä¸”æ­£ç¡®çš„å¹¶è¡Œç›®å½•éå†ã€‚&lt;/p></description></item><item><title>Haystack</title><link>https://www.dust-zed.site/rust/ripgrep/haystack/</link><pubDate>Tue, 26 Aug 2025 09:21:41 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/haystack/</guid><description>&lt;p>&lt;code>haystack.rs&lt;/code>æ˜¯è¿æ¥æ–‡ä»¶å‘ç°å’Œæœç´¢æ‰§è¡Œçš„æ ¸å¿ƒæŠ½è±¡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//åœ¨main.rsä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> haystack_builder &lt;span style="color:#f92672">=&lt;/span> args.haystack_builder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> haystack &lt;span style="color:#f92672">=&lt;/span> haystack_builder.build_from_result(result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>searcher.search(&lt;span style="color:#f92672">&amp;amp;&lt;/span>haystack);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Haystack&lt;/code>æ˜¯å¯¹&lt;code>ignore::DirEntry&lt;/code>çš„åŒ…è£…ï¼Œæ·»åŠ äº†åº”ç”¨å±‚é€»è¾‘,å¯¹&lt;code>DirEntry&lt;/code>å¢åŠ äº†å‡ ç§åˆ¤æ–­ï¼Œè€Œ&lt;code>HaystackBuilder&lt;/code>åˆ™æ˜¯æ ¹æ®&lt;code>DirEntry&lt;/code>çš„ç±»å‹è¿”å›ä¸åŒçš„ç»“æœã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Haystack&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dent: &lt;span style="color:#a6e22e">ignore&lt;/span>::DirEntry,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> strip_dot_prefix: &lt;span style="color:#66d9ef">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Haystack {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_stdin&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_dir&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_explicit&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_file&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Haystack&lt;/code>ä¸­çš„æ–¹æ³•æŒ‡æ˜äº†æ–‡ä»¶ç±»å‹çš„å±‚æ¬¡å…³ç³»ï¼š&lt;/p>
&lt;ul>
&lt;li>æ™®é€šæ–‡ä»¶(&lt;code>is_file() == true&lt;/code>)&lt;/li>
&lt;li>ç›®å½•(&lt;code>is_dir() == true&lt;/code>)&lt;/li>
&lt;li>ç¬¦å·é“¾æ¥ (æ—¢ä¸æ˜¯æ–‡ä»¶ä¹Ÿä¸æ˜¯ç›®å½•)&lt;/li>
&lt;li>ç‰¹æ®Šæ–‡ä»¶(è®¾å¤‡ã€ç®¡é“ã€socket)&lt;/li>
&lt;/ul>
&lt;p>&lt;code>HaystackBuilder&lt;/code>æ ¹æ®å‡ ä¸ª&lt;code>is_*&lt;/code>æ–¹æ³•è¿”å›&lt;code>Option&amp;lt;Haystack&amp;gt;&lt;/code>ã€‚&lt;/p>
&lt;h4 id="haystackå¯¹direntryåŒ…è£…">Haystackå¯¹DirEntryåŒ…è£…
&lt;/h4>&lt;p>&lt;code>Haystack&lt;/code>åŒ…è£…äº†&lt;code>DirEntry&lt;/code>,è€Œä¸æ˜¯åœ¨&lt;code>DirEntry&lt;/code>ä¸­æ‰©å±•ï¼Œä½“ç°äº†å‡ ä¸ªé‡è¦çš„è®¾è®¡åŸåˆ™ï¼š&lt;/p>
&lt;h5 id="1-å…³æ³¨ç‚¹åˆ†ç¦»">1. å…³æ³¨ç‚¹åˆ†ç¦»
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ignore::DirEntry - é€šç”¨æ–‡ä»¶ç³»ç»ŸæŠ½è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// èŒè´£ï¼šæ–‡ä»¶éå†ã€åŸºç¡€å…ƒæ•°æ®ã€å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Haystack - ripgrep ç‰¹å®šçš„æœç´¢æŠ½è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// èŒè´£ï¼šæœç´¢é€»è¾‘ã€ç”¨æˆ·æ„å›¾ç†è§£ã€åº”ç”¨å±‚ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-ä¸åŒçš„è¯­ä¹‰å±‚æ¬¡">2. ä¸åŒçš„è¯­ä¹‰å±‚æ¬¡
&lt;/h5>&lt;p>&lt;code>DirEntry&lt;/code>çš„è§†è§’ï¼šæ–‡ä»¶ç³»ç»Ÿæ¡ç›®&lt;/p>
&lt;ul>
&lt;li>&lt;code>is_file()&lt;/code>â†’&amp;ldquo;è¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå—ï¼Ÿ&amp;rdquo;&lt;/li>
&lt;li>&lt;code>is_dir()&lt;/code>â†’&amp;ldquo;è¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿç›®å½•å—ï¼Ÿ&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Haystack&lt;/code>çš„è§†è§’ï¼šæœç´¢ç›®æ ‡&lt;/p>
&lt;ul>
&lt;li>&lt;code>is_explicit()&lt;/code> â†’&amp;ldquo;ç”¨æˆ·æ˜ç¡®è¦æ±‚æœç´¢è¿™ä¸ªå—ï¼Ÿ&amp;rdquo;&lt;/li>
&lt;li>&lt;code>is_dir()&lt;/code>â†’ &amp;ldquo;ä»æœç´¢è§’åº¦çœ‹ï¼Œè¿™åº”è¯¥è¢«å½“ä½œç›®å½•å¤„ç†å—ï¼Ÿ&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;h5 id="3-ç¬¦å·é“¾æ¥å¤„ç†çš„å·®å¼‚">3. ç¬¦å·é“¾æ¥å¤„ç†çš„å·®å¼‚
&lt;/h5>&lt;p>æ³¨æ„&lt;code>Haystack::is_dir()&lt;/code>çš„ç‰¹æ®Šé€»è¾‘ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_dir&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> ft &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.dent.file_type() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(ft) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> ft,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ft.is_dir() { &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é”®å·®å¼‚ï¼šé¢å¤–çš„ç¬¦å·é“¾æ¥è§£æ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.dent.path_is_symlink() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> self.dent.path().is_dir()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªé€»è¾‘æ˜¯ripgrepç‰¹æœ‰çš„ï¼Œä¸åº”è¯¥æ±¡æŸ“é€šç”¨çš„&lt;code>DirEntry&lt;/code>&lt;/p>
&lt;h5 id="4-åº”ç”¨ç‰¹å®šçš„æ¦‚å¿µ">4. åº”ç”¨ç‰¹å®šçš„æ¦‚å¿µ
&lt;/h5>&lt;p>&lt;code>Haystack&lt;/code>å¼•å…¥äº†ripgrepç‰¹æœ‰çš„æ¦‚å¿µï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>is_explicit()&lt;/code> - åŸºäº&lt;code>depth == 0&lt;/code>åˆ¤æ–­ç”¨æˆ·æ„å›¾&lt;/li>
&lt;li>&lt;code>strip_dot_prefix&lt;/code> - UIä¼˜åŒ–åŠŸèƒ½&lt;/li>
&lt;li>æœç´¢ä¼˜å…ˆçº§ç­–ç•¥ - æ˜¾å¼ &amp;gt; æ–‡ä»¶ &amp;gt; å…¶ä»–&lt;/li>
&lt;/ul>
&lt;h5 id="5-ä¾èµ–æ–¹å‘æ§åˆ¶">5. ä¾èµ–æ–¹å‘æ§åˆ¶
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>ignore &lt;span style="color:#66d9ef">crate&lt;/span> (&lt;span style="color:#960050;background-color:#1e0010">é€šç”¨&lt;/span>) &lt;span style="color:#960050;background-color:#1e0010">â†&lt;/span> ripgrep core (&lt;span style="color:#960050;background-color:#1e0010">ç‰¹å®š&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœæŠŠ ripgrep é€»è¾‘æ”¾å…¥ DirEntryï¼Œä¼šè®©é€šç”¨åº“ä¾èµ–ç‰¹å®šåº”ç”¨ï¼Œè¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ã€‚&lt;/p>
&lt;h5 id="6-æ¶æ„ä¼˜åŠ¿">6. æ¶æ„ä¼˜åŠ¿
&lt;/h5>&lt;ol>
&lt;li>å¯æµ‹è¯•æ€§ - &lt;code>Haystack&lt;/code>çš„é€»è¾‘å¯ä»¥ç‹¬ç«‹æµ‹è¯•&lt;/li>
&lt;li>å¯æ‰©å±•æ€§ - å¯ä»¥æ·»åŠ æ›´å¤šripgrepç‰¹å®šçš„æ–¹æ³•&lt;/li>
&lt;li>å¤ç”¨æ€§ - &lt;code>ignore&lt;/code>crate å¯ä»¥è¢«å…¶ä»–å·¥å…·ä½¿ç”¨&lt;/li>
&lt;li>æ¸…æ™°æ€§ - æ¯ä¸ªç±»å‹çš„èŒè´£è¾¹ç•Œæ˜ç¡®&lt;/li>
&lt;/ol>
&lt;p>è¿™æ˜¯&lt;strong>é€‚é…å™¨æ¨¡å¼&lt;/strong>çš„ç»å…¸åº”ç”¨ï¼Œä½“ç°äº†ä¼˜ç§€çš„è½¯ä»¶æ¶æ„è®¾è®¡ã€‚&lt;/p>
&lt;h5 id="7-æŠ½è±¡å±‚æ¬¡çš„è§†è§’">7. æŠ½è±¡å±‚æ¬¡çš„è§†è§’
&lt;/h5>&lt;p>ä»&lt;code>Haystack&lt;/code>çš„è®¾è®¡å¯ä»¥å­¦åˆ°ä¼˜ç§€æ¶æ„è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³ï¼š&lt;strong>æŠ½è±¡å±‚æ¬¡çš„è§†è§’åˆ†ç¦»&lt;/strong>&lt;/p>
&lt;p>&lt;code>DirEntry&lt;/code>æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„æŠ½è±¡ï¼Œå°±åº”è¯¥ä»æ–‡ä»¶ç³»ç»Ÿè§†è§’å»æ·»åŠ ä¸€äº›æ–¹æ³•ï¼›&lt;code>Haystack&lt;/code>æ˜¯æœç´¢ç›®æ ‡çš„æŠ½è±¡ï¼Œå°±åº”è¯¥ä»æœç´¢è§’åº¦å»æ·»åŠ æ–¹æ³•ã€‚&lt;/p></description></item><item><title>HiArgså’ŒlowArgs</title><link>https://www.dust-zed.site/rust/ripgrep/hiargs%E5%92%8Clowargs/</link><pubDate>Sun, 24 Aug 2025 20:57:16 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/hiargs%E5%92%8Clowargs/</guid><description>&lt;h3 id="æ ¸å¿ƒè®¾è®¡æ¨¡å¼">æ ¸å¿ƒè®¾è®¡æ¨¡å¼
&lt;/h3>&lt;h4 id="1-ä¸¤å±‚å‚æ•°ç»“æ„">1. ä¸¤å±‚å‚æ•°ç»“æ„
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>LowArgs (&lt;span style="color:#960050;background-color:#1e0010">åŸå§‹å‚æ•°&lt;/span>) &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> HiArgs (&lt;span style="color:#960050;background-color:#1e0010">å¤„ç†åçš„é…ç½®&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡ç†å¿µ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>LowArgs&lt;/strong>ï¼šæ¥è¿‘CLIåŸå§‹è¾“å…¥ï¼Œæœ€å°éªŒè¯&lt;/li>
&lt;li>&lt;strong>HiArgs&lt;/strong>ï¼šä¸šåŠ¡å°±ç»ªçš„é…ç½®ï¼ŒåŒ…å«å¤æ‚å¯¹è±¡å’Œè®¡ç®—ç»“æœ&lt;/li>
&lt;li>&lt;strong>æœ€å°éªŒè¯&lt;/strong>ï¼šæœ€å°éªŒè¯çš„æ ¸å¿ƒæ˜¯&lt;strong>å°†ä¸å—ä¿¡ä»»æ•°æ®å¿«é€Ÿè½¬å˜ä¸ºå¯ä¿¡æ•°æ®&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h4 id="2-å­—æ®µç»„ç»‡ç­–ç•¥">2. å­—æ®µç»„ç»‡ç­–ç•¥
&lt;/h4>&lt;p>&lt;strong>ç®€å•é…ç½®å­—æ®µ&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>byte_offset: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>column: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>heading: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>quiet: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ... ç›´æ¥ä»LowArgs å¤åˆ¶æˆ–ç®€å•è®¡ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å¤æ‚æ„å»ºå¯¹è±¡&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>globs: &lt;span style="color:#a6e22e">ignore&lt;/span>::overrides::Override,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pre_globs: &lt;span style="color:#a6e22e">ignore&lt;/span>::overrides::Overrode,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>types: &lt;span style="color:#a6e22e">ignore&lt;/span>::types::Types,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>patterns: &lt;span style="color:#a6e22e">Patterns&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>paths: &lt;span style="color:#a6e22e">Paths&lt;/span>,
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ç¯å¢ƒæ„ŸçŸ¥å­—æ®µ&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>is_terminal_stdout: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ£€æµ‹è¾“å‡ºç»ˆç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>mmap_choice: &lt;span style="color:#a6e22e">grep&lt;/span>::searcher::MmapChoice, &lt;span style="color:#75715e">// å†…å­˜æ˜ å°„ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>hyperlink_config: &lt;span style="color:#a6e22e">grep&lt;/span>::printer::HyperLinkConfig, &lt;span style="color:#75715e">// è¶…é“¾æ¥é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å…³é”®è®¾è®¡åŸåˆ™">å…³é”®è®¾è®¡åŸåˆ™
&lt;/h3>&lt;h4 id="1-å»¶è¿Ÿæ„å»ºæ¨¡å¼">1. å»¶è¿Ÿæ„å»ºæ¨¡å¼
&lt;/h4>&lt;p>å¤æ‚å¯¹è±¡åœ¨ &lt;code>from_low_args&lt;/code> ä¸­ç»Ÿä¸€æ„å»ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> globs &lt;span style="color:#f92672">=&lt;/span> globs(&lt;span style="color:#f92672">&amp;amp;&lt;/span>state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>low)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">// éœ€è¦æ‰€æœ‰ glob æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> types &lt;span style="color:#f92672">=&lt;/span> types(&lt;span style="color:#f92672">&amp;amp;&lt;/span>low)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">// éœ€è¦æ‰€æœ‰ç±»å‹è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> patterns &lt;span style="color:#f92672">=&lt;/span> Patterns::from_low_args(&lt;span style="color:#f92672">..&lt;/span>.)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">// éœ€è¦æ‰€æœ‰æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="2-çŠ¶æ€ä¾èµ–ç®¡ç†">2. çŠ¶æ€ä¾èµ–ç®¡ç†
&lt;/h4>&lt;p>é€šè¿‡ &lt;code>State&lt;/code> ç»“æ„ä½“ç®¡ç†ç¯å¢ƒçŠ¶æ€&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> state &lt;span style="color:#f92672">=&lt;/span> State::new()&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// state åŒ…å«ï¼šç»ˆç«¯æ£€æµ‹ã€stdin_cosumedã€å·¥ä½œç›®å½•ç­‰
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="3-é…ç½®è®¡ç®—æ¨¡å¼">3. é…ç½®è®¡ç®—æ¨¡å¼
&lt;/h4>&lt;p>æ ¹æ®ç¯å¢ƒå’Œæ ‡å¿—åŠ¨æ€è®¡ç®—æœ€ç»ˆé…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> color &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> low.color {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ColorChoice::Auto &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>state.is_terminal_stdout &lt;span style="color:#f92672">=&amp;gt;&lt;/span> ColorChoice::Never,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _ &lt;span style="color:#f92672">=&amp;gt;&lt;/span> low.color,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> heading &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> low.heading {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>low.vimgrep &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> state.is_terminal_stdout, &lt;span style="color:#75715e">// æ™ºèƒ½é»˜è®¤å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Some(value) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> value &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>low.vimgrep, &lt;span style="color:#75715e">// è€ƒè™‘æ ‡å¿—å†²çª
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>HiArgs&lt;/code> å’Œ &lt;code>LowArgs&lt;/code> è¿™ç§åˆ†å±‚è®¾è®¡ï¼Œå°†â€œè§£æâ€å’Œâ€œé…ç½®â€èŒè´£åˆ†ç¦»ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¨¡å—åŒ–ï¼Œæ¯å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œã€‚&lt;/p>
&lt;h3 id="æ ¸å¿ƒæ„å»ºæ–¹æ³•">æ ¸å¿ƒæ„å»ºæ–¹æ³•
&lt;/h3>&lt;h4 id="matcher-æ–¹æ³•çš„è®¾è®¡æ¨¡å¼">matcher() æ–¹æ³•çš„è®¾è®¡æ¨¡å¼
&lt;/h4>&lt;p>&lt;strong>ç­–ç•¥æ¨¡å¼&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">matcher&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>PatternMatcher&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self.engine {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EngineChoice::Default &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.matcher_rust() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(m) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(m),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> anyhow::&lt;span style="color:#a6e22e">bail!&lt;/span>(suggest_other_engine(err.to_string())),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EngineChoice::&lt;span style="color:#66d9ef">PCRE2&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(self.matcher_pcre2()&lt;span style="color:#f92672">?&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EngineChoice::Auto &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°è¯• Rust å¼•æ“ï¼Œå¤±è´¥åˆ™å°è¯• PCRE2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> rust_err &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.matcher_rust() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(m) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Ok(m),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> err,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> pcre_err &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.matcher_pcre2() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(m) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Ok(m),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> err,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸¤ä¸ªéƒ½å¤±è´¥ï¼Œæä¾›è¯¦ç»†é”™è¯¯ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> anyhow::&lt;span style="color:#a6e22e">bail!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;regex could not be compiled with either engine...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡æ€è·¯&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„å¼•æ“ç±»å‹ï¼ŒåŠ¨æ€é€‰æ‹©ä¸åŒçš„åŒ¹é…å™¨å®ç°&lt;/li>
&lt;li>&lt;code>Auto&lt;/code> æ¨¡å¼ä½“ç°äº†ä¼˜é›…çš„é™çº§ç­–ç•¥ï¼šå…ˆå°è¯•é»˜è®¤å¼•æ“ï¼Œå¤±è´¥åˆ™å°è¯• PCRE2&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>å»ºé€ è€…æ¨¡å¼&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">matcher_rust&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>PatternMatcher&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> builder &lt;span style="color:#f92672">=&lt;/span> grep::regex::RegexMatcherBuilder::new();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .multi_line(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .unicode(&lt;span style="color:#f92672">!&lt;/span>self.no_unicode)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .octal(&lt;span style="color:#66d9ef">false&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .fixed_strings(self.fixed_strings);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ¹æ®é…ç½®é€æ­¥æ„å»º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.case {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CaseMode::Sensitive &lt;span style="color:#f92672">=&amp;gt;&lt;/span> builder.case_insensitive(&lt;span style="color:#66d9ef">false&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CaseMode::Insensitive &lt;span style="color:#f92672">=&amp;gt;&lt;/span> builder.case_insensitive(&lt;span style="color:#66d9ef">true&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CaseMode::Smart &lt;span style="color:#f92672">=&amp;gt;&lt;/span> builder.case_smart(&lt;span style="color:#66d9ef">true&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœ€ç»ˆæ„å»º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> builder.build_many(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self.patterns.patterns)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(PatternMatcher::RustRegex(m))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡æ€è·¯&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨å»ºé€ è€…æ¨¡å¼é€æ­¥é…ç½®å¤æ‚å¯¹è±¡&lt;/li>
&lt;li>é“¾å¼è°ƒç”¨æä¾›æµç•…çš„ API&lt;/li>
&lt;li>æœ€åè°ƒç”¨ &lt;code>build_many()&lt;/code> å®Œæˆæ„å»º&lt;/li>
&lt;/ul>
&lt;h4 id="æ¡ä»¶ç¼–è¯‘å’Œç‰¹æ€§é—¨æ§">æ¡ä»¶ç¼–è¯‘å’Œç‰¹æ€§é—¨æ§
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">matcher_pcre2&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>PatternMatcher&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[cfg(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;pcre2&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// PCRE2 å®ç°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> builder &lt;span style="color:#f92672">=&lt;/span> grep::pcre2::RegexMatcherBuilder::new();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ... é…ç½®ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(PatternMatcher::&lt;span style="color:#66d9ef">PCRE2&lt;/span>(m))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[cfg(not(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;pcre2&amp;#34;&lt;/span>&lt;span style="color:#75715e">))]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(anyhow::&lt;span style="color:#a6e22e">anyhow!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;PCRE2 is not available in this build&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡æ€è·¯&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä½¿ç”¨ Rust çš„æ¡ä»¶ç¼–è¯‘ç‰¹æ€§&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç‰¹æ€§å®šä¹‰ï¼ˆ&lt;code>Cargo.toml&lt;/code>ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#a6e22e">features&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">pcre2&lt;/span> = [&lt;span style="color:#e6db74">&amp;#34;grep/pcre2&amp;#34;&lt;/span>] &lt;span style="color:#960050;background-color:#1e0010">//&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å®šä¹‰&lt;/span> &lt;span style="color:#a6e22e">pcre2&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">ç‰¹æ€§ï¼Œä¾èµ–äº&lt;/span> &lt;span style="color:#a6e22e">grep&lt;/span> &lt;span style="color:#a6e22e">crate&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">çš„&lt;/span> &lt;span style="color:#a6e22e">pcre2&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">ç‰¹æ€§&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>åœ¨ç¼–è¯‘æ—¶å†³å®šæ˜¯å¦åŒ…å« PCRE2 æ”¯æŒ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å…¶ä»–æ–¹æ³•">å…¶ä»–æ–¹æ³•
&lt;/h3>&lt;p>&lt;code>searcher()&lt;/code>ã€&lt;code>printer()&lt;/code> ç­‰å…¶ä»–æ„é€ æ–¹æ³•åŸºæœ¬é‡‡ç”¨å»ºé€ è€…æ¨¡å¼ã€‚&lt;code>search_worker()&lt;/code> æ–¹æ³•å•ç‹¬è¯´æ˜ï¼š&lt;/p>
&lt;h4 id="ç»„ä»¶ç»„åˆæ¨¡å¼">ç»„ä»¶ç»„åˆæ¨¡å¼
&lt;/h4>&lt;p>&lt;code>search_worker&lt;/code> ä½“ç°ç»å…¸çš„ &lt;strong>ç»„åˆæ¨¡å¼&lt;/strong>ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>SearchWorker
â”œâ”€â”€ PatternMatcher (æ¨¡å¼åŒ¹é…)
â”œâ”€â”€ Searcher (æ–‡ä»¶æœç´¢)
â””â”€â”€ Printer (ç»“æœè¾“å‡º)
&lt;/code>&lt;/pre>&lt;p>æ¯ä¸ªç»„ä»¶èŒè´£ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>PatternMatcher&lt;/code>ï¼šåˆ¤æ–­æ–‡æœ¬æ˜¯å¦åŒ¹é…æ¨¡å¼&lt;/li>
&lt;li>&lt;code>Searcher&lt;/code>ï¼šè¯»å–æ–‡ä»¶å†…å®¹ï¼ŒæŒ‰è¡Œå¤„ç†&lt;/li>
&lt;li>&lt;code>Printer&lt;/code>ï¼šæ ¼å¼åŒ–å¹¶è¾“å‡ºåŒ¹é…ç»“æœ&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>è®¾è®¡ä¼˜åŠ¿&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>èŒè´£åˆ†ç¦»ï¼šæ¯ä¸ªç»„ä»¶ä¸“æ³¨äºè‡ªå·±çš„åŠŸèƒ½&lt;/li>
&lt;li>å¯æµ‹è¯•æ€§ï¼šå¯ä»¥ç‹¬ç«‹æµ‹è¯•æ¯ä¸ªç»„ä»¶&lt;/li>
&lt;li>å¯æ‰©å±•æ€§ï¼šå¯ä»¥æ›¿æ¢ä»»ä½•ç»„ä»¶çš„å®ç°&lt;/li>
&lt;/ul>
&lt;h4 id="walk_builder">walk_builder()
&lt;/h4>&lt;h5 id="èŒè´£åˆ†å±‚">èŒè´£åˆ†å±‚
&lt;/h5>&lt;p>åŒ…å«å››ä¸ªæ ¸å¿ƒèŒè´£ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>è·¯å¾„ç®¡ç†&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> builder &lt;span style="color:#f92672">=&lt;/span> ignore::WalkBuilder::new(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self.paths.paths[&lt;span style="color:#ae81ff">0&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> path &lt;span style="color:#66d9ef">in&lt;/span> self.paths.paths.iter().skip(&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builder.add(path)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åˆå§‹åŒ–ï¼šä½¿ç”¨ç¬¬ä¸€ä¸ªè·¯å¾„ä½œä¸ºæ ¹è·¯å¾„&lt;/li>
&lt;li>æ‰©å±•ï¼šæ·»åŠ æ‰€æœ‰é¢å¤–çš„æœç´¢è·¯å¾„&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>&lt;strong>å¿½ç•¥æ–‡ä»¶ç³»ç»Ÿé…ç½®&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç”¨æˆ·è‡ªå®šä¹‰å¿½ç•¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.no_ignore_files {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> path &lt;span style="color:#66d9ef">in&lt;/span> self.ignore_file.iter() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(err) &lt;span style="color:#f92672">=&lt;/span> builder.add_ignore(path) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">ignore_message!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;{err}&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Git é›†æˆå¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>.git_global(&lt;span style="color:#f92672">!&lt;/span>self.no_ignore_vcs &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.no_ignore_global)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.git_ignore(&lt;span style="color:#f92672">!&lt;/span>self.no_ignore_vcs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.git_exclude(&lt;span style="color:#f92672">!&lt;/span>self.no_ignore_vcs &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.no_ignore_exclude)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é€šç”¨å¿½ç•¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>.ignore(&lt;span style="color:#f92672">!&lt;/span>self.no_ignore_dot)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.parents(&lt;span style="color:#f92672">!&lt;/span>self.no_ignore_parent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ripgrep ä¸“ç”¨å¿½ç•¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.no_ignore_dot {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builder.add_custom_ignore_filename(&lt;span style="color:#e6db74">&amp;#34;.rgignore&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>&lt;strong>éå†è¡Œä¸ºé…ç½®&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>builder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .max_depth(self.max_depth) &lt;span style="color:#75715e">// æœ€å¤§é€’å½’æ·±åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .follow_links(self.follow) &lt;span style="color:#75715e">// æ˜¯å¦è·Ÿéšç¬¦å·é“¾æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .max_filesize(self.max_filesize) &lt;span style="color:#75715e">// æœ€å¤§æ–‡ä»¶å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .threads(self.threads) &lt;span style="color:#75715e">// çº¿ç¨‹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .same_file_system(self.one_file_system) &lt;span style="color:#75715e">// æ˜¯å¦é™åˆ¶åœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .skip_stdout(&lt;span style="color:#a6e22e">matches!&lt;/span>(self.mode, Mode::Search(_))) &lt;span style="color:#75715e">// è·³è¿‡æ ‡å‡†è¾“å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .hidden(&lt;span style="color:#f92672">!&lt;/span>self.hidden) &lt;span style="color:#75715e">// æ˜¯å¦åŒ…å«éšè—æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .require_git(&lt;span style="color:#f92672">!&lt;/span>self.no_require_git) &lt;span style="color:#75715e">// æ˜¯å¦è¦æ±‚ Git ä»“åº“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .ignore_case_insensitive(self.ignore_file_case_insensitive); &lt;span style="color:#75715e">// å¿½ç•¥æ–‡ä»¶å¤§å°å†™
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>&lt;strong>é«˜çº§åŠŸèƒ½é…ç½®&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ–‡ä»¶ç±»å‹è¿‡æ»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>.overrides(self.globs.clone())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.types(self.types.clone())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ’åºä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(&lt;span style="color:#66d9ef">ref&lt;/span> sort) &lt;span style="color:#f92672">=&lt;/span> self.sort {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, self.threads, &lt;span style="color:#e6db74">&amp;#34;sorting implies single threaded&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>sort.reverse &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">matches!&lt;/span>(sort.kind, SortModeKind::Path) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builder.sort_by_file_name(&lt;span style="color:#f92672">|&lt;/span>a, b&lt;span style="color:#f92672">|&lt;/span> a.cmp(b));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>walk_builder&lt;/code> æ˜¯ç³»ç»Ÿé›†æˆç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>åº•å±‚&lt;/strong>ï¼šæ–‡ä»¶ç³»ç»Ÿéå†ï¼ˆ&lt;code>ignore::WalkBuilder&lt;/code>ï¼‰&lt;/li>
&lt;li>&lt;strong>ä¸­å±‚&lt;/strong>ï¼šå¿½ç•¥è§„åˆ™å¤„ç†ï¼ˆGitã€è‡ªå®šä¹‰ã€ç±»å‹è¿‡æ»¤ï¼‰&lt;/li>
&lt;li>&lt;strong>ä¸Šå±‚&lt;/strong>ï¼šç”¨æˆ·é…ç½®æ˜ å°„ï¼ˆå‘½ä»¤è¡Œå‚æ•°åˆ°è¡Œä¸ºï¼‰&lt;/li>
&lt;/ul>
&lt;h4 id="current_dir">current_dir()
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">current_dir&lt;/span>() -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>PathBuf&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> err &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> std::env::current_dir() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> err, &lt;span style="color:#75715e">// ä¿å­˜é”™è¯¯ï¼Œç»§ç»­å°è¯•å›é€€æ–¹æ¡ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(cwd) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Ok(cwd), &lt;span style="color:#75715e">// æˆåŠŸåˆ™ç›´æ¥è¿”å›
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(cwd) &lt;span style="color:#f92672">=&lt;/span> std::env::var_os(&lt;span style="color:#e6db74">&amp;#34;PWD&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>cwd.is_empty() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Ok(PathBuf::from(cwd));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> anyhow::&lt;span style="color:#a6e22e">bail!&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;failed to get current working directory: {err}&lt;/span>&lt;span style="color:#ae81ff">\n\&lt;/span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> did your CWD get deleted?&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ–¹æ³•è·å–å½“å‰å·¥ä½œç›®å½•æ—¶çš„å¼‚å¸¸å¤„ç†ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç›®å½•è¢«åˆ é™¤&lt;/strong> - è¿›ç¨‹æ‰€åœ¨ç›®å½•å¯èƒ½è¢«å…¶ä»–è¿›ç¨‹åˆ é™¤&lt;/li>
&lt;li>&lt;strong>æƒé™é—®é¢˜&lt;/strong> - æ— è¯»å–å½“å‰ç›®å½•æƒé™&lt;/li>
&lt;li>&lt;strong>ç¬¦å·é“¾æ¥é—®é¢˜&lt;/strong> - å½“å‰ç›®å½•æ˜¯æŸåçš„ç¬¦å·é“¾æ¥&lt;/li>
&lt;/ul>
&lt;p>ä¸ºä½•éœ€è¦å¤æ‚å¤„ç†ï¼Ÿ&lt;/p>
&lt;ol>
&lt;li>éœ€è¦ cwd å°†ç›¸å¯¹è·¯å¾„è½¬ç»å¯¹è·¯å¾„ï¼ˆå¦‚ &lt;code>rg &amp;quot;pattern&amp;quot; ../other_projects/&lt;/code>ï¼‰&lt;/li>
&lt;li>é€šè¿‡ &lt;code>PWD&lt;/code> ç¯å¢ƒå˜é‡å›é€€ä¿è¯å¥å£®æ€§&lt;/li>
&lt;/ol>
&lt;p>&lt;code>hiargs.rs&lt;/code> ä¸­å…¶ä»–æ–¹æ³•å‡åŸºäº &lt;code>LowArgs&lt;/code> å®Œå–„ &lt;code>HiArgs&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ ¸å¿ƒæ•°æ®ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> patterns &lt;span style="color:#f92672">=&lt;/span> Patterns::from_low_args(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> low)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> paths &lt;span style="color:#f92672">=&lt;/span> Paths::from_low_args(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>patterns, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> low)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> binary &lt;span style="color:#f92672">=&lt;/span> BinaryDetection::from_low_args(&lt;span style="color:#f92672">&amp;amp;&lt;/span>state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>low);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¾…åŠ©åŠŸèƒ½é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> colors &lt;span style="color:#f92672">=&lt;/span> take_color_specs(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> low);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hyperlink_config &lt;span style="color:#f92672">=&lt;/span> take_hyperlink_config(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> low)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> stats &lt;span style="color:#f92672">=&lt;/span> stats(&lt;span style="color:#f92672">&amp;amp;&lt;/span>low);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> types &lt;span style="color:#f92672">=&lt;/span> types(&lt;span style="color:#f92672">&amp;amp;&lt;/span>low)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> globs &lt;span style="color:#f92672">=&lt;/span> globs(&lt;span style="color:#f92672">&amp;amp;&lt;/span>state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>low)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">// æ–‡ä»¶åŒ¹é…è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> pre_globs &lt;span style="color:#f92672">=&lt;/span> preprocessor_globs(&lt;span style="color:#f92672">&amp;amp;&lt;/span>state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>low)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">// é¢„å¤„ç†å™¨è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ ¸å¿ƒç»“æ„ä½“">æ ¸å¿ƒç»“æ„ä½“
&lt;/h3>&lt;h4 id="patterns">Patterns
&lt;/h4>&lt;p>è¡¨ç¤ºè¦åŒ¹é…çš„å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Patterns&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> patterns: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¨¡å¼æ¥æºçš„ç»Ÿä¸€å¤„ç†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">from_low_args&lt;/span>(state: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> State, low: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> LowArgs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>Patterns&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸‰ç§æ¨¡å¼æ¥æºï¼š&lt;/p>
&lt;ol>
&lt;li>positionalï¼š&lt;code>rg &amp;quot;pattern&amp;quot; file.txt&lt;/code>&lt;/li>
&lt;li>&lt;code>-e/--regexp&lt;/code>: &lt;code>rg -e &amp;quot;pattern1&amp;quot; -e &amp;quot;pattern2&amp;quot;&lt;/code>&lt;/li>
&lt;li>&lt;code>-f/--file&lt;/code>: &lt;code>rg -f patterns.txt&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>&lt;code>-e/--regexp&lt;/code> å¯¹åº” &lt;code>Pattern&lt;/code> flag çš„ update é€»è¾‘ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">update&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self, v: &lt;span style="color:#a6e22e">FlagValue&lt;/span>, args: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> LowArgs) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> regexp &lt;span style="color:#f92672">=&lt;/span> convert::string(v.unwrap_value());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> args.patterns.push(PatternSource::Regexp(regexp));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>-f/--file&lt;/code> å¯¹åº” &lt;code>File&lt;/code> flag çš„ update é€»è¾‘ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">update&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self, v: &lt;span style="color:#a6e22e">FlagValue&lt;/span>, args: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> LowArgs) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> path &lt;span style="color:#f92672">=&lt;/span> PathBuf::from(v.unwrap_value());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> args.patterns.push(PatternSource::File(path));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Patterns::from_low_args&lt;/code> ä»ä¸‰ç§æ¥æºæ„é€ å»é‡(åˆ©ç”¨&lt;code>HashSet&lt;/code>)çš„ &lt;code>Patterns::patterns: Vec&amp;lt;String&amp;gt;&lt;/code> ã€‚&lt;code>-f file.txt, --file=file.txt&lt;/code>ä¸­&lt;code>file.txt(patternæ–‡ä»¶)&lt;/code>å­˜æ”¾ç€éœ€è¦åŒ¹é…çš„&lt;code>patterns&lt;/code>ã€‚&lt;/p>
&lt;h4 id="paths---è·¯å¾„ç®¡ç†ç³»ç»Ÿ">Paths - è·¯å¾„ç®¡ç†ç³»ç»Ÿ
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Paths&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> paths: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>PathBuf&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// å®é™…è·¯å¾„åˆ—è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> has_implicit_path: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ˜¯å¦æœ‰éšå¼è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> is_one_file: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ˜¯å¦åªæœç´¢å•ä¸ªæ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¦ä¹ˆä»&lt;code>positional&lt;/code>ä¸­è¯»å–æ–‡ä»¶è·¯å¾„ï¼Œè¦ä¹ˆå°±æ˜¯æ™ºèƒ½è·¯å¾„æ¨æ–­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">from_low_args&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> State,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Patterns&lt;/span>, &lt;span style="color:#75715e">// è™½ç„¶ä¸ä½¿ç”¨ï¼Œä½†å¼ºåˆ¶è¦æ±‚å­˜åœ¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> low: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> LowArgs,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>) -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>Paths&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> paths &lt;span style="color:#f92672">=&lt;/span> Vec::with_capacity(low.positional.len());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> osarg &lt;span style="color:#66d9ef">in&lt;/span> low.positional.drain(&lt;span style="color:#f92672">..&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> path &lt;span style="color:#f92672">=&lt;/span> PathBuf::from(osarg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> state.stdin_consumed &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> path &lt;span style="color:#f92672">==&lt;/span> Path::new(&lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> anyhow::&lt;span style="color:#a6e22e">bail!&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;error: attempted to read patterns from stdin &lt;/span>&lt;span style="color:#ae81ff">\&lt;/span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> while also searching stdin&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> paths.push(path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">..&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> use_cwd &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">!&lt;/span>is_readable_stdin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">||&lt;/span> state.stdin_consumed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#a6e22e">matches!&lt;/span>(low.mode, Mode::Search(_));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (path, is_one_file) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> use_cwd {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (PathBuf::from(&lt;span style="color:#e6db74">&amp;#34;./&amp;#34;&lt;/span>), &lt;span style="color:#66d9ef">false&lt;/span>) &lt;span style="color:#75715e">// æœç´¢å½“å‰ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (PathBuf::from(&lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>), &lt;span style="color:#66d9ef">true&lt;/span>) &lt;span style="color:#75715e">// æœç´¢ stdin
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Paths::from_low_args()&lt;/code>å‡½æ•°ä½¿ç”¨äº†ä¸€ä¸ªéå¸¸å·§å¦™çš„&lt;strong>ç¼–è¯‘æ—¶ä¾èµ–çº¦æŸ&lt;/strong>è®¾è®¡ï¼Œè¿™ä¸ªè®¾è®¡ç¡®ä¿äº†&lt;/p>
&lt;ul>
&lt;li>è°ƒç”¨ç€å¿…é¡»å…ˆæ„é€ &lt;code>Patterns&lt;/code>&lt;/li>
&lt;li>ç¼–è¯‘å™¨ä¼šæ£€æŸ¥è¿™ä¸ªçº¦æŸ&lt;/li>
&lt;li>æ— æ³•æ„å¤–åœ°é¢ å€’è°ƒç”¨é¡ºåº&lt;/li>
&lt;/ul>
&lt;p>è®¾è®¡&lt;strong>ç¼–è¯‘æ—¶ä¾èµ–çº¦æŸ&lt;/strong>çš„åŸå› æ˜¯&lt;code>Patterns&lt;/code>å’Œ&lt;code>Paths&lt;/code>éƒ½ä½¿ç”¨äº†&lt;code>positional&lt;/code>,æ­¤æ•°æ®æ¶ˆè´¹é¡ºåºä¸å¯é¢ å€’ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Patterns::from_low_args ä¸­ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> low.patterns.is_empty() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> ospat &lt;span style="color:#f92672">=&lt;/span> low.positional.remove(&lt;span style="color:#ae81ff">0&lt;/span>); &lt;span style="color:#75715e">// æ¶ˆè´¹ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Ok(Patterns { patterns: &lt;span style="color:#a6e22e">vec&lt;/span>&lt;span style="color:#f92672">!&lt;/span>[pat] });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Paths::from_low_args ä¸­ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">for&lt;/span> osarg &lt;span style="color:#66d9ef">in&lt;/span> low.positional.drain(&lt;span style="color:#f92672">..&lt;/span>) { &lt;span style="color:#75715e">// å¤„ç†å‰©ä½™çš„ä½ç½®å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> paths.push(PathBuf::from(osarg));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ç¼–è¯‘æ—¶ä¾èµ–çº¦æŸè®¾è®¡ä¼˜åŠ¿&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç¼–è¯‘æ—¶å®‰å…¨&lt;/strong> - ç±»å‹ç³»ç»Ÿé˜²æ­¢é”™è¯¯è°ƒç”¨é¡ºåº&lt;/li>
&lt;li>&lt;strong>è‡ªæ–‡æ¡£åŒ–&lt;/strong> - å‡½æ•°ç­¾åæ¸…æ¥šè¡¨è¾¾ä¾èµ–å…³ç³»&lt;/li>
&lt;li>&lt;strong>é›¶è¿è¡Œæ—¶æˆæœ¬&lt;/strong> - çº¦æŸåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œè¿è¡Œæ—¶æ— å¼€é”€&lt;/li>
&lt;li>&lt;strong>API æ¸…æ™°æ€§&lt;/strong> - å¼ºåˆ¶è°ƒç”¨è€…ç†è§£æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼&lt;/li>
&lt;/ol>
&lt;p>å•æ–‡ä»¶ä¼˜åŒ–æ£€æµ‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> is_one_file &lt;span style="color:#f92672">=&lt;/span> paths.len() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> (paths[&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#f92672">==&lt;/span> Path::new(&lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>) &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#f92672">!&lt;/span>paths[&lt;span style="color:#ae81ff">0&lt;/span>].is_dir());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>!is_dir()&lt;/code> è€Œé &lt;code>is_file()&lt;/code> æ›´å‡†ç¡®&lt;/li>
&lt;li>stdin (&lt;code>-&lt;/code>) è¢«è§†ä¸ºå•æ–‡ä»¶&lt;/li>
&lt;li>å•æ–‡ä»¶æœç´¢å¯ç”¨ç‰¹å®šä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;h4 id="binarydetection---äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹ç³»ç»Ÿ">BinaryDetection - äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹ç³»ç»Ÿ
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">BinaryDetection&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> explicit: &lt;span style="color:#a6e22e">grep&lt;/span>::searcher::BinaryDetection &lt;span style="color:#75715e">// æ˜¾å¼æŒ‡å®šæ–‡ä»¶çš„æ£€æµ‹ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> implicit: &lt;span style="color:#a6e22e">grep&lt;/span>::searcher::BinaryDetection &lt;span style="color:#75715e">// éšå¼å‘ç°æ–‡ä»¶çš„æ£€æµ‹ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ˜¾å¼ vs éšå¼æ–‡ä»¶å¤„ç†&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> explicit &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> none {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> grep::searcher::BinaryDetection::none()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> grep::searcher::BinaryDetection::convert(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;\x00&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> implicit &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> none {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> grep::searcher::BinaryDetection::none()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> convert {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> grep::searcher::BinaryDetection::convert(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;\x00&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> grep::searcher::BinaryDetection::quit(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;\x00&amp;#39;&lt;/span>) &lt;span style="color:#75715e">// å…³é”®å·®å¼‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>æ˜¾å¼æ–‡ä»¶&lt;/strong>ï¼šç”¨æˆ·æ˜ç¡®æŒ‡å®šï¼Œå¿…é¡»æœç´¢ï¼Œä¸èƒ½â€œé€€å‡ºâ€&lt;/li>
&lt;li>&lt;strong>éšå¼æ–‡ä»¶&lt;/strong>ï¼šç›®å½•éå†å‘ç°ï¼Œå¯ä»¥è·³è¿‡äºŒè¿›åˆ¶æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä¸‰ç§æ£€æµ‹æ¨¡å¼&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>none&lt;/code>ï¼šç¦ç”¨äºŒè¿›åˆ¶æ£€æµ‹ï¼Œå½“ä½œæ–‡æœ¬å¤„ç† (&lt;code>--text&lt;/code> æˆ– &lt;code>--null-data&lt;/code>)&lt;/li>
&lt;li>&lt;code>convert(b'\x00')&lt;/code>ï¼šå°† null å­—èŠ‚è½¬æ¢ä¸ºæ¢è¡Œç¬¦ç»§ç»­æœç´¢ (&lt;code>--binary&lt;/code>)&lt;/li>
&lt;li>&lt;code>quit(b'\x00')&lt;/code>ï¼šé‡åˆ° null å­—èŠ‚ç«‹å³åœæ­¢æœç´¢è¯¥æ–‡ä»¶&lt;/li>
&lt;/ol>
&lt;p>é»˜è®¤ç­–ç•¥ï¼š&lt;/p>
&lt;ul>
&lt;li>æ˜¾å¼æ–‡ä»¶ï¼š&lt;code>convert(b'\x00')&lt;/code>&lt;/li>
&lt;li>éšå¼æ–‡ä»¶ï¼š&lt;code>quit(b'\x00')&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="state---è§£æçŠ¶æ€ç®¡ç†">State - è§£æçŠ¶æ€ç®¡ç†
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">State&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> is_terminal_stdout: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// stdout æ˜¯å¦è¿æ¥åˆ°ç»ˆç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> stdin_consumed: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// stdin æ˜¯å¦å·²è¢«æ¶ˆè´¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> cwd: &lt;span style="color:#a6e22e">PathBuf&lt;/span>, &lt;span style="color:#75715e">// å½“å‰å·¥ä½œç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>is_terminal_stdout&lt;/code>ï¼šå½±å“é¢œè‰²è¾“å‡ºã€ç¼“å†²ç­–ç•¥ç­‰ï¼ˆéœ€è·¨å¹³å°å¤„ç†ï¼‰&lt;/li>
&lt;li>&lt;code>stdin_consumed&lt;/code>ï¼šé˜²æ­¢åŒæ—¶ä» stdin è¯»å–æ¨¡å¼å’Œå†…å®¹&lt;/li>
&lt;/ul>
&lt;h3 id="ç»“æ„ä½“è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³">ç»“æ„ä½“è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³
&lt;/h3>&lt;h4 id="1-èŒè´£åˆ†ç¦»">1. èŒè´£åˆ†ç¦»
&lt;/h4>&lt;ul>
&lt;li>&lt;code>Patterns&lt;/code>ï¼šæ¨¡å¼æ”¶é›†å’Œå»é‡&lt;/li>
&lt;li>&lt;code>Paths&lt;/code>ï¼šè·¯å¾„ç®¡ç†å’Œæ¨æ–­&lt;/li>
&lt;li>&lt;code>BinaryDetection&lt;/code>ï¼šäºŒè¿›åˆ¶æ–‡ä»¶å¤„ç†ç­–ç•¥&lt;/li>
&lt;li>&lt;code>State&lt;/code>ï¼šè§£æçŠ¶æ€è·Ÿè¸ª&lt;/li>
&lt;/ul></description></item><item><title>Flagsç›¸å…³</title><link>https://www.dust-zed.site/rust/ripgrep/flags%E7%9B%B8%E5%85%B3/</link><pubDate>Sat, 23 Aug 2025 12:06:35 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/flags%E7%9B%B8%E5%85%B3/</guid><description>&lt;p>&lt;code>flag&lt;/code>æ˜¯å‘½ä»¤è¡Œä¸­çš„ä¸€ä¸ªé€‰é¡¹æˆ–å¼€å…³(ä»¥&lt;code>-&lt;/code>æˆ–&lt;code>--&lt;/code>å¼€å¤´)ï¼Œç”¨æ¥æ”¹å˜ç¨‹åºçš„è¡Œä¸ºæˆ–ä¼ å…¥å‚æ•°ã€‚&lt;/p>
&lt;h4 id="ç›¸å…³å®šä¹‰">ç›¸å…³å®šä¹‰
&lt;/h4>&lt;p>&lt;code>FlagValue&lt;/code>å¯¹flagè¿›è¡Œäº†åˆ†ç±»ï¼š&lt;code>Switch&lt;/code>&amp;mdash;-æ”¹å˜ç¨‹åºè¡Œä¸ºå’Œ&lt;code>Value&lt;/code>&amp;mdash;&amp;ndash;ä¼ å…¥å‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">FlagValue&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Switch(&lt;span style="color:#66d9ef">bool&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Value(OsString),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Flag&lt;/code> traitæŠ½è±¡å¹¶å®šä¹‰äº†â€œä¸€ä¸ªé€»è¾‘ä¸Šçš„å‘½ä»¤è¡Œé€‰é¡¹/å¼€å…³çš„å…ƒä¿¡æ¯ä¸è¡Œä¸ºï¼ˆåç§°ã€åˆ«åã€æ˜¯å¦ä¸ºå¼€å…³ã€å¸®åŠ©æ–‡æœ¬ã€ç±»åˆ«ç­‰ï¼‰â€ä»¥åŠåœ¨è§£æåå¦‚ä½•æŠŠè¯¥é€‰é¡¹çš„å€¼åº”ç”¨åˆ°ä½çº§å‚æ•°ç»“æ„&lt;code>LowArgs&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">trait&lt;/span> Flag {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_switch&lt;/span>() -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">name_&lt;/span>&lt;span style="color:#f92672">*&lt;/span>(); &lt;span style="color:#75715e">// åå­—ä¸åˆ«å/å¦å®šå
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">doc_&lt;/span>&lt;span style="color:#f92672">*&lt;/span>(); &lt;span style="color:#75715e">//å¸®åŠ©æ–‡æœ¬æ–‡æ¡£ã€å˜é‡åã€å¯é€‰å€¼åˆ—è¡¨ã€ç±»åˆ«ç­‰ï¼ˆç”¨äºç”Ÿæˆ-h/man/completionï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">completion_type&lt;/span>(); &lt;span style="color:#75715e">// ç”¨äºshellè‡ªåŠ¨è¡¥å…¨çš„å‚æ•°ç±»å‹åˆ†ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">update&lt;/span>(); &lt;span style="color:#75715e">//æŠŠè§£æå¾—åˆ°çš„FlagValueåº”ç”¨åˆ°LowArgs(åªåšéªŒè¯/èµ‹å€¼ï¼Œä¸æ‰§è¡Œæ˜‚è´µæ“ä½œ)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨æµç¨‹(ä¼ªä»£ç )&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> token &lt;span style="color:#66d9ef">in&lt;/span> argv {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (flag_impl, value) &lt;span style="color:#f92672">=&lt;/span> match_token_to_flag(token, &lt;span style="color:#66d9ef">FLAGS&lt;/span>)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flag_impl.update(value, &lt;span style="color:#f92672">&amp;amp;&lt;/span>mutual low_args)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">//æ¯ä¸ªFlagæŠŠè‡ªå·±çš„è¯­ä¹‰å†™å…¥low_args
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è®¾è®¡åŸåˆ™ï¼šFlagçš„updateä¸åšå‰¯ä½œç”¨æ€§â€œåŠ¨ä½œâ€ï¼ˆå¦‚è¿è¡Œå¤–éƒ¨å‘½ä»¤ï¼‰ï¼›åªè´Ÿè´£éªŒè¯å¹¶æŠŠé…ç½®è®°å½•åˆ°LowArgsï¼Œåç»­åœ¨HiArgsé˜¶æ®µæ‰§è¡Œæ„é€ /åˆå§‹åŒ–å·¥ä½œã€‚&lt;/p>
&lt;h4 id="è§£ææµç¨‹">è§£ææµç¨‹
&lt;/h4>&lt;p>æ€»ä½“çš„è§£ææµç¨‹æ˜¯&lt;code>cliä¸­çš„token&lt;/code> &amp;mdash;&amp;ndash;&amp;gt; &lt;code>lowArgs&lt;/code> &amp;mdash;&amp;mdash;&amp;gt; &lt;code>hiArgs&lt;/code>&lt;/p>
&lt;h5 id="parse_low">parse_low
&lt;/h5>&lt;ul>
&lt;li>åŠŸèƒ½ï¼šå°†&lt;code>token&lt;/code>è§£æä¸º&lt;code>LowArgs&lt;/code>&lt;/li>
&lt;li>è¯´æ˜ï¼š&lt;code>parse_low&lt;/code>æ‰§è¡Œäº†ä¸¤æ¬¡parseï¼Œå…¶ç›®çš„æ˜¯ä¿è¯æ­£ç¡®çš„ä¼˜å…ˆçº§å’Œå‰¯ä½œç”¨æ§åˆ¶
&lt;ul>
&lt;li>ç¬¬ä¸€æ¬¡å¿«é€Ÿè§£æ(åªç”¨å‘½ä»¤è¡Œ)ç”¨äºï¼š
&lt;ul>
&lt;li>ç«‹å³è®¾ç½®æ—¥å¿—/æ¶ˆæ¯ç›¸å…³çš„å…¨å±€çŠ¶æ€(set_log_levels)ï¼Œè¿™æ ·åœ¨éšåè¯»å–å¹¶è§£æé…ç½®æ–‡ä»¶æ—¶æŒ‰ç…§CLIæŒ‡å®šçš„æ—¥å¿—çº§åˆ«è¾“å‡ºï¼ˆä¾‹å¦‚&amp;ndash;traceï¼‰&lt;/li>
&lt;li>æ£€æµ‹ç‰¹æ®Šæ¨¡å¼ï¼ˆhelp/versionï¼‰ï¼Œå¦‚æœæ˜¯specialå°±ç«‹åˆ»çŸ­è·¯è¿”å›ï¼Œä¸å»è¯»é…ç½®æ–‡ä»¶æˆ–åšæ›´å¤šçš„å·¥ä½œ&lt;/li>
&lt;li>æ£€æµ‹&lt;code>--no-config&lt;/code>æ ‡å¿—ï¼Œè‹¥å­˜åœ¨åˆ™ç›´æ¥ä½¿ç”¨ç¬¬ä¸€æ¬¡çš„ç»“æœå¹¶è¿”å›ï¼ˆä¸è¯»é…ç½®æ–‡ä»¶ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç¬¬äºŒæ¬¡å®Œæ•´è§£æï¼šæ²¡æœ‰çŸ­è·¯è¿”å›ä¸”å…è®¸è¯»é…ç½®æ–‡ä»¶ï¼Œæ‰å»è¯»å–é…ç½®æ–‡ä»¶è·å¾—config_argsï¼Œå¹¶æŠŠå®ƒä»¬ä¸åŸå§‹CLIå‚æ•°åˆå¹¶ï¼ˆconfig_argsåœ¨å‰ï¼ŒCLIå‚æ•°åœ¨åï¼Œä¿è¯CLIè¦†ç›–é…ç½®æ–‡ä»¶çš„è®¾ç½®ï¼‰ï¼Œç„¶åç¬¬äºŒæ¬¡å®Œæ•´çš„parseå‡ºæœ€ç»ˆçš„LowArgsã€‚å¦å¤–ï¼Œç¬¬äºŒæ¬¡ä¼šé‡æ–°æ„é€ ä¸€ä¸ªæ–°çš„LowArgsï¼ˆè€Œä¸æ˜¯åœ¨ç¬¬ä¸€æ¬¡çš„åŸºç¡€ä¸Šæ”¹ï¼‰ï¼Œè¿™æ ·é¿å…ç¬¬ä¸€æ¬¡è§£ææ—¶å¯èƒ½é—ç•™çš„ä¸­é—´çŠ¶æ€å½±å“æœ€ç»ˆç»“æœï¼Œä¿æŒè¯­ä¹‰æ¸…æ™°ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="parse">parse
&lt;/h5>&lt;ul>
&lt;li>
&lt;p>&lt;code>parse_low&lt;/code>è°ƒç”¨&lt;code>parse&lt;/code>æ‰§è¡Œå…·ä½“çš„è§£æé€»è¾‘&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨&lt;code>lexopt&lt;/code>è¿™ä¸ªcrateæŠŠtokenåˆ†ä¸ºäº†&lt;code>Short&lt;/code>,&lt;code>Long&lt;/code>,&lt;code>Value&lt;/code>ï¼›å…¶ä¸­&lt;code>-abc&lt;/code>ä¼šä¾æ¬¡äº§ç”Ÿ&lt;code>Short('a')&lt;/code>,&lt;code>Short('b')&lt;/code>,&lt;code>Short('c')&lt;/code>;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½œä¸ºé€‰é¡¹å‚æ•°çš„value&lt;/p>
&lt;ul>
&lt;li>ç”± parse åœ¨é‡åˆ° Short/Long åæ ¹æ®è¯¥ Flag çš„ç±»å‹å†³å®šæ˜¯å¦ç”¨ p.value() è¯»å–ï¼ˆæ”¯æŒ &amp;ndash;opt=value æˆ– &amp;ndash;opt valueï¼‰ã€‚&lt;/li>
&lt;li>è¿™ç±»å€¼è¢«å°è£…ä¸º FlagValue::Value å¹¶ä¼ å…¥ç›¸åº”çš„ Flag.update(&amp;hellip;) å»ä¿®æ”¹ LowArgs çš„å­—æ®µã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ä½ç½®å‚æ•°(positional)&lt;/p>
&lt;ul>
&lt;li>lexopt åœ¨é‡åˆ°ä¸ä»¥ &lt;code>-&lt;/code> å¼€å¤´çš„ &lt;code>token&lt;/code> æ—¶è¿”å› &lt;code>Arg::Value&lt;/code>ï¼Œparse ç›´æ¥æŠŠå®ƒ push åˆ° args.positionalã€‚&lt;/li>
&lt;li>è¿™äº›ä½ç½®å‚æ•°åœ¨åç»­ LowArgs -&amp;gt; HiArgs é˜¶æ®µè¢«è¯­ä¹‰åŒ–ï¼ˆç¬¬ä¸€ä¸ªå¯èƒ½æ˜¯ PATTERNï¼Œåé¢æ˜¯ PATHSï¼Œç‰¹æ®Šçš„ &amp;ldquo;-&amp;rdquo; è¡¨ç¤º stdin ç­‰ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Special case: -h/-Vä¸&amp;ndash;help/&amp;ndash;versionçš„çŸ­è·¯å¤„ç†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åç§°åˆ°Flagçš„æŸ¥æ‰¾ï¼š&lt;/p>
&lt;p>å…ˆç®€å•ä»‹ç»ä¸‹ç›¸å…³çš„ç±»&lt;/p>
&lt;ul>
&lt;li>&lt;code>FlagInfo&lt;/code>æ˜¯å¯¹Flagç±»çš„è¡¥å……ï¼ŒFlag traitè¡¨ç¤ºä¸€ä¸ª&amp;quot;é€»è¾‘ä¸Šçš„&amp;quot;é€‰é¡¹ï¼ˆå¸¦é•¿åã€å¯é€‰çŸ­åã€å¦å®šåã€åˆ«åä»¥åŠupdateè¡Œä¸ºï¼›FlagInfoåˆ™æ˜¯å¯¹åŒä¸€ä¸ªé€»è¾‘flagåœ¨è§£æå™¨ä¸­å…·ä½“å‡ºç°å½¢å¼ï¼ˆæŸä¸ªé•¿å/çŸ­å/åˆ«å/å¦å®šåï¼‰çš„ä¸€æ¡è®°å½•ã€‚&lt;/li>
&lt;li>&lt;code>FlagMap&lt;/code>å®é™…æ˜¯hashmap&amp;lt;vec[u8], usize&amp;gt;,usizeå¯¹åº”Vec&amp;lt;FlagInfo&amp;gt;çš„indexï¼ŒParserå°±ç»´æŠ¤äº† flagMapå’ŒVec&amp;lt;FlagInfo&amp;gt;&lt;/li>
&lt;li>&lt;code>FlagLookUp&lt;/code>æ˜¯enumç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæ ¹æ®flag nameæŸ¥æ‰¾çš„flagçš„ç»“æœï¼Œåˆ†ä¸º&lt;code>Match(&amp;amp;'a FlagInfo')&lt;/code>,&lt;code>UnrecognizedShort(char)&lt;/code>,&lt;code>UnrecognizedLong(String)&lt;/code>.&lt;/li>
&lt;/ul>
&lt;p>æ¥ç€å°±æ˜¯å¯¹lexoptè§£æå‡ºçš„short/longè¿›è¡Œå¤„ç†ï¼Œåˆ†åˆ«è°ƒç”¨&lt;code>find_short&lt;/code>å’Œ&lt;code>find_long&lt;/code>åœ¨FlagMapå’ŒVec&amp;lt;FlagInfo&amp;gt;è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¹¶è¿”å›&lt;code>FlagLookUp&lt;/code>ï¼Œæ‰¾åˆ°å¯¹åº”çš„FlagInfoå°±ä¼šä½¿ç”¨Flag traitä¸­çš„&lt;code>update&lt;/code>å¯¹æ™®é€švalueè¿›è¡Œå¤„ç†&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="ç”¨ä¾‹å­ç†Ÿæ‚‰æµç¨‹">ç”¨ä¾‹å­ç†Ÿæ‚‰æµç¨‹
&lt;/h4>&lt;p>ä»¥&lt;code>rg --json -F 'impl&amp;lt;T&amp;gt; ParseResult&amp;lt;T&amp;gt;'&lt;/code>ä¸ºä¾‹ç†Ÿæ‚‰ä¸‹æµç¨‹&lt;/p>
&lt;ol>
&lt;li>&lt;code>lexopt&lt;/code>è¯æ³•åŒ–ï¼šæŠŠ&lt;code>--json&lt;/code>ä½œä¸º&lt;code>lexopt::Arg::Long(&amp;quot;json&amp;quot;)&lt;/code>äº¤ç»™Parserã€‚&lt;/li>
&lt;li>åç§°æŸ¥æ‰¾ï¼š&lt;code>Parser::new()&lt;/code>æ„å»ºä¸€æ¬¡æ€§çš„è§£æè¡¨ï¼›&lt;code>Parser.find_long&lt;/code>åœ¨&lt;code>FlagMap&lt;/code>ä¸­æŸ¥æ‰¾,è¿”å›FlagLookup::Match(&amp;amp;FlagInfo)ã€‚&lt;/li>
&lt;li>æ„é€ FlagValueï¼Œç”±äº&lt;code>--json&lt;/code>åœ¨&lt;code>defs.rs&lt;/code>å®šä¹‰ä¸ºswitch,æ‰€ä»¥æ„é€ ä¸º&lt;code>FlagValue::Switch(true)&lt;/code>&lt;/li>
&lt;li>è°ƒç”¨&lt;code>Flag.update&lt;/code>å†™å…¥&lt;code>LowArgs&lt;/code>ï¼Œæœ¬ä¾‹å°±æ˜¯&lt;code>LowArgs.mode&lt;/code>è¢«è®¾ç½®ä¸º&lt;code>Search(JSON)&lt;/code>&lt;/li>
&lt;li>&lt;code>LowArgs&lt;/code> -&amp;gt; &lt;code>HiArgs&lt;/code>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="parsersä¸­ä¼˜ç§€çš„ç¼–ç¨‹æ€æƒ³">parse.rsä¸­ä¼˜ç§€çš„ç¼–ç¨‹æ€æƒ³
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>&lt;strong>æ˜ç¡®çš„èŒè´£åˆ†ç¦»&lt;/strong>ï¼šæŠŠâ€œè¯†åˆ«tokenï¼ˆparseï¼‰â€ã€â€œæŠŠflagå€¼å†™å…¥LowArgs(Flag::update)â€å’Œâ€œæŠŠLowArgså‡ä¸ºHiArgsï¼ˆHiArgs::from_low_argsï¼‰â€æ¸…æ™°æ‹†å¼€ï¼Œé™ä½æ¯ä¸ªæ¨¡å—å¤æ‚åº¦ï¼Œä¾¿äºæµ‹è¯•ä¸å¤ç”¨ã€‚&lt;strong>è§£æ â†’ ä¸­é—´ç»“æ„ â†’ è¿è¡Œæ—¶æ„é€ &lt;/strong>çš„åˆ†å±‚è§£æ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¸¤é˜¶æ®µè§£æä»¥æ”¯æŒé…ç½®åˆå¹¶ä¸æ—©æœŸçŸ­è·¯&lt;/strong>ï¼šå…ˆå…ˆç”¨ CLI å¿«é€Ÿè®¾ç½®æ—¥å¿—/short-circuitï¼ˆhelp/versionï¼‰ï¼Œå†åœ¨éœ€è¦æ—¶åˆå¹¶ config args å¹¶é‡æ–°è§£æï¼Œæ—¢èƒ½æ—©æœŸåé¦ˆåˆä¿æŒæœ€ç»ˆè¯­ä¹‰ä¸€è‡´&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨OnceLockåšæƒ°æ€§å…¨å±€åªè¯»åˆå§‹åŒ–ï¼šç”¨OnceLockåˆå§‹åŒ–ä¸€æ¬¡æ€§ä¸å¯å˜è§£æå™¨ï¼Œæ—¢çº¿ç¨‹å®‰å…¨åˆé¿å…é‡å¤æ„é€ å¼€é”€&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::sync::OnceLock;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> P: &lt;span style="color:#a6e22e">OnceLock&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Parser&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> OnceLock::new();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>P.get_or_init(&lt;span style="color:#f92672">||&lt;/span> {&lt;span style="color:#75715e">/* build parser*/&lt;/span> })
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç”¨trait + å®ç° å®ç°å¯æ‰©å±•æ€§ï¼ˆ&lt;strong>é¢å‘æ¥å£ç¼–ç¨‹&lt;/strong>ï¼‰: &lt;code>Flag&lt;/code> traitå®šä¹‰è¡Œä¸ºï¼Œå…·ä½“flagå®ç°åªæ”¹updateï¼Œè§£æå™¨åªä¾èµ–traitï¼Œä¸è€¦åˆå…·ä½“å®ç°ï¼Œæ–°å¢flagä»…éœ€å®ç°traitå¹¶åŠ å…¥FLAGSï¼›å›´ç»•&lt;code>Flag&lt;/code>traitå®šä¹‰äº†Flagç›¸å…³çš„structã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é¿å…è‡ªå¼•ç”¨ç»“æ„çš„æŠ€å·§ï¼ˆ&lt;strong>ç´¢å¼•æ›¿ä»£å¼•ç”¨&lt;/strong>ï¼‰ï¼šç”¨ HashMap&amp;lt;Vec&lt;u8>, usize&amp;gt; + Vec&lt;FlagInfo>ï¼ˆmap å­˜ç´¢å¼•ï¼‰ç»•å¼€åœ¨åŒä¸€ struct ä¸­å­˜æ”¾è‡ªå¼•ç”¨çš„é—®é¢˜ï¼ŒåŒæ—¶æé«˜æŸ¥æ‰¾åè®¿é—®æ•ˆç‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½çº§è§£æåº“ï¼ˆ&lt;code>lexopt&lt;/code>ï¼‰ç»“åˆè‡ªå®šä¹‰é€»è¾‘ï¼šé‡‡ç”¨ä½å±‚è§£æå™¨ä»¥è·å¾—æœ€å¤§æ§åˆ¶æƒï¼ˆæ”¯æŒ negationã€suggestã€è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯ç­‰ï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨é«˜çº§åº“å¼ºè¡Œé€‚é…ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸°å¯Œçš„é”™è¯¯ä¸Šä¸‹æ–‡ï¼ˆ&lt;code>anyhow::Context / with_context&lt;/code>ï¼‰ï¼šåœ¨å¯èƒ½å¤±è´¥çš„ç‚¹ç”¨ .with_context(|| format!(&amp;hellip;)) åŒ…è£…é”™è¯¯ï¼Œç»™å‡ºå¯¹ç”¨æˆ·/è°ƒè¯•æ›´å‹å¥½çš„ä¿¡æ¯ï¼ˆâ€œmissing value for flag â€¦â€ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ˜ç¡®åœ°æŠŠâ€œé€‰é¡¹å‚æ•°â€å’Œâ€œä½ç½®å‚æ•°â€åˆ†å¼€æ”¶é›†ä¸å¤„ç†ï¼šåœ¨parseé˜¶æ®µæŠŠpositionalç›´æ¥æ”¶é›†ï¼Œåé¢åŒä¸€è¯­ä¹‰åŒ–(pattern/path)ï¼Œæœ‰åˆ©äºä¿æŒè§£æé€»è¾‘æ•´æ´&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="æ€è€ƒ">æ€è€ƒ
&lt;/h4>&lt;ul>
&lt;li>å¦‚ä½•åšåˆ°æ°åˆ°å¥½å¤„çš„åˆ†å±‚ï¼Œæ—¢ä¸è¿‡åº¦ä¹Ÿä¸è®©æŸä¸€å±‚è¿‡äºå†—æ‚ï¼Ÿ&lt;/li>
&lt;li>é¢å‘æ¥å£/traitç¼–ç¨‹æ€è·¯çš„åˆç†åº”ç”¨ã€‚ æŠŠtraitå½“ä½œâ€&lt;strong>å¯æ’æ‹”ç‚¹&lt;/strong>â€è€Œä¸æ˜¯é»˜è®¤æ¨¡ç‰ˆ&lt;/li>
&lt;/ul></description></item><item><title>ripgrepçš„mainå‡½æ•°</title><link>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84main%E5%87%BD%E6%95%B0/</link><pubDate>Fri, 22 Aug 2025 22:03:01 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84main%E5%87%BD%E6%95%B0/</guid><description>&lt;h4 id="æ¦‚è§ˆ">æ¦‚è§ˆ
&lt;/h4>&lt;ul>
&lt;li>&lt;code>main.rs&lt;/code>&lt;/li>
&lt;li>è§’è‰²ï¼šripgrepå¯æ‰§è¡Œç¨‹åºçš„å…¥å£ï¼Œè´Ÿè´£é¡¶å±‚å‚æ•°åˆ†å‘ã€å¹¶å‘ç­–ç•¥é€‰è€…ã€é”™è¯¯ä¸é€€å‡ºç å¤„ç†ã€ä»¥åŠå‡ ç§è¿è¡Œæ¨¡å¼(search/files/types/generate/special)çš„åè°ƒã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="ä¸»è¦èŒè´£">ä¸»è¦èŒè´£
&lt;/h4>&lt;ul>
&lt;li>è°ƒç”¨flags::parse()è·å–è§£æç»“æœå¹¶äº¤ç”±run()å¤„ç†&lt;/li>
&lt;li>åœ¨é¡¶å±‚å¤„ç†run()è¿”å›çš„é”™è¯¯ï¼šBrokenPipeè¢«è§†ä¸ºä¼˜é›…é€€å‡ºï¼ˆé€€å‡ºç ä¸º0ï¼‰ï¼Œå…¶ä»–é”™è¯¯æ‰“å°å¹¶è¿”å›2ã€‚&lt;/li>
&lt;li>æ ¹æ®HiArgså’ŒModeå†³å®šå•çº¿ç¨‹æˆ–å¹¶è¡Œæ‰§è¡Œæœç´¢/åˆ—ä¸¾ç­‰é€»è¾‘ã€‚&lt;/li>
&lt;li>åœ¨æœç´¢ç»“æŸåä¾æ®åŒ¹é…æƒ…å†µã€é”™è¯¯æ ‡è®°å’Œquietæ ‡å¿—è®¡ç®—æœ€ç»ˆé€€å‡ºç  (0/1/2)ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="æ§åˆ¶æµä¼ªä»£ç ">æ§åˆ¶æµï¼ˆä¼ªä»£ç ï¼‰
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//é«˜å±‚ä¼ªä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() -&amp;gt; &lt;span style="color:#a6e22e">ExitCode&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> run(flags::parse()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(code) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> code,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> err.chain() contains BrokenPipe { &lt;span style="color:#66d9ef">return&lt;/span> ExitCode::from(&lt;span style="color:#ae81ff">0&lt;/span>); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> eprintln(err);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExitCode::from(&lt;span style="color:#ae81ff">2&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å…³é”®å‡½æ•°ä¸èŒè´£">å…³é”®å‡½æ•°ä¸èŒè´£
&lt;/h4>&lt;ul>
&lt;li>mainï¼šé¡¶å±‚é”™è¯¯æ•è·ä¸BrokenPipeç‰¹æ®Šå¤„ç†&lt;/li>
&lt;li>run(result): è§£åŒ…ParseResultï¼ˆErr/Special/Okï¼‰ï¼Œåˆ†æ´¾åˆ°å…·ä½“æ¨¡å¼ï¼›è®¡ç®—æœ€ç»ˆé€€å‡ºç ã€‚&lt;/li>
&lt;li>search(args, mode)ï¼šå•çº¿ç¨‹æœç´¢ã€‚æ„é€ walk -&amp;gt; haystack -&amp;gt; é¡ºåºè°ƒç”¨searcherï¼Œç»Ÿè®¡å¹¶æ‰“å°statsã€‚&lt;/li>
&lt;li>search_parallel(args, mode)ï¼šå¹¶è¡Œæœç´¢ï¼Œä½¿ç”¨walkçš„å¹¶è¡Œrunnerï¼Œworker closuerè´Ÿè´£å•æ–‡ä»¶æœç´¢ã€ç»Ÿè®¡åˆå¹¶å’Œé€šè¿‡bufwtræ‰“å°ç»“æœã€‚&lt;/li>
&lt;li>files(args)/file_parallel(args)ï¼šåˆ—å‡ºæ–‡ä»¶è·¯å¾„(å•çº¿ç¨‹/å¤šçº¿ç¨‹å®ç°ï¼Œåè€…ä½¿ç”¨æ‰“å°çº¿ç¨‹å’Œmpsc channel)ã€‚&lt;/li>
&lt;li>special(mode)ï¼šè¾“å‡ºhelp/versionç­‰çŸ­è·¯æ¨¡å¼(æœ€å°‘åˆå§‹åŒ–)&lt;/li>
&lt;li>generate(mode)ï¼šç”Ÿæˆmané¡µæˆ–shellè¡¥å…¨å¹¶å†™stdout&lt;/li>
&lt;li>print_stats(&amp;hellip;)ï¼šæ ¹æ®SearchModeè¾“å‡ºæ–‡æœ¬æˆ–JSONç»Ÿè®¡ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="é‡è¦æ¦‚å¿µä¸ç±»å‹">é‡è¦æ¦‚å¿µä¸ç±»å‹
&lt;/h4>&lt;ul>
&lt;li>HiArgsï¼šé«˜å±‚è¿è¡Œæ—¶é…ç½®ï¼ˆï¼‰&lt;/li>
&lt;li>Mode/SearchModeï¼šå†³å®šæ˜¯ Search/Files/Types/Generate/Special ä»¥åŠ JSON/text è¾“å‡ºç­‰ã€‚&lt;/li>
&lt;li>WalkStateï¼šignore crateçš„éå†æ§åˆ¶(Continue/Quit)&lt;/li>
&lt;/ul></description></item><item><title>Rustä¸­çš„IOæ“ä½œ</title><link>https://www.dust-zed.site/rust/rust%E4%B8%AD%E7%9A%84io%E6%93%8D%E4%BD%9C/</link><pubDate>Fri, 22 Aug 2025 06:01:17 +0800</pubDate><guid>https://www.dust-zed.site/rust/rust%E4%B8%AD%E7%9A%84io%E6%93%8D%E4%BD%9C/</guid><description>&lt;p>åœ¨Rustä¸­ï¼ŒI/Oæ“ä½œä¸»è¦é€šè¿‡&lt;code>Read&lt;/code>å’Œ&lt;code>Write&lt;/code>ä¸¤ä¸ªæ ¸å¿ƒtraitå®ç°ï¼Œè€Œ&lt;code>Cursor&lt;/code>ã€&lt;code>BufWriter&lt;/code>å’Œ&lt;code>ReadBuf&lt;/code>æ˜¯å›´ç»•è¿™äº›traitçš„å®ç”¨å·¥å…·ã€‚&lt;/p>
&lt;hr>
&lt;h4 id="1-readå’Œwrite-trait">1. &lt;code>Read&lt;/code>å’Œ&lt;code>Write&lt;/code> trait
&lt;/h4>&lt;h5 id="stdioread">&lt;code>std::io::Read&lt;/code>
&lt;/h5>&lt;p>&lt;strong>ä½œç”¨&lt;/strong>ï¼šä»æ•°æ®æºï¼ˆæ–‡ä»¶ã€ç½‘ç»œç­‰ï¼‰è¯»å–å­—èŠ‚æµã€‚&lt;/p>
&lt;p>&lt;strong>æ ¸å¿ƒæ–¹æ³•&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">read&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, buf: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> [&lt;span style="color:#66d9ef">u8&lt;/span>]) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">usize&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å°è¯•è¯»å–æ•°æ®åˆ°ç¼“å†²åŒº&lt;code>buf&lt;/code>&lt;/li>
&lt;li>è¿”å›å®é™…è¯»å–çš„å­—èŠ‚æ•°(&lt;code>Ok(n)&lt;/code>)ï¼Œæˆ–é”™è¯¯ï¼ˆ&lt;code>Err(e)&lt;/code>ï¼‰&lt;/li>
&lt;li>å½“è¯»å–åˆ°EOFæ—¶è¿”å›&lt;code>Ok(0)&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>å¸¸ç”¨æ–¹æ³•&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>read_to_end(&amp;amp;mut vec)&lt;/code>:è¯»å–æ‰€æœ‰å­—èŠ‚åˆ°&lt;code>Vec&amp;lt;u8&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>read_to_string(&amp;amp;mut string)&lt;/code>:è¯»å–UTF-8å­—èŠ‚åˆ°&lt;code>String&lt;/code>&lt;/li>
&lt;li>&lt;code>read_exact(&amp;amp;mut buf)&lt;/code>:ç²¾ç¡®è¯»å–&lt;code>buf.len()&lt;/code>å­—èŠ‚ï¼Œå¦åˆ™æŠ¥é”™&lt;/li>
&lt;/ul>
&lt;h5 id="stdiowrite">&lt;code>std::io::Write&lt;/code>
&lt;/h5>&lt;p>&lt;strong>ä½œç”¨&lt;/strong>ï¼šå°†å­—èŠ‚æµå†™å…¥ç›®æ ‡&lt;/p>
&lt;p>&lt;strong>æ ¸å¿ƒæ–¹æ³•&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">write&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, buf: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>[&lt;span style="color:#66d9ef">u8&lt;/span>]) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">usize&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">flush&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>()&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>write&lt;/code>å°è¯•å†™å…¥ç¼“å†²åŒº&lt;code>buf&lt;/code>ï¼Œè¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°&lt;/li>
&lt;li>&lt;code>flush&lt;/code>ç¡®ä¿æ‰€æœ‰ç¼“å†²æ•°æ®å†™å…¥ç›®æ ‡ï¼ˆå¦‚ç£ç›˜ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="2-cursort">2. &lt;code>Cursor&amp;lt;T&amp;gt;&lt;/code>
&lt;/h4>&lt;p>&lt;strong>ä½œç”¨&lt;/strong>ï¼šå°†å†…å­˜ç±»å‹åŒ…è£…æˆå¯&lt;code>éšæœºè®¿é—®&lt;/code>çš„&lt;code>Read&lt;/code>/&lt;code>Write&lt;/code>å¯¹è±¡ã€‚&lt;/p>
&lt;p>&lt;strong>ç‰¹ç‚¹&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿæ–‡ä»¶æŒ‡é’ˆï¼ˆç»´æŠ¤&lt;code>position&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>å®ç°Readå’ŒWriteï¼ˆéœ€&lt;code>T: AsMut&amp;lt;[u8]&amp;gt;&lt;/code>)ï¼Œæ”¯æŒ&lt;code>Seek&lt;/code>ã€‚&lt;/li>
&lt;li>é›¶æˆæœ¬æŠ½è±¡ï¼Œé«˜æ€§èƒ½å†…å­˜æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä½¿ç”¨åœºæ™¯&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä»&lt;code>Vec&amp;lt;u8&amp;gt;&lt;/code>è¯»å–æ•°æ®ï¼Œæˆ–å†™å…¥åˆ°&lt;code>Vec&amp;lt;u8&amp;gt;&lt;/code>ã€‚&lt;/li>
&lt;li>æµ‹è¯•æ—¶ä»£æ›¿çœŸå®æ–‡ä»¶I/Oã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="3-bufwriterw">3. &lt;code>BufWriter&amp;lt;W&amp;gt;&lt;/code>
&lt;/h4>&lt;p>&lt;strong>ä½œç”¨&lt;/strong>ï¼šåŒ…è£…ä¸€ä¸ª&lt;code>Write&lt;/code>å¯¹è±¡ï¼Œæä¾›&lt;strong>å†™å…¥ç¼“å†²&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;strong>ä¼˜ç‚¹&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ç£ç›˜ã€ç½‘ç»œå†™å…¥ï¼‰ã€‚&lt;/li>
&lt;li>æ‰¹é‡å†™å…¥æé«˜æ€§èƒ½ï¼ˆé»˜è®¤ç¼“å†²åŒºå¤§å°&lt;strong>8KB&lt;/strong>ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è¡Œä¸º&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>å…ˆå†™å…¥å†…å­˜ç¼“å†²åŒºï¼Œæ»¡æ—¶è‡ªåŠ¨åˆ·æ–°åˆ°å†…éƒ¨&lt;code>W&lt;/code>ã€‚&lt;/li>
&lt;li>æ‰‹åŠ¨è°ƒç”¨&lt;code>flush()&lt;/code>æˆ–&lt;code>Drop&lt;/code>æ—¶å¼ºåˆ¶åˆ·æ–°ç¼“å†²åŒºã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="4-bufreaderr">4. &lt;code>BufReader&amp;lt;R&amp;gt;&lt;/code>
&lt;/h4>&lt;p>&lt;strong>ä½œç”¨&lt;/strong>ï¼šåŒ…è£…&lt;code>Read&lt;/code>å¯¹è±¡ï¼Œæä¾›&lt;strong>è¯»å–ç¼“å†²&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;strong>ä¼˜ç‚¹&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡å°‘é¢‘ç¹ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚è¯»å–æ–‡ä»¶æ—¶å¤šæ¬¡å°æ•°æ®è¯»å–ï¼‰&lt;/li>
&lt;li>æ”¯æŒæŒ‰è¡Œè¯»å–ï¼ˆ&lt;code>read_line&lt;/code>å’Œ&lt;code>lines&lt;/code>ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="å®Œæ•´çŸ¥è¯†å›¾è°±">å®Œæ•´çŸ¥è¯†å›¾è°±
&lt;/h4>&lt;pre tabindex="0">&lt;code>I/O æ ¸å¿ƒ Trait
â”‚
â”œâ”€â”€ Read (å­—èŠ‚æº)
â”‚ â”œâ”€â”€ å®ç°ç±»å‹ï¼šFile, TcpStream, Vec&amp;lt;u8&amp;gt;, etc.
â”‚ â”œâ”€â”€ å·¥å…·ï¼šBufReader (ç¼“å†²è¯»å–), Take (é™åˆ¶è¯»å–é•¿åº¦)
â”‚ â””â”€â”€ æ‰©å±•ï¼šBufRead (æä¾› read_line, lines ç­‰æ–¹æ³•)
â”‚
â”œâ”€â”€ Write (å­—èŠ‚ç›®æ ‡)
â”‚ â”œâ”€â”€ å®ç°ç±»å‹ï¼šFile, TcpStream, Vec&amp;lt;u8&amp;gt;, etc.
â”‚ â””â”€â”€ å·¥å…·ï¼šBufWriter (ç¼“å†²å†™å…¥), LineWriter (è¡Œç¼“å†²)
â”‚
â”œâ”€â”€ Seek (éšæœºè®¿é—®)
â”‚ â””â”€â”€ å®ç°ç±»å‹ï¼šFile, Cursor&amp;lt;T&amp;gt;
â”‚
â””â”€â”€ å†…å­˜é€‚é…å™¨
â””â”€â”€ Cursor&amp;lt;T&amp;gt; (å†…å­˜æ¨¡æ‹Ÿ I/O)
â”œâ”€â”€ æ”¯æŒï¼šRead/Write/Seek
â””â”€â”€ é€‚ç”¨ï¼šVec&amp;lt;u8&amp;gt;, &amp;amp;[u8], String, &amp;amp;str
&lt;/code>&lt;/pre>&lt;hr>
&lt;h5 id="å…³é”®åŸåˆ™">å…³é”®åŸåˆ™
&lt;/h5>&lt;p>&lt;strong>1. ç¼“å†²ä½¿ç”¨&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>BufReader/BufWriteræ€»æ˜¯æ¨èç”¨äºæ–‡ä»¶/ç½‘ç»œ I/Oã€‚&lt;/li>
&lt;li>Cursorç”¨äºå†…å­˜æ•°æ®ï¼ˆå¦‚è§£æäºŒè¿›åˆ¶æ ¼å¼ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>2. é”™è¯¯å¤„ç†&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰€æœ‰I/Oæ“ä½œè¿”å›&lt;code>Result&lt;/code>ï¼Œå¿…é¡»å¤„ç†&lt;code>Err&lt;/code>æƒ…å†µã€‚&lt;/li>
&lt;li>ç‰¹åˆ«æ³¨æ„&lt;code>flush()&lt;/code>çš„é”™è¯¯ï¼ˆå¦‚ç£ç›˜æ»¡ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>3. æ€§èƒ½&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å°æ•°æ®å†™å…¥ç”¨&lt;code>BufWriter&lt;/code>&lt;/li>
&lt;li>é¿å…é¢‘ç¹å°æ•°æ®è¯»å–ï¼ˆç¼“å†²æˆ–æ‰¹é‡åŒ–ï¼‰&lt;/li>
&lt;/ul></description></item><item><title>å¤§ç«¯åºå’Œå°ç«¯åº</title><link>https://www.dust-zed.site/rust/%E5%A4%A7%E7%AB%AF%E5%BA%8F%E5%92%8C%E5%B0%8F%E7%AB%AF%E5%BA%8F/</link><pubDate>Fri, 22 Aug 2025 03:33:16 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E5%A4%A7%E7%AB%AF%E5%BA%8F%E5%92%8C%E5%B0%8F%E7%AB%AF%E5%BA%8F/</guid><description>&lt;p>å¤§ç«¯åºå’Œå°ç«¯åºæ˜¯ä¸¤ç§ä¸åŒçš„&lt;strong>å­—èŠ‚å­˜å‚¨é¡ºåº&lt;/strong>ï¼Œç”¨äºæè¿°å¤šå­—èŠ‚æ•°æ®ï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰åœ¨è®¡ç®—æœºå†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼ã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äºå­—èŠ‚çš„æ’åˆ—é¡ºåºï¼š&lt;/p>
&lt;h4 id="å¤§ç«¯åº">å¤§ç«¯åº
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨ä½åœ°å€&lt;/strong>ï¼Œä½ä½å­—èŠ‚å­˜å‚¨åœ¨é«˜åœ°å€&lt;/li>
&lt;/ul>
&lt;h4 id="å°ç«¯åº">å°ç«¯åº
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>ä½ä½å­—èŠ‚å­˜å‚¨åœ¨ä½åœ°å€&lt;/strong>ï¼Œé«˜ä½å­—èŠ‚å­˜å‚¨åœ¨é«˜åœ°å€&lt;/li>
&lt;/ul>
&lt;p>å°ç«¯åºæ›´ç¬¦åˆè®¡ç®—æœºçš„å¤„ç†é€»è¾‘&lt;/p></description></item><item><title>éœ€è¦å¤šç†Ÿæ‚‰çš„rustè¯­æ³•</title><link>https://www.dust-zed.site/rust/%E9%9C%80%E8%A6%81%E5%A4%9A%E7%86%9F%E6%82%89%E7%9A%84rust%E8%AF%AD%E6%B3%95/</link><pubDate>Tue, 19 Aug 2025 15:02:39 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E9%9C%80%E8%A6%81%E5%A4%9A%E7%86%9F%E6%82%89%E7%9A%84rust%E8%AF%AD%E6%B3%95/</guid><description>&lt;h4 id="ç»‘å®šè¿ç®—ç¬¦">@(ç»‘å®šè¿ç®—ç¬¦)
&lt;/h4>&lt;p>åœ¨Rustä¸­ï¼Œ&lt;code>@&lt;/code>è¢«ç§°ä¸ºç»‘å®šè¿ç®—ç¬¦ï¼Œç”¨äºåœ¨æ¨¡å¼åŒ¹é…çš„å€¼ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ï¼ŒåŒæ—¶å…è®¸è¿›ä¸€æ­¥è§£æ„å†…éƒ¨ç»“æ„ã€‚&lt;/p>
&lt;p>&lt;strong>å…·ä½“è§£æ&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">match&lt;/span> self.reader.read(buf) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(len) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.size &lt;span style="color:#f92672">-=&lt;/span> len;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(len)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> err &lt;span style="color:#f92672">@&lt;/span> Err(_) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>&lt;code>Ok(len)&lt;/code>åˆ†æ”¯&lt;/strong>ï¼šåŒ¹é…æˆåŠŸçš„&lt;code>Ok&lt;/code>å˜ä½“ï¼Œæå–å†…éƒ¨çš„&lt;code>len&lt;/code>å€¼ï¼Œç„¶åæ›´æ–°&lt;code>self.size&lt;/code>å¹¶è¿”å›&lt;code>Ok(len)&lt;/code>&lt;/li>
&lt;li>**&lt;code>err @ Err(_)&lt;/code>**åˆ†æ”¯ï¼š
&lt;ul>
&lt;li>&lt;code>Err(_)&lt;/code>åŒ¹é…ä»»æ„&lt;code>Err&lt;/code>å˜ä½“(ä¸å…³å¿ƒå†…éƒ¨é”™è¯¯çš„å…·ä½“å€¼)&lt;/li>
&lt;li>&lt;code>@&lt;/code>å°†æ•´ä¸ªErrçš„å€¼(å¦‚&lt;code>Err(&amp;quot;io_error&amp;quot;)&lt;/code>)ç»‘å®šåˆ°å˜é‡&lt;code>err&lt;/code>&lt;/li>
&lt;li>åˆ†æ”¯è¿”å›&lt;code>err&lt;/code>ï¼Œå³åŸå§‹çš„&lt;code>Err&lt;/code>å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>è§£æ„é»˜è®¤ä¼šå‘ç”Ÿæ‰€æœ‰æƒè½¬ç§»ï¼Œ&lt;code>let Data(inner) = &amp;amp;data;&lt;/code>ç­‰ä»·äº&lt;code>let Data(ref inner) = &amp;amp;data;&lt;/code>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="asref">AsRef
&lt;/h4>&lt;p>&lt;code>AsRef&lt;/code> traitçš„æ ¸å¿ƒä½œç”¨æ˜¯å…è®¸ä¸€ä¸ªç±»å‹ä»¥&lt;strong>é›¶å¼€é”€&lt;/strong>çš„æ–¹å¼å°†è‡ªå·±æˆ–å¼•ç”¨è½¬æ¢æˆ&lt;strong>å¦ä¸€ç§ç±»å‹çš„å¼•ç”¨&lt;/strong>ã€‚&lt;code>AsMut&lt;/code>æ˜¯&lt;code>AsRef&lt;/code>çš„å¯å˜ç‰ˆæœ¬&lt;/p>
&lt;p>&lt;strong>1. æ ¸å¿ƒæœºåˆ¶&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>AsRef&amp;lt;T&amp;gt;&lt;/code>å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š&lt;code>fn as_ref(&amp;amp;self) -&amp;gt; &amp;amp;T&lt;/code>&lt;/li>
&lt;li>å®ƒæ¥å—&lt;code>&amp;amp;self&lt;/code>ï¼Œè¿”å›ç›®æ ‡ç±»å‹&lt;code>&amp;amp;T&lt;/code>çš„å¼•ç”¨&lt;/li>
&lt;li>æœ¬è´¨ä¸Šï¼šå°†&lt;code>&amp;amp;Self&lt;/code>è½¬æ¢ä¸º&lt;code>&amp;amp;T&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>2. è½¬æ¢ç±»å‹&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å…è®¸çš„æ˜¯&lt;code>Self&lt;/code>åˆ°&lt;code>T&lt;/code>çš„å¼•ç”¨è½¬æ¢ã€‚&lt;/li>
&lt;li>ä¾‹å¦‚ï¼š
&lt;ul>
&lt;li>&lt;code>String&lt;/code>å®ç°&lt;code>AsRef&amp;lt;str&amp;gt;&lt;/code>: &lt;code>&amp;amp;String -&amp;gt; &amp;amp;str&lt;/code>&lt;/li>
&lt;li>&lt;code>Vec&amp;lt;T&amp;gt;&lt;/code> å®ç°&lt;code>AsRef&amp;lt;[T]&amp;gt;&lt;/code>: &lt;code>&amp;amp;Vec&amp;lt;T&amp;gt; -&amp;gt;&amp;amp;[T]&lt;/code>&lt;/li>
&lt;li>&lt;code>PathBuf&lt;/code>å®ç°&lt;code>AsRef&amp;lt;Path&amp;gt;&lt;/code>: &lt;code>&amp;amp;PathBuf -&amp;gt; &amp;amp;Path&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>**3. è®¾è®¡ç›®çš„ **&lt;/p>
&lt;ul>
&lt;li>æ³›å‹çµæ´»æ€§ï¼šè®©å‡½æ•°æ¥å—å¤šç§ç±»å‹å‚æ•°&lt;/li>
&lt;li>é›¶å¼€é”€æŠ½è±¡ï¼šè½¬æ¢è¿‡ç¨‹æ— é¢å¤–å †åˆ†é…æˆ–å¤åˆ¶&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="é›¶å¼€é”€">é›¶å¼€é”€
&lt;/h4>&lt;p>&lt;strong>ä»€ä¹ˆæ˜¯é›¶å¼€é”€&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æ ˆæ“ä½œå’Œå¾®å°çš„å¯„å­˜å™¨å¤åˆ¶æ˜¯å…è®¸çš„&lt;/li>
&lt;li>æ²¡æœ‰&lt;strong>å †å†…å­˜åˆ†é…&lt;/strong>ï¼šç»ä¸è°ƒç”¨å†…å­˜åˆ†é…å™¨&lt;/li>
&lt;li>æ²¡æœ‰&lt;strong>æ·±æ‹·è´&lt;/strong>ï¼šä¸å¤åˆ¶åº•å±‚æ•°æ®æœ¬èº«ï¼ˆå³ä½¿æ˜¯æ ˆä¸Šçš„è§£æ„ä¹Ÿéœ€è¦åˆç†åŒºåˆ†ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="åˆ‡ç‰‡å¼•ç”¨">åˆ‡ç‰‡å¼•ç”¨
&lt;/h4>&lt;p>&lt;strong>åˆ‡ç‰‡å¼•ç”¨æœ¬è´¨å°±æ˜¯å®½æŒ‡é’ˆ&lt;/strong>ï¼Œç”±&lt;strong>æ•°æ®æŒ‡é’ˆ&lt;/strong>å’Œ&lt;strong>é•¿åº¦&lt;/strong>ç»„æˆ&lt;/p>
&lt;hr>
&lt;h4 id="condvar">Condvar
&lt;/h4>&lt;p>åœ¨rustä¸­ï¼Œ&lt;code>Condvar&lt;/code>ï¼ˆæ¡ä»¶å˜é‡ï¼‰æ˜¯ç”¨äºçº¿ç¨‹é—´åŒæ­¥çš„æ ¸å¿ƒå·¥å…·ï¼Œé€šå¸¸ä¸&lt;code>Mutex&lt;/code>ç»“åˆä½¿ç”¨ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯è®©çº¿ç¨‹åœ¨æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶&lt;strong>ä¸»åŠ¨é˜»å¡&lt;/strong>ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹ä¿®æ”¹æ¡ä»¶å¹¶é€šçŸ¥å®ƒç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;ul>
&lt;li>ä½œç”¨ï¼šè§£å†³çº¿ç¨‹é—´çš„&lt;strong>ç­‰å¾…-é€šçŸ¥&lt;/strong>é—®é¢˜ï¼Œé¿å…busy loopingã€‚&lt;/li>
&lt;li>ä¾èµ–ï¼šå¿…é¡»ä¸&lt;code>Mutex&lt;/code>é…åˆä½¿ç”¨ï¼ˆä¿æŠ¤å…±äº«æ•°æ® + åŒæ­¥æ¡ä»¶ï¼‰&lt;/li>
&lt;li>å…¸å‹åœºæ™¯ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€ä»»åŠ¡é˜Ÿåˆ—è°ƒåº¦ã€èµ„æºæ± ç®¡ç†ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::sync::{Arc, Mutex, Condvar};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::thread;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//åˆ›å»ºå…±äº«æ•°æ®ç»“æ„ï¼š(Mutex&amp;lt;bool&amp;gt;, Condvar)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> pair &lt;span style="color:#f92672">=&lt;/span> Arc::new(Mutex::new(&lt;span style="color:#66d9ef">false&lt;/span>), Condvar::new()));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> pair_clone &lt;span style="color:#f92672">=&lt;/span> Arc::clone(&lt;span style="color:#f92672">&amp;amp;&lt;/span>pair);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> consumer &lt;span style="color:#f92672">=&lt;/span> thread::spawn(&lt;span style="color:#66d9ef">move&lt;/span> &lt;span style="color:#f92672">||&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (lock, cvar) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;*&lt;/span>pair_clone;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> condition &lt;span style="color:#f92672">=&lt;/span> lock.lock().unwarp();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//ç­‰æ¡ä»¶æ»¡è¶³
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#f92672">!*&lt;/span>condition {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//é‡Šæ”¾é”å¹¶é˜»å¡ï¼Œè¢«å”¤é†’å(waitè¿”å›å)é‡æ–°è·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> condition &lt;span style="color:#f92672">=&lt;/span> cvar.wait(condition).unwarp();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ¶ˆè´¹è€…ï¼šæ¡ä»¶å·²æ»¡è¶³ï¼ç»§ç»­æ‰§è¡Œ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//æ¶ˆè´¹è€…çš„å¤„ç†é€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> thread::sleep(Duration::from_secs(&lt;span style="color:#ae81ff">1&lt;/span>));&lt;span style="color:#75715e">//æ¨¡æ‹Ÿå·¥ä½œè€—æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (lock, cvar) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;*&lt;/span>pair;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> condition &lt;span style="color:#f92672">=&lt;/span> lock.lock().unwarp();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç”Ÿäº§è€…ï¼šæ›´æ–°æ¡ä»¶å¹¶é€šçŸ¥æ¶ˆè´¹è€…...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>condition &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šçŸ¥ä¸€ä¸ªç­‰å¾…çš„æ¶ˆè´¹è€…çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> cvar.notify_one();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.join().unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ä¸»çº¿ç¨‹: æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæˆ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="pin">PIN
&lt;/h4>&lt;hr>
&lt;p>&lt;strong>&lt;code>haystack&lt;/code>&lt;strong>å‘½åæºè‡ªè‹±è¯­è°šè¯­&lt;/strong>&amp;ldquo;looking for a needle in a haystack&amp;rdquo;&lt;/strong>(å¤§æµ·æé’ˆ),&lt;code>haystack&lt;/code>è¡¨ç¤ºè¢«æœç´¢çš„&lt;strong>ä¸»ä½“æ•°æ®&lt;/strong>ï¼Œ&lt;code>needle&lt;/code>è¡¨ç¤ºå¾…æŸ¥æ‰¾çš„&lt;strong>ç›®æ ‡å…ƒç´ &lt;/strong>.&lt;/p>
&lt;p>rustä¸­æœ‰ä¸¤ç§è§£å¼•ç”¨çš„æ–¹å¼ï¼š&lt;strong>&lt;code>*&lt;/code>&lt;strong>å’Œ&lt;/strong>æ¨¡å¼åŒ¹é…è§£å¼•ç”¨&lt;/strong>&lt;/p>
&lt;hr>
&lt;h4 id="unicodeasciiå’Œutf-8ç­‰">Unicodeã€ASCIIå’ŒUTF-8ç­‰
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Unicode&lt;/strong>ä¸ºæ‰€æœ‰å­—ç¬¦åˆ†é…äº†å”¯ä¸€æ ‡è¯†(ç§°ä¸º&lt;strong>ç ç‚¹&lt;/strong>)&lt;/li>
&lt;li>&lt;strong>UTF-8&lt;/strong>ç­‰æ˜¯éœ€è¦å°†è¿™äº›ç ç‚¹è½¬æ¢ä¸ºç”¨äºå­˜å‚¨/ä¼ è¾“çš„&lt;strong>å­—èŠ‚åºåˆ—&lt;/strong>,æ ¹æ®&lt;strong>ç ç‚¹å€¼çš„èŒƒå›´åˆ†ç±»&lt;/strong>ï¼Œç¡®å®šå­—èŠ‚åºåˆ—çš„&lt;strong>é•¿åº¦&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>ASCII&lt;/strong>æ˜¯Unicodeå’ŒUTF-8çš„&lt;strong>ç‰¹æ®Šå…¼å®¹å­é›†&lt;/strong>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="å­—ç¬¦æ•°æ®">å­—ç¬¦æ•°æ®
&lt;/h4>&lt;ul>
&lt;li>&lt;code>b&lt;/code>å‰ç¼€æ ‡è¯†çš„æ•°æ®ï¼šè¡¨ç¤º&lt;code>ASCII&lt;/code>å­—ç¬¦é›†çš„å­—èŠ‚æ•°æ®ï¼Œç±»å‹ä¸º&lt;code>u8&lt;/code>æˆ–&lt;code>&amp;amp;[u8]&lt;/code>&lt;/li>
&lt;li>&lt;code>&amp;amp;str&lt;/code>å’Œ&lt;code>&amp;amp;[u8]&lt;/code>ï¼š&lt;code>&amp;amp;str&lt;/code>æ˜¯utf-8ç¼–ç çš„åˆ‡ç‰‡å¼•ç”¨ä¸”ä¸å¯å˜ï¼Œ&lt;code>&amp;amp;[u8]&lt;/code>æ˜¯å¯¹åŸå§‹å­—èŠ‚çš„åˆ‡ç‰‡å¼•ç”¨ï¼Œå¯å˜ç‰ˆæœ¬æ˜¯&lt;code>&amp;amp;mut [u8]&lt;/code>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="ä¸ºä»€ä¹ˆå¯ä»¥æ‰‹åŠ¨è°ƒç”¨dropxè€Œä¸èƒ½è°ƒç”¨xdrop">ä¸ºä»€ä¹ˆå¯ä»¥æ‰‹åŠ¨è°ƒç”¨drop(x)è€Œä¸èƒ½è°ƒç”¨x.drop()
&lt;/h4>&lt;p>å…³é”®åœ¨äº&lt;strong>æ‰€æœ‰æƒ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>std::mem::drop&amp;lt;T&amp;gt;(_x: T)&lt;/code>è½¬ç§»äº†æ‰€æœ‰æƒï¼Œ_xç¦»å¼€dropå‡½æ•°ä½œç”¨åŸŸï¼Œ&lt;strong>è‡ªåŠ¨è§¦å‘ææ„é€»è¾‘&lt;/strong>ï¼ˆè°ƒç”¨&lt;code>Drop::drop&lt;/code> traitçš„å®ç°ï¼‰&lt;/li>
&lt;li>&lt;code>drop(&amp;amp;mut self)&lt;/code>æ²¡æœ‰å‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»ï¼Œå¦‚æœå…è®¸æ‰‹åŠ¨è°ƒç”¨&lt;code>x.drop&lt;/code>,ç¼–è¯‘æœŸåœ¨ä½œç”¨åŸŸç»“æŸæ—¶ä»ä¼šå†æ¬¡è°ƒç”¨&lt;code>drop&lt;/code>ï¼ŒåŒé‡é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜å®‰å…¨é—®é¢˜ã€‚&lt;/li>
&lt;/ul></description></item><item><title>Ripgrepçš„å‘½ä»¤æ–‡æ¡£</title><link>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84%E5%91%BD%E4%BB%A4%E6%96%87%E6%A1%A3/</link><pubDate>Fri, 15 Aug 2025 12:50:54 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84%E5%91%BD%E4%BB%A4%E6%96%87%E6%A1%A3/</guid><description>&lt;p>ç”¨æ³• ï¼ˆ&lt;code>[]&lt;/code>å†…è¡¨ç¤ºæ˜¯å¯é€‰å‚æ•°):&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] PATTERN [PATH ...]&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] -e PATTERN ... [PATH ...]&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] -f PATTERNFILE ... [PATH ...]&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] --files [PATH ...]&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] --type-list&lt;/code>&lt;/p>
&lt;p>&lt;code>command | rg [OPTIONS] PATTERN&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] --help&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] --version&lt;/code>&lt;/p>
&lt;h4 id="å‚æ•°è§£é‡Š">å‚æ•°è§£é‡Š
&lt;/h4>&lt;p>PATTERN: è¦æœç´¢çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥&lt;code>-&lt;/code>å¼€å§‹çš„æ­£åˆ™éœ€è¦æ·»åŠ  &lt;code>-e&lt;/code>/&lt;code>--regexp&lt;/code>flagï¼Œå¦‚&lt;code>rg -e -foo&lt;/code>&lt;/p>
&lt;p>PATH&amp;hellip;: éœ€è¦æ£€ç´¢çš„æ–‡ä»¶æˆ–ç›®å½•&lt;/p>
&lt;h4 id="è¾“å…¥é€‰é¡¹input-options">è¾“å…¥é€‰é¡¹(input options)
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>&lt;code>--&lt;/code>ï¼šè¡¨ç¤ºåç»­ä»¥&lt;code>-&lt;/code>å¼€å¤´çš„&lt;code>word&lt;/code>éƒ½ä¸å†æ˜¯&lt;code>flag&lt;/code>è€Œæ˜¯&lt;code>pattern&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-e PATTERN, --regexp=PATTERN&lt;/code>: éœ€è¦æœç´¢çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯å¤šæ¬¡æŒ‡å®š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-f PATTERNFILE, --file=PATTERNFILE&lt;/code>:æŒ‡å®šä»ä½•æ–‡ä»¶æœç´¢æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯å¤šæ¬¡æŒ‡å®š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>--pre=COMMAND&lt;/code> å…è®¸æŒ‡å®šä¸€ä¸ªæ–‡ä»¶æ ¼å¼è½¬æ¢å‘½ä»¤ï¼Œripgrepä¼šå…ˆå°†æ–‡ä»¶é€šè¿‡è¯¥å‘½ä»¤è½¬æ¢ï¼Œç„¶ååœ¨è½¬æ¢åçš„å†…å®¹æœç´¢æ­£åˆ™è¡¨è¾¾å¼ã€‚&lt;code>æ–‡ä»¶&lt;/code> â†’ &lt;code>COMMANDå¤„ç†&lt;/code> â†’ &lt;code>è·å–æ ‡å‡†è¾“å‡º&lt;/code> â†’ &lt;code>ripgrepæœç´¢è¾“å‡ºå†…å®¹&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>--pre-glob=GLOB&lt;/code>ä¸“ä¸º&lt;code>--pre&lt;/code>å‘½ä»¤è®¾è®¡ï¼Œç²¾ç¡®çš„ç­›é€‰éœ€è¦é¢„å¤„ç†çš„æ–‡ä»¶ï¼Œé¿å…å¯¹ä¸åŒ¹é…çš„æ–‡ä»¶æ‰§è¡Œä¸å¿…è¦çš„æ ¼å¼è½¬æ¢ï¼Œå¤§å¹…æå‡æ€§èƒ½ã€‚&lt;code>rg --pre=pre-pdftotext --pre-glob='*.pdf' 'å…³é”®è¯'&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>report.pdf&lt;/code> â†’ è°ƒç”¨ &lt;code>pdftotext&lt;/code> è½¬æ¢åæœç´¢&lt;/li>
&lt;li>&lt;code>notes.txt&lt;/code> â†’ ç›´æ¥æœç´¢æ–‡æœ¬ï¼ˆçœå»è¿›ç¨‹åˆ›å»ºï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-z, --search-zip&lt;/code>æœç´¢å‹ç¼©åŒ…&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="search-options">search options
&lt;/h4>&lt;ul>
&lt;li>&lt;code>-s, --case-sensitive&lt;/code>æ‰§è¡Œæœç´¢æ—¶åŒºåˆ†å¤§å°å†™&lt;/li>
&lt;li>&lt;code>-i, --ignore-case&lt;/code>æ‰§è¡Œæœç´¢æ—¶ä¸åŒºåˆ†å¤§å°å†™&lt;/li>
&lt;li>&lt;code>--crlf&lt;/code>å¯åŠ¨æ—¶å°†CRLF(\r\n)è§†ä¸ºè¡Œç»ˆæ­¢ç¬¦ï¼Œè€Œä¸æ˜¯\n&lt;/li>
&lt;li>&lt;code>--dfa-size-limit=NUM+SUFFIX?&lt;/code>æ­£åˆ™è¡¨è¾¾å¼çš„dfaä¸Šé™ï¼Œå¯å¸¦å•ä½&lt;/li>
&lt;li>&lt;code>--regex-size-limit=NUM+SUFFIX?&lt;/code>è®¾ç½®&lt;strong>åœ¨å†…å­˜ä¸­æ„å»º&lt;/strong>çš„æ•´ä½“æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡çš„æœ€å¤§å°ºå¯¸&lt;/li>
&lt;li>&lt;code>--engine=ENGINE&lt;/code>æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼å¼•æ“&lt;/li>
&lt;li>&lt;code>-E ENCODING, --encoding=ENCODING&lt;/code>å¼ºåˆ¶ ripgrep ä½¿ç”¨ç‰¹å®šç¼–ç å¤„ç†æ‰€æœ‰è¢«æœç´¢æ–‡ä»¶ï¼ˆé»˜è®¤è‡ªåŠ¨æ£€æµ‹ç¼–ç ï¼‰&lt;/li>
&lt;li>&lt;code>-F, --fixedstrings&lt;/code>å°†æ‰€æœ‰æ¨¡å¼è§†ä¸ºå­—é¢é‡è€Œä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼&lt;/li>
&lt;li>&lt;code>-v --invert-match&lt;/code>åè½¬åŒ¹é…ï¼Œæ‰“å°ä¸åŒ¹é…çš„è¡Œï¼Œ&lt;code>--no-invert-match&lt;/code>ä¸ºç›¸åçš„è¾“å…¥&lt;/li>
&lt;li>&lt;code>-x --line-regexp&lt;/code>æ•´è¡ŒåŒ¹é…&lt;/li>
&lt;li>&lt;code>-w, --word-regexp&lt;/code>ç‹¬ç«‹å•è¯åŒ¹é…ï¼Œå¯ç”¨æ­¤æ ‡å¿—åï¼Œripgrep åªæ˜¾ç¤ºè¢«&lt;strong>å•è¯è¾¹ç•Œ&lt;/strong>åŒ…å›´çš„åŒ¹é…ç»“æœã€‚ç±»ä¼¼äºåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­è‡ªåŠ¨ç»™æœç´¢è¯æ·»åŠ  &lt;code>\b&lt;/code> è¾¹ç•Œï¼Œæ¯”&lt;code>-x&lt;/code>ä¼˜å…ˆçº§é«˜&lt;/li>
&lt;li>&lt;code>-m NUM, --max-count=NUM&lt;/code> é™åˆ¶æ¯ä¸ªæ–‡ä»¶çš„åŒ¹é…è¡Œæ•°é‡ï¼Œåˆ°è¾¾æŒ‡å®šæ•°é‡å°±åœæ­¢å½“å‰æ–‡ä»¶æœç´¢&lt;/li>
&lt;li>&lt;code>--mmap&lt;/code>ä¼˜å…ˆä½¿ç”¨&lt;code>mmap&lt;/code>æŠ€æœ¯è¿›è¡Œæ–‡ä»¶æœç´¢&lt;/li>
&lt;li>&lt;code>-U, --multiline&lt;/code>å¤šè¡Œæ¨¡å¼ï¼Œå…è®¸åŒ¹é…å†…å®¹è·¨è¶Šå¤šä¸ªè¡Œï¼Œçªç ´é»˜è®¤çš„å•è¡ŒåŒ¹é…é™åˆ¶&lt;/li>
&lt;li>&lt;code>--multiline-dotall&lt;/code>å½“å¯ç”¨å¤šè¡Œæœç´¢æ—¶(&lt;code>-U&lt;/code>)ï¼Œå¼ºåˆ¶æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‚¹å·&lt;code>.&lt;/code>åŒ¹é…&lt;strong>åŒ…æ‹¬æ¢è¡Œç¬¦&lt;/strong>çš„æ‰€æœ‰å­—ç¬¦&lt;/li>
&lt;li>&lt;code>--no-unicode&lt;/code>ç¦ç”¨unicodeæ¨¡å¼&lt;/li>
&lt;li>&lt;code>--null-data&lt;/code> å°†é»˜è®¤çš„è¡Œç»ˆæ­¢ç¬¦ä»æ¢è¡Œç¬¦&lt;code>\n&lt;/code>æ”¹ä¸ºNULå­—ç¬¦(&lt;code>\0&lt;/code>æˆ–ASCII 0)&lt;/li>
&lt;li>&lt;code>-P, --pcre2&lt;/code>åˆ‡æ¢é»˜è®¤çš„æ­£åˆ™å¼•æ“æ›´æ¢ä¸º&lt;strong>PCRE2&lt;/strong>&lt;/li>
&lt;li>&lt;code>-S, --smart-case&lt;/code>å¯ç”¨æ™ºèƒ½å¤§å°å†™åŒ¹é…æ¨¡å¼&lt;/li>
&lt;li>&lt;code>--stop-no-nonmatch&lt;/code>æ‰¾åˆ°è‡³å°‘ä¸€ä¸ªåŒ¹é…è¡Œä¸”åç»­é‡åˆ°ä¸åŒ¹é…è¡Œå°±æå‰åœæ­¢è¯»å–æ–‡ä»¶&lt;/li>
&lt;li>&lt;code>-a, --text&lt;/code>å¼ºåˆ¶å°†æ‰€æœ‰æ–‡ä»¶å½“ä½œçº¯æ–‡æœ¬æ–‡ä»¶å¤„ç†ï¼Œç¦ç”¨å…¶é»˜è®¤çš„äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹æœºåˆ¶&lt;/li>
&lt;li>&lt;code>-j NUM, --threads=NUM&lt;/code>æ§åˆ¶æœç´¢æ—¶ä½¿ç”¨çš„å¹¶è¡Œçº¿ç¨‹æ•°&lt;/li>
&lt;/ul>
&lt;h4 id="filter-options">filter options
&lt;/h4>&lt;ul>
&lt;li>&lt;code>--binary&lt;/code> é»˜è®¤æƒ…å†µä¸‹ripgrepä½¿ç”¨&lt;code>NUL&lt;/code>å­—èŠ‚ä½œä¸ºå¯å‘å¼æ ‡å¿—ã€‚ä¸€æ—¦åœ¨æ–‡ä»¶ä¸­æ£€æµ‹åˆ°NULå­—èŠ‚ï¼Œç«‹å³åˆ¤æ–­ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åç«‹å³åœæ­¢æœç´¢è¯¥æ–‡ä»¶å¹¶ä¸æ˜¾ç¤ºåŒ¹é…å†…å®¹ã€‚å¯ç”¨åå³ä½¿æ£€æµ‹åˆ°NULå­—èŠ‚ï¼Œä¹Ÿç»§ç»­æœç´¢æ–‡ä»¶ï¼Œç›´åˆ°æ‰¾åˆ°&lt;strong>é¦–ä¸ªåŒ¹é…é¡¹&lt;/strong>æˆ–æœç´¢åˆ°&lt;strong>æ–‡ä»¶ç»“æŸ&lt;/strong>åœæ­¢æœç´¢&lt;/li>
&lt;li>&lt;code>-L, --follow&lt;/code> å¼€å¯â€œè·Ÿéšç¬¦å·é“¾æ¥â€åŠŸèƒ½ï¼ˆé»˜è®¤å…³é—­ï¼‰,ç”¨ &lt;code>--no-follow&lt;/code> åœ¨æœ¬å‘½ä»¤ä¸­å–æ¶ˆ &lt;code>-L&lt;/code> çš„æ•ˆæœ&lt;/li>
&lt;li>&lt;code>-g GLOB, --glob=GLOB&lt;/code> é€šè¿‡é€šé…ç¬¦æ¨¡å¼ï¼ˆglobï¼‰&lt;strong>åŒ…å«æˆ–æ’é™¤ç‰¹å®šæ–‡ä»¶å’Œç›®å½•&lt;/strong>è¿›è¡Œæœç´¢&lt;/li>
&lt;li>&lt;code>--glob-case-insensitive&lt;/code>è®©æ‰€æœ‰é€šè¿‡&lt;code>-g/--glob&lt;/code>æŒ‡å®šçš„é€šé…ç¬¦è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…ï¼Œ&lt;code>--no-glob-case-insensitive&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--iglob=GLOB&lt;/code>å…è®¸ç”¨æˆ·é€šè¿‡&lt;strong>ä¸åŒºåˆ†å¤§å°å†™&lt;/strong>çš„é€šé…ç¬¦æ¨¡å¼æ¥&lt;strong>åŒ…å«æˆ–æ’é™¤æ–‡ä»¶/ç›®å½•&lt;/strong>&lt;/li>
&lt;li>&lt;code>-., --hidden&lt;/code> æœç´¢éšè—æ–‡ä»¶å’Œç›®å½•ï¼Œ&lt;code>--no-hidden&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--ignore-file=PATH&lt;/code> é€šè¿‡å¤–éƒ¨æ–‡ä»¶æŒ‡å®šå¿½ç•¥è§„åˆ™ï¼ˆ&lt;code>gitignore&lt;/code> æ ¼å¼ï¼‰&lt;/li>
&lt;li>&lt;code>--ignore-file-case-insensitive&lt;/code> æ§åˆ¶&lt;strong>å¿½ç•¥æ–‡ä»¶è§„åˆ™åŒ¹é…æ—¶æ˜¯å¦åŒºåˆ†å¤§å°å†™&lt;/strong>&lt;/li>
&lt;li>&lt;code>-d NUM, --max-depth=NUM&lt;/code>æŒ‡å®šæœç´¢çš„ç›®å½•éå†çš„æ·±åº¦å±‚çº§&lt;/li>
&lt;li>&lt;code>--max-filesize=NUM+SUFFIX?&lt;/code> è·³è¿‡è¶…è¿‡æŒ‡å®šå¤§å°çš„æ–‡ä»¶&lt;/li>
&lt;li>&lt;code>--no-ignore&lt;/code> è·³è¿‡æ‰€æœ‰å¿½ç•¥æ–‡ä»¶ï¼Œ&lt;code>--ignore&lt;/code>å–æ¶ˆè¿™æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-ignore-dot&lt;/code> ä»…è·³è¿‡ &lt;code>.ignore&lt;/code> å’Œ&lt;code>.rgignore&lt;/code> æ–‡ä»¶ä¸­çš„è¿‡æ»¤è§„åˆ™ï¼Œé€šè¿‡ &lt;code>--ignore-dot&lt;/code> å¯å…³é—­æ­¤åŠŸèƒ½&lt;/li>
&lt;li>&lt;code>--no-ignore-exclude&lt;/code> ç¦ç”¨æ‰‹åŠ¨é…ç½®çš„æ’é™¤è§„åˆ™ï¼Œ&lt;code>--ignore-exclude&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-ignore-files&lt;/code> ç¦ç”¨æ˜¾å¼æŒ‡å®šçš„å¿½ç•¥æ–‡ä»¶ï¼Œ&lt;code>--ignore-files&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-ignore-global&lt;/code> ç¦ç”¨æ¥è‡ªâ€œå…¨å±€â€æºçš„å¿½ç•¥è§„åˆ™ï¼ˆ&lt;code>.gitignore&lt;/code> æ–‡ä»¶ï¼‰ï¼Œ&lt;code>--ignore-global&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-ignore-parent&lt;/code>ä¸åº”ç”¨ä»çˆ¶ç›®å½•ä¸­æ‰¾åˆ°çš„å¿½ç•¥æ–‡ä»¶ï¼ˆå¦‚ &lt;code>.gitignore&lt;/code>ï¼‰ä¸­çš„è§„åˆ™ï¼Œ&lt;code>--ignore-parent&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-ignore-vcs&lt;/code> ç¦ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„å¿½ç•¥è§„åˆ™ï¼Œ&lt;code>-ignore--vcs&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-require-git&lt;/code> é»˜è®¤åªåœ¨gitä»“åº“æ‰éµå®ˆç‰ˆæœ¬æ§åˆ¶çš„å¿½ç•¥æ–‡ä»¶ï¼ˆå¦‚&lt;code>.gitignore&lt;/code>ï¼‰ï¼Œå¯ç”¨åå³ä½¿ä¸å†gitä»“åº“ï¼Œä¹Ÿä¼šéµå®ˆç‰ˆæœ¬æ§åˆ¶çš„å¿½ç•¥æ–‡ä»¶ã€‚&lt;code>--require-git&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-file-system&lt;/code> éå†ç›®å½•æ ‘æœç´¢æ–‡ä»¶æ—¶ï¼Œä¸ä¼šè·¨è¶Šä»»ä½•æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œï¼Œ&lt;code>--no-one-file-system&lt;/code>å–æ¶ˆæ­¤æ•ˆæœã€‚åœ¨æœç´¢&lt;strong>æ¯ä¸ªç»™å®šçš„èµ·å§‹è·¯å¾„&lt;/strong>æ—¶ï¼Œé‡åˆ°&lt;strong>æŒ‚è½½ç‚¹ï¼ˆé€šå¾€å¦ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„â€œé—¨â€ï¼‰å°±åœä¸‹æ¥ï¼Œä¸è¿›å»æœç´¢&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;code>-t TYPE, --type=TYPE&lt;/code> ç”¨äºé™åˆ¶åªæœç´¢ç‰¹å®šç±»å‹çš„æ–‡ä»¶&lt;/li>
&lt;li>&lt;code>-T TYPE, --type-not=TYPE&lt;/code> ç”¨äº&lt;strong>æ’é™¤&lt;/strong>æŒ‡å®šç±»å‹çš„æ–‡ä»¶ä¸è¿›è¡Œæœç´¢&lt;/li>
&lt;li>&lt;code>--type-add=TYPESPEC&lt;/code> ç”¨äºåˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶ç±»å‹åŒ¹é…è§„åˆ™&lt;/li>
&lt;li>&lt;code>--type-clear=TYPE&lt;/code> æ¸…æ¥š &lt;code>type-add&lt;/code>åˆ›å»ºçš„è‡ªå®šä¹‰æ–‡ä»¶ç±»å‹åŒ¹é…è§„åˆ™&lt;/li>
&lt;li>&lt;code>-u, --unrestricted&lt;/code> æ ‡å¿—é€šè¿‡å¤šæ¬¡é‡å¤ï¼ˆæœ€é«˜3æ¬¡ï¼‰é€æ­¥é™ä½ ripgrep çš„æ™ºèƒ½è¿‡æ»¤çº§åˆ«ï¼Œä½¿æœç´¢èŒƒå›´è¶Šæ¥è¶Šå¹¿&lt;/li>
&lt;/ul>
&lt;h4 id="output-options">output options
&lt;/h4>&lt;ul>
&lt;li>&lt;code>-A NUM, --after-context=NUM&lt;/code> ä¼šæ˜¾ç¤ºæ¯æ¡åŒ¹é…ç»“æœ&lt;strong>ä¹‹å&lt;/strong>çš„ NUM è¡Œå†…å®¹&lt;/li>
&lt;li>&lt;code>-B, --before-context=NUM&lt;/code> ä¼šæ˜¾ç¤ºæ¯æ¡åŒ¹é…ç»“æœä¹‹å‰çš„NUMè¡Œå†…å®¹&lt;/li>
&lt;li>&lt;code>-C NUM, --context=NUM&lt;/code>åœ¨åŒ¹é…ç»“æœå‰åæ˜¾ç¤ºNUMè¡Œå†…å®¹&lt;/li>
&lt;li>&lt;code>block-buffered&lt;/code>ä½¿ç”¨å†…å­˜ç¼“å†²åŒºï¼Œåªæœ‰å½“è¿™ä¸ªç¼“å†²åŒºç§¯ç´¯åˆ°ä¸€å®šå¤§å°åï¼Œæ‰ä¼šä¸€æ¬¡æ€§å°†å…¶å†…å®¹**åˆ·æ–° (flush) **åˆ°æ ‡å‡†è¾“å‡º (stdout)ã€‚&lt;code>--no-block-buffered&lt;/code>å–æ¶ˆæ­¤åŠŸèƒ½&lt;/li>
&lt;li>&lt;code>-b, --byte-offset&lt;/code>åœ¨è¾“å‡ºä¸­æ·»åŠ æ•°å­—å‰ç¼€ï¼Œè¡¨ç¤ºè¡Œæˆ–åŒ¹é…æ–‡æœ¬åœ¨æ–‡ä»¶ä¸­çš„èµ·å§‹å­—èŠ‚ä½ç½®ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼‰&lt;/li>
&lt;li>&lt;code>--color=WHEN&lt;/code>æ­¤é€‰é¡¹å†³å®šä½•æ—¶åœ¨è¾“å‡ºä¸­ä½¿ç”¨&lt;strong>é¢œè‰²é«˜äº®&lt;/strong>å’Œ&lt;strong>ANSIè½¬ä¹‰åºåˆ—&lt;/strong>&lt;/li>
&lt;li>&lt;code>--colors=COLOR_SPEC&lt;/code>é€‰é¡¹ç”¨äº&lt;strong>è‡ªå®šä¹‰è¾“å‡ºå†…å®¹çš„é¢œè‰²å’Œæ ·å¼&lt;/strong>ï¼Œå¯é€šè¿‡å¤šæ¬¡æŒ‡å®šå®ç°å¤šå±‚æ ·å¼å åŠ &lt;/li>
&lt;li>&lt;code>--column&lt;/code>åœ¨è¾“å‡ºä¸­å¢åŠ åˆ—å·ä¿¡æ¯ï¼Œ&lt;code>--no-column&lt;/code>å–æ¶ˆè¿™ä¸ªåŠŸèƒ½&lt;/li>
&lt;li>&lt;code>--context-separator=SEPARATOR&lt;/code>åœ¨ä½¿ç”¨ä¸Šä¸‹æ–‡é€‰é¡¹ï¼ˆ&lt;code>-A/-B/-C&lt;/code>ï¼‰æ—¶ï¼ŒæŒ‡å®š&lt;strong>åˆ†éš”ä¸åŒä¸Šä¸‹æ–‡å—çš„æ˜¾ç¤ºç¬¦å·&lt;/strong>,&lt;code>--no-context-separator&lt;/code>å–æ¶ˆæ­¤åŠŸèƒ½&lt;/li>
&lt;li>&lt;code>--field-match-separator=SEPARATOR&lt;/code>è‡ªå®šä¹‰ ripgrep è¾“å‡ºç»“æœä¸­&lt;strong>å„å­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦å·&lt;/strong>&lt;/li>
&lt;li>&lt;code>--heading&lt;/code>åœ¨æ¯ä¸ªæ–‡ä»¶åŒ¹é…ç»“æœç»„çš„&lt;strong>é¡¶éƒ¨&lt;/strong>æ˜¾ç¤ºä¸€æ¬¡æ–‡ä»¶è·¯å¾„ï¼Œè€Œä¸æ˜¯åœ¨æ¯è¡ŒåŒ¹é…å‰éƒ½é‡å¤æ˜¾ç¤ºï¼Œ&lt;code>--no-heading&lt;/code>å–æ¶ˆæ­¤åŠŸèƒ½&lt;/li>
&lt;li>&lt;code>-h, --help&lt;/code> &lt;code>-h&lt;/code>æ˜¯ç²¾ç®€å¸®åŠ©æ¨¡å¼ï¼Œ&lt;code>--help&lt;/code>æ˜¯å®Œæ•´å¸®åŠ©æ¨¡å¼&lt;/li>
&lt;li>&lt;code>--hyperlink-format=FORMAT&lt;/code> åˆ›å»ºå¯ç‚¹å‡»çš„è¶…é“¾æ¥&lt;/li>
&lt;/ul></description></item><item><title>åç¨‹çŸ¥è¯†ç‚¹</title><link>https://www.dust-zed.site/android-develop/%E5%8D%8F%E7%A8%8B%E7%9F%A5%E8%AF%86%E7%82%B9/</link><pubDate>Mon, 30 Jun 2025 19:02:22 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/%E5%8D%8F%E7%A8%8B%E7%9F%A5%E8%AF%86%E7%82%B9/</guid><description>&lt;h4 id="å°†å›è°ƒè½¬æ¢ä¸ºåç¨‹">å°†å›è°ƒè½¬æ¢ä¸ºåç¨‹
&lt;/h4>&lt;p>&lt;strong>èƒŒæ™¯&lt;/strong>ï¼šå¾ˆå¤šåº“ï¼ˆå°¤å…¶æ˜¯Java/Androidé—ç•™åº“ï¼‰ä½¿ç”¨åŸºäºå›è°ƒï¼ˆCallbackï¼‰çš„APIå¤„ç†å¼‚æ­¥æ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼Œæ•°æ®åº“æ“ä½œï¼‰ã€‚è¿™åœ¨ä»£ç ä¸­ä¼šå¯¼è‡´å›è°ƒåœ°ç‹±ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•å°†è¿™ç§å›è°ƒé£æ ¼çš„APIè½¬æ¢æˆ&lt;code>æŒ‚èµ·å‡½æ•°(suspend fun)&lt;/code>ï¼Œä½¿å…¶å¯ä»¥åœ¨åç¨‹ä¸­åƒ&lt;strong>é¡ºåºä»£ç &lt;/strong>ä¸€æ ·ä½¿ç”¨ã€‚&lt;/p>
&lt;p>&lt;strong>æ ¸å¿ƒå‡½æ•°ï¼š&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;strong>&lt;code>suspendCoroutine&lt;/code>(ç®€å•è½¬æ¢ï¼Œæ— å†…ç½®å–æ¶ˆæ”¯æŒ)&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">suspend&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &amp;lt;&lt;span style="color:#a6e22e">T&lt;/span>&amp;gt; &lt;span style="color:#a6e22e">convertCallbackToSuspendingFunc&lt;/span>(): T = suspendCoroutine {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> continuation &lt;span style="color:#f92672">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//1. å¯åŠ¨å¼‚æ­¥æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> callback = &lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">: &lt;/span>&lt;span style="color:#a6e22e">Callback&lt;/span>&amp;lt;T&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onSuccess&lt;/span>(result: T) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//2. æˆåŠŸæ—¶æ¢å¤åç¨‹ï¼Œä¼ é€’ç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> continuation.resume(result)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onFailure&lt;/span>(error: Throwable) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//3. å¤±è´¥æ—¶æ¢å¤åç¨‹ï¼Œä¼ é€’å¼‚å¸¸
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> continuation.resumeWithException(error)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> someAsyncOperation(callback)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>continuation: è¡¨ç¤ºå½“å‰è¢«æŒ‚èµ·çš„åç¨‹ã€‚å®ƒæä¾›äº†æ¢å¤åç¨‹çš„æ–¹æ³•ï¼šresume(value)å’ŒresumeWithException(exception)ã€‚&lt;/li>
&lt;li>ç¼ºç‚¹ï¼šå¦‚æœè°ƒç”¨è¿™ä¸ªsuspend fun çš„åç¨‹è¢«å–æ¶ˆã€‚someAsyncOperationä¸ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚è¿™å¯èƒ½å¯¼è‡´èµ„æºæµªè´¹æˆ–æ„å¤–ç»“æœã€‚åªé€‚ç”¨äºå¼‚æ­¥æ“ä½œæœ¬èº«éå¸¸å¿«æˆ–ä½ ä¸å…³å¿ƒå–æ¶ˆçš„æƒ…å†µã€‚&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>&lt;strong>&lt;code>suspendCancellableCoroutine&lt;/code>(æ”¯æŒå–æ¶ˆ)&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">suspend&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &amp;lt;&lt;span style="color:#a6e22e">T&lt;/span>&amp;gt; &lt;span style="color:#a6e22e">convertCallbackToSuspendingFuncSafely&lt;/span>(): T = suspendCancellableCoroutine { cancellableContinuation &lt;span style="color:#f92672">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. å¯åŠ¨å¼‚æ­¥æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> callback = &lt;span style="color:#66d9ef">object&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">: &lt;/span>&lt;span style="color:#a6e22e">Callback&lt;/span>&amp;lt;T&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onSuccess&lt;/span>(result: T) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cancellableContinuation.resume(result)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">onFailure&lt;/span>(error: Throwable) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cancellableContinuation.resumeWithException(error)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> someAsyncOperation(callback)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. â­ å…³é”®æ­¥éª¤ï¼šæ³¨å†Œå–æ¶ˆç›‘å¬å™¨ â­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> cancellableContinuation.invokeOnCancellation {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å½“åç¨‹è¢«å–æ¶ˆæ—¶ï¼Œå°è¯•å–æ¶ˆåº•å±‚çš„å¼‚æ­¥æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// é€šå¸¸è°ƒç”¨åº“æä¾›çš„å–æ¶ˆæ–¹æ³•ï¼Œä¾‹å¦‚ï¼šcancelOperation(callback)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> cancelOperation(callback)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å½“è°ƒç”¨è¿™ä¸ª&lt;code>suspend fun&lt;/code>çš„åç¨‹è¢«å–æ¶ˆæ—¶ï¼š
&lt;ol>
&lt;li>åç¨‹çš„å–æ¶ˆçŠ¶æ€ä¼šä¼ æ’­åˆ°è¿™ä¸ª &lt;code>CancellableContinuation&lt;/code>ã€‚&lt;/li>
&lt;li>è§¦å‘ &lt;code>invokeOnCancellation {}&lt;/code> å—ã€‚&lt;/li>
&lt;li>åœ¨å—å†…ï¼Œä½ è°ƒç”¨åº“çš„å–æ¶ˆæ–¹æ³•å»æ¸…ç†èµ„æºå¹¶åœæ­¢æ“ä½œã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>è¿™æ˜¯&lt;strong>å°†å›è°ƒ API é›†æˆåˆ°åç¨‹ä¸–ç•Œçš„æœ€ä½³å®è·µ&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="åç¨‹ä½œç”¨åŸŸ">åç¨‹ä½œç”¨åŸŸ
&lt;/h4>&lt;h5 id="1ä»€ä¹ˆæ˜¯åç¨‹ä½œç”¨åŸŸcoroutinescope">1ã€ä»€ä¹ˆæ˜¯åç¨‹ä½œç”¨åŸŸï¼ˆCoroutineScopeï¼‰
&lt;/h5>&lt;ul>
&lt;li>&lt;code>CoroutineScope&lt;/code>ä¸æ˜¯åç¨‹æœ¬èº«ï¼Œè€Œæ˜¯ä¸€ä¸ª&lt;strong>å®šä¹‰æ–°åç¨‹è¿è¡Œç¯å¢ƒ&lt;/strong>çš„æ¥å£&lt;/li>
&lt;li>å®ƒä¸ºåœ¨å…¶å†…éƒ¨å¯åŠ¨çš„æ‰€æœ‰å­åç¨‹æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„&lt;code>CoroutineContext&lt;/code>åŸºç¡€&lt;/li>
&lt;li>å®ƒå°†æ‰€æœ‰åœ¨å…¶å†…éƒ¨å¯åŠ¨çš„åç¨‹&lt;strong>ç»„ç»‡åœ¨ä¸€ä¸ªç»“æ„ä¸­&lt;/strong>ï¼Œä»¥ä¾¿è¿›è¡Œ&lt;strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æ ¸å¿ƒæ„æˆï¼š&lt;/strong>&lt;/p>
&lt;p>CoroutineScopeæ¥å£åªæœ‰ä¸€ä¸ªå±æ€§ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">interface&lt;/span> &lt;span style="color:#a6e22e">CoroutineScope&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> coroutineContext: CotoutineContext
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ª&lt;code>coroutineContext&lt;/code>æ˜¯å¯åŠ¨åœ¨è¯¥ä½œç”¨åŸŸå†…çš„&lt;strong>æ‰€æœ‰å­åç¨‹çš„é»˜è®¤ä¸Šä¸‹æ–‡&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;strong>åç¨‹ä½œç”¨åŸŸçš„æ ¸å¿ƒä¼˜ç‚¹&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç”Ÿå‘½å‘¨æœŸçš„è‡ªåŠ¨ç®¡ç†(å–æ¶ˆ)&lt;/strong>
&lt;ul>
&lt;li>é¿å…å†…å­˜æ³„æ¼&lt;/li>
&lt;li>ç®€åŒ–èµ„æºæ¸…ç†&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>å®‰å…¨æ€§ä¸æ¸…æ™°æ€§&lt;/strong>
&lt;ul>
&lt;li>å–æ¶ˆä¼ æ’­ï¼šä½œç”¨åŸŸçš„å–æ¶ˆä¼šè‡ªåŠ¨ä¸”å¯é åœ°ä¼ æ’­åˆ°æ‰€æœ‰å­åç¨‹ï¼Œæ— éœ€å¼€å‘è€…æ‰‹åŠ¨çº§è”å–æ¶ˆ&lt;/li>
&lt;li>å¼‚å¸¸å¤„ç†æ§åˆ¶ï¼šä½œç”¨åŸŸå®šä¹‰äº†å¼‚å¸¸ä¼ æ’­çš„ç­–ç•¥ï¼ˆé€šè¿‡å…¶å…³è”çš„&lt;code>Job&lt;/code>æ˜¯æ™®é€š&lt;code>Job&lt;/code>è¿˜æ˜¯&lt;code>SupervisorJob&lt;/code>ï¼‰ã€‚&lt;code>SupervisorJob&lt;/code>å…è®¸å­åç¨‹ç‹¬ç«‹å¤±è´¥è€Œä¸å½±å“å…¶ä»–å…„å¼Ÿåç¨‹å’Œçˆ¶ä½œç”¨åŸŸï¼ˆå¸¸ç”¨äºUIç»„ä»¶ä¸­å•ç‹¬çš„åå°ä»»åŠ¡ï¼‰ã€‚&lt;/li>
&lt;li>ä»£ç ç»„ç»‡æ¸…æ™°ï¼šå°†ä»»åŠ¡åˆ’åˆ†åˆ°ä¸åŒçš„ä½œç”¨åŸŸä¸­ï¼Œä½“ç°äº†ä»»åŠ¡çš„é€»è¾‘å’Œç”Ÿå‘½å‘¨æœŸå½’å±ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ä¸Šä¸‹æ–‡ç»§æ‰¿ä¸å…±äº«&lt;/strong>
&lt;ul>
&lt;li>åœ¨ä½œç”¨åŸŸå†…å¯åŠ¨çš„åç¨‹é»˜è®¤ç»§æ‰¿ä½œç”¨åŸŸçš„coroutineContext&lt;/li>
&lt;li>å¯ä»¥æŒ‡å®šä¸åŒçš„CoroutineContextå…ƒç´ æ¥è¦†ç›–ä¸Šä¸‹æ–‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ååŒç­‰å¾…(job.join(), coroutineScope {})&lt;/strong>
&lt;ul>
&lt;li>ä½ å¯ä»¥é€šè¿‡ä½œç”¨åŸŸçš„å…³è” &lt;code>Job&lt;/code> (è°ƒç”¨ &lt;code>scope.coroutineContext[Job]!!.join()&lt;/code> æˆ–æ›´ç®€å•åœ°ä½¿ç”¨ &lt;code>coroutineScope {}&lt;/code> æ„å»ºå™¨) æ¥&lt;strong>ç­‰å¾…ä½œç”¨åŸŸå†…æ‰€æœ‰å­åç¨‹å…¨éƒ¨å®Œæˆ&lt;/strong>ã€‚è¿™ä¿è¯äº†ä»»åŠ¡å†…éƒ¨çš„å¹¶å‘æ“ä½œåœ¨å¤–éƒ¨çœ‹æ¥æ˜¯åŸå­æ€§çš„ï¼ˆå³çˆ¶åç¨‹ç­‰å¾…æ‰€æœ‰å­åç¨‹å®Œæˆåè‡ªå·±æ‰å®Œæˆï¼‰ã€‚&lt;/li>
&lt;li>&lt;code>coroutineScope {}&lt;/code> æ„å»ºå™¨æœ¬èº«ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­ä½œç”¨åŸŸï¼Œå¹¶ç­‰å¾…å…¶å†…éƒ¨æ‰€æœ‰å­åç¨‹å®Œæˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="asyncçš„è¡Œä¸º">asyncçš„è¡Œä¸º
&lt;/h4>&lt;h5 id="1-asyncçš„ç«‹å³å¯åŠ¨ç‰¹æ€§">1. asyncçš„ç«‹å³å¯åŠ¨ç‰¹æ€§
&lt;/h5>&lt;ul>
&lt;li>asyncä¸æ˜¯ç­‰å¾…awaitæ‰æ‰§è¡Œï¼šå½“ä½¿ç”¨async { &amp;hellip; } åˆ›å»ºåç¨‹æ—¶ï¼Œå…¶ä¸­çš„ä»£ç ä¼šç«‹å³å¼€å§‹æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç­‰å¾…è°ƒç”¨&lt;code>await()&lt;/code>ã€‚å³ä½¿ä¸è°ƒç”¨await()ï¼Œåç¨‹ä½“ä¹Ÿä¼šåœ¨åå°å¯åŠ¨ã€‚&lt;/li>
&lt;li>å¹¶å‘æ‰§è¡Œï¼šå¤šä¸ªasyncåç¨‹é»˜è®¤å¹¶è¡Œæ‰§è¡Œï¼ˆå–å†³äºè°ƒåº¦å™¨å’Œä¸Šä¸‹æ–‡ï¼‰ã€‚ä¾‹å¦‚ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">val&lt;/span> deferred1 = async { task1() } &lt;span style="color:#75715e">// ç«‹å³å¼€å§‹æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> deferred2 = async { task2() } &lt;span style="color:#75715e">// ç«‹å³å¼€å§‹æ‰§è¡Œï¼ˆå¯èƒ½ä¸ task1 åŒæ—¶è¿è¡Œï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-awaitçš„ä½œç”¨">2. await()çš„ä½œç”¨
&lt;/h5>&lt;ul>
&lt;li>åŒæ­¥ç­‰å¾…ç»“æœï¼šawait()æ˜¯ä¸€ä¸ªæŒ‚èµ·ç‚¹ï¼š
&lt;ul>
&lt;li>å¦‚æœåç¨‹å·²å®Œæˆï¼šç›´æ¥è¿”å›ç»“æœ&lt;/li>
&lt;li>å¦‚æœåç¨‹æœªå®Œæˆï¼šæŒ‚èµ·å½“å‰åç¨‹ï¼Œç­‰å¾…ç»“æœä½†ä¸é˜»æ­¢å…¶ä»–åç¨‹æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>é¡ºåºæ§åˆ¶ï¼šawait()å¯å¼ºåˆ¶ç­‰å¾…é¡ºåºï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">val&lt;/span> result1 = deferred1.await() &lt;span style="color:#75715e">// ç­‰å¾… task1 å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">val&lt;/span> result2 = deferred2.await() &lt;span style="color:#75715e">// å†ç­‰å¾… task2 å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="qa">Q&amp;amp;A
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>çˆ¶åç¨‹çš„æŒ‚èµ·ä¼šå½±å“å­åç¨‹çš„è¿è¡Œå—ï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>&lt;strong>é€šå¸¸ä¸ä¼šå½±å“å­åç¨‹çš„è¿è¡Œ&lt;/strong>ï¼Œçˆ¶åç¨‹ä¸å­åç¨‹æ˜¯ç‹¬ç«‹çš„ä»»åŠ¡å•å…ƒï¼Œåªè¦å­åç¨‹æœªå®Œæˆä¸”æœªè¢«å–æ¶ˆï¼Œä»–ä»¬ä¼šç»§ç»­ç”±è°ƒåº¦å™¨åˆ†é…çº¿ç¨‹æ‰§è¡Œã€‚å–æ¶ˆæ˜¯å–æ¶ˆï¼ŒæŒ‚èµ·æ—¶è®©å‡ºå½“å‰çº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>çˆ¶ä½œç”¨åŸŸä¼šç­‰å¾…æ‰€æœ‰å­åç¨‹å®Œæˆåæ‰ç»§ç»­æ‰§è¡Œï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>æ˜¯çš„ï¼Œæ‰€æœ‰çˆ¶åç¨‹ï¼ˆçˆ¶ä½œç”¨åŸŸï¼‰ä¼šè‡ªåŠ¨ç­‰å¾…æ‰€æœ‰å­åç¨‹å®Œæˆã€‚&lt;code>join()&lt;/code>å’Œ&lt;code>wait()&lt;/code>&lt;strong>æ§åˆ¶æ‰§è¡Œé¡ºåº&lt;/strong>å’Œ&lt;strong>ç¡®ä¿åœ¨ç‰¹å®šèŠ‚ç‚¹æœ‰ç»“æœ&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ä¸ºä»€ä¹ˆI/Oæ“ä½œæ”¯æŒæŒ‚èµ·ï¼Œè€ŒCPUå¯†é›†æ“ä½œéœ€è¦&lt;code>withContext&lt;/code>æ‰‹åŠ¨æŒ‚èµ·ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>I/Oæ“ä½œéœ€è¦&lt;strong>ç­‰å¾…å¤–éƒ¨èµ„æº&lt;/strong>ï¼ˆæ–‡ä»¶/ç½‘ç»œ/æ•°æ®åº“å“åº”ï¼‰å°±ç»ªï¼Œè¿›è€ŒCPUå°±ä¼šç©ºé—²ï¼Œç©ºé—²ä¸‹æ¥äº†ï¼Œåç¨‹å°±å†³å®š&lt;strong>ä¸»åŠ¨é‡Šæ”¾çº¿ç¨‹ - æŒ‚èµ·&lt;/strong>ï¼Œè®©å…¶ä»–ä»»åŠ¡å»ä½¿ç”¨çº¿ç¨‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CPUå¯†é›†æ“ä½œ&lt;strong>æŒç»­æ¶ˆè€—CPUè®¡ç®—èµ„æº&lt;/strong>ï¼ŒCPUä¸ä¼šç©ºé—²&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item><item><title>åç¨‹åŸç†</title><link>https://www.dust-zed.site/android-develop/%E5%8D%8F%E7%A8%8B%E5%8E%9F%E7%90%86/</link><pubDate>Mon, 30 Jun 2025 15:13:25 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/%E5%8D%8F%E7%A8%8B%E5%8E%9F%E7%90%86/</guid><description>&lt;p>Kotlinåç¨‹çš„æœ¬è´¨æ˜¯&lt;strong>é€šè¿‡çŠ¶æ€æœºç®¡ç†æŒ‚èµ·ç‚¹ï¼Œç”±ç¼–è¯‘å™¨è¿›è¡ŒCPSå˜æ¢å®ç°çš„è½»é‡çº§å¹¶å‘æŠ½è±¡&lt;/strong>ã€‚å…¶æ ¸å¿ƒåŸç†å’ŒçŠ¶æ€æ¨è¿›æœºåˆ¶å¦‚ä¸‹ï¼š&lt;/p>
&lt;h4 id="æ ¸å¿ƒåŸç†">æ ¸å¿ƒåŸç†
&lt;/h4>&lt;h5 id="1-æŒ‚èµ·å‡½æ•°">1. æŒ‚èµ·å‡½æ•°
&lt;/h5>&lt;ul>
&lt;li>ç”¨suspendä¿®é¥°çš„å‡½æ•°&lt;/li>
&lt;li>ç¼–è¯‘å™¨ä¼šå°†å…¶ç¼–è¯‘ä¸º&lt;strong>çŠ¶æ€æœºä»£ç &lt;/strong>(è€Œéé˜»å¡çº¿ç¨‹)ï¼Œæ”¯æŒåœ¨ä»»æ„ä½ç½®æŒ‚èµ·/æ¢å¤&lt;/li>
&lt;/ul>
&lt;h5 id="2-ç»­ä½“">2. ç»­ä½“
&lt;/h5>&lt;ul>
&lt;li>ç±»ä¼¼å›è°ƒçš„æ¥å£&lt;code>Continuation&amp;lt;T&amp;gt;&lt;/code>ï¼Œå…¶å…³é”®æ–¹æ³•æ˜¯&lt;code>resumeWith(result)&lt;/code>&lt;/li>
&lt;li>åç¨‹çš„æ¯ä¸€æ­¥æ‰§è¡Œéƒ½ä¾é™„äºä¸€ä¸ªç»­ä½“å¯¹è±¡ï¼Œå­˜å‚¨å½“å‰æ‰§è¡ŒçŠ¶æ€å’Œä¸Šä¸‹æ–‡&lt;/li>
&lt;/ul>
&lt;h5 id="3-çŠ¶æ€æœºè½¬æ¢">3. çŠ¶æ€æœºè½¬æ¢
&lt;/h5>&lt;ul>
&lt;li>ç¼–è¯‘å™¨å°†æŒ‚èµ·å‡½æ•°æ‹†è§£æˆä¸€ä¸ªçŠ¶æ€æœºï¼ˆé€šè¿‡&lt;code>label&lt;/code>æ ‡è®°çŠ¶æ€ï¼‰&lt;/li>
&lt;li>æ¯ä¸ªæŒ‚èµ·ç‚¹å¯¹åº”ä¸€ä¸ªçŠ¶æ€è¿ç§»&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="çŠ¶æ€æ¨è¿›æµç¨‹">çŠ¶æ€æ¨è¿›æµç¨‹
&lt;/h4>&lt;p>ä»¥ä¸‹ä»£ç å±•ç¤ºçŠ¶æ€æœºçš„è¿ä½œï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">suspend&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">fetchData&lt;/span>(): String {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> data1 = fetchPart1() &lt;span style="color:#75715e">//æŒ‚èµ·ç‚¹1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">val&lt;/span> data2 = fetchPart2() &lt;span style="color:#75715e">//æŒ‚èµ·ç‚¹2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> data1 + data2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ç¼–è¯‘å™¨è½¬æ¢åï¼ˆä¼ªä»£ç ï¼‰&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">FetchDataStateMachine&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">val&lt;/span> completion: Continuation&amp;lt;String&amp;gt;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> label: Int = &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>) : Continuation&amp;lt;Unit&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> data1: String? = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> data2: String? = &lt;span style="color:#66d9ef">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">fun&lt;/span> &lt;span style="color:#a6e22e">resumeWith&lt;/span>(result: Result&amp;lt;Any?&amp;gt;) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">when&lt;/span>(label) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> label = &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fetchPart1(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data1 = result.getOrThrow() &lt;span style="color:#66d9ef">as&lt;/span> String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> label = &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fetchPart2(&lt;span style="color:#66d9ef">this&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data2 = result.getOrThrow() &lt;span style="color:#66d9ef">as&lt;/span> String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> completion.resumeWith(data1 + data2) &lt;span style="color:#75715e">//è¿”å›æœ€ç»ˆç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="å…³é”®æœºåˆ¶">å…³é”®æœºåˆ¶
&lt;/h4>&lt;h5 id="1-æŒ‚èµ·ä¸é˜»å¡çº¿ç¨‹">1. æŒ‚èµ·ä¸é˜»å¡çº¿ç¨‹ï¼š
&lt;/h5>&lt;ul>
&lt;li>åç¨‹æŒ‚èµ·æ—¶ï¼Œåº•å±‚çº¿ç¨‹ç«‹å³é‡Šæ”¾ï¼ˆä¾‹å¦‚è¿”å›åˆ°çº¿ç¨‹æ± ï¼‰ï¼Œé¿å…èµ„æºæµªè´¹&lt;/li>
&lt;li>å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œä»»åŠ¡è¢«æ´¾å‘åˆ°åˆé€‚çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼ˆé€šè¿‡&lt;code>Dispatcher&lt;/code>ï¼‰&lt;/li>
&lt;/ul>
&lt;h5 id="2ç»­ä½“ä¼ é€’é£æ ¼">2.ç»­ä½“ä¼ é€’é£æ ¼
&lt;/h5>&lt;ul>
&lt;li>æŒ‚èµ·å‡½æ•°è¢«ç¼–è¯‘ä¸ºæ¥å—é¢å¤–&lt;code>Continuation&lt;/code>å‚æ•°çš„å‡½æ•°&lt;/li>
&lt;li>ä¾‹å¦‚&lt;code>suspend fun foo()&lt;/code> â†’ &lt;code>fun foo(continuation: Continuation)&lt;/code>&lt;/li>
&lt;/ul>
&lt;h5 id="3-åç¨‹ä¸Šä¸‹æ–‡coroutinecontext">3. åç¨‹ä¸Šä¸‹æ–‡ï¼ˆCoroutineContextï¼‰
&lt;/h5>&lt;ul>
&lt;li>é€šè¿‡&lt;code>CoroutineContext&lt;/code>ä¼ é€’è°ƒåº¦å™¨ã€å¼‚å¸¸å¤„ç†å™¨ç­‰ã€‚&lt;/li>
&lt;li>çŠ¶æ€æœºä¸­é€šè¿‡&lt;code>Continuation.context&lt;/code>è·å–å½“å‰ä¸Šä¸‹æ–‡&lt;/li>
&lt;/ul>
&lt;h5 id="4-ç»“æ„åŒ–å¹¶å‘">4. ç»“æ„åŒ–å¹¶å‘
&lt;/h5>&lt;ul>
&lt;li>åç¨‹æ ‘é€šè¿‡çˆ¶-å­å…³ç³»ç®¡ç†ç”Ÿå‘½å‘¨æœŸ&lt;/li>
&lt;li>çˆ¶åç¨‹å–æ¶ˆæ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆæ‰€æœ‰å­åç¨‹&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="çŠ¶æ€æ¨è¿›">çŠ¶æ€æ¨è¿›
&lt;/h4>&lt;p>åœ¨&lt;code>FetchDataStateMachine&lt;/code>çš„&lt;code>resumeWith&lt;/code>ä¸­å¹¶æ²¡æœ‰å¾ªç¯ï¼Œlabelçš„çŠ¶æ€æ˜¯å¦‚ä½•æ¨è¿›çš„å‘¢ï¼Ÿå®é™…ä¸ŠçŠ¶æ€æ¨è¿›æ˜¯é€šè¿‡&lt;strong>é€’å½’é“¾å¼è°ƒç”¨ä¸é—´æ¥è·³è½¬&lt;/strong>å®ç°çš„ã€‚&lt;/p>
&lt;h5 id="1-å•æ¬¡è§¦å‘æ¨¡å‹">1. å•æ¬¡è§¦å‘æ¨¡å‹
&lt;/h5>&lt;ul>
&lt;li>æ¯æ¬¡resumeWithè¢«è°ƒç”¨æ—¶åªå¤„ç†å½“å‰çŠ¶æ€&lt;/li>
&lt;li>é€šè¿‡æ›´æ–°labelå€¼æ ‡è®°ä¸‹ä¸€æ­¥çŠ¶æ€&lt;/li>
&lt;li>ä¸ç«‹å³å¤„ç†åç»­çŠ¶æ€ï¼Œè€Œæ˜¯ç­‰å¾…ä¸‹ä¸€æ¬¡æ¢å¤&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span style="display:flex;">&lt;span>label = &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#75715e">//åªæ ‡è®°ä¸‹ä¸€æ­¥çŠ¶æ€ï¼Œä¸ç«‹å³æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>fetchPart2(&lt;span style="color:#66d9ef">this&lt;/span>) &lt;span style="color:#75715e">//è§¦å‘å¼‚æ­¥æ“ä½œï¼ˆæŒ‚èµ·ï¼‰ï¼Œthiså°±æ˜¯FetchDataStateMachineï¼Œå…¶æ˜¯Continuationï¼Œå¯é€šè¿‡thisè°ƒç”¨resumeWith
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-é“¾å¼é€’å½’å”¤é†’">2. é“¾å¼é€’å½’å”¤é†’
&lt;/h5>&lt;ul>
&lt;li>æ¯ä¸ªå¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œéƒ½ä¼šé‡æ–°è°ƒç”¨resumeWith&lt;/li>
&lt;li>æ¯è°ƒç”¨ä¸€æ¬¡ï¼Œå°±ä¼šå¤„ç†å½“å‰çŠ¶æ€å¹¶è®¾ç½®ä¸‹ä¸€æ¬¡çŠ¶æ€&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>resumeWith(ç»“æœ) â†’ å¤„ç†å½“å‰çŠ¶æ€
â†‘ â†“
å¼‚æ­¥å®Œæˆ è®¾ç½®ä¸‹ä¸€çŠ¶æ€
â†‘
æ¢å¤æ‰§è¡Œ
&lt;/code>&lt;/pre>&lt;h5 id="3-çŠ¶æ€å˜é‡æŒä¹…åŒ–">3. çŠ¶æ€å˜é‡æŒä¹…åŒ–
&lt;/h5>&lt;ul>
&lt;li>çŠ¶æ€æœºå¯¹è±¡åœ¨æŒ‚èµ·æœŸé—´æŒç»­å­˜åœ¨ï¼ˆå †å†…å­˜ï¼‰&lt;/li>
&lt;li>æˆå‘˜å˜é‡(data1, label)ä¿å­˜ä¸­é—´çŠ¶æ€&lt;/li>
&lt;li>æ¯æ¬¡æ¢å¤æ—¶ä»æ­£ç¡®çŠ¶æ€ç»§ç»­æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;h5 id="4-ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€å·§">4. ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€å·§
&lt;/h5>&lt;ul>
&lt;li>å°¾é€’å½’ä¼˜åŒ–ï¼šç¼–è¯‘å™¨ä¼šå°†çŠ¶æ€å¤„ç†è½¬ä¸ºå¾ªç¯&lt;/li>
&lt;li>çŠ¶æ€æŠ˜å  ï¼šåˆå¹¶å¯ä¼˜åŒ–çŠ¶æ€å‡å°‘è·³è½¬æ¬¡æ•°&lt;/li>
&lt;li>å†…è”çŠ¶æ€ï¼šç®€å•çŠ¶æ€æœºè½¬ä¸ºswitchè·³è½¬è¡¨&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="å¯¹æŒ‚èµ·çš„ç†è§£">å¯¹æŒ‚èµ·çš„ç†è§£
&lt;/h4>&lt;p>åç¨‹æŒ‚æœºï¼šåœ¨æŒ‚èµ·ç‚¹æš‚åœå½“å‰çš„åŒæ­¥ä»£ç ï¼Œè½¬è€Œå»æ‰§è¡Œæ¶ˆæ¯é˜Ÿåˆ—çš„runnableï¼›è¿™æ ·å°±æ˜¯æˆ‘å¯¹æŒ‚èµ·çš„ç†è§£ï¼Œä¹Ÿå°±æ˜¯è®©å‡ºçº¿ç¨‹&lt;/p></description></item><item><title>gradleç›¸å…³çŸ¥è¯†</title><link>https://www.dust-zed.site/android-develop/gradle%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</link><pubDate>Sun, 29 Jun 2025 15:26:57 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/gradle%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</guid><description>&lt;h3 id="ä¸€æ’ä»¶plugins-vs-åº“libraries">ä¸€ã€æ’ä»¶(Plugins) vs åº“(Libraries)
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>ç‰¹å¾&lt;/strong>&lt;/th>
&lt;th>æ’ä»¶ (Plugins)&lt;/th>
&lt;th>åº“ (Libraries)&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>æœ¬è´¨&lt;/strong>&lt;/td>
&lt;td>æ„å»ºé€»è¾‘æ‰©å±•å·¥å…·&lt;/td>
&lt;td>è¿è¡Œæ—¶ä¾èµ–çš„ä»£ç ç»„ä»¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>ä½œç”¨&lt;/strong>&lt;/td>
&lt;td>æ·»åŠ ä»»åŠ¡/é…ç½®/ç›®å½•ç»“æ„&lt;/td>
&lt;td>æä¾›å¯è°ƒç”¨çš„å…·ä½“ä»£ç å®ç°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>å£°æ˜ä½ç½®&lt;/strong>&lt;/td>
&lt;td>&lt;code>plugins {}&lt;/code> å—&lt;/td>
&lt;td>&lt;code>dependencies {}&lt;/code> å—&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>å½±å“èŒƒå›´&lt;/strong>&lt;/td>
&lt;td>æ„å»ºè¿‡ç¨‹&lt;/td>
&lt;td>è¿è¡Œæ—¶æˆ–ç¼–è¯‘æ—¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>å…¸å‹ç¤ºä¾‹&lt;/strong>&lt;/td>
&lt;td>&lt;code>java&lt;/code>ï¼Œ&lt;code>android&lt;/code>&lt;/td>
&lt;td>&lt;code>gson&lt;/code>, &lt;code>junit&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="1-æ’ä»¶è¯¦è§£">1. æ’ä»¶è¯¦è§£
&lt;/h4>&lt;p>&lt;strong>æ ¸å¿ƒä½œç”¨&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>æ·»åŠ æ–°ä»»åŠ¡ï¼ˆå¦‚ &lt;code>compileJava&lt;/code>, &lt;code>assemble&lt;/code>ï¼‰&lt;/li>
&lt;li>å®šä¹‰é»˜è®¤ç›®å½•ç»“æ„ï¼ˆå¦‚ &lt;code>src/main/java&lt;/code>ï¼‰&lt;/li>
&lt;li>å¼•å…¥é¢„ç½®é…ç½®ï¼ˆå¦‚ &lt;code>implementation&lt;/code> ä¾èµ–é…ç½®ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä½¿ç”¨åœºæ™¯&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-groovy" data-lang="groovy">&lt;span style="display:flex;">&lt;span>plugins &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> id &lt;span style="color:#e6db74">&amp;#39;com.android.application&amp;#39;&lt;/span> &lt;span style="color:#75715e">// Android APPæ’ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> id &lt;span style="color:#e6db74">&amp;#39;org.jetbrains.kotlin.android&amp;#39;&lt;/span> &lt;span style="color:#75715e">// Kotlinæ”¯æŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="2-åº“è¯¦è§£">2. åº“è¯¦è§£
&lt;/h4>&lt;p>&lt;strong>å…³é”®ç‰¹å¾&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡åæ ‡å£°æ˜ï¼š&lt;code>group:name:version&lt;/code>ï¼ˆå¦‚ &lt;code>com.google.guava:guava:32.0-jre&lt;/code>ï¼‰&lt;/li>
&lt;li>&lt;strong>ä¼ é€’ä¾èµ–&lt;/strong>ï¼šåº“å¯èƒ½è‡ªå¸¦å…¶ä»–ä¾èµ–ï¼ˆå¦‚ Retrofit è‡ªåŠ¨å¼•å…¥ OkHttpï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä½¿ç”¨åœºæ™¯&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-groovy" data-lang="groovy">&lt;span style="display:flex;">&lt;span>dependencies &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementation &lt;span style="color:#e6db74">&amp;#39;androidx.core:core-ktx:1.12.0&amp;#39;&lt;/span> &lt;span style="color:#75715e">// ä¸»ä»£ç ä¾èµ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> testImplementation &lt;span style="color:#e6db74">&amp;#39;junit:junit:4.13.2&amp;#39;&lt;/span> &lt;span style="color:#75715e">// æµ‹è¯•ä»£ç ä¸“ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 id="äºŒä¾èµ–é…ç½®è¯¦è§£">äºŒã€ä¾èµ–é…ç½®è¯¦è§£
&lt;/h3>&lt;h4 id="1-implementationæœ€å¸¸ç”¨">1. &lt;code>implementation&lt;/code>ï¼ˆæœ€å¸¸ç”¨ï¼‰
&lt;/h4>&lt;p>&lt;strong>ç‰¹ç‚¹&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>ä¾èµ–&lt;strong>ä¸ä¼ é€’&lt;/strong>ç»™å…¶ä»–æ¨¡å—,&lt;code>æ¨¡å—F â†’ æ¨¡å—D â†’ æ¨¡å—E&lt;/code>ï¼ˆä¼ å¯¼ç»ˆæ­¢äºDï¼‰ï¼Œæ¨¡å—Få®Œå…¨ä¸çŸ¥é“æ¨¡å—Eçš„å­˜åœ¨&lt;/li>
&lt;li>åŠ å¿«æ„å»ºï¼ˆå‡å°‘é‡ç¼–è¯‘ï¼‰&lt;/li>
&lt;li>é€‚ç”¨äºç»å¤§å¤šæ•°å­—ä¾èµ–&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-groovy" data-lang="groovy">&lt;span style="display:flex;">&lt;span>implementation &lt;span style="color:#e6db74">&amp;#39;com.squareup.retrofit2:retrofit:2.9.0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="2-apiè°¨æ…ä½¿ç”¨">2. &lt;code>api&lt;/code>ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
&lt;/h4>&lt;p>&lt;strong>ç‰¹ç‚¹&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>ä¾èµ–&lt;strong>ä¼ é€’&lt;/strong>ç»™å…¶ä»–æ¨¡å—ï¼Œå»ºç«‹&lt;strong>ä¾èµ–ä¼ é€’é“¾&lt;/strong>ï¼š&lt;code>æ¨¡å—C â†’ æ¨¡å—A â†’ æ¨¡å—B&lt;/code>ï¼Œæ¨¡å—Cå¯ä»¥ä½¿ç”¨æ¨¡å—Bå…¬å¼€çš„æ¥å£&lt;/li>
&lt;li>ç”¨äº SDK å¼€å‘éœ€æš´éœ²ä¾èµ–çš„åœºæ™¯&lt;/li>
&lt;li>ä¼šå¢åŠ æ„å»ºæ—¶é—´&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-groovy" data-lang="groovy">&lt;span style="display:flex;">&lt;span>api &lt;span style="color:#e6db74">&amp;#39;com.google.dagger:dagger:2.48&amp;#39;&lt;/span> &lt;span style="color:#75715e">// å…¶ä»–æ¨¡å—éœ€ä½¿ç”¨Dagger
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="3-classpath">3. &lt;code>classpath&lt;/code>
&lt;/h4>&lt;p>&lt;strong>ç‰¹ç‚¹&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>ä»…ç”¨äºé¡¹ç›®çº§æ„å»ºè„šæœ¬(&lt;code>build.gradle&lt;/code>)&lt;/li>
&lt;li>ä¸º Gradle è‡ªèº«å¼•å…¥æ’ä»¶åŒ…ï¼Œç„¶ååœ¨æ¨¡å—çº§pluginså—ä¸­å£°æ˜ä½¿ç”¨&lt;/li>
&lt;li>&lt;strong>ä¸å‚ä¸&lt;/strong>æ¨¡å—ä»£ç ç¼–è¯‘&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-groovy" data-lang="groovy">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é¡¹ç›®çº§ build.gradle
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>buildscript &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dependencies &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> classpath &lt;span style="color:#e6db74">&amp;#39;com.android.tools.build:gradle:8.1.0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="4-aliasç‰ˆæœ¬ç›®å½•">4. &lt;code>alias&lt;/code>ï¼ˆç‰ˆæœ¬ç›®å½•ï¼‰
&lt;/h4>&lt;p>&lt;strong>ç‰¹ç‚¹&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨ &lt;code>gradle/libs.versions.toml&lt;/code> ä¸­é›†ä¸­ç®¡ç†ä¾èµ–&lt;/li>
&lt;li>è§£å†³ç‰ˆæœ¬å·ç¡¬ç¼–ç é—®é¢˜&lt;/li>
&lt;li>&lt;strong>éœ€ AGP 7.4+&lt;/strong> æ”¯æŒ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># libs.versions.toml&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#a6e22e">versions&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">androidxCore&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;1.12.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#a6e22e">libraries&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">android-core&lt;/span> = {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">group&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidx.core&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">name&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;core-ktx&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">version&lt;/span>.&lt;span style="color:#a6e22e">ref&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;androidxCore&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-groovy" data-lang="groovy">&lt;span style="display:flex;">&lt;span>dependencies &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> implementation&lt;span style="color:#f92672">(&lt;/span>libs&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">android&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">core&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#75715e">// é€šè¿‡åˆ«åå¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Androidæ‰“åŒ…apkæµç¨‹</title><link>https://www.dust-zed.site/android-develop/android%E6%89%93%E5%8C%85apk%E6%B5%81%E7%A8%8B/</link><pubDate>Sat, 28 Jun 2025 12:15:42 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/android%E6%89%93%E5%8C%85apk%E6%B5%81%E7%A8%8B/</guid><description>&lt;p>androidåº”ç”¨çš„æ‰“åŒ…æµç¨‹æ˜¯å°†ä»£ç ã€èµ„æºæ–‡ä»¶ã€æ¸…å•æ–‡ä»¶ç­‰ç¼–è¯‘å’Œå‹ç¼©æˆå¯åœ¨è®¾å¤‡ä¸Šå®‰è£…çš„APK/AABæ–‡ä»¶çš„è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤ï¼š&lt;/p>
&lt;h4 id="ä¸€ä¸»è¦æµç¨‹">ä¸€ã€ä¸»è¦æµç¨‹
&lt;/h4>&lt;h5 id="1-ç¼–å†™ä»£ç ä¸èµ„æºç®¡ç†">1. ç¼–å†™ä»£ç ä¸èµ„æºç®¡ç†
&lt;/h5>&lt;ul>
&lt;li>åˆ›å»º&lt;code>/src&lt;/code>ç›®å½•å­˜æ”¾Kotlin/Javaæºç &lt;/li>
&lt;li>åœ¨&lt;code>/res&lt;/code>ç›®å½•æ·»åŠ èµ„æº&lt;/li>
&lt;li>é…ç½®&lt;code>AndroidManifest.xml&lt;/code>(å£°æ˜ç»„ä»¶ã€æƒé™ç­‰)ã€‚&lt;/li>
&lt;/ul>
&lt;h5 id="2-ä¾èµ–ç®¡ç†">2. ä¾èµ–ç®¡ç†
&lt;/h5>&lt;ul>
&lt;li>åœ¨build.gradleä¸­æ·»åŠ æ‰€éœ€ä¾èµ–åº“&lt;/li>
&lt;/ul>
&lt;h5 id="3-ç¼–è¯‘è¿‡ç¨‹">3. ç¼–è¯‘è¿‡ç¨‹
&lt;/h5>&lt;ul>
&lt;li>ç¼–è¯‘ä»£ç ï¼š kotlinæºç  â†’ &lt;code>.class&lt;/code>å­—èŠ‚ç ï¼ˆjavac/kotlincï¼‰&lt;/li>
&lt;li>è½¬æ¢ä¸ºDexï¼š&lt;code>.class&lt;/code>æ–‡ä»¶â†’ &lt;code>.dex&lt;/code>æ–‡ä»¶ï¼ˆ&lt;code>d8&lt;/code>/&lt;code>dx&lt;/code>å·¥å…·ï¼‰ï¼Œç”¨äºAndroidçš„ARTè™šæ‹Ÿæœº&lt;/li>
&lt;li>ç¼–è¯‘èµ„æºï¼š&lt;code>AAPT2&lt;/code>ç¼–è¯‘èµ„æºæ–‡ä»¶ï¼ˆ&lt;code>res/&lt;/code> â†’ äºŒè¿›åˆ¶æ ¼å¼ï¼‰ï¼Œç”Ÿæˆ&lt;code>R.java&lt;/code>å’Œä¸´æ—¶èµ„æºåŒ…(&lt;code>.flat&lt;/code>)&lt;/li>
&lt;/ul>
&lt;h5 id="4æ‰“åŒ…ä¸ç­¾å">4.æ‰“åŒ…ä¸ç­¾å
&lt;/h5>&lt;ul>
&lt;li>åˆå¹¶èµ„æºï¼š AAPT2é“¾æ¥ç¼–è¯‘åçš„èµ„æºï¼Œç”Ÿæˆ&lt;code>resources.arsc&lt;/code>ï¼ˆèµ„æºç´¢å¼•è¡¨ï¼‰å’Œä¼˜åŒ–åçš„&lt;code>res/&lt;/code>ç›®å½•&lt;/li>
&lt;li>æ‰“åŒ…æˆAPKï¼šAPK Builderå°†ä»¥ä¸‹æ–‡ä»¶åˆå¹¶ä¸ºæœªç­¾åçš„APKï¼š
&lt;ul>
&lt;li>ç¼–è¯‘åçš„å­—èŠ‚ç (&lt;code>.dex&lt;/code>)&lt;/li>
&lt;li>èµ„æºæ–‡ä»¶(&lt;code>res/&lt;/code> + &lt;code>resources.arsc&lt;/code>)&lt;/li>
&lt;li>&lt;code>AndroidManifest.xml&lt;/code>&lt;/li>
&lt;li>åŸç”Ÿåº“(&lt;code>.so&lt;/code>ï¼Œè‹¥æœ‰JNI)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç­¾åAPKï¼šä½¿ç”¨ç­¾åè¯ä¹¦(keystore)è¿›è¡ŒV1/V2/V3ç­¾å(é€šè¿‡&lt;code>apksigner&lt;/code> æˆ–Gradleé…ç½®)&lt;/li>
&lt;/ul>
&lt;h5 id="5ä¼˜åŒ–ä¸å¯¹é½">5.ä¼˜åŒ–ä¸å¯¹é½
&lt;/h5>&lt;ul>
&lt;li>ZIPå¯¹é½ï¼š&lt;code>zipalign&lt;/code>ä¼˜åŒ–APKæ–‡ä»¶ç»“æ„(4å­—èŠ‚å¯¹é½)ï¼Œå‡å°‘è¿è¡Œæ—¶å†…å­˜å ç”¨&lt;/li>
&lt;li>ç”Ÿæˆæœ€ç»ˆçš„APKï¼šè¾“å‡º&lt;code>app-release.apk&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="äºŒåè¯è§£é‡Š">äºŒã€åè¯è§£é‡Š
&lt;/h4>&lt;h5 id="1-ä¸´æ—¶èµ„æºåŒ…">1. ä¸´æ—¶èµ„æºåŒ…
&lt;/h5>&lt;p>åœ¨AAPT2ï¼ˆ&lt;code>Android Asset Packaging Tool 2&lt;/code>ï¼‰çš„èµ„æºé¢„ç¼–è¯‘é˜¶æ®µä¼šç”Ÿæˆ&lt;code>.flat&lt;/code>æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æ˜¯ä¸­é—´äº§ç‰©&lt;/p>
&lt;ul>
&lt;li>ç‹¬ç«‹ç¼–è¯‘ï¼šAAPT2å°†&lt;code>/res&lt;/code>ç›®å½•ä¸‹çš„æ¯ä¸ªèµ„æºæ–‡ä»¶å•ç‹¬ç¼–è¯‘æˆäºŒè¿›åˆ¶æ ¼å¼çš„&lt;code>.flat&lt;/code>æ–‡ä»¶&lt;/li>
&lt;li>æ”¯æŒå¢é‡ç¼–è¯‘ï¼šè‹¥åªä¿®æ”¹äº†å•ä¸ªèµ„æºæ–‡ä»¶ï¼Œåªéœ€é‡æ–°ç¼–è¯‘è¯¥æ–‡ä»¶çš„.flatæ–‡ä»¶ï¼Œé¿å…å…¨é‡ç¼–è¯‘ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦&lt;/li>
&lt;li>åˆ†é˜¶æ®µå¤„ç†
&lt;ul>
&lt;li>ç¼–è¯‘é˜¶æ®µï¼šèµ„æºâ†’ &lt;code>.flat&lt;/code>æ–‡ä»¶&lt;/li>
&lt;li>é“¾æ¥é˜¶æ®µï¼šåˆå¹¶æ‰€æœ‰&lt;code>.flat&lt;/code>æ–‡ä»¶ â†’ ç”Ÿæˆ&lt;code>resources.arsc&lt;/code>å’Œæœ€ç»ˆçš„&lt;code>res/&lt;/code>ç›®å½•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¼˜åŠ¿
&lt;ul>
&lt;li>æå‡å¤§å‹é¡¹ç›®çš„ç¼–è¯‘é€Ÿåº¦&lt;/li>
&lt;li>æ”¯æŒèµ„æºæ··æ·†&lt;/li>
&lt;li>æ›´ä¸¥æ ¼çš„èµ„æºéªŒè¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="2-å¯¹é½">2. å¯¹é½
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>å†…å­˜å¯¹é½&lt;/strong>ï¼šè§£å†³CPUè®¿é—®æ•ˆç‡é—®é¢˜ï¼ˆ&lt;code>æ•°æ®é¡¹é¦–åœ°å€ % n == 0&lt;/code>ï¼‰ï¼Œä½†ä¼šå¢åŠ æ•°æ®ç»“æ„å¤§å°&lt;/li>
&lt;li>&lt;strong>æ–‡ä»¶å¯¹é½(zipalign)&lt;/strong>:è§£å†³å†…å­˜æ˜ å°„æ•ˆç‡çš„é—®é¢˜ï¼ˆ&lt;code>æ–‡ä»¶åç§» % 4096 == 0&lt;/code>ï¼‰ï¼Œé€šè¿‡æ¶ˆé™¤è·¨é¡µç¢ç‰‡å‡å°‘è¿è¡Œæ—¶å†…å­˜å ç”¨&lt;/li>
&lt;li>&lt;strong>å†…å­˜é¡µæœºåˆ¶&lt;/strong>
&lt;ul>
&lt;li>ç³»ç»Ÿå†…å­˜ç®¡ç†ä»¥**é¡µ(é€šå¸¸4KB)**ä¸ºå•ä½&lt;/li>
&lt;li>å¯¹é½åï¼Œæ¯æ¬¡æ–‡ä»¶è¯»å– = æ•´æ•°å€å†…å­˜é¡µ â†’ &lt;strong>å‡å°‘I/Oæ¬¡æ•°&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>Choreographerç±»è§£æ</title><link>https://www.dust-zed.site/android-develop/choreographer%E7%B1%BB%E8%A7%A3%E6%9E%90/</link><pubDate>Mon, 16 Jun 2025 06:49:21 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/choreographer%E7%B1%BB%E8%A7%A3%E6%9E%90/</guid><description>&lt;h4 id="ä¸€æ ¸å¿ƒä½œç”¨">ä¸€ã€æ ¸å¿ƒä½œç”¨
&lt;/h4>&lt;p>Choreographeræ˜¯Androidç³»ç»Ÿ&lt;strong>åè°ƒåŠ¨ç”»ã€è¾“å…¥å’Œç»˜åˆ¶æ“ä½œçš„æ ¸å¿ƒè°ƒåº¦å™¨&lt;/strong>ã€‚å®ƒé€šè¿‡VSYNCä¿¡å·ç¡®ä¿å¸§çš„æ¸²æŸ“ä¸å±å¹•åˆ·æ–°ç‡åŒæ­¥ï¼Œé¿å…ç”»é¢æ’•è£‚å’Œå¡é¡¿ã€‚&lt;/p>
&lt;h4 id="äºŒå…³é”®æ¦‚å¿µ">äºŒã€å…³é”®æ¦‚å¿µ
&lt;/h4>&lt;ul>
&lt;li>VSYNCï¼šå‚ç›´åŒæ­¥ä¿¡å·ï¼Œè¡¨ç¤ºå±å¹•å¼€å§‹åˆ·æ–°æ–°çš„ä¸€å¸§&lt;/li>
&lt;li>Frame Callbacksï¼šæ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼Œåœ¨ä¸‹ä¸€å¸§çš„ç‰¹å®šé˜¶æ®µæ‰§è¡Œ&lt;/li>
&lt;li>Callback Typesï¼ˆæŒ‰æ‰§è¡Œé¡ºåºæ’åºï¼‰
&lt;ul>
&lt;li>CALLBACK_INPUT&lt;/li>
&lt;li>CALLBACK_ANIMATION&lt;/li>
&lt;li>CALLBACK_INSETS_ANIMATION&lt;/li>
&lt;li>CALLBACK_TRAVERSAL&lt;/li>
&lt;li>CALLBACK_COMMIT&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Choreographer&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// äº”ç§å›è°ƒç±»å‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> CALLBACK_INPUT &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> CALLBACK_ANIMATION &lt;span style="color:#f92672">=&lt;/span> 1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> CALLBACK_INSETS_ANIMATION &lt;span style="color:#f92672">=&lt;/span> 2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> CALLBACK_TRAVERSAL &lt;span style="color:#f92672">=&lt;/span> 3;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> CALLBACK_COMMIT &lt;span style="color:#f92672">=&lt;/span> 4;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> CALLBACK_LAST &lt;span style="color:#f92672">=&lt;/span> CALLBACK_COMMIT; &lt;span style="color:#75715e">// æœ€åä¸€ç§ç±»å‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å•ä¾‹æ¨¡å¼å®ç°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> ThreadLocal&lt;span style="color:#f92672">&amp;lt;&lt;/span>Choreographer&lt;span style="color:#f92672">&amp;gt;&lt;/span> sThreadInstance &lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">new&lt;/span> ThreadLocal&lt;span style="color:#f92672">&amp;lt;&lt;/span>Choreographer&lt;span style="color:#f92672">&amp;gt;&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span> Choreographer &lt;span style="color:#a6e22e">initialValue&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Looper looper &lt;span style="color:#f92672">=&lt;/span> Looper.&lt;span style="color:#a6e22e">myLooper&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Choreographer(looper, VSYNC_SOURCE_APP);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å›è°ƒé˜Ÿåˆ—æ•°ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> CallbackQueue&lt;span style="color:#f92672">[]&lt;/span> mCallbackQueues;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// VSYNC æ¥æ”¶å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> FrameDisplayEventReceiver mDisplayEventReceiver;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ¶ˆæ¯çš„Handler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> FrameHandler mHandler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä¸‰æ ¸å¿ƒæ¶æ„å›¾è§£">ä¸‰ã€æ ¸å¿ƒæ¶æ„å›¾è§£
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-tex" data-lang="tex">&lt;span style="display:flex;">&lt;span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”‚ VSYNC ä¿¡å·æº â”‚â”€â”€â”€â”€â”€â”€&amp;gt;â”‚ FrameDisplayEventReceiver â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ (æ¥æ”¶ç¡¬ä»¶VSYNCä¿¡å·) â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â–¼
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”‚ FrameHandler â”‚&amp;lt;â”€â”€â”€â”€â”€â”€â”‚ onVsync() â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”‚ (å¤„ç†3ç±»æ¶ˆæ¯) â”‚â”€â”€â”€â”€â”€â”€&amp;gt;â”‚ scheduleVsync() â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â–¼
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”‚ doFrame() â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”‚ (å¸§å¤„ç†æ ¸å¿ƒæ–¹æ³•) â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â–¼
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”‚ CallbackQueue[] â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”‚ (5ç§ç±»å‹å›è°ƒé“¾è¡¨) â”‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä¸‰å›è°ƒæ·»åŠ å…¥å£">ä¸‰ã€å›è°ƒæ·»åŠ å…¥å£
&lt;/h4>&lt;h5 id="1-æ·»åŠ å›è°ƒå…¥å£">1. æ·»åŠ å›è°ƒå…¥å£
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">postCallback&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> callbackType, Runnable action, Object token) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> postCallbackDelayed(callbackType, action, token, 0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">postCallbackDelayed&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> callbackType, Runnable action, &lt;span style="color:#66d9ef">long&lt;/span> delayMillis) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> postCallbackDelayedInternal(callbackType, action, token, delayMillis);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-å†…éƒ¨æ·»åŠ å®ç°">2. å†…éƒ¨æ·»åŠ å®ç°
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">postCallbackDelayedInternal&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> callbackType,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object action, Object token, &lt;span style="color:#66d9ef">long&lt;/span> delayMillis) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">synchronized&lt;/span> (mLock) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> now &lt;span style="color:#f92672">=&lt;/span> SystemClock.&lt;span style="color:#a6e22e">uptimeMillis&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> dueTime &lt;span style="color:#f92672">=&lt;/span> now &lt;span style="color:#f92672">+&lt;/span> delayMillis;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. æ·»åŠ åˆ°å¯¹åº”çš„å›è°ƒé˜Ÿåˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mCallbackQueues&lt;span style="color:#f92672">[&lt;/span>callbackType&lt;span style="color:#f92672">]&lt;/span>.&lt;span style="color:#a6e22e">addCallbackLocked&lt;/span>(dueTime, action, token);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. è°ƒåº¦å¸§å¤„ç†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (dueTime &lt;span style="color:#f92672">&amp;lt;=&lt;/span> now) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç«‹å³è°ƒåº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scheduleFrameLocked(now);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å»¶è¿Ÿè°ƒåº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Message msg &lt;span style="color:#f92672">=&lt;/span> mHandler.&lt;span style="color:#a6e22e">obtainMessage&lt;/span>(MSG_DO_SCHEDULE_CALLBACK, action);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> msg.&lt;span style="color:#a6e22e">arg1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> callbackType;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> msg.&lt;span style="color:#a6e22e">setAsynchronous&lt;/span>(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mHandler.&lt;span style="color:#a6e22e">sendMessageAtTime&lt;/span>(msg, dueTime);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-å›è°ƒé“¾è¡¨ç»“æ„">3. å›è°ƒé“¾è¡¨ç»“æ„
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">CallbackQueue&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> CallbackRecord mHead;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">addCallbackLocked&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> dueTime, Object action, Object token) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CallbackRecord callback &lt;span style="color:#f92672">=&lt;/span> obtainCallbackLocked(dueTime, action, token);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (mHead &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mHead &lt;span style="color:#f92672">=&lt;/span> callback;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é“¾è¡¨æŒ‰ç…§æ‰§è¡Œæ—¶é—´æ’åºï¼ˆå°åˆ°å¤§ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (dueTime &lt;span style="color:#f92672">&amp;lt;&lt;/span> mHead.&lt;span style="color:#a6e22e">dueTime&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> callback.&lt;span style="color:#a6e22e">next&lt;/span> &lt;span style="color:#f92672">=&lt;/span> mHead;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mHead &lt;span style="color:#f92672">=&lt;/span> callback;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CallbackRecord entry &lt;span style="color:#f92672">=&lt;/span> mHead;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (entry.&lt;span style="color:#a6e22e">next&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (dueTime &lt;span style="color:#f92672">&amp;lt;&lt;/span> entry.&lt;span style="color:#a6e22e">next&lt;/span>.&lt;span style="color:#a6e22e">dueTime&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> callback.&lt;span style="color:#a6e22e">next&lt;/span> &lt;span style="color:#f92672">=&lt;/span> entry.&lt;span style="color:#a6e22e">next&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> entry.&lt;span style="color:#a6e22e">next&lt;/span> &lt;span style="color:#f92672">=&lt;/span> callback;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> entry &lt;span style="color:#f92672">=&lt;/span> entry.&lt;span style="color:#a6e22e">next&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> entry.&lt;span style="color:#a6e22e">next&lt;/span> &lt;span style="color:#f92672">=&lt;/span> callback;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é“¾è¡¨èŠ‚ç‚¹å®šä¹‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">CallbackRecord&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> CallbackRecord next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> dueTime;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Object action; &lt;span style="color:#75715e">// Runnable æˆ– FrameCallback&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Object token;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å››vsyncåŒæ­¥æœºåˆ¶">å››ã€VSYNCåŒæ­¥æœºåˆ¶
&lt;/h4>&lt;h5 id="1-vsyncè¯·æ±‚">1ã€ VSYNCè¯·æ±‚
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">scheduleFrameLocked&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> now) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>mFrameScheduled) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mFrameScheduled &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (USE_VSYNC) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šè¿‡ FrameDisplayEventReceiver è¯·æ±‚ VSYNC&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (isRunningOnLooperThreadLocked()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//æ³¨å†Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scheduleVsyncLocked();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éUIçº¿ç¨‹å‘é€æ¶ˆæ¯åˆ°UIçº¿ç¨‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Message msg &lt;span style="color:#f92672">=&lt;/span> mHandler.&lt;span style="color:#a6e22e">obtainMessage&lt;/span>(MSG_DO_SCHEDULE_VSYNC);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> msg.&lt;span style="color:#a6e22e">setAsynchronous&lt;/span>(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mHandler.&lt;span style="color:#a6e22e">sendMessageAtFrontOfQueue&lt;/span>(msg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ— VSYNCç›´æ¥å®‰æ’å¸§&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> nextFrameTime &lt;span style="color:#f92672">=&lt;/span> ...;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Message msg &lt;span style="color:#f92672">=&lt;/span> mHandler.&lt;span style="color:#a6e22e">obtainMessage&lt;/span>(MSG_DO_FRAME);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> msg.&lt;span style="color:#a6e22e">setAsynchronous&lt;/span>(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mHandler.&lt;span style="color:#a6e22e">sendMessageAtTime&lt;/span>(msg, nextFrameTime);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">scheduleVsyncLocked&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mDisplayEventReceiver.&lt;span style="color:#a6e22e">scheduleVsync&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-vsyncæ¥æ”¶ä¸å¤„ç†">2. VSYNCæ¥æ”¶ä¸å¤„ç†
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">FrameDisplayEventReceiver&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> DisplayEventReceiver {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">onVsync&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> timestampNanos, &lt;span style="color:#66d9ef">long&lt;/span> physicalDisplayId, &lt;span style="color:#66d9ef">int&lt;/span> frame) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. è®¡ç®—æ­£ç¡®çš„å¸§æ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> now &lt;span style="color:#f92672">=&lt;/span> System.&lt;span style="color:#a6e22e">nanoTime&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> intendedFrameTimeNanos &lt;span style="color:#f92672">=&lt;/span> ...;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. å‘é€MSG_DO_FRAMEæ¶ˆæ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Message msg &lt;span style="color:#f92672">=&lt;/span> Message.&lt;span style="color:#a6e22e">obtain&lt;/span>(mHandler, MSG_DO_FRAME);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> msg.&lt;span style="color:#a6e22e">setAsynchronous&lt;/span>(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mHandler.&lt;span style="color:#a6e22e">sendMessageAtTime&lt;/span>(msg, intendedFrameTimeNanos &lt;span style="color:#f92672">/&lt;/span> NANOS_PER_MS);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-å¸§å¤„ç†æ ¸å¿ƒ---doframe">3. å¸§å¤„ç†æ ¸å¿ƒ - doFrame()
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doFrame&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> frameTimeNanos, &lt;span style="color:#66d9ef">int&lt;/span> frame) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> startNanos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">synchronized&lt;/span> (mLock) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ£€æŸ¥å¸§è°ƒåº¦çŠ¶æ€&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>mFrameScheduled) &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¡ç®—è·³å¸§æƒ…å†µ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> jitterNanos &lt;span style="color:#f92672">=&lt;/span> startNanos &lt;span style="color:#f92672">-&lt;/span> frameTimeNanos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (jitterNanos &lt;span style="color:#f92672">&amp;gt;=&lt;/span> mFrameIntervalNanos) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> skippedFrames &lt;span style="color:#f92672">=&lt;/span> jitterNanos &lt;span style="color:#f92672">/&lt;/span> mFrameIntervalNanos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¶…è¿‡é˜ˆå€¼æ‰“å°è­¦å‘Šæ—¥å¿—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (skippedFrames &lt;span style="color:#f92672">&amp;gt;=&lt;/span> SKIPPED_FRAME_WARNING_LIMIT) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Log.&lt;span style="color:#a6e22e">i&lt;/span>(TAG, &lt;span style="color:#e6db74">&amp;#34;Skipped &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> skippedFrames &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34; frames!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> frameTimeNanos &lt;span style="color:#f92672">=&lt;/span> ...; &lt;span style="color:#75715e">// è°ƒæ•´å¸§æ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mLastFrameTimeNanos &lt;span style="color:#f92672">=&lt;/span> frameTimeNanos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mFrameScheduled &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŒ‰ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œå›è°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mFrameInfo.&lt;span style="color:#a6e22e">markInputHandlingStart&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> doCallbacks(Choreographer.&lt;span style="color:#a6e22e">CALLBACK_INPUT&lt;/span>, frameTimeNanos);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mFrameInfo.&lt;span style="color:#a6e22e">markAnimationsStart&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> doCallbacks(Choreographer.&lt;span style="color:#a6e22e">CALLBACK_ANIMATION&lt;/span>, frameTimeNanos);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mFrameInfo.&lt;span style="color:#a6e22e">markPerformTraversalsStart&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> doCallbacks(Choreographer.&lt;span style="color:#a6e22e">CALLBACK_TRAVERSAL&lt;/span>, frameTimeNanos);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> doCallbacks(Choreographer.&lt;span style="color:#a6e22e">CALLBACK_COMMIT&lt;/span>, frameTimeNanos);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¸…ç†å·¥ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="äº”å›è°ƒæ‰§è¡Œå¤„ç†">äº”ã€å›è°ƒæ‰§è¡Œå¤„ç†
&lt;/h4>&lt;h5 id="1-æ‰§è¡Œå›è°ƒæ ¸å¿ƒé€»è¾‘">1. æ‰§è¡Œå›è°ƒæ ¸å¿ƒé€»è¾‘
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doCallbacks&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> callbackType, &lt;span style="color:#66d9ef">long&lt;/span> frameTimeNanos) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CallbackRecord callbacks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">synchronized&lt;/span> (mLock) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æå–æ‰€æœ‰åˆ°æœŸçš„å›è°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">final&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> now &lt;span style="color:#f92672">=&lt;/span> frameTimeNanos &lt;span style="color:#f92672">/&lt;/span> NANOS_PER_MS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> callbacks &lt;span style="color:#f92672">=&lt;/span> mCallbackQueues&lt;span style="color:#f92672">[&lt;/span>callbackType&lt;span style="color:#f92672">]&lt;/span>.&lt;span style="color:#a6e22e">extractDueCallbacksLocked&lt;/span>(now);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (callbacks &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mCallbacksRunning &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œé“¾è¡¨ä¸­çš„æ‰€æœ‰å›è°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (CallbackRecord c &lt;span style="color:#f92672">=&lt;/span> callbacks; c &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>; c &lt;span style="color:#f92672">=&lt;/span> c.&lt;span style="color:#a6e22e">next&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œå›è°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (c.&lt;span style="color:#a6e22e">action&lt;/span> &lt;span style="color:#66d9ef">instanceof&lt;/span> Runnable) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ((Runnable) c.&lt;span style="color:#a6e22e">action&lt;/span>).&lt;span style="color:#a6e22e">run&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ((FrameCallback) c.&lt;span style="color:#a6e22e">action&lt;/span>).&lt;span style="color:#a6e22e">doFrame&lt;/span>(frameTimeNanos);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">synchronized&lt;/span> (mLock) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å›æ”¶CallbackRecordå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> recycleCallbackRecordsLocked(callbacks);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mCallbacksRunning &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2åˆ°æœŸå›è°ƒæå–ç®—æ³•">2.åˆ°æœŸå›è°ƒæå–ç®—æ³•
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>CallbackRecord &lt;span style="color:#a6e22e">extractDueCallbacksLocked&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> now) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CallbackRecord callbacks &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CallbackRecord next &lt;span style="color:#f92672">=&lt;/span> mHead;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éå†é“¾è¡¨ï¼Œæ‰¾å‡ºæ‰€æœ‰dueTime&amp;lt;=nowçš„èŠ‚ç‚¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (next &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> next.&lt;span style="color:#a6e22e">dueTime&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> now) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CallbackRecord temp &lt;span style="color:#f92672">=&lt;/span> next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> next &lt;span style="color:#f92672">=&lt;/span> next.&lt;span style="color:#a6e22e">next&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> temp.&lt;span style="color:#a6e22e">next&lt;/span> &lt;span style="color:#f92672">=&lt;/span> callbacks; &lt;span style="color:#75715e">// æ–°èŠ‚ç‚¹æ’å…¥é“¾è¡¨å¤´éƒ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> callbacks &lt;span style="color:#f92672">=&lt;/span> temp; &lt;span style="color:#75715e">// æ–°é“¾è¡¨å¤´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ›´æ–°åŸé“¾è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mHead &lt;span style="color:#f92672">=&lt;/span> next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿”å›çš„æ˜¯å€’åºé“¾è¡¨ï¼ˆæœ€è¿‘åŠ å…¥çš„å…ˆæ‰§è¡Œï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> callbacks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å®Œæ•´æµç¨‹">å®Œæ•´æµç¨‹
&lt;/h5>&lt;pre tabindex="0">&lt;code>[1] postCallback()
â†“
[2] scheduleFrameLocked()
â†“
[3] scheduleVsyncLocked()
â†“
[4] mDisplayEventReceiver.scheduleVsync() (è¯·æ±‚ Vsync)
â†“
... ç­‰å¾…ç¡¬ä»¶ Vsync ä¿¡å· ...
â†“
[5] onVsync() (native çº¿ç¨‹å›è°ƒ)
â†“
[6] Message msg = obtainMessage(MSG_DO_FRAME)
â†“
[7] mHandler.sendMessageAtTime(msg, ...) (å‘é€åˆ°ä¸»çº¿ç¨‹)
â†“
[8] FrameHandler.handleMessage() (ä¸»çº¿ç¨‹)
â†“
[9] doFrame() (ä¸»çº¿ç¨‹æ‰§è¡Œ)
â†“
[10] doCallbacks() (æ‰§è¡Œæ‰€æœ‰ Callback)
&lt;/code>&lt;/pre>&lt;hr>
&lt;h4 id="å…­choreographerçš„å…¶ä»–ä½œç”¨">å…­ã€Choreographerçš„å…¶ä»–ä½œç”¨
&lt;/h4>&lt;h5 id="1-å¸§ç‡ç›‘æ§">1. å¸§ç‡ç›‘æ§
&lt;/h5>&lt;p>å¼€å‘è€…å¯ä»¥é€šè¿‡postFrameCallbackå®ç°å¸§ç‡ç›‘æ§ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">startMonitoring&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Choreographer.&lt;span style="color:#a6e22e">getInstance&lt;/span>().&lt;span style="color:#a6e22e">postFrameCallback&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> FrameCallback() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> lastFrameTime &lt;span style="color:#f92672">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doFrame&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> frameTimeNanos) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (lastFrameTime &lt;span style="color:#f92672">!=&lt;/span> 0) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> frameInterval &lt;span style="color:#f92672">=&lt;/span> (frameTimeNanos &lt;span style="color:#f92672">-&lt;/span> lastFrameTime) &lt;span style="color:#f92672">/&lt;/span> 1000000;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (frameInterval &lt;span style="color:#f92672">&amp;gt;&lt;/span> 16) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®°å½•æ‰å¸§æƒ…å†µ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lastFrameTime &lt;span style="color:#f92672">=&lt;/span> frameTimeNanos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Choreographer.&lt;span style="color:#a6e22e">getInstance&lt;/span>().&lt;span style="color:#a6e22e">postFrameCallback&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä¸ƒæ€»ç»“">ä¸ƒã€æ€»ç»“
&lt;/h4>&lt;p>Choreographer æ˜¯ Android æ¸²æŸ“ç³»ç»Ÿçš„æ ¸å¿ƒåè°ƒå™¨ï¼Œå…¶å·¥ä½œåŸç†å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>ä»»åŠ¡ç®¡ç†&lt;/strong>ï¼šé€šè¿‡ 5 ä¸ªé“¾è¡¨é˜Ÿåˆ—ç®¡ç†ä¸åŒä¼˜å…ˆçº§çš„å›è°ƒä»»åŠ¡&lt;/p>
&lt;ul>
&lt;li>è¾“å…¥ &amp;gt; åŠ¨ç”» &amp;gt; æ’å…¥åŠ¨ç”» &amp;gt; è§†å›¾éå† &amp;gt; æäº¤&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>VSYNC åŒæ­¥&lt;/strong>ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>scheduleVsync() â†’ DisplayEventReceiver â†’ onVsync() â†’ doFrame()
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¸§ç”Ÿå‘½å‘¨æœŸ&lt;/strong>ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>doFrame() â†’
doCallbacks(INPUT) â†’
doCallbacks(ANIMATION) â†’
doCallbacks(TRAVERSAL) â†’
doCallbacks(COMMIT)
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ€§èƒ½ç›‘æ§&lt;/strong>ï¼šå†…ç½®è·³å¸§æ£€æµ‹å’Œè­¦å‘Šæœºåˆ¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç³»ç»Ÿåè°ƒ&lt;/strong>ï¼šä½œä¸ºåŠ¨ç”»ç³»ç»Ÿã€UI ç³»ç»Ÿã€è¾“å…¥ç³»ç»Ÿçš„åŒæ­¥ä¸­æ¢&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>æ•´ä¸ªè®¾è®¡ä½“ç°äº† Android ç³»ç»Ÿå¯¹ä»¥ä¸‹å…³é”®ç›®æ ‡çš„å¹³è¡¡ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç²¾ç¡®æ€§&lt;/strong>ï¼šé€šè¿‡ VSYNC ç²¾å‡†åŒæ­¥&lt;/li>
&lt;li>&lt;strong>é«˜æ•ˆæ€§&lt;/strong>ï¼šé“¾è¡¨ç»“æ„å’Œå¯¹è±¡å¤ç”¨&lt;/li>
&lt;li>&lt;strong>ä¼˜å…ˆçº§&lt;/strong>ï¼šä¸¥æ ¼çš„åˆ†çº§å›è°ƒé¡ºåº&lt;/li>
&lt;li>&lt;strong>æ‰©å±•æ€§&lt;/strong>ï¼šæ”¯æŒå¤šç§å›è°ƒç±»å‹&lt;/li>
&lt;li>&lt;strong>ç›‘æ§èƒ½åŠ›&lt;/strong>ï¼šå†…ç½®æ€§èƒ½æ£€æµ‹æœºåˆ¶&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>&lt;code>scheduleVsync()&lt;/code> çš„å”¯ä¸€ç›®çš„å°±æ˜¯åœ¨ VSYNC åˆ°æ¥æ—¶è§¦å‘ &lt;code>doFrame()&lt;/code>&lt;/strong>ï¼Œè€Œæ•´ä¸ª Choreographer çš„æ ¸å¿ƒä»»åŠ¡å°±æ˜¯ç¡®ä¿æ‰€æœ‰å¸§å¤„ç†æ“ä½œå®Œç¾å¯¹é½ VSYNC æ—¶é—´åºåˆ—ã€‚&lt;/p></description></item><item><title>åŒ…ä½“ç§¯ä¼˜åŒ–</title><link>https://www.dust-zed.site/android-develop/%E5%8C%85%E4%BD%93%E7%A7%AF%E4%BC%98%E5%8C%96/</link><pubDate>Sun, 15 Jun 2025 23:19:59 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/%E5%8C%85%E4%BD%93%E7%A7%AF%E4%BC%98%E5%8C%96/</guid><description>&lt;h4 id="åŒ…ä½“ç§¯ä¼˜åŒ–">åŒ…ä½“ç§¯ä¼˜åŒ–
&lt;/h4>&lt;h4 id="ä¸€apkç»“æ„åˆ†æå·¥å…·">ä¸€ã€APKç»“æ„åˆ†æå·¥å…·
&lt;/h4>&lt;ol>
&lt;li>Android Studioå†…ç½®å·¥å…·
&lt;ul>
&lt;li>ä½¿ç”¨ Build &amp;gt; Analyze APK&lt;/li>
&lt;li>æŸ¥çœ‹å„æ¨¡å—å æ¯”(ä»£ç /èµ„æº/åŸç”Ÿåº“/Assets)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å‘½ä»¤è¡Œå·¥å…·&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>./gradlew :app:assembleRelease --scan
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="äºŒä»£ç ä¼˜åŒ–">äºŒã€ä»£ç ä¼˜åŒ–
&lt;/h4>&lt;ol>
&lt;li>å¯ç”¨ä»£ç æ··æ·†ä¸ä¼˜åŒ–&lt;/li>
&lt;li>ç§»é™¤æœªä½¿ç”¨ä»£ç 
&lt;ul>
&lt;li>ä½¿ç”¨android studioçš„lintåˆ†ææœªä½¿ç”¨ä»£ç &lt;/li>
&lt;li>æ·»åŠ R8é…ç½®æ–‡ä»¶åˆ é™¤æ— å¼•ç”¨ä»£ç &lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ–¹æ³•æ•°ä¼˜åŒ–
&lt;ul>
&lt;li>å¯ç”¨Multidexå‰ä¼˜åŒ–&lt;/li>
&lt;li>ä½¿ç”¨D8ç¼–è¯‘å™¨çš„dexä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="ä¸‰èµ„æºä¼˜åŒ–">ä¸‰ã€èµ„æºä¼˜åŒ–
&lt;/h4>&lt;ol>
&lt;li>èµ„æºå‹ç¼©ä¸æ¸…ç†&lt;/li>
&lt;li>ç§»é™¤æœªä½¿ç”¨èµ„æº&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ£€æµ‹æœªä½¿ç”¨èµ„æº&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./gradlew lintRelease
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è‡ªåŠ¨ç§»é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./gradlew removeUnusedResources
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>çŸ¢é‡å›¾ä»£æ›¿ä½å›¾&lt;/li>
&lt;li>Webpæ ¼å¼è½¬æ¢&lt;/li>
&lt;/ol>
&lt;h4 id="å››åº“ä¼˜åŒ–">å››ã€åº“ä¼˜åŒ–
&lt;/h4>&lt;ol>
&lt;li>ä»…ä¿ç•™å¿…è¦ABI&lt;/li>
&lt;li>è½»é‡åº“ä»£æ›¿&lt;/li>
&lt;/ol>
&lt;h4 id="äº”é«˜çº§ä¼˜åŒ–æŠ€æœ¯">äº”ã€é«˜çº§ä¼˜åŒ–æŠ€æœ¯
&lt;/h4>&lt;ol>
&lt;li>èµ„æºæ··æ·†&lt;/li>
&lt;li>èµ„æºåˆ†åŒ…åŠ è½½&lt;/li>
&lt;li>æŒ‰éœ€åŠ è½½åŠŸèƒ½æ¨¡å—&lt;/li>
&lt;/ol>
&lt;h4 id="å…­--assetsä¼˜åŒ–">å…­ ã€ Assetsä¼˜åŒ–
&lt;/h4>&lt;ol>
&lt;li>å‹ç¼©assetsèµ„æºï¼šå­˜å‚¨æ—¶å‹ç¼©ï¼Œä½¿ç”¨æ—¶è§£å‹&lt;/li>
&lt;/ol>
&lt;h4 id="ä¸ƒçŸ¥è¯†è¡¥å……">ä¸ƒã€çŸ¥è¯†è¡¥å……
&lt;/h4>&lt;ol>
&lt;li>D8ã€R8å’Œä»£ç æ··æ·†çš„å…³ç³»
&lt;ul>
&lt;li>D8è´Ÿè´£å­—èŠ‚ç åˆ°Dexçš„ç²¾ç¡®è½¬æ¢&lt;/li>
&lt;li>R8 = D8 + è£å‰ª + ä¼˜åŒ– + æ··æ·†&lt;/li>
&lt;li>æ··æ·†æ˜¯R8çš„æˆ˜æœ¯æ­¦å™¨ï¼šä»…è´Ÿè´£åç§°æ··æ·†ï¼ˆå¯¹ä½“ç§¯å½±å“å°ï¼Œå¯¹å®‰å…¨æ€§å…³é”®ï¼‰&lt;/li>
&lt;li>&lt;strong>å¼€å¯R8 â‰ˆ D8ç¼–è¯‘ + ä¸‰é‡ä¼˜åŒ–(è£å‰ª/ä¼˜åŒ–/æ··æ·†)&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item><item><title>å†…å­˜ç®¡ç†æœ€ä½³å®è·µ</title><link>https://www.dust-zed.site/android-develop/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</link><pubDate>Sun, 15 Jun 2025 13:05:49 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</guid><description>&lt;h4 id="ä¸€å†…å­˜ç®¡ç†åŸåˆ™">ä¸€ã€å†…å­˜ç®¡ç†åŸåˆ™
&lt;/h4>&lt;ol>
&lt;li>ç†è§£Androidå†…å­˜æ¨¡å‹
&lt;ul>
&lt;li>åŸºäºJVMåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œé‡‡ç”¨åˆ†ä»£å›æ”¶ç­–ç•¥&lt;/li>
&lt;li>å†…å­˜ä¸è¶³æ˜¯è§¦å‘&lt;code>onTrimMemory()&lt;/code>ï¼Œå¼€å‘è€…éœ€å“åº”æ­¤å›è°ƒé‡Šæ”¾èµ„æº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>é¿å…å†…å­˜æ³„æ¼æ ¹æº
&lt;ul>
&lt;li>é™æ€å¼•ç”¨ï¼šç¦æ­¢ç”¨staticæŒæœ‰Activity/Contextï¼ˆç”¨Application Contextä»£æ›¿ï¼‰&lt;/li>
&lt;li>éé™æ€å†…éƒ¨ç±»ï¼šæ”¹ç”¨é™æ€å†…éƒ¨ç±»+å¼±å¼•ç”¨&lt;/li>
&lt;li>èµ„æºæœªé‡Šæ”¾ï¼šå…³é—­Cursorã€Fileã€Bitmapç­‰èµ„æºã€‚gcåªé‡Šæ”¾javaå¯¹è±¡æœ¬èº«ï¼Œåœ¨jvmå †ä¸­ï¼Œç³»ç»Ÿèµ„æºéœ€è¦æ˜¾ç¤ºé‡Šæ”¾&lt;/li>
&lt;li>é›†åˆå¯¹è±¡ï¼šåŠæ—¶æ¸…ç†æ— ç”¨çš„é›†åˆå…ƒç´ &lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¼˜åŒ–å…³é”®ç»„ä»¶
&lt;ul>
&lt;li>Activity/Fragment
&lt;ul>
&lt;li>åœ¨onDestroyä¸­è§£é™¤BroadcastReceiverã€Handleræ³¨å†Œï¼Œç§»é™¤å›è°ƒ&lt;/li>
&lt;li>é¿å…åœ¨å¼‚æ­¥ä»»åŠ¡ä¸­ç›´æ¥å¼•ç”¨View&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Handler
&lt;ul>
&lt;li>ä½¿ç”¨é™æ€å†…éƒ¨ç±» + WeakReferenceã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å•ä¾‹æ¨¡å¼
&lt;ul>
&lt;li>ä¼ é€’Application Contextï¼Œè€ŒéActivity Context&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¤§å¯¹è±¡ä¼˜åŒ–
&lt;ul>
&lt;li>Bitmap
&lt;ul>
&lt;li>ä½¿ç”¨inSampleSizeå‹ç¼©å›¾ç‰‡ï¼Œé‡‡ç”¨Glideç­‰åº“ç®¡ç†å†…å­˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ•°æ®ç¼“å­˜
&lt;ul>
&lt;li>ä¼˜å…ˆä½¿ç”¨LruCacheå’ŒDiskLruCache&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="äºŒå†…å­˜æ³„æ¼æ’æŸ¥å·¥å…·">äºŒã€å†…å­˜æ³„æ¼æ’æŸ¥å·¥å…·
&lt;/h4>&lt;ol>
&lt;li>Android Profiler&lt;/li>
&lt;li>LeakCanary&lt;/li>
&lt;li>MAT&lt;/li>
&lt;li>StrictMode&lt;/li>
&lt;/ol>
&lt;h3 id="äºŒå†…å­˜æ³„æ¼æ’æŸ¥å·¥å…·-1">&lt;strong>äºŒã€å†…å­˜æ³„æ¼æ’æŸ¥å·¥å…·&lt;/strong>
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>Android Profilerï¼ˆAndroid Studioï¼‰&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å†…å­˜ç›‘æ§&lt;/strong>ï¼šå®æ—¶æŸ¥çœ‹å †å†…å­˜ä½¿ç”¨æƒ…å†µã€‚&lt;/li>
&lt;li>&lt;strong>Heap Dump&lt;/strong>ï¼šæ•è·å †å¿«ç…§ï¼Œåˆ†æå¯¹è±¡å¼•ç”¨é“¾ã€‚&lt;/li>
&lt;li>&lt;strong>Allocation Tracker&lt;/strong>ï¼šè·Ÿè¸ªçŸ­æ—¶é—´å†…çš„å†…å­˜åˆ†é…ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>LeakCanaryï¼ˆè‡ªåŠ¨åŒ–æ£€æµ‹ï¼‰&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é›†æˆæ­¥éª¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-groovy" data-lang="groovy">&lt;span style="display:flex;">&lt;span>debugImplementation &lt;span style="color:#e6db74">&amp;#39;com.squareup.leakcanary:leakcanary-android:2.9.1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>è‡ªåŠ¨æ£€æµ‹æ³„æ¼å¹¶ç”ŸæˆæŠ¥å‘Šï¼Œå®šä½æ³„æ¼å¼•ç”¨é“¾ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>MATï¼ˆMemory Analyzer Toolï¼‰&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åˆ†æHeap Dumpæ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç”¨Android Profilerå¯¼å‡º&lt;code>.hprof&lt;/code>æ–‡ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€šè¿‡&lt;code>hprof-conv&lt;/code>è½¬æ¢æ ¼å¼ï¼ˆAndroid SDKå·¥å…·ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>hprof-conv input.hprof output.hprof
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>åœ¨MATä¸­æ‰“å¼€ï¼Œé€šè¿‡&lt;strong>Dominator Tree&lt;/strong>å’Œ&lt;strong>Path to GC Roots&lt;/strong>åˆ†ææ³„æ¼å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>StrictMode&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ£€æµ‹ä¸»çº¿ç¨‹ç£ç›˜/ç½‘ç»œæ“ä½œï¼Œé—´æ¥é¿å…å†…å­˜é—®é¢˜ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>StrictMode.&lt;span style="color:#a6e22e">setVmPolicy&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> VmPolicy.&lt;span style="color:#a6e22e">Builder&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">detectActivityLeaks&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">detectLeakedClosableObjects&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">penaltyLog&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#a6e22e">build&lt;/span>());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item><item><title>Viewæ€§èƒ½ä¼˜åŒ–</title><link>https://www.dust-zed.site/android-develop/view%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</link><pubDate>Fri, 13 Jun 2025 23:55:35 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/view%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</guid><description>&lt;h3 id="android-view-æ€§èƒ½ä¼˜åŒ–ä½“ç³»">Android View æ€§èƒ½ä¼˜åŒ–ä½“ç³»
&lt;/h3>&lt;hr>
&lt;h3 id="ä¸€è§„é¿è¿‡åº¦ç»˜åˆ¶gpuä¼˜åŒ–">ä¸€ã€è§„é¿è¿‡åº¦ç»˜åˆ¶ï¼ˆGPUä¼˜åŒ–ï¼‰
&lt;/h3>&lt;p>ä¸“æ³¨äºå‡å°‘GPUçš„æ— æ•ˆåƒç´ å¡«å……è´Ÿè½½&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ¦‚å¿µè§£æï¼š&lt;/strong>&lt;br>
GPUåœ¨å•ä¸ªåƒç´ ç‚¹é‡å¤ç»˜åˆ¶è¶…è¿‡2.5æ¬¡ï¼ˆ1xç»˜åˆ¶+1.5xåŠé€æ˜æ··åˆï¼‰çš„ç°è±¡ï¼Œæ¶ˆè€—å¡«å……ç‡å¯¼è‡´å¸§ç‡ä¸‹é™&lt;/li>
&lt;li>&lt;strong>æ£€æµ‹å·¥å…·ï¼š&lt;/strong>&lt;br>
&lt;code>å¼€å‘è€…é€‰é¡¹-&amp;gt;è°ƒè¯•GPUè¿‡åº¦ç»˜åˆ¶&lt;/code>ï¼ˆè“è‰²&amp;lt;1x, ç»¿è‰²&amp;lt;2x, ç²‰è‰²&amp;lt;3x, çº¢è‰²â‰¥4xï¼‰&lt;/li>
&lt;li>&lt;strong>æ ¸å¿ƒç­–ç•¥ï¼š&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>ç§»é™¤æ— æ•ˆèƒŒæ™¯å±‚ï¼š&lt;/strong>
&lt;ul>
&lt;li>æ£€æŸ¥å¹¶ç§»é™¤Activityæ ¹å¸ƒå±€æˆ–ä¸»é¢˜ä¸­å†—ä½™çš„&lt;code>windowBackground&lt;/code>&lt;/li>
&lt;li>åˆ é™¤è¢«å®Œå…¨è¦†ç›–çš„ä¸­é—´å±‚å¸ƒå±€ï¼ˆå¦‚FrameLayoutï¼‰èƒŒæ™¯&lt;/li>
&lt;li>é¿å…åœ¨è‡ªå®šä¹‰Viewçš„&lt;code>onDraw()&lt;/code>ä¸­ç»˜åˆ¶è¢«è¦†ç›–åŒºåŸŸ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>å±‚çº§æ‰å¹³åŒ–ï¼š&lt;/strong>
&lt;ul>
&lt;li>ä½¿ç”¨&lt;code>ConstraintLayout&lt;/code>æ›¿ä»£å¤šå±‚åµŒå¥—å¸ƒå±€&lt;/li>
&lt;li>å‡å°‘RelativeLayoutå¯¼è‡´çš„äºŒæ¬¡æµ‹é‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é€æ˜æ•ˆæœæ§åˆ¶ï¼š&lt;/strong>
&lt;ul>
&lt;li>é¿å…å¤§é¢ç§¯åŠé€æ˜è§†å›¾ï¼ˆå¼•å‘GPUæ··åˆè®¡ç®—ï¼‰&lt;/li>
&lt;li>ç¡¬ä»¶å±‚åŠ¨ç”»ç»“æŸæ—¶ç«‹å³ç¦ç”¨ï¼ˆ&lt;code>setLayerType(LAYER_TYPE_NONE)&lt;/code>ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>å¼•ç”¨å…³é”®é€šç”¨æŠ€æœ¯ï¼š&lt;/strong>&lt;br>
ç»“åˆ&lt;code>clipRect/quickReject&lt;/code>é™å®šç»˜åˆ¶åŒºåŸŸï¼ˆè¯¦è§é€šç”¨æŠ€æœ¯ç« èŠ‚ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="äºŒç»˜åˆ¶æŒ‡ä»¤ä¼˜åŒ–cpuä¼˜åŒ–">äºŒã€ç»˜åˆ¶æŒ‡ä»¤ä¼˜åŒ–ï¼ˆCPUä¼˜åŒ–ï¼‰
&lt;/h3>&lt;p>é™ä½CPUç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤çš„å¼€é”€&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ä¼˜åŒ–ç„¦ç‚¹ï¼š&lt;/strong>&lt;br>
&lt;code>onDraw()&lt;/code>æ–¹æ³•çš„æ‰§è¡Œæ•ˆç‡ä¸èµ„æºç®¡ç†&lt;/li>
&lt;li>&lt;strong>æ ¸å¿ƒå‡†åˆ™ï¼š&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>ç¦æ­¢å†…å­˜åˆ†é…ï¼š&lt;/strong>&lt;br>
ç»ä¸åœ¨&lt;code>onDraw()&lt;/code>ä¸­åˆ›å»ºPaint/Path/Bitmapå¯¹è±¡ï¼ˆåº”åœ¨æ„é€ æ–¹æ³•åˆå§‹åŒ–ï¼‰&lt;/li>
&lt;li>&lt;strong>è§„é¿è€—æ—¶æ“ä½œï¼š&lt;/strong>&lt;br>
é¿å…å¤æ‚è®¡ç®—ã€IOæˆ–è§£æé€»è¾‘&lt;/li>
&lt;li>&lt;strong>é˜»æ–­é€’å½’è§¦å‘ï¼š&lt;/strong>&lt;br>
ç¦æ­¢åœ¨&lt;code>onDraw()&lt;/code>ä¸­è°ƒç”¨&lt;code>invalidate()&lt;/code>æˆ–&lt;code>requestLayout()&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é«˜çº§æŠ€å·§ï¼š&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>ç»˜å›¾èµ„æºå¤ç”¨ï¼š&lt;/strong>&lt;br>
å¯¹çŸ¢é‡å›¾(VectorDrawable)å’Œä½å›¾é‡‡ç”¨ä¸åŒä¼˜åŒ–ç­–ç•¥
&lt;ul>
&lt;li>å°å›¾æ ‡ä¼˜å…ˆä½¿ç”¨çŸ¢é‡å›¾&lt;/li>
&lt;li>ä½å›¾åŠ è½½å¯ç”¨&lt;code>inSampleSize&lt;/code>é‡‡æ ·å’Œ&lt;code>RGB_565&lt;/code>è§£ç &lt;/li>
&lt;li>ä½¿ç”¨&lt;code>ImageView.setImageDrawable()&lt;/code>æ›¿ä»£&lt;code>canvas.drawBitmap()&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é€æ˜æ•ˆæœå®ç°ï¼š&lt;/strong>&lt;br>
ä¼˜å…ˆä½¿ç”¨&lt;code>View.setAlpha()&lt;/code>è€ŒéåŠé€æ˜èƒŒæ™¯è‰²&lt;/li>
&lt;li>&lt;strong>å¼•ç”¨å…³é”®é€šç”¨æŠ€æœ¯ï¼š&lt;/strong>&lt;br>
ç²¾å‡†æ§åˆ¶ç¡¬ä»¶åŠ é€Ÿç”Ÿå‘½å‘¨æœŸï¼ˆè¯¦è§é€šç”¨æŠ€æœ¯ç« èŠ‚ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="ä¸‰é€šç”¨æ ¸å¿ƒæŠ€æœ¯">ä¸‰ã€é€šç”¨æ ¸å¿ƒæŠ€æœ¯
&lt;/h3>&lt;p>è·¨ä¼˜åŒ–é¢†åŸŸçš„å…±æ€§æŠ€æœ¯æ–¹æ¡ˆ&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>åŒºåŸŸè£å‰ªæŠ€æœ¯ï¼š&lt;/strong>&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">graph TB
A[canvas.clipRect] --&amp;gt; B[é™å®šå­Viewç»˜åˆ¶åŒºåŸŸ]
C[canvas.quickReject] --&amp;gt; D[è·³è¿‡å±å¹•å¤–åŒºåŸŸç»˜åˆ¶]
A--&amp;gt;|ViewGroup| E[é‡å†™dispatchDrawæ§åˆ¶]
C--&amp;gt;|è‡ªå®šä¹‰View| F[onDrawä¸­é¢„åˆ¤å¯è§æ€§]
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>åœ¨&lt;code>ViewGroup.drawChild&lt;/code>ä¸­é™å®šå­Viewç»˜åˆ¶è¾¹ç•Œ&lt;/li>
&lt;li>åˆ—è¡¨é¡¹ç­‰éé‡å è§†å›¾å¿…å¤‡ä¼˜åŒ–æ‰‹æ®µ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç¡¬ä»¶åŠ é€Ÿæ·±åº¦æŒ‡å—ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>è¿ä½œæœºåˆ¶ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å°†Viewç¼“å­˜ä¸ºGPUçº¹ç†(Texture)&lt;/li>
&lt;li>é€šè¿‡&lt;code>setLayerType(LAYER_TYPE_HARDWARE, null)&lt;/code>å¯ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æœ€ä½³å®è·µï¼š&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åŠ¨ç”»å¼€å§‹å‰å¯ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>view.&lt;span style="color:#a6e22e">setLayerType&lt;/span>(LAYER_TYPE_HARDWARE, &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ObjectAnimator.&lt;span style="color:#a6e22e">run&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åŠ¨ç”»ç»“æŸåç«‹å³é‡Šæ”¾&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>animator.&lt;span style="color:#a6e22e">addListener&lt;/span>(() &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> view.&lt;span style="color:#a6e22e">setLayerType&lt;/span>(LAYER_TYPE_NONE, &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¼€é”€é¢„è­¦ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ç¦»å±ç¼“å†²å¢åŠ 20%-30%å†…å­˜å ç”¨&lt;/li>
&lt;li>é™æ€è§†å›¾å¯ç”¨åè€Œé™ä½æ€§èƒ½&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>åœ†è§’å¤„ç†æ–¹æ¡ˆï¼š&lt;/strong>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å®ç°æ–¹å¼&lt;/th>
&lt;th>é€‚ç”¨åœºæ™¯&lt;/th>
&lt;th>æ€§èƒ½å½±å“&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>ViewOutlineProvider&lt;/td>
&lt;td>å°é¢ç§¯åœ†è§’&lt;/td>
&lt;td>â˜…â˜…â˜†&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>.9.pngè´´å›¾&lt;/td>
&lt;td>å›ºå®šå°ºå¯¸å…ƒç´ &lt;/td>
&lt;td>â˜…â˜†â˜†&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ç»˜åˆ¶åœ†è§’çŸ©å½¢&lt;/td>
&lt;td>åŠ¨æ€å°ºå¯¸è§†å›¾&lt;/td>
&lt;td>â˜…â˜…â˜†&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>clipToOutline&lt;/td>
&lt;td>é¿å…å¤§é¢ç§¯ä½¿ç”¨&lt;/td>
&lt;td>â˜…â˜…â˜…&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="å››å¸ƒå±€ä¼˜åŒ–ç‹¬ç«‹æ¨¡å—">å››ã€å¸ƒå±€ä¼˜åŒ–ï¼ˆç‹¬ç«‹æ¨¡å—ï¼‰
&lt;/h3>&lt;p>ä¼˜åŒ–æµ‹é‡(measure)ä¸å¸ƒå±€(layout)é˜¶æ®µæ€§èƒ½&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ£€æµ‹å·¥å…·ï¼š&lt;/strong>&lt;br>
&lt;code>Profile GPU Rendering&lt;/code>åˆ†æå„é˜¶æ®µè€—æ—¶&lt;/li>
&lt;li>&lt;strong>ä¼˜åŒ–ç­–ç•¥ï¼š&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>å±‚çº§å‹ç¼©ï¼š&lt;/strong>
&lt;ul>
&lt;li>ä½¿ç”¨ConstraintLayoutå‡å°‘åµŒå¥—&lt;/li>
&lt;li>é¿å…LinearLayoutæƒé‡å¯¼è‡´çš„äºŒæ¬¡æµ‹é‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>åŠ¨æ€åŠ è½½ï¼š&lt;/strong>
&lt;ul>
&lt;li>&lt;code>&amp;lt;merge&amp;gt;&lt;/code>æ¶ˆé™¤å†—ä½™å®¹å™¨å±‚&lt;/li>
&lt;li>&lt;code>ViewStub&lt;/code>å»¶è¿ŸåŠ è½½éšè—è§†å›¾&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>è‡ªå®šä¹‰å¸ƒå±€ä¼˜åŒ–ï¼š&lt;/strong>
&lt;ul>
&lt;li>ç¼“å­˜&lt;code>onMeasure()&lt;/code>è®¡ç®—ç»“æœ&lt;/li>
&lt;li>åªæµ‹é‡å¯è§å­View&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="ä¼˜åŒ–å…³è”å›¾è°±">ä¼˜åŒ–å…³è”å›¾è°±
&lt;/h3>&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">flowchart TD
A[æ€§èƒ½ä¼˜åŒ–] --&amp;gt; B[GPUè´Ÿè½½]
A --&amp;gt; C[CPUè´Ÿè½½]
B --&amp;gt; D[è¿‡åº¦ç»˜åˆ¶ä¼˜åŒ–]
C --&amp;gt; E[å¸ƒå±€è®¡ç®—ä¼˜åŒ–]
C --&amp;gt; F[ç»˜åˆ¶æŒ‡ä»¤ä¼˜åŒ–]
D &amp;amp; F --&amp;gt; G[é€šç”¨æŠ€æœ¯]
G --&amp;gt; H[åŒºåŸŸè£å‰ª]
G --&amp;gt; I[ç¡¬ä»¶åŠ é€Ÿ]
G --&amp;gt; J[åœ†è§’å¤„ç†]
&lt;/code>&lt;/pre>&lt;p>è¯¥é‡ç»„æ–¹æ¡ˆï¼š&lt;/p>
&lt;ol>
&lt;li>å®Œæ•´ä¿ç•™åŸæ–‡æ‰€æœ‰æŠ€æœ¯ç‚¹&lt;/li>
&lt;li>æ¶ˆé™¤ç¡¬ä»¶åŠ é€Ÿ/clipRectç­‰æŠ€æœ¯ç‚¹çš„é‡å¤æè¿°&lt;/li>
&lt;li>å»ºç«‹æ¸…æ™°çš„ã€ŒGPUä¼˜åŒ–-CPUä¼˜åŒ–-é€šç”¨æŠ€æœ¯ã€é€»è¾‘é“¾è·¯&lt;/li>
&lt;li>é€šè¿‡æµç¨‹å›¾å’Œè¡¨æ ¼æå‡å…³é”®æŠ€æœ¯çš„å¯æ“ä½œæ€§&lt;/li>
&lt;li>ç»´æŒä¸åŸæ–‡æ¡£ç›¸åŒçš„æŠ€æœ¯ç»†èŠ‚é¢—ç²’åº¦&lt;/li>
&lt;/ol>
&lt;p>æœ€ç»ˆå½¢æˆçš„ä½“ç³»é€»è¾‘ï¼š&lt;br>
&lt;strong>GPUä¼˜åŒ–&lt;/strong>è§£å†³&amp;quot;ç»˜åˆ¶æ¬¡æ•°&amp;quot;é—®é¢˜ â†’ &lt;strong>CPUä¼˜åŒ–&lt;/strong>è§£å†³&amp;quot;ç»˜åˆ¶æ•ˆç‡&amp;quot;é—®é¢˜ â†’ &lt;strong>é€šç”¨æŠ€æœ¯&lt;/strong>æä¾›è·¨é¢†åŸŸè§£å†³æ–¹æ¡ˆ â†’ &lt;strong>å¸ƒå±€ä¼˜åŒ–&lt;/strong>ä½œä¸ºç‹¬ç«‹å¹¶è¡Œæ¨¡å—&lt;/p>
&lt;ul>
&lt;li>&lt;code>canvas.save()&lt;/code>: å°†å½“å‰&lt;strong>ç»˜åˆ¶çŠ¶æ€&lt;/strong>ï¼ˆçŸ©é˜µå˜æ¢/è£å‰ªåŒºåŸŸ/å›¾å±‚å±æ€§ï¼‰å­˜å…¥æ ˆä¸­&lt;/li>
&lt;li>&lt;code>canvas.restore()&lt;/code>: ä»æ ˆé¡¶å–å‡ºæœ€è¿‘ä¿å­˜çš„çŠ¶æ€å¹¶æ¢å¤&lt;/li>
&lt;li>&lt;code>canvas.quickReject()&lt;/code>:å¿«é€Ÿåˆ¤æ–­æŒ‡å®šçŸ©å½¢åŒºåŸŸæ˜¯å¦&lt;strong>å®Œå…¨ä½äºå½“å‰è£å‰ªåŒºåŸŸå¤–&lt;/strong>&lt;/li>
&lt;/ul></description></item><item><title>å…³äºç¡¬ä»¶åŠ é€Ÿ</title><link>https://www.dust-zed.site/android-develop/%E5%85%B3%E4%BA%8E%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F/</link><pubDate>Fri, 13 Jun 2025 22:50:57 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/%E5%85%B3%E4%BA%8E%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F/</guid><description>&lt;h4 id="ä¸€ç¡¬ä»¶åŠ é€Ÿæ ¸å¿ƒæ¦‚å¿µ">ä¸€ã€ç¡¬ä»¶åŠ é€Ÿæ ¸å¿ƒæ¦‚å¿µ
&lt;/h4>&lt;p>ç¡¬ä»¶åŠ é€Ÿæ˜¯å°†å›¾å½¢æ¸²æŸ“ä¸­çš„å…‰æ …åŒ–ä»CPUè½¬ç§»åˆ°GPUæ‰§è¡Œçš„æŠ€æœ¯ã€‚CPUåªéœ€è¦ç”Ÿæˆ&lt;strong>ç»˜åˆ¶æŒ‡ä»¤é›†(DisplayList)&lt;/strong>ï¼Œç”±GPUè¿›è¡Œé«˜æ•ˆçš„å¹¶è¡Œå…‰æ …åŒ–è®¡ç®—ï¼Œæœ€ç»ˆå†™å…¥å›¾å½¢ç¼“å†²åŒºæä¾›å±å¹•æ˜¾ç¤ºã€‚&lt;/p>
&lt;p>æœ¬è´¨ï¼šCPUè´Ÿè´£é€»è¾‘æŒ‡ä»¤ï¼ŒGPUè´Ÿè´£ç¹é‡åƒç´ è®¡ç®—ï¼Œåˆ†å·¥åä½œæå‡æ•ˆç‡&lt;/p>
&lt;p>å…‰æ …åŒ–ï¼šå¯ä»¥é«˜åº¦æŠ½è±¡çš„æ¦‚æ‹¬ä¸º&lt;strong>è®¡ç®—å±å¹•ä¸Šæ¯ä¸ªåƒç´ ç‚¹æœ€ç»ˆæ˜¾ç¤ºçš„ARGBå€¼&lt;/strong>&lt;/p>
&lt;h4 id="äºŒç¡¬ä»¶åŠ é€Ÿå¯ç”¨å‰åçš„æ ¸å¿ƒæµç¨‹å¯¹æ¯”">äºŒã€ç¡¬ä»¶åŠ é€Ÿå¯ç”¨å‰åçš„æ ¸å¿ƒæµç¨‹å¯¹æ¯”
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>æœªå¯ç”¨ç¡¬ä»¶åŠ é€Ÿ&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>measure &amp;amp; layout&lt;/strong>ï¼šç”±CPUåœ¨ä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰æ‰§è¡Œ&lt;/li>
&lt;li>&lt;strong>Draw&lt;/strong>ï¼ˆå…³é”®åŒºåˆ«ï¼‰ï¼š
&lt;ul>
&lt;li>CPUï¼šéå†Viewæ ‘ï¼Œåœ¨ä¸»çº¿ç¨‹ç›´æ¥æ‰§è¡Œæ¯ä¸ªViewçš„onDraw(Canvas)æ–¹æ³•&lt;/li>
&lt;li>å…‰æ …åŒ–ï¼šonDrawä¸­çš„ç»˜åˆ¶æŒ‡ä»¤ä¹Ÿç”±CPUæ‰§è¡Œï¼Œç›´æ¥è®¡ç®—å‡ºæœ€ç»ˆçš„åƒç´ å€¼ã€‚&lt;/li>
&lt;li>ç¼“å†²åŒº(Frame Buffer)
&lt;ul>
&lt;li>ç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªå¸§ç¼“å†²åŒºã€‚&lt;/li>
&lt;li>CPUå…‰æ …åŒ–å¥½çš„åƒç´ æ•°æ®ç›´æ¥å†™å…¥è¿™ä¸ªå¸§ç¼“å†²åŒº&lt;/li>
&lt;li>æ ¸å¿ƒï¼šCPUæ—¢å¤„ç†é€»è¾‘è®¡ç®—åˆå¤„ç†ç”Ÿæˆæœ€ç»ˆåƒç´ çš„ç¹é‡è®¡ç®—(å…‰æ …åŒ–)ï¼Œç„¶åæŠŠç»“æœæ”¾è¿›å¸§ç¼“å†²&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>åˆæˆ &amp;amp; æ˜¾ç¤º&lt;/strong>ï¼šå±å¹•è¯»å–å¸§ç¼“å†²åŒºçš„å†…å®¹æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸æ¶‰åŠåŒç¼“å†²å’ŒVsyncä¿¡å·æ¥é¿å…æ’•è£‚ï¼Œä½†å…¶ç»˜åˆ¶æ ¸å¿ƒæ˜¯CPU
&lt;ul>
&lt;li>Front Bufferæ˜¯å±å¹•å½“å‰å¸§æ˜¾ç¤ºçš„å†…å®¹ï¼ŒBack Bufferæ˜¯å±å¹•ä¸‹ä¸€å¸§è¦æ˜¾ç¤ºçš„å†…å®¹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>å¼€å¯ç¡¬ä»¶åŠ é€Ÿ&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>Measure &amp;amp; Layout&lt;/strong>ï¼šä»ç„¶ç”±CPUåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œã€‚&lt;/li>
&lt;li>&lt;strong>Draw&lt;/strong>(å…³é”®åŒºåˆ«)ï¼š
&lt;ul>
&lt;li>CPUï¼šéå†Viewæ ‘ï¼Œåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œæ¯ä¸ªViewçš„**&lt;code>onDraw(Canvas)&lt;/code>**æ–¹æ³•ã€‚ä½†æ˜¯è¿™é‡Œçš„&lt;code>Canvas&lt;/code>è¡Œä¸ºä¸åŒäº†&lt;/li>
&lt;li>Display Listï¼šonDraw(Canvas)ä¸­çš„ç»˜åˆ¶æŒ‡ä»¤ä¸å†ç«‹å³å…‰æ …åŒ–ï¼Œè€Œæ˜¯è¢«è®°å½•åˆ°DisplayListçš„æ•°æ®ç»“æ„ä¸­ã€‚DisplayListæœ¬è´¨æ˜¯ä¸€ç³»åˆ—GPUèƒ½ç†è§£çš„ç»˜å›¾æ“ä½œæŒ‡ä»¤çš„åºåˆ—åŒ–è¡¨ç¤º&lt;/li>
&lt;li>å…‰æ …åŒ–ï¼šç”±GPUæ‰§è¡Œï¼ŒCPUå°†æ„å»ºå¥½çš„&lt;code>DisplayList&lt;/code>æäº¤ç»™GPUã€‚GPUé©±åŠ¨ç¨‹åºå°†è¿™äº›é«˜çº§ç»˜å›¾æŒ‡ä»¤&lt;strong>å¹¶è¡Œåœ°ã€é«˜æ•ˆåœ°å…‰æ …åŒ–&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ç¼“å†²åŒº&lt;/strong>(Frame Buffer / GRALLOC Buffers):
&lt;ul>
&lt;li>&lt;strong>æ™®é€šå¼€å¯ç¡¬ä»¶åŠ é€Ÿæ—¶çš„ç¼“å†²åŒºï¼š&lt;/strong> GPU å°†å…‰æ …åŒ–&lt;strong>å¥½çš„åƒç´ æ•°æ®å†™å…¥ç³»ç»Ÿåˆ†é…çš„å›¾å½¢ç¼“å†²åŒº&lt;/strong> (é€šå¸¸æ˜¯é€šè¿‡ &lt;code>Gralloc&lt;/code> åˆ†é…ç®¡ç†çš„ Buffer Queue ä¸­çš„ç¼“å†²åŒºï¼Œå¦‚ &lt;code>SurfaceTexture&lt;/code>)ã€‚è¿™äº›ç¼“å†²åŒº&lt;strong>å°±æ˜¯å±å¹•æœ€ç»ˆåˆæˆæ—¶ä½¿ç”¨çš„åƒç´ æ•°æ®æº&lt;/strong>&lt;/li>
&lt;li>æ ¸å¿ƒï¼šCPUè´Ÿè´£è®°å½•ç»˜åˆ¶å‘½ä»¤(onDraw -&amp;gt; DisplayList)ï¼›GPUè´Ÿè´£å…‰æ …åŒ–ï¼Œç»“æœå†™å…¥å›¾å½¢ç¼“å†²åŒº&lt;/li>
&lt;li>Frame Bufferæ˜¯æŠ½è±¡çš„ç¼“å†²åŒºï¼Œè€ŒGRALLOC Buffersæ˜¯ç‰©ç†ç¼“å†²åŒº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="ä¸‰å¯ç”¨ç¡¬ä»¶å±‚">ä¸‰ã€å¯ç”¨ç¡¬ä»¶å±‚
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>ç›®çš„&lt;/strong>ï¼šå¯¹åƒç´ ä¸ä¼šé¢‘ç¹å˜åŒ–çš„Viewé‡‡ç”¨ç©ºé—´æ¢æ—¶é—´çš„æ–¹æ¡ˆï¼Œé¿å…Viewå†…å®¹æœªå˜æ—¶é‡å¤å…‰æ …åŒ–ï¼Œç”¨äºåç»­å¿«é€Ÿåˆæˆ&lt;/li>
&lt;li>&lt;strong>ä½œç”¨&lt;/strong>ï¼šä»…å½“è§†å›¾å†…å®¹æ”¹å˜(&lt;code>invalidate()&lt;/code>)æ—¶æˆ–ä¸»åŠ¨æ›´æ–°æ—¶ï¼šGPUé‡æ–°å…‰æ …åŒ–è¯¥Viewçš„DisplayList -&amp;gt; æ›´æ–°ç¦»å±çº¹ç†ã€‚è€Œåªæ¶‰åŠçº¹ç†çš„å˜æ¢æ—¶ï¼Œä¸ä¼šé‡æ–°å…‰æ …åŒ–DisplayListï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨çº¹ç†ç¼“å­˜è¿›è¡Œåˆæˆï¼Œçº¹ç†å˜æ¢æ­£æ˜¯GPUæ“…é•¿çš„ã€‚çº¹ç†å˜æ¢å’Œopenglç®¡çº¿å·¥ä½œæµç¨‹ä¸­çš„é¡¶ç‚¹å˜æ¢æ˜¯ä¸åŒçš„å±‚çº§æ¦‚å¿µ&lt;/li>
&lt;li>&lt;strong>æœ€ä½³å®è·µ&lt;/strong>
&lt;ol>
&lt;li>é€‚åˆ&lt;strong>å°é¢ç§¯é™æ€è§†å›¾&lt;/strong>æˆ–&lt;strong>å±æ€§åŠ¨ç”»&lt;/strong>&lt;/li>
&lt;li>é¿å…å¯¹å¤§è§†å›¾ï¼ˆå¦‚åˆ—è¡¨è§†å›¾ï¼‰å¯ç”¨ï¼Œæ˜“è€—å°½æ˜¾å­˜&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol></description></item><item><title>é¢è¯•é—®é¢˜æ”¶é›†</title><link>https://www.dust-zed.site/android-develop/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E6%94%B6%E9%9B%86/</link><pubDate>Fri, 13 Jun 2025 09:30:56 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E6%94%B6%E9%9B%86/</guid><description>&lt;h4 id="ä¸€bitmapå†…å­˜ä¼˜åŒ–">ä¸€ã€Bitmapå†…å­˜ä¼˜åŒ–
&lt;/h4>&lt;p>Bitmapæ˜¯å†…å­˜æ¶ˆè€—å¤§æˆ·ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹æ³•å‡å°‘å ç”¨ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>é™ä½è‰²å½©è§£ææ¨¡å¼&lt;/strong>&lt;br>
ä½¿ç”¨RGB565ç­‰ä½è‰²å½©æ¨¡å¼ï¼Œå°†å•ä¸ªåƒç´ çš„å­—èŠ‚å¤§å°ä»32ä½ï¼ˆARGB8888ï¼‰å‡å°‘åˆ°16ä½ï¼Œæ˜¾è‘—èŠ‚çœå†…å­˜ã€‚&lt;/li>
&lt;li>&lt;strong>åˆç†æ”¾ç½®èµ„æºæ–‡ä»¶&lt;/strong>&lt;br>
é«˜åˆ†è¾¨ç‡å›¾ç‰‡åº”æ”¾ç½®åœ¨é«˜å¯†åº¦ç›®å½•ï¼ˆå¦‚&lt;code>drawable-xxhdpi&lt;/code>ï¼‰ï¼Œé¿å…ç³»ç»Ÿè‡ªåŠ¨ç¼©æ”¾å¯¼è‡´å†…å­˜æµªè´¹ã€‚&lt;/li>
&lt;li>&lt;strong>ç¼©å°å›¾ç‰‡å°ºå¯¸&lt;/strong>&lt;br>
åŠ è½½æ—¶é€šè¿‡&lt;code>BitmapFactory.Options&lt;/code>åŠ¨æ€è°ƒæ•´é‡‡æ ·ç‡ï¼ˆ&lt;code>inSampleSize&lt;/code>ï¼‰ï¼Œæˆ–ä½¿ç”¨&lt;code>createScaledBitmap()&lt;/code>å‡å°‘å®½é«˜å°ºå¯¸ã€‚&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="äºŒviewmodelä¸livedataæœºåˆ¶">äºŒã€ViewModelä¸LiveDataæœºåˆ¶
&lt;/h4>&lt;p>ViewModelå’ŒLiveDataæ˜¯Jetpackç»„ä»¶ï¼Œç”¨äºæ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œå“åº”å¼UIæ›´æ–°ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>ç²˜æ€§äº‹ä»¶ï¼ˆSticky Eventï¼‰&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>å®šä¹‰&lt;/strong>ï¼šå½“æ–°è§‚å¯Ÿè€…è®¢é˜…&lt;code>LiveData&lt;/code>æ—¶ï¼Œè‹¥å·²æœ‰å­˜å‚¨å€¼ï¼Œä¼šç«‹å³æ”¶åˆ°æœ€åä¸€æ¬¡æ›´æ–°ï¼ˆæ—§æ•°æ®ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç¤ºä¾‹&lt;/strong>ï¼šå±å¹•æ—‹è½¬åï¼Œæ–°Activityè§‚å¯ŸLiveDataæ—¶è§¦å‘UIæ›´æ–°ï¼ˆæ—§æ•°æ®ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ¥æº&lt;/strong>ï¼šåŸºäºLiveDataçš„ç‰ˆæœ¬å·å¯¹æ¯”æœºåˆ¶ã€‚ä»£ç å…³é”®éƒ¨åˆ†å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">abstract&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">LiveData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> mVersion &lt;span style="color:#f92672">=&lt;/span> START_VERSION; &lt;span style="color:#75715e">// LiveDataå½“å‰ç‰ˆæœ¬ï¼ˆåˆå§‹-1ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">LifecycleBoundObserver&lt;/span> &lt;span style="color:#66d9ef">implements&lt;/span> ObserverWrapper {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> mLastVersion &lt;span style="color:#f92672">=&lt;/span> START_VERSION;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">considerNotify&lt;/span>(ObserverWrapper observer) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (observer.&lt;span style="color:#a6e22e">mLastVersion&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> mVersion) { &lt;span style="color:#75715e">// æ ¸å¿ƒåˆ¤æ–­ï¼šç‰ˆæœ¬å·è½åæ‰åˆ†å‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> observer.&lt;span style="color:#a6e22e">mLastVersion&lt;/span> &lt;span style="color:#f92672">=&lt;/span> mVersion;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> observer.&lt;span style="color:#a6e22e">mObserver&lt;/span>.&lt;span style="color:#a6e22e">onChanged&lt;/span>((T)data);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç®€å•è§£æ³•&lt;/strong>ï¼šä½¿ç”¨&lt;code>Event&lt;/code>åŒ…è£…æ•°æ®ã€‚äº‹ä»¶æ¶ˆè´¹åç½®ç©ºå€¼ï¼Œé¿å…æ—§æ•°æ®è§¦å‘æ›´æ–°ã€‚&lt;/p>
&lt;ul>
&lt;li>ä½†æ˜¯è¿™ä¸ªä¸æ”¯æŒå¤šè§‚å¯Ÿè€…&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨&lt;code>SharedFlow&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ViewModelä¸´æ—¶æ•°æ®ä¿å­˜æœºåˆ¶&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å†…å­˜ä¸­ä¿å­˜&lt;/strong>&lt;br>
ViewModelå¯¹è±¡å­˜å‚¨åœ¨&lt;code>ViewModelStore&lt;/code>ä¸­ã€‚å½“é…ç½®å˜æ›´ï¼ˆå¦‚å±å¹•æ—‹è½¬ï¼‰æ—¶ï¼š
&lt;ul>
&lt;li>Activity/Fragmentè¢«é”€æ¯é‡å»ºã€‚&lt;/li>
&lt;li>&lt;code>ViewModelStore&lt;/code>è¢«ç³»ç»Ÿä¿ç•™ï¼ˆç»‘å®šåˆ°&lt;code>NonConfigurationInstances&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>æ–°å»ºActivity/Fragmentæ—¶è‡ªåŠ¨æ¢å¤ViewModelå®ä¾‹ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>æ•°æ®èŒƒå›´ä¸æœ€ä½³å®è·µ&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>ä¿ç•™åœºæ™¯&lt;/strong>ï¼šå±å¹•æ—‹è½¬ã€åˆ†å±åˆ‡æ¢ã€ç³»ç»Ÿè¯­è¨€æ›´æ”¹ã€‚&lt;/li>
&lt;li>&lt;strong>ä¸ä¿ç•™åœºæ™¯&lt;/strong>ï¼šç”¨æˆ·é€€å‡ºåº”ç”¨ã€ç³»ç»Ÿèµ„æºä¸è¶³æ€æ­»è¿›ç¨‹ã€Activityè¢«finish()ã€‚&lt;/li>
&lt;li>&lt;strong>æœ€ä½³å®è·µ&lt;/strong>ï¼š
&lt;ol>
&lt;li>ViewModelè§£å†³é…ç½®å˜æ›´çš„&lt;strong>ä¸´æ—¶æ•°æ®ä¿å­˜&lt;/strong>ï¼ˆå†…å­˜çº§ï¼‰ã€‚&lt;/li>
&lt;li>åœ¨ViewModelä½¿ç”¨&lt;code>SavedStateHandle&lt;/code>è§£å†³è¿›ç¨‹è¢«æ€æ­»æ—¶çš„&lt;strong>å…³é”®æ•°æ®æŒä¹…åŒ–&lt;/strong>ã€‚&lt;/li>
&lt;li>å¤æ‚æ•°æ®åº”ä½¿ç”¨æ•°æ®åº“ç­‰æŒä¹…åŒ–æ–¹æ¡ˆã€‚&lt;/li>
&lt;li>é¿å…å†…å­˜æ³„æ¼ï¼šå‹¿åœ¨ViewModelæŒæœ‰Context/Viewå¼•ç”¨ï¼Œå¿…è¦æ—¶ç”¨&lt;code>Application Context&lt;/code>ä»£æ›¿ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="ä¸‰viewåŸºç¡€åŸç†">ä¸‰ã€ViewåŸºç¡€åŸç†
&lt;/h4>&lt;p>æ·±å…¥ç†è§£Viewçš„æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶æœºåˆ¶ï¼Œæ˜¯ä¼˜åŒ–UIæ€§èƒ½çš„æ ¸å¿ƒã€‚&lt;/p>
&lt;ol>
&lt;li>&lt;strong>MeasureSpecè®¡ç®—ä¸å¸ƒå±€ä¼˜åŒ–&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>MeasureSpecåŸç†&lt;/strong>ï¼šçˆ¶å®¹å™¨ä¼ é€’ç»™å­Viewçš„æµ‹é‡è¦æ±‚ï¼Œç”±å¤§å°å’Œæ¨¡å¼ç»„æˆï¼Œå–å†³äºçˆ¶å®¹å™¨çš„MeasureSpecå’Œå­Viewçš„LayoutParamsã€‚
&lt;ul>
&lt;li>çˆ¶å¸ƒå±€æ ¹æ®è‡ªèº«MeasureSpecå’Œå­View LayoutParamsï¼Œç¡®å®šå­Viewçš„MeasureSpecï¼Œå†è°ƒç”¨&lt;code>children.measure()&lt;/code>ï¼Œæœ€ç»ˆç¡®å®šè‡ªèº«å°ºå¯¸ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>å¸ƒå±€æ€§èƒ½ä¼˜åŒ–&lt;/strong>ï¼š
&lt;ul>
&lt;li>ç¼“å­˜MeasureSpecè®¡ç®—ç»“æœï¼šå›ºå®šå°ºå¯¸Viewï¼ˆå¦‚æŒ‰é’®ï¼‰ç›´æ¥è°ƒç”¨&lt;code>setMeasuredDimension()&lt;/code>è®¾ç½®å®½é«˜ã€‚&lt;/li>
&lt;li>ä¼˜åŒ–å¸ƒå±€æµç¨‹ï¼šå‡å°‘åµŒå¥—å±‚çº§ã€æ‡’åŠ è½½å¸ƒå±€ã€åˆå¹¶é‡å¤å¸ƒå±€ã€‚&lt;/li>
&lt;li>é¿å…æ— æ•ˆé‡ç»˜ï¼šä½¿ç”¨å±€éƒ¨åˆ·æ–°æœºåˆ¶ã€‚&lt;/li>
&lt;li>ç²¾ç¡®æ§åˆ¶ç»˜åˆ¶èŒƒå›´ï¼šé€šè¿‡&lt;code>Canvas.clipRect()&lt;/code>é™åˆ¶ç»˜åˆ¶åŒºåŸŸã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>getMeasuredWidth()ä¸getWidth()åŒºåˆ«&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>getMeasuredWidth()&lt;/strong>ï¼šæµ‹é‡é˜¶æ®µååˆ†é…çš„å®½åº¦ï¼ˆå«å†…è¾¹è·ï¼‰ã€‚
&lt;ul>
&lt;li>ä½¿ç”¨æ—¶æœºï¼š&lt;code>onMeasure()&lt;/code>åæˆ–&lt;code>layout()&lt;/code>å‰ã€‚&lt;/li>
&lt;li>ç‰¹ç‚¹ï¼šåæ˜ è§†å›¾çš„æœŸæœ›å®½åº¦ï¼›è‹¥å¸ƒå±€æœªå¼ºåˆ¶æ”¹å˜å°ºå¯¸ï¼Œå¯èƒ½ä¸&lt;code>getWidth&lt;/code>ç›¸åŒã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>getWidth()&lt;/strong>ï¼šå¸ƒå±€é˜¶æ®µåçš„æœ€ç»ˆå¯è§å®½åº¦ï¼ˆå±å¹•å®é™…å€¼ï¼‰ã€‚
&lt;ul>
&lt;li>ä½¿ç”¨æ—¶æœºï¼š&lt;code>onLayout&lt;/code>åã€‚&lt;/li>
&lt;li>è®¡ç®—æ–¹å¼ï¼š&lt;code>width = right - left&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>requestLayout()ä¸invalidate()åŒºåˆ«&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>requestLayout()&lt;/strong>ï¼šè¯·æ±‚æ•´ä¸ªè§†å›¾æ ‘çš„æµ‹é‡ï¼ˆmeasureï¼‰å’Œå¸ƒå±€ï¼ˆlayoutï¼‰æµç¨‹ã€‚
&lt;ul>
&lt;li>è§¦å‘åœºæ™¯ï¼šè§†å›¾å°ºå¯¸/ä½ç½®å˜åŒ–ã€åŠ¨æ€æ·»åŠ /ç§»é™¤å­è§†å›¾ã€&lt;code>setVisibility()&lt;/code>å¯¼è‡´å¸ƒå±€ç»“æ„å˜åŒ–ã€‚&lt;/li>
&lt;li>æ‰§è¡Œæµç¨‹ï¼šä»å½“å‰è§†å›¾å‘ä¸Šå›æº¯åˆ°æ ¹è§†å›¾ï¼ˆå¦‚ViewRootImplï¼‰ï¼Œä¾æ¬¡æ‰§è¡Œmeasure â†’ layoutã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>invalidate()&lt;/strong>ï¼šä»…æ ‡è®°è§†å›¾çš„å±€éƒ¨åŒºåŸŸä¸ºâ€œè„åŒºâ€ï¼Œè¯·æ±‚ä¸‹ä¸€å¸§é‡ç»˜è¯¥åŒºåŸŸã€‚
&lt;ul>
&lt;li>è§¦å‘åœºæ™¯ï¼šè§†å›¾å†…å®¹å˜åŒ–ä½†ä¸å½±å“å°ºå¯¸/ä½ç½®ï¼ˆå¦‚&lt;code>onDraw()&lt;/code>ä¾èµ–æ•°æ®æ›´æ–°ï¼‰ã€‚&lt;/li>
&lt;li>æ‰§è¡Œæµç¨‹ï¼šæ ‡è®°è„åŒº â†’ åŠ å…¥é‡ç»˜é˜Ÿåˆ— â†’ ä¸‹ä¸€å¸§VSyncä¿¡å·æ—¶è°ƒç”¨&lt;code>onDraw()&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Viewåæ ‡ä½“ç³»&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>getX()/getY()&lt;/strong>ï¼šç›¸å¯¹å½“å‰Viewå·¦ä¸Šè§’çš„å±€éƒ¨åæ ‡ï¼ˆè§¦æ‘¸ç‚¹åœ¨Viewå†…çš„ä½ç½®ï¼‰ã€‚
&lt;ul>
&lt;li>ç‰¹ç‚¹ï¼šä¸çˆ¶å®¹å™¨æ— å…³ï¼›å€¼å¯ä¸ºè´Ÿï¼ˆå¦‚æ»‘åŠ¨è¶…å‡ºViewè¾¹ç•Œï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>getRawX()/getRawY()&lt;/strong>ï¼šç›¸å¯¹å±å¹•å·¦ä¸Šè§’çš„å…¨å±€åæ ‡ã€‚
&lt;ul>
&lt;li>ç‰¹ç‚¹ï¼šåŒ…å«çŠ¶æ€æ é«˜åº¦ï¼ˆ&lt;code>getRawY()&lt;/code>ä»å±å¹•é¡¶éƒ¨ç®—èµ·ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>getLocationOnScreen()&lt;/strong>ï¼šè·å–Viewå·¦ä¸Šè§’åœ¨å±å¹•ä¸Šçš„ç»å¯¹åæ ‡ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Viewç”Ÿå‘½å‘¨æœŸå…³é”®æ–¹æ³•&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>æ„é€ å‡½æ•°&lt;/strong>ï¼šé€šè¿‡ä»£ç æˆ–XMLåˆ›å»ºViewå®ä¾‹ã€‚&lt;/li>
&lt;li>&lt;strong>onAttachedToWindow()&lt;/strong>ï¼šViewè¢«æ·»åŠ åˆ°çª—å£æ—¶è°ƒç”¨ã€‚
&lt;ul>
&lt;li>ç”¨é€”ï¼šåˆå§‹åŒ–èµ„æºã€æ³¨å†Œç›‘å¬å™¨ã€å¯åŠ¨åŠ¨ç”»ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>onDetachedFromWindow()&lt;/strong>ï¼šViewä»çª—å£ç§»é™¤æ—¶è°ƒç”¨ï¼ˆå¦‚Activityé”€æ¯ï¼‰ã€‚
&lt;ul>
&lt;li>å…³é”®ä½œç”¨ï¼šé‡Šæ”¾èµ„æºã€åœæ­¢åŠ¨ç”»ã€æ³¨é”€ç›‘å¬å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>æ³¨æ„äº‹é¡¹&lt;/strong>ï¼š
&lt;ul>
&lt;li>&lt;code>onVisibilityChanged()&lt;/code>å¯èƒ½åœ¨&lt;code>onAttachedToWindow()&lt;/code>å‰/åè°ƒç”¨ï¼ˆå¦‚Viewåˆå§‹åŒ–ä¸º&lt;code>GONE&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>&lt;code>onWindowFocusChanged()&lt;/code>å¯èƒ½åœ¨&lt;code>onDetachedFromWindow()&lt;/code>åè°ƒç”¨ï¼ˆé¿å…åœ¨æ­¤è®¿é—®èµ„æºï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Viewæ€§èƒ½ä¼˜åŒ–&lt;/strong>
&lt;ol>
&lt;li>&lt;strong>è¿‡åº¦ç»˜åˆ¶ï¼š&lt;/strong>
&lt;ul>
&lt;li>æ¦‚å¿µï¼šGPUåœ¨ä¸€ä¸ªåƒç´ ç‚¹ä¸Šç»˜åˆ¶äº†å¤šæ¬¡çš„ç°è±¡ã€‚ç³»ç»Ÿé»˜è®¤å…è®¸2.5æ¬¡ï¼ˆ1xç»˜åˆ¶ + 1.5xåŠé€æ˜æ··åˆï¼‰&lt;/li>
&lt;li>ä¸»è¦ä¼˜åŒ–ç­–ç•¥
&lt;ul>
&lt;li>ç§»é™¤ä¸å¿…è¦çš„èƒŒæ™¯&lt;/li>
&lt;li>å‡å°‘Viewçš„å±‚çº§æ·±åº¦&lt;/li>
&lt;li>è°¨æ…ä½¿ç”¨åŠé€æ˜æˆ–**&lt;code>setLayerType(LAYER_TYPE_HARDWARE)&lt;/code>**&lt;/li>
&lt;li>ä¼˜åŒ–&lt;code>clipRect&lt;/code>å’Œ&lt;code>quickReject&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>å¸ƒå±€ä¼˜åŒ–ï¼š&lt;/strong>
&lt;ul>
&lt;li>æ¦‚å¿µï¼šæŒ‡æµ‹é‡å’Œå¸ƒå±€é˜¶æ®µçš„æ€§èƒ½ä¼˜åŒ–ã€‚CPUéœ€è¦éå†Viewæ ‘è®¡ç®—æ¯ä¸ªViewçš„å¤§å°å’Œä½ç½®&lt;/li>
&lt;li>ä¼˜åŒ–ç­–ç•¥ï¼š
&lt;ul>
&lt;li>å‡å°‘åµŒå¥—å±‚çº§&lt;/li>
&lt;li>ä½¿ç”¨é«˜æ•ˆå¸ƒå±€æ ‡ç­¾ï¼ˆmergeã€includeã€ViewStubï¼‰&lt;/li>
&lt;li>ä¼˜åŒ–&lt;code>onMeasure&lt;/code>/&lt;code>onLayout&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ç»˜åˆ¶ä¼˜åŒ–ï¼š&lt;/strong>
&lt;ul>
&lt;li>æ¦‚å¿µï¼šæŒ‡å®é™…è°ƒç”¨View.onDrawæ–¹æ³•æ¸²æŸ“åƒç´ åˆ°å±å¹•çš„æ€§èƒ½ä¼˜åŒ–ã€‚CPUå‡†å¤‡ç»˜åˆ¶æŒ‡ä»¤ -&amp;gt;GPUæ‰§è¡Œç»˜åˆ¶&lt;/li>
&lt;li>ä¼˜åŒ–ç­–ç•¥
&lt;ul>
&lt;li>ä¼˜åŒ–onDraw()æ–¹æ³•ï¼šé¿å…å†…å­˜åˆ†é…(ä¸åœ¨onDrawæ–¹æ³•å†…å®ä¾‹åŒ–Paintã€Pathã€Bitmapã€Rectå¯¹è±¡)ï¼Œé¿å…è€—æ—¶æ“ä½œã€é¿å…è°ƒç”¨invalidateï¼ˆé¿å…é€’å½’/ç»˜åˆ¶è¯·æ±‚ï¼‰ï¼Œåˆ©ç”¨canvas.clipRectå’Œcanvas.quickReject(),ä¼˜å…ˆä½¿ç”¨çŸ¢é‡å›¾ä»£æ›¿ä½å›¾ï¼Œä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿæ”¯æŒçš„Canvasæ“ä½œ&lt;/li>
&lt;li>è°¨æ…å¼€å¯Hardware_Layer&lt;/li>
&lt;li>ä¼˜åŒ–alphaé€šé“å’Œé€æ˜åº¦&lt;/li>
&lt;li>ä¼˜åŒ–BitmapåŠ è½½ä¸æ˜¾ç¤º&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>&lt;strong>é«˜çº§æœºåˆ¶ä¸åŸç†&lt;/strong>
&lt;ol>
&lt;li>ç¡¬ä»¶åŠ é€Ÿï¼šå°†ç»˜åˆ¶æŒ‡ä»¤äº¤ç»™GPUï¼Œä½†æ˜¯éƒ¨åˆ†apiä¸æ”¯æŒ&lt;/li>
&lt;li>SurfaceViewä¸TextureViewï¼štodo&lt;/li>
&lt;li>view.postä¸Handlerï¼štodo&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="å››äº‹ä»¶åˆ†å‘æœºåˆ¶">å››ã€äº‹ä»¶åˆ†å‘æœºåˆ¶
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>æ»‘åŠ¨å®ç°æ–¹å¼&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>&lt;code>scrollTo()&lt;/code>/&lt;code>scrollBy()&lt;/code>&lt;/strong>: scrollTo()æ˜¯ç›´æ¥è·³è½¬åˆ°æŒ‡å®šä½ç½®ï¼ŒscrollByæ˜¯ç›¸å¯¹ç§»åŠ¨ï¼ŒåŸºäºå½“å‰ä½ç½®æ»‘åŠ¨æŒ‡å®šåç§»é‡&lt;/li>
&lt;li>é€šè¿‡&lt;code>ViewDragHelper&lt;/code>å®ç°å¤æ‚æ‹–æ‹½: todo&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>è‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°æ§ä»¶&lt;/strong>
&lt;ul>
&lt;li>todo&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>äº‹ä»¶åˆ†å‘æœºåˆ¶å¦‚ä½•æå‡æ•ˆç‡&lt;/strong>
&lt;ul>
&lt;li>todo&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>åµŒå¥—æ»‘åŠ¨å¤„ç†&lt;/strong>
&lt;ul>
&lt;li>todo&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>RecyclerViewçš„æ»‘åŠ¨å†²çªå¤„ç†&lt;/strong>
&lt;ul>
&lt;li>todo&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="äº”handler">äº”ã€Handler
&lt;/h4>&lt;ol>
&lt;li>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="å…­æ€§èƒ½ä¼˜åŒ–-todo">å…­ã€æ€§èƒ½ä¼˜åŒ– ï¼ˆtodoï¼‰
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>å†…å­˜ç®¡ç†ä¸æ³„æ¼æ’æŸ¥&lt;/strong>&lt;/li>
&lt;li>&lt;strong>UIæ¸²æŸ“æ€§èƒ½(å¡é¡¿ä¼˜åŒ–)&lt;/strong>&lt;/li>
&lt;li>&lt;strong>å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–&lt;/strong>&lt;/li>
&lt;li>&lt;strong>åŠŸè€—ä¼˜åŒ–åŸºç¡€&lt;/strong>&lt;/li>
&lt;li>&lt;strong>åŒ…ä½“ç§¯ä¼˜åŒ–&lt;/strong>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="ä¸ƒå¸¸ç”¨åº“ä¸æ¡†æ¶todo">ä¸ƒã€å¸¸ç”¨åº“ä¸æ¡†æ¶ï¼ˆtodoï¼‰
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>ç½‘ç»œè¯·æ±‚(å¦‚Retrofit)&lt;/strong>&lt;/li>
&lt;li>&lt;strong>å›¾ç‰‡åŠ è½½(å¦‚Glide / Picasso)&lt;/strong>&lt;/li>
&lt;li>&lt;strong>GradleåŸºç¡€&lt;/strong>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="å…«ç½‘ç»œä¸åå°">å…«ã€ç½‘ç»œä¸åå°
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>RESTful APIæ¦‚å¿µä¸ä½¿ç”¨&lt;/strong>&lt;/li>
&lt;li>&lt;strong>å¼‚æ­¥å¤„ç†æ·±å…¥ï¼ˆçº¿ç¨‹å®‰å…¨ã€åå°é™åˆ¶ï¼‰&lt;/strong>&lt;/li>
&lt;li>&lt;strong>ç¼“å­˜ç­–ç•¥&lt;/strong>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="ä¹æ¶æ„è®¾è®¡">ä¹ã€æ¶æ„è®¾è®¡
&lt;/h4>&lt;ol>
&lt;li>MVVM/MVIç†è§£ä¸å®è·µ&lt;/li>
&lt;li>æ¨¡å—åŒ– / ç»„ä»¶åŒ–&lt;/li>
&lt;li>è®¾è®¡æ¨¡å¼åº”ç”¨&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="åæ–°æŠ€æœ¯ä¸è¶‹åŠ¿">åã€æ–°æŠ€æœ¯ä¸è¶‹åŠ¿
&lt;/h4>&lt;ol>
&lt;li>Compose&lt;/li>
&lt;li>KMM / Flutter&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="åä¸€jvm--å†…å­˜æ¨¡å‹åŸºç¡€">åä¸€ã€JVM / å†…å­˜æ¨¡å‹åŸºç¡€
&lt;/h4>&lt;ol>
&lt;li>JVMå†…å­˜ç»“æ„&lt;/li>
&lt;li>åƒåœ¾å›æ”¶æœºåˆ¶åŸºç¡€&lt;/li>
&lt;li>å¸¸è§æ•°æ®ç»“æ„ä¸åŸºç¡€ç®—æ³•&lt;/li>
&lt;/ol></description></item><item><title>RecyclerViewç¼“å­˜æœºåˆ¶</title><link>https://www.dust-zed.site/android-develop/recyclerview%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/</link><pubDate>Wed, 11 Jun 2025 15:26:57 +0800</pubDate><guid>https://www.dust-zed.site/android-develop/recyclerview%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/</guid><description>&lt;p>RecyclerViewç¼“å­˜æœºåˆ¶&lt;/p>
&lt;h4 id="å¤šçº§ç¼“å­˜ä½“ç³»æ¶æ„å›¾">&lt;strong>å¤šçº§ç¼“å­˜ä½“ç³»æ¶æ„å›¾&lt;/strong>
&lt;/h4>&lt;pre tabindex="0">&lt;code>TEXT
RecyclerView ç¼“å­˜ç³»ç»Ÿ
â”œâ”€â”€ 1. å±å¹•å†…ç¼“å­˜ (Attached Scrap)
â”‚ â””â”€â”€ å­˜æ”¾å½“å‰å¯è§çš„ViewHolderï¼ˆå¿«é€Ÿå¤ç”¨ï¼‰
â”œâ”€â”€ 2. å±å¹•å¤–ç¼“å­˜ (Cache)
â”‚ â””â”€â”€ ä¿å­˜æœ€è¿‘ç¦»å¼€å±å¹•çš„ViewHolderï¼ˆé»˜è®¤å®¹é‡=2ï¼‰
â”œâ”€â”€ 3. æ‰©å±•ç¼“å­˜ (ViewCacheExtension)
â”‚ â””â”€â”€ å¼€å‘è€…è‡ªå®šä¹‰ç¼“å­˜ï¼ˆç‰¹æ®Šç”¨é€”ï¼‰
â””â”€â”€ 4. å›æ”¶æ±  (RecycledViewPool)
â””â”€â”€ å…¨å±€å…±äº«çš„ViewHolderå­˜å‚¨ï¼ˆä¸åŒç±»å‹ç‹¬ç«‹ç¼“å­˜ï¼‰
&lt;/code>&lt;/pre>&lt;p>æ ¹æ®&lt;code>position&lt;/code>åˆ¤æ–­æ˜¯å¦å‘½ä¸­&lt;code>Cache&lt;/code>ï¼Œæ ¹æ®&lt;code>viewType&lt;/code>åˆ¤æ–­æ˜¯å¦å‘½ä¸­&lt;code>RecyclerViewPool&lt;/code>ï¼Œä¼šæ‰§è¡Œ&lt;code>onBindViewHolder&lt;/code>&lt;/p>
&lt;p>åœ¨ &lt;strong>RecyclerView&lt;/strong> çš„å›æ”¶å¤ç”¨æœºåˆ¶ä¸­ï¼Œ&lt;code>changedScrap&lt;/code> å’Œ &lt;code>attachedScrap&lt;/code> æ˜¯ä¸¤ä¸ªå…³é”®ä¸´æ—¶ç¼“å­˜ï¼Œè€Œ &lt;strong>Stable IDs&lt;/strong> ä¼šæ”¹å˜ ViewHolder è·å–çš„æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šï¼š&lt;/p>
&lt;hr>
&lt;h3 id="1">&lt;strong>1. &lt;code>changedScrap&lt;/code> çš„ä½œç”¨&lt;/strong>
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>ç”¨é€”&lt;/strong>ï¼šä¸“é—¨é…åˆ &lt;code>notifyItemChanged()&lt;/code> æˆ– &lt;code>notifyDataSetChanged()&lt;/code> ä½¿ç”¨ã€‚&lt;/li>
&lt;li>&lt;strong>å·¥ä½œæœºåˆ¶&lt;/strong>ï¼š
&lt;ul>
&lt;li>å½“è°ƒç”¨ &lt;code>notifyItemChanged(position)&lt;/code> æ—¶ï¼Œè¢«æ ‡è®°æ›´æ–°çš„ item ä¼šè¢«ä¸´æ—¶ç§»åˆ° &lt;code>changedScrap&lt;/code> ä¸­ã€‚&lt;/li>
&lt;li>åœ¨å¸ƒå±€é˜¶æ®µï¼ˆå¦‚ &lt;code>onLayout&lt;/code>ï¼‰ï¼Œè¿™äº› ViewHolder ä¼šè¢«é‡æ–°ç»‘å®šæ•°æ®ï¼ˆè°ƒç”¨ &lt;code>onBindViewHolder()&lt;/code>ï¼‰ï¼Œç„¶åæ”¾å›åŸä½ç½®ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ç›®çš„&lt;/strong>ï¼šæ”¯æŒå±€éƒ¨æ›´æ–°åŠ¨ç”»ï¼ˆå¦‚æ·¡å…¥æ·¡å‡ºï¼‰ï¼Œé¿å…ç›´æ¥å›æ”¶å¯¼è‡´è§†è§‰ä¸­æ–­ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="2">&lt;strong>2. &lt;code>attachedScrap&lt;/code> çš„ä½œç”¨&lt;/strong>
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>ç”¨é€”&lt;/strong>ï¼šç”¨äº &lt;strong>å¿«é€Ÿå¤ç”¨å¯è§æˆ–å³å°†å¯è§çš„ ViewHolder&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>å·¥ä½œæœºåˆ¶&lt;/strong>ï¼š
&lt;ul>
&lt;li>åœ¨å¸ƒå±€è¿‡ç¨‹ä¸­ï¼ˆå¦‚ &lt;code>LinearLayoutManager.fill()&lt;/code>ï¼‰ï¼ŒRecyclerView ä¼šå…ˆå°†å½“å‰å±å¹•ä¸Šçš„ ViewHolder &lt;strong>ä¸´æ—¶ç§»é™¤&lt;/strong> åˆ° &lt;code>attachedScrap&lt;/code>ã€‚&lt;/li>
&lt;li>éå†æ–°å¸ƒå±€æ—¶ï¼Œç›´æ¥ä» &lt;code>attachedScrap&lt;/code> ä¸­æŒ‰ &lt;strong>position åŒ¹é…&lt;/strong> å–å› ViewHolderï¼ˆæ— éœ€åˆ›å»ºæˆ–ç»‘å®šï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ç›®çš„&lt;/strong>ï¼šé¿å…æ— æ•ˆçš„åˆ›å»º/ç»‘å®šï¼Œæå‡æ»šåŠ¨æ€§èƒ½ï¼ˆå°¤å…¶åœ¨å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="3-stable-ids-å¦‚ä½•æ”¹å˜-viewholder-è·å–æ–¹å¼">&lt;strong>3. Stable IDs å¦‚ä½•æ”¹å˜ ViewHolder è·å–æ–¹å¼&lt;/strong>
&lt;/h3>&lt;p>å½“å¯ç”¨ &lt;strong>Stable IDs&lt;/strong>ï¼ˆé€šè¿‡ &lt;code>setHasStableIds(true)&lt;/code> + é‡å†™ &lt;code>getItemId()&lt;/code>ï¼‰æ—¶ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>ä¼ ç»Ÿæ–¹å¼ï¼ˆæ—  Stable IDsï¼‰&lt;/strong>ï¼š&lt;br>
RecyclerView é€šè¿‡ &lt;strong>position&lt;/strong> åœ¨ &lt;code>attachedScrap&lt;/code> æˆ– &lt;code>changedScrap&lt;/code> ä¸­æŸ¥æ‰¾åŒ¹é…çš„ ViewHolderã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¼ªä»£ç ï¼šæŒ‰ position åŒ¹é…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ViewHolder vh &lt;span style="color:#f92672">=&lt;/span> attachedScrap.&lt;span style="color:#a6e22e">findViewForPosition&lt;/span>(position);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¯ç”¨ Stable IDs å&lt;/strong>ï¼š&lt;br>
RecyclerView æ”¹ä¸ºé€šè¿‡ &lt;strong>item ID&lt;/strong>ï¼ˆè€Œé positionï¼‰åœ¨ &lt;code>scrap&lt;/code> ä¸­æŸ¥æ‰¾ ViewHolderï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¼ªä»£ç ï¼šæŒ‰ stable ID åŒ¹é…&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ViewHolder vh &lt;span style="color:#f92672">=&lt;/span> changedScrap.&lt;span style="color:#a6e22e">findViewHolderByItemId&lt;/span>(id);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="ä¼˜åŠ¿">&lt;strong>ä¼˜åŠ¿&lt;/strong>
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>ä½ç½®æ— å…³å¤ç”¨&lt;/strong>ï¼š
&lt;ul>
&lt;li>å³ä½¿æ•°æ®é›†å˜åŒ–å¯¼è‡´ item ä½ç½®æ”¹å˜ï¼ˆå¦‚æ’å…¥/åˆ é™¤ï¼‰ï¼Œä»èƒ½é€šè¿‡å”¯ä¸€ ID æ­£ç¡®å¤ç”¨ ViewHolderã€‚&lt;/li>
&lt;li>é¿å…å›  position å˜åŒ–å¯¼è‡´çš„ â€œå¤ç”¨é”™ä¹±â€ é—®é¢˜ï¼ˆå¦‚ A ä½ç½®å¤ç”¨åˆ° B æ•°æ®ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>åŠ¨ç”»å…¼å®¹æ€§&lt;/strong>ï¼š
&lt;ul>
&lt;li>æ”¯æŒæ›´æµç•…çš„åŠ¨ç”»ï¼ˆå¦‚ &lt;code>DiffUtil&lt;/code>ï¼‰ï¼Œå› ä¸º ID æ˜¯æ•°æ®é¡¹çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸å—å¸ƒå±€é¡ºåºå½±å“ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>æ•ˆç‡æå‡&lt;/strong>ï¼š
&lt;ul>
&lt;li>æŸ¥æ‰¾æ“ä½œä» O(N) ä¼˜åŒ–åˆ° O(1)ï¼ˆåŸºäº &lt;code>LongSparseArray&lt;/code> å®ç°ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="å…³é”®å¯¹æ¯”æ€»ç»“">&lt;strong>å…³é”®å¯¹æ¯”æ€»ç»“&lt;/strong>
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>ç‰¹æ€§&lt;/strong>&lt;/th>
&lt;th>&lt;code>changedScrap&lt;/code>&lt;/th>
&lt;th>&lt;code>attachedScrap&lt;/code>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>è§¦å‘åœºæ™¯&lt;/strong>&lt;/td>
&lt;td>&lt;code>notifyItemChanged()&lt;/code> è°ƒç”¨æ—¶&lt;/td>
&lt;td>å¸ƒå±€è¿‡ç¨‹ä¸­ä¸´æ—¶ç§»é™¤å¯è§ ViewHolder&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>æ•°æ®çŠ¶æ€&lt;/strong>&lt;/td>
&lt;td>éœ€é‡æ–°ç»‘å®šï¼ˆ&lt;code>onBindViewHolder&lt;/code>ï¼‰&lt;/td>
&lt;td>æ•°æ®æœªå˜ï¼Œç›´æ¥å¤ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>å­˜å‚¨å†…å®¹&lt;/strong>&lt;/td>
&lt;td>è¢«æ ‡è®°æ›´æ–°çš„ ViewHolder&lt;/td>
&lt;td>å½“å‰/å³å°†å¯è§çš„ ViewHolder&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>æŸ¥æ‰¾æ–¹å¼ï¼ˆæ—  IDï¼‰&lt;/strong>&lt;/td>
&lt;td>æŒ‰ &lt;code>position&lt;/code> åŒ¹é…&lt;/td>
&lt;td>æŒ‰ &lt;code>position&lt;/code> åŒ¹é…&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>æŸ¥æ‰¾æ–¹å¼ï¼ˆæœ‰ IDï¼‰&lt;/strong>&lt;/td>
&lt;td>æŒ‰ &lt;code>stableId&lt;/code> åŒ¹é…&lt;/td>
&lt;td>æŒ‰ &lt;code>stableId&lt;/code> åŒ¹é…&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;blockquote>
&lt;p>&lt;strong>ä½¿ç”¨å»ºè®®&lt;/strong>ï¼š&lt;br>
è‹¥æ•°æ®é›†å­˜åœ¨åŠ¨æ€ä½ç½®å˜åŒ–ï¼ˆå¦‚æ’åºã€å¢åˆ ï¼‰ï¼Œå¼ºçƒˆå»ºè®®å¯ç”¨ &lt;strong>Stable IDs&lt;/strong>ï¼Œä»¥æå‡å¤ç”¨å‡†ç¡®æ€§å’ŒåŠ¨ç”»æ•ˆæœã€‚&lt;/p>&lt;/blockquote></description></item><item><title>Hugo Vercelåšå®¢é…ç½®</title><link>https://www.dust-zed.site/tutorials/hugo-vercel%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/</link><pubDate>Wed, 11 Jun 2025 12:20:50 +0800</pubDate><guid>https://www.dust-zed.site/tutorials/hugo-vercel%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/</guid><description>&lt;h4 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>å®‰è£… Hugo&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># macOS (Homebrew)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>brew install hugo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>æ³¨å†ŒVercelè´¦å·&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="åˆ›å»ºæœ¬åœ°åšå®¢">åˆ›å»ºæœ¬åœ°åšå®¢
&lt;/h4>&lt;h5 id="11-ç”Ÿæˆæ–°ç«™ç‚¹">1.1 ç”Ÿæˆæ–°ç«™ç‚¹
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>hugo new site myblog
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd myblog
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="12-æ·»åŠ ä¸»é¢˜">1.2 æ·»åŠ ä¸»é¢˜
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#34;theme = &amp;#39;ananke&amp;#39;&amp;#34;&lt;/span> &amp;gt;&amp;gt; config.toml &lt;span style="color:#75715e"># é…ç½®ä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="è‡ªå®šä¹‰åŸŸå">è‡ªå®šä¹‰åŸŸå
&lt;/h4>&lt;ol>
&lt;li>åœ¨Vercelæ§åˆ¶æ§åˆ¶å° -&amp;gt; &lt;strong>Settings&lt;/strong> -&amp;gt; &lt;strong>Domains&lt;/strong>&lt;/li>
&lt;li>è¾“å…¥è‡ªå·±çš„åŸŸå(&lt;code>dust-zed.site&lt;/code>,å¯åœ¨é˜¿é‡Œäº‘è´­ä¹°)&lt;/li>
&lt;li>æŒ‰æç¤ºé…ç½®DNSè§£æ&lt;/li>
&lt;/ol>
&lt;h4 id="ç®¡ç†ä¸åŒç±»å‹çš„æ–‡ç« ">ç®¡ç†ä¸åŒç±»å‹çš„æ–‡ç« 
&lt;/h4>&lt;h5 id="31-ä½¿ç”¨ç‰©ç†ç›®å½•åˆ†ç±»">3.1 ä½¿ç”¨ç‰©ç†ç›®å½•åˆ†ç±»
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>content/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”œâ”€â”€ blog/ &lt;span style="color:#75715e"># å¸¸è§„åšå®¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”œâ”€â”€ tutorials/ &lt;span style="color:#75715e"># æ•™ç¨‹ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”œâ”€â”€ reviews/ &lt;span style="color:#75715e"># äº§å“è¯„æµ‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â””â”€â”€ notes/ &lt;span style="color:#75715e"># å­¦ä¹ ç¬”è®°&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="32-åˆ›å»ºå¯¹åº”ç±»å‹æ–‡ç« ">3.2 åˆ›å»ºå¯¹åº”ç±»å‹æ–‡ç« 
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>hugo new tutorials/hugo-vercelåšå®¢é…ç½®.md
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="33-ç»Ÿä¸€é…ç½®æ–‡ä»¶">3.3 ç»Ÿä¸€é…ç½®æ–‡ä»¶
&lt;/h5>&lt;p>åœ¨&lt;code>config.toml&lt;/code>ä¸­é›†ä¸­ç®¡ç†URLè§„åˆ™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æ‰€æœ‰æ–‡ç« é»˜è®¤è·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># :slugåŠ¨æ€ä»£è¡¨å†…å®¹çš„URLå‹å¥½ç‰ˆæœ¬æ ‡é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#a6e22e">permalinks&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">posts&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;/blog/:year/:month/:slug/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tutorials&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;/learn/:slug/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">reviews&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;/products/:category/:slug/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆ†ç±»é¡µé¢è·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#a6e22e">taxonomies&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">category&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;categories&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tag&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;tags&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="35-å¤šçº§ç›®å½•">3.5 å¤šçº§ç›®å½•
&lt;/h5>&lt;p>ä½¿ç”¨çš„æ˜¯&lt;code>hugo-theme-stack&lt;/code>ä¸»é¢˜ï¼Œæ”¯æŒå¤šçº§ç›®å½•ï¼Œéœ€è¦é€šè¿‡é…ç½®å’Œå†…å®¹ç»„ç»‡æ¥å®ç°ã€‚&lt;/p>
&lt;p>&lt;strong>å†…å®¹ç»„ç»‡&lt;/strong>&lt;/p>
&lt;p>æŒ‰å±‚çº§ç»„ç»‡å†…å®¹æ–‡ä»¶å¤¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">content&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> &lt;span style="color:#a6e22e">rust&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">/&lt;/span> &lt;span style="color:#75715e"># ä¸€çº§ç›®å½•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> &lt;span style="color:#a6e22e">ripgrep&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">/&lt;/span> &lt;span style="color:#75715e"># äºŒçº§ç›®å½•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">/&lt;/span> &lt;span style="color:#75715e"># ä¸‰çº§ç›®å½•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> &lt;span style="color:#a6e22e">post1&lt;/span>.&lt;span style="color:#a6e22e">md&lt;/span> &lt;span style="color:#75715e"># æ–‡ç« &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> &lt;span style="color:#a6e22e">post2&lt;/span>.&lt;span style="color:#a6e22e">md&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> &lt;span style="color:#a6e22e">other&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">/&lt;/span> &lt;span style="color:#75715e"># äºŒçº§ç›®å½•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> &lt;span style="color:#a6e22e">post3&lt;/span>.&lt;span style="color:#a6e22e">md&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åéœ€è¦åœ¨æ–‡ç« çš„frontmatterä¸­æŒ‡å®šåˆ†ç±»å±‚çº§ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">categories&lt;/span> = [&lt;span style="color:#e6db74">&amp;#34;rust&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;ripgrep&amp;#34;&lt;/span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>é…ç½®å¯¼èˆªèœå•&lt;/strong>&lt;/p>
&lt;p>ä¿®æ”¹config.tomlé…ç½®æ–‡ä»¶ï¼Œé€šè¿‡[[menu.main]]å®šä¹‰éœ€è¦å¤šçº§èœå•çš„ç›®å½•:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>[[&lt;span style="color:#a6e22e">menu&lt;/span>.&lt;span style="color:#a6e22e">main&lt;/span>]]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">name&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;rust&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">url&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;/rust&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">weight&lt;/span> = &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [[&lt;span style="color:#a6e22e">menu&lt;/span>.&lt;span style="color:#a6e22e">main&lt;/span>.&lt;span style="color:#a6e22e">children&lt;/span>]] &lt;span style="color:#75715e"># æ³¨æ„ç¼©è¿›&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">name&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;ripgrep&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">url&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;/rust/ripgrep&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">weight&lt;/span> = &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ·»åŠ ç´¢å¼•æ–‡ä»¶&lt;/strong>&lt;/p>
&lt;p>äºŒçº§èœå•é€šå¸¸éœ€è¦å¯¹åº”å®é™…å†…å®¹ç›®å½•ï¼Œå¦åˆ™å¯èƒ½è¢«ä¸»é¢˜éšè—ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨&lt;code>content&lt;/code>ç›®å½•ä¸‹åˆ›å»ºåŒ¹é…çš„æ–‡ä»¶å¤¹ç»“æ„ï¼Œå¹¶æ·»åŠ ç´¢å¼•æ–‡ä»¶&lt;code>_index.md&lt;/code>&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>content/
â””â”€â”€ rust/
â”œâ”€â”€ _index.md # ä¸€çº§ç›®å½•ç´¢å¼•é¡µ
â””â”€â”€ ripgrep/
â””â”€â”€ _index.md # äºŒçº§ç›®å½•ç´¢å¼•é¡µ
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>åœ¨ &lt;code>_index.md&lt;/code> ä¸­æ·»åŠ åŸºæœ¬å†…å®¹ï¼ˆfrontmatter å³å¯ï¼‰ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># content/rust/_index.md&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">+++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">title&lt;/span> = &lt;span style="color:#e6db74">&amp;#34;Rust ç›¸å…³å†…å®¹&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">+++&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å‡çº§ç»´æŠ¤">å‡çº§ç»´æŠ¤
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>æ›´æ–°ä¸»é¢˜ï¼š&lt;code>git submodule update --remote --merge&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœ¬åœ°æµ‹è¯•ï¼š&lt;code>hugo server -D&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¼ºåˆ¶æ¸…é™¤ç¼“å­˜ï¼š&lt;code>hugo --gc -minify --cleanDestiantionDir&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨&lt;code>hugo new --kind tutorial tutorials/new-tutorial.md&lt;/code>åˆ›å»ºé¢„è®¾æ ¼å¼çš„æ–‡ç« &lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸ºä¸åŒç›®å½•è®¾ç½®ç‹¬ç«‹çš„å‰è¨€å‚æ•°(archetypes)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>archetypes/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â”œâ”€â”€ tutorials.md &lt;span style="color:#75715e"># åšå®¢æ•™ç¨‹æ¨¡æ¿&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul></description></item></channel></rss>
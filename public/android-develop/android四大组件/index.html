<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Activity ç”Ÿå‘½å‘¨æœŸ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Activity â”‚ â”‚ Created â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†“ onCreate() â† åˆ›å»ºï¼Œåˆå§‹åŒ–å˜é‡ã€åŠ è½½å¸ƒå±€ â†“ onStart() â† å¯è§ä½†ä¸å¯äº¤äº’ â†“ onResume() â† å¯è§ä¸”å¯äº¤äº’ï¼ˆå‰å°ï¼‰ â†“ [è¿è¡Œä¸­] â†“ onPause() â† éƒ¨åˆ†å¯è§ï¼ˆè¢«é®æŒ¡ï¼Œå¦‚å¯¹è¯æ¡†ï¼‰ â†“ onStop() â† å®Œå…¨ä¸å¯è§ï¼ˆåˆ‡åˆ°åå°ï¼‰ â†“ onDestroy() â† é”€æ¯ï¼Œé‡Šæ”¾èµ„æº â†“ [ç»“æŸ] çŠ¶æ€ä¿å­˜ä¸æ¢å¤ ä¸ºä»€ä¹ˆéœ€è¦ä¿å­˜çŠ¶æ€ï¼Ÿ ç”¨æˆ·æ­£åœ¨å¡«å†™è¡¨å• â†“ çªç„¶æ¥ç”µè¯ â†’ Activity è¢«é”€æ¯ â†“ ç”µè¯ç»“æŸè¿”å› â†’ Activity é‡æ–°åˆ›å»º â†“ è¡¨å•å†…å®¹ä¸¢å¤±äº†ï¼âŒ ä¿å­˜çŠ¶æ€ class FormActivity : AppCompatActivity() { private var userName: String = "" private var age: Int = 0 // ä¿å­˜çŠ¶æ€ï¼ˆç³»ç»Ÿæ€æ­» Activity å‰è°ƒç”¨ï¼‰ override fun onSaveInstanceState(outState: Bundle) { super.onSaveInstanceState(outState) outState.putString("userName", userName) outState.putInt("age", age) Log.d("State", "çŠ¶æ€å·²ä¿å­˜") } // æ¢å¤çŠ¶æ€ override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContentView(R.layout.activity_form) // æ–¹å¼ 1: åœ¨ onCreate ä¸­æ¢å¤ if (savedInstanceState != null) { userName = savedInstanceState.getString("userName", "") age = savedInstanceState.getInt("age", 0) Log.d("State", "çŠ¶æ€å·²æ¢å¤: $userName, $age") } } // æ–¹å¼ 2: åœ¨ onRestoreInstanceState ä¸­æ¢å¤ override fun onRestoreInstanceState(savedInstanceState: Bundle) { super.onRestoreInstanceState(savedInstanceState) userName = savedInstanceState.getString("userName", "") age = savedInstanceState.getInt("age", 0) } } å¯åŠ¨æ¨¡å¼ 4ç§å¯åŠ¨æ¨¡å¼ <!-- AndroidManifest.xml --> <activity android:name=".MainActivity" android:launchMode="standard" /> 1. standard æ¯æ¬¡å¯åŠ¨éƒ½åˆ›å»ºæ–°å®ä¾‹ MainActivity â†’ MainActivity â†’ MainActivity â†‘ â†‘ â†‘ å®ä¾‹ 1 å®ä¾‹ 2 å®ä¾‹ 3 è¿”å›æ ˆ: [å®ä¾‹3, å®ä¾‹2, å®ä¾‹1] 2. singleTop å¦‚æœåœ¨æ ˆé¡¶ï¼Œå¤ç”¨ï¼›å¦åˆ™åˆ›å»ºæ–°å®ä¾‹ åœºæ™¯ 1: MainActivity åœ¨æ ˆé¡¶ MainActivity (æ ˆé¡¶) â†’ å¯åŠ¨ MainActivity â†“ è°ƒç”¨ onNewIntent() å¤ç”¨ï¼Œä¸åˆ›å»ºæ–°å®ä¾‹ åœºæ™¯ 2: MainActivity ä¸åœ¨æ ˆé¡¶ MainActivity â†’ DetailActivity â†’ å¯åŠ¨ MainActivity â†“ åˆ›å»ºæ–°å®ä¾‹: [MainActivity(æ–°), DetailActivity, MainActivity(æ—§)] ç”¨é€”ï¼šé€šçŸ¥æ ç‚¹å‡»ã€æœç´¢ç»“æœé¡µ\n'><title>Androidå››å¤§ç»„ä»¶</title><link rel=canonical href=https://www.dust-zed.site/android-develop/android%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="Androidå››å¤§ç»„ä»¶"><meta property='og:description' content='Activity ç”Ÿå‘½å‘¨æœŸ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Activity â”‚ â”‚ Created â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†“ onCreate() â† åˆ›å»ºï¼Œåˆå§‹åŒ–å˜é‡ã€åŠ è½½å¸ƒå±€ â†“ onStart() â† å¯è§ä½†ä¸å¯äº¤äº’ â†“ onResume() â† å¯è§ä¸”å¯äº¤äº’ï¼ˆå‰å°ï¼‰ â†“ [è¿è¡Œä¸­] â†“ onPause() â† éƒ¨åˆ†å¯è§ï¼ˆè¢«é®æŒ¡ï¼Œå¦‚å¯¹è¯æ¡†ï¼‰ â†“ onStop() â† å®Œå…¨ä¸å¯è§ï¼ˆåˆ‡åˆ°åå°ï¼‰ â†“ onDestroy() â† é”€æ¯ï¼Œé‡Šæ”¾èµ„æº â†“ [ç»“æŸ] çŠ¶æ€ä¿å­˜ä¸æ¢å¤ ä¸ºä»€ä¹ˆéœ€è¦ä¿å­˜çŠ¶æ€ï¼Ÿ ç”¨æˆ·æ­£åœ¨å¡«å†™è¡¨å• â†“ çªç„¶æ¥ç”µè¯ â†’ Activity è¢«é”€æ¯ â†“ ç”µè¯ç»“æŸè¿”å› â†’ Activity é‡æ–°åˆ›å»º â†“ è¡¨å•å†…å®¹ä¸¢å¤±äº†ï¼âŒ ä¿å­˜çŠ¶æ€ class FormActivity : AppCompatActivity() { private var userName: String = "" private var age: Int = 0 // ä¿å­˜çŠ¶æ€ï¼ˆç³»ç»Ÿæ€æ­» Activity å‰è°ƒç”¨ï¼‰ override fun onSaveInstanceState(outState: Bundle) { super.onSaveInstanceState(outState) outState.putString("userName", userName) outState.putInt("age", age) Log.d("State", "çŠ¶æ€å·²ä¿å­˜") } // æ¢å¤çŠ¶æ€ override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContentView(R.layout.activity_form) // æ–¹å¼ 1: åœ¨ onCreate ä¸­æ¢å¤ if (savedInstanceState != null) { userName = savedInstanceState.getString("userName", "") age = savedInstanceState.getInt("age", 0) Log.d("State", "çŠ¶æ€å·²æ¢å¤: $userName, $age") } } // æ–¹å¼ 2: åœ¨ onRestoreInstanceState ä¸­æ¢å¤ override fun onRestoreInstanceState(savedInstanceState: Bundle) { super.onRestoreInstanceState(savedInstanceState) userName = savedInstanceState.getString("userName", "") age = savedInstanceState.getInt("age", 0) } } å¯åŠ¨æ¨¡å¼ 4ç§å¯åŠ¨æ¨¡å¼ <!-- AndroidManifest.xml --> <activity android:name=".MainActivity" android:launchMode="standard" /> 1. standard æ¯æ¬¡å¯åŠ¨éƒ½åˆ›å»ºæ–°å®ä¾‹ MainActivity â†’ MainActivity â†’ MainActivity â†‘ â†‘ â†‘ å®ä¾‹ 1 å®ä¾‹ 2 å®ä¾‹ 3 è¿”å›æ ˆ: [å®ä¾‹3, å®ä¾‹2, å®ä¾‹1] 2. singleTop å¦‚æœåœ¨æ ˆé¡¶ï¼Œå¤ç”¨ï¼›å¦åˆ™åˆ›å»ºæ–°å®ä¾‹ åœºæ™¯ 1: MainActivity åœ¨æ ˆé¡¶ MainActivity (æ ˆé¡¶) â†’ å¯åŠ¨ MainActivity â†“ è°ƒç”¨ onNewIntent() å¤ç”¨ï¼Œä¸åˆ›å»ºæ–°å®ä¾‹ åœºæ™¯ 2: MainActivity ä¸åœ¨æ ˆé¡¶ MainActivity â†’ DetailActivity â†’ å¯åŠ¨ MainActivity â†“ åˆ›å»ºæ–°å®ä¾‹: [MainActivity(æ–°), DetailActivity, MainActivity(æ—§)] ç”¨é€”ï¼šé€šçŸ¥æ ç‚¹å‡»ã€æœç´¢ç»“æœé¡µ\n'><meta property='og:url' content='https://www.dust-zed.site/android-develop/android%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/'><meta property='og:site_name' content='zedçš„åšå®¢'><meta property='og:type' content='article'><meta property='article:section' content='Android-Develop'><meta property='article:published_time' content='2025-10-21T00:05:46+08:00'><meta property='article:modified_time' content='2025-10-21T00:05:46+08:00'><meta name=twitter:title content="Androidå››å¤§ç»„ä»¶"><meta name=twitter:description content='Activity ç”Ÿå‘½å‘¨æœŸ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Activity â”‚ â”‚ Created â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†“ onCreate() â† åˆ›å»ºï¼Œåˆå§‹åŒ–å˜é‡ã€åŠ è½½å¸ƒå±€ â†“ onStart() â† å¯è§ä½†ä¸å¯äº¤äº’ â†“ onResume() â† å¯è§ä¸”å¯äº¤äº’ï¼ˆå‰å°ï¼‰ â†“ [è¿è¡Œä¸­] â†“ onPause() â† éƒ¨åˆ†å¯è§ï¼ˆè¢«é®æŒ¡ï¼Œå¦‚å¯¹è¯æ¡†ï¼‰ â†“ onStop() â† å®Œå…¨ä¸å¯è§ï¼ˆåˆ‡åˆ°åå°ï¼‰ â†“ onDestroy() â† é”€æ¯ï¼Œé‡Šæ”¾èµ„æº â†“ [ç»“æŸ] çŠ¶æ€ä¿å­˜ä¸æ¢å¤ ä¸ºä»€ä¹ˆéœ€è¦ä¿å­˜çŠ¶æ€ï¼Ÿ ç”¨æˆ·æ­£åœ¨å¡«å†™è¡¨å• â†“ çªç„¶æ¥ç”µè¯ â†’ Activity è¢«é”€æ¯ â†“ ç”µè¯ç»“æŸè¿”å› â†’ Activity é‡æ–°åˆ›å»º â†“ è¡¨å•å†…å®¹ä¸¢å¤±äº†ï¼âŒ ä¿å­˜çŠ¶æ€ class FormActivity : AppCompatActivity() { private var userName: String = "" private var age: Int = 0 // ä¿å­˜çŠ¶æ€ï¼ˆç³»ç»Ÿæ€æ­» Activity å‰è°ƒç”¨ï¼‰ override fun onSaveInstanceState(outState: Bundle) { super.onSaveInstanceState(outState) outState.putString("userName", userName) outState.putInt("age", age) Log.d("State", "çŠ¶æ€å·²ä¿å­˜") } // æ¢å¤çŠ¶æ€ override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContentView(R.layout.activity_form) // æ–¹å¼ 1: åœ¨ onCreate ä¸­æ¢å¤ if (savedInstanceState != null) { userName = savedInstanceState.getString("userName", "") age = savedInstanceState.getInt("age", 0) Log.d("State", "çŠ¶æ€å·²æ¢å¤: $userName, $age") } } // æ–¹å¼ 2: åœ¨ onRestoreInstanceState ä¸­æ¢å¤ override fun onRestoreInstanceState(savedInstanceState: Bundle) { super.onRestoreInstanceState(savedInstanceState) userName = savedInstanceState.getString("userName", "") age = savedInstanceState.getInt("age", 0) } } å¯åŠ¨æ¨¡å¼ 4ç§å¯åŠ¨æ¨¡å¼ <!-- AndroidManifest.xml --> <activity android:name=".MainActivity" android:launchMode="standard" /> 1. standard æ¯æ¬¡å¯åŠ¨éƒ½åˆ›å»ºæ–°å®ä¾‹ MainActivity â†’ MainActivity â†’ MainActivity â†‘ â†‘ â†‘ å®ä¾‹ 1 å®ä¾‹ 2 å®ä¾‹ 3 è¿”å›æ ˆ: [å®ä¾‹3, å®ä¾‹2, å®ä¾‹1] 2. singleTop å¦‚æœåœ¨æ ˆé¡¶ï¼Œå¤ç”¨ï¼›å¦åˆ™åˆ›å»ºæ–°å®ä¾‹ åœºæ™¯ 1: MainActivity åœ¨æ ˆé¡¶ MainActivity (æ ˆé¡¶) â†’ å¯åŠ¨ MainActivity â†“ è°ƒç”¨ onNewIntent() å¤ç”¨ï¼Œä¸åˆ›å»ºæ–°å®ä¾‹ åœºæ™¯ 2: MainActivity ä¸åœ¨æ ˆé¡¶ MainActivity â†’ DetailActivity â†’ å¯åŠ¨ MainActivity â†“ åˆ›å»ºæ–°å®ä¾‹: [MainActivity(æ–°), DetailActivity, MainActivity(æ—§)] ç”¨é€”ï¼šé€šçŸ¥æ ç‚¹å‡»ã€æœç´¢ç»“æœé¡µ\n'></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column compact"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_f509edb42ecc0ebd.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>zedçš„åšå®¢</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><li><a href=/android-develop><span>android-develop</span></a></li><li><a href=/basic><span>basic</span></a></li><li><a href=/rust><span>rust</span></a></li><li><a href=/learning-reflection/><span>Learning-Reflections</span></a></li><li><a href=/tutorials/><span>Tutorials</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/android-develop/>Android-Develop</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/android-develop/android%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/>Androidå››å¤§ç»„ä»¶</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 21, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 12 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h4 id=activity>Activity</h4><h5 id=ç”Ÿå‘½å‘¨æœŸ>ç”Ÿå‘½å‘¨æœŸ</h5><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Activity    â”‚
â”‚  Created     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
   onCreate()  â† åˆ›å»ºï¼Œåˆå§‹åŒ–å˜é‡ã€åŠ è½½å¸ƒå±€
       â†“
   onStart()   â† å¯è§ä½†ä¸å¯äº¤äº’
       â†“
   onResume()  â† å¯è§ä¸”å¯äº¤äº’ï¼ˆå‰å°ï¼‰
       â†“
   [è¿è¡Œä¸­]
       â†“
   onPause()   â† éƒ¨åˆ†å¯è§ï¼ˆè¢«é®æŒ¡ï¼Œå¦‚å¯¹è¯æ¡†ï¼‰
       â†“
   onStop()    â† å®Œå…¨ä¸å¯è§ï¼ˆåˆ‡åˆ°åå°ï¼‰
       â†“
   onDestroy() â† é”€æ¯ï¼Œé‡Šæ”¾èµ„æº
       â†“
   [ç»“æŸ]
</code></pre><hr><h5 id=çŠ¶æ€ä¿å­˜ä¸æ¢å¤>çŠ¶æ€ä¿å­˜ä¸æ¢å¤</h5><h6 id=ä¸ºä»€ä¹ˆéœ€è¦ä¿å­˜çŠ¶æ€>ä¸ºä»€ä¹ˆéœ€è¦ä¿å­˜çŠ¶æ€ï¼Ÿ</h6><pre tabindex=0><code>ç”¨æˆ·æ­£åœ¨å¡«å†™è¡¨å•
  â†“
çªç„¶æ¥ç”µè¯ â†’ Activity è¢«é”€æ¯
  â†“
ç”µè¯ç»“æŸè¿”å› â†’ Activity é‡æ–°åˆ›å»º
  â†“
è¡¨å•å†…å®¹ä¸¢å¤±äº†ï¼âŒ
</code></pre><h5 id=ä¿å­˜çŠ¶æ€>ä¿å­˜çŠ¶æ€</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FormActivity</span> : AppCompatActivity() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> userName: String = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> age: Int = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¿å­˜çŠ¶æ€ï¼ˆç³»ç»Ÿæ€æ­» Activity å‰è°ƒç”¨ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onSaveInstanceState</span>(outState: Bundle) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onSaveInstanceState(outState)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        outState.putString(<span style=color:#e6db74>&#34;userName&#34;</span>, userName)
</span></span><span style=display:flex><span>        outState.putInt(<span style=color:#e6db74>&#34;age&#34;</span>, age)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;State&#34;</span>, <span style=color:#e6db74>&#34;çŠ¶æ€å·²ä¿å­˜&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¢å¤çŠ¶æ€
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(savedInstanceState: Bundle?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onCreate(savedInstanceState)
</span></span><span style=display:flex><span>        setContentView(<span style=color:#a6e22e>R</span>.layout.activity_form)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ–¹å¼ 1: åœ¨ onCreate ä¸­æ¢å¤
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (savedInstanceState <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>            userName = savedInstanceState.getString(<span style=color:#e6db74>&#34;userName&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>            age = savedInstanceState.getInt(<span style=color:#e6db74>&#34;age&#34;</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;State&#34;</span>, <span style=color:#e6db74>&#34;çŠ¶æ€å·²æ¢å¤: </span><span style=color:#e6db74>$userName</span><span style=color:#e6db74>, </span><span style=color:#e6db74>$age</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ–¹å¼ 2: åœ¨ onRestoreInstanceState ä¸­æ¢å¤
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onRestoreInstanceState</span>(savedInstanceState: Bundle) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onRestoreInstanceState(savedInstanceState)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        userName = savedInstanceState.getString(<span style=color:#e6db74>&#34;userName&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        age = savedInstanceState.getInt(<span style=color:#e6db74>&#34;age&#34;</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h5 id=å¯åŠ¨æ¨¡å¼>å¯åŠ¨æ¨¡å¼</h5><h6 id=4ç§å¯åŠ¨æ¨¡å¼>4ç§å¯åŠ¨æ¨¡å¼</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>&lt;!<span style=color:#f92672>--</span> <span style=color:#a6e22e>AndroidManifest</span>.xml <span style=color:#f92672>--</span>&gt;
</span></span><span style=display:flex><span>&lt;activity
</span></span><span style=display:flex><span>    android:name=<span style=color:#e6db74>&#34;.MainActivity&#34;</span>
</span></span><span style=display:flex><span>    android:launchMode=<span style=color:#e6db74>&#34;standard&#34;</span> /&gt;
</span></span></code></pre></div><h6 id=1-standard>1. standard</h6><pre tabindex=0><code>æ¯æ¬¡å¯åŠ¨éƒ½åˆ›å»ºæ–°å®ä¾‹

MainActivity â†’ MainActivity â†’ MainActivity
    â†‘              â†‘              â†‘
  å®ä¾‹ 1        å®ä¾‹ 2         å®ä¾‹ 3

è¿”å›æ ˆ: [å®ä¾‹3, å®ä¾‹2, å®ä¾‹1]
</code></pre><h6 id=2-singletop>2. singleTop</h6><pre tabindex=0><code>å¦‚æœåœ¨æ ˆé¡¶ï¼Œå¤ç”¨ï¼›å¦åˆ™åˆ›å»ºæ–°å®ä¾‹

åœºæ™¯ 1: MainActivity åœ¨æ ˆé¡¶
MainActivity (æ ˆé¡¶) â†’ å¯åŠ¨ MainActivity
    â†“
è°ƒç”¨ onNewIntent() å¤ç”¨ï¼Œä¸åˆ›å»ºæ–°å®ä¾‹

åœºæ™¯ 2: MainActivity ä¸åœ¨æ ˆé¡¶
MainActivity â†’ DetailActivity â†’ å¯åŠ¨ MainActivity
    â†“
åˆ›å»ºæ–°å®ä¾‹: [MainActivity(æ–°), DetailActivity, MainActivity(æ—§)]
</code></pre><p>ç”¨é€”ï¼šé€šçŸ¥æ ç‚¹å‡»ã€æœç´¢ç»“æœé¡µ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SearchActivity</span> : AppCompatActivity() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(savedInstanceState: Bundle?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onCreate(savedInstanceState)
</span></span><span style=display:flex><span>        handleIntent(intent)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// singleTop æ¨¡å¼ä¸‹ï¼Œå†æ¬¡å¯åŠ¨æ—¶è°ƒç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onNewIntent</span>(intent: Intent) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onNewIntent(intent)
</span></span><span style=display:flex><span>        setIntent(intent)  <span style=color:#75715e>// æ›´æ–° intent
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        handleIntent(intent)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>handleIntent</span>(intent: Intent) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> query = intent.getStringExtra(<span style=color:#e6db74>&#34;query&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æœç´¢...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h6 id=3-singletask>3. singleTask</h6><pre tabindex=0><code>æ•´ä¸ªä»»åŠ¡æ ˆä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹

åœºæ™¯ 1: ä¸å­˜åœ¨
TaskA: [DetailActivity, MainActivity]
å¯åŠ¨ ProfileActivity (singleTask)
  â†“
TaskA: [ProfileActivity, DetailActivity, MainActivity]

åœºæ™¯ 2: å·²å­˜åœ¨
TaskA: [DetailActivity, ProfileActivity, MainActivity]
å¯åŠ¨ ProfileActivity
  â†“
æ¸…é™¤å…¶ä¸Šæ‰€æœ‰ Activityï¼ŒProfileActivity ç§»åˆ°æ ˆé¡¶
TaskA: [ProfileActivity, MainActivity]
DetailActivity è¢«é”€æ¯ï¼
</code></pre><p>ç”¨é€”ï¼šä¸»é¡µã€ç™»å½•é¡µ</p><h6 id=4-singleinstance>4. singleInstance</h6><pre tabindex=0><code>ç‹¬å ä¸€ä¸ªä»»åŠ¡æ ˆï¼Œæ•´ä¸ªç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹

TaskA: [DetailActivity, MainActivity]
å¯åŠ¨ VideoActivity (singleInstance)
  â†“
TaskA: [DetailActivity, MainActivity]
TaskB: [VideoActivity]  â† ç‹¬ç«‹çš„ä»»åŠ¡æ ˆ

ä» VideoActivity å¯åŠ¨å…¶ä»– Activity
  â†“
TaskA: [OtherActivity, DetailActivity, MainActivity]
TaskB: [VideoActivity]  â† ä»ç„¶ç‹¬å 
</code></pre><p>ç”¨é€”ï¼šè§†é¢‘é€šè¯ã€é—¹é’Ÿ</p><hr><h5 id=intent-flags>Intent Flags</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// FLAG_ACTIVITY_NEW_TASK: æ–°ä»»åŠ¡æ ˆ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#66d9ef>this</span>, MainActivity<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>intent.flags = <span style=color:#a6e22e>Intent</span>.FLAG_ACTIVITY_NEW_TASK
</span></span><span style=display:flex><span>startActivity(intent)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// FLAG_ACTIVITY_CLEAR_TOP: æ¸…é™¤å…¶ä¸Šæ‰€æœ‰ Activity
</span></span></span><span style=display:flex><span><span style=color:#75715e>// å¸¸ç”¨äº&#34;è¿”å›ä¸»é¡µ&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#66d9ef>this</span>, MainActivity<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>intent.flags = <span style=color:#a6e22e>Intent</span>.FLAG_ACTIVITY_CLEAR_TOP
</span></span><span style=display:flex><span>startActivity(intent)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// FLAG_ACTIVITY_SINGLE_TOP: ç­‰åŒäº singleTop æ¨¡å¼
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>intent.flags = <span style=color:#a6e22e>Intent</span>.FLAG_ACTIVITY_SINGLE_TOP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ç»„åˆä½¿ç”¨ï¼ˆæ¸…é™¤æ ˆå¹¶å¯åŠ¨ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>intent.flags = <span style=color:#a6e22e>Intent</span>.FLAG_ACTIVITY_NEW_TASK or <span style=color:#a6e22e>Intent</span>.FLAG_ACTIVITY_CLEAR_TASK
</span></span></code></pre></div><hr><h4 id=service>Service</h4><h5 id=ä»€ä¹ˆæ˜¯service>ä»€ä¹ˆæ˜¯Serviceï¼Ÿ</h5><p>Service = åœ¨åå°æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œæ“ä½œçš„ç»„ä»¶ï¼Œæ²¡æœ‰ç”¨æˆ·ç•Œé¢</p><pre tabindex=0><code>å‰å° Activity: ç”¨æˆ·æ­£åœ¨æµè§ˆå•†å“
åå° Service: åŒæ—¶ä¸‹è½½æ–‡ä»¶ã€æ’­æ”¾éŸ³ä¹ã€åŒæ­¥æ•°æ®
</code></pre><hr><h5 id=serviceçš„ä¸‰ç§ç±»å‹>Serviceçš„ä¸‰ç§ç±»å‹</h5><h6 id=1-å‰å°æœåŠ¡foreground-service>1. å‰å°æœåŠ¡ï¼ˆForeground Serviceï¼‰</h6><p>å¿…é¡»æ˜¾ç¤ºé€šçŸ¥ï¼Œç”¨æˆ·å¯è§</p><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”” é€šçŸ¥æ         â”‚
â”‚ æ­£åœ¨æ’­æ”¾éŸ³ä¹... â”‚ â† å‰å°æœåŠ¡çš„é€šçŸ¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åº”ç”¨ç•Œé¢      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><p>ç”¨é€”ï¼šéŸ³ä¹æ’­æ”¾ã€å¯¼èˆªã€æ–‡ä»¶ä¸‹è½½</p><h6 id=2-åå°æœåŠ¡background-service>2. åå°æœåŠ¡ï¼ˆBackground Serviceï¼‰</h6><p>ç”¨æˆ·ä¸å¯è§ï¼Œä½†ä¼šè¢«ç³»ç»Ÿé™åˆ¶ï¼›Android 8.0+ä¸¥æ ¼é™åˆ¶åå°æœåŠ¡</p><p>ç”¨é€”ï¼šæ•°æ®åŒæ­¥ï¼Œæ—¥å¿—ä¸Šä¼ ï¼ˆä½†æ¨èç”¨WorkManagerï¼‰</p><h6 id=3-ç»‘å®šæœåŠ¡bound-service>3. ç»‘å®šæœåŠ¡ï¼ˆBound Serviceï¼‰</h6><p>ä¸ç»„ä»¶ç»‘å®šï¼Œæä¾›å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¥å£</p><pre tabindex=0><code>Activity â†â”€â”€â”€ç»‘å®šâ”€â”€â”€â†’ Service
   â†“                    â†“
è°ƒç”¨æ–¹æ³•             æä¾›æ–¹æ³•
</code></pre><p>ç”¨é€”ï¼šè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ã€éŸ³ä¹æ’­æ”¾å™¨æ§åˆ¶</p><hr><h4 id=serviceç”Ÿå‘½å‘¨æœŸ>Serviceç”Ÿå‘½å‘¨æœŸ</h4><h5 id=å¯åŠ¨æœåŠ¡started-service>å¯åŠ¨æœåŠ¡ï¼ˆStarted Serviceï¼‰</h5><pre tabindex=0><code>startService()
     â†“
 onCreate()     â† é¦–æ¬¡åˆ›å»ºæ—¶è°ƒç”¨ï¼ˆåªè°ƒç”¨ä¸€æ¬¡ï¼‰
     â†“
onStartCommand() â† æ¯æ¬¡ startService() éƒ½è°ƒç”¨
     â†“
 [è¿è¡Œä¸­]
     â†“
 onDestroy()    â† æœåŠ¡é”€æ¯
</code></pre><h5 id=ç»‘å®šæœåŠ¡bound-service>ç»‘å®šæœåŠ¡ï¼ˆBound Serviceï¼‰</h5><pre tabindex=0><code>bindService()
     â†“
 onCreate()     â† é¦–æ¬¡åˆ›å»ºæ—¶è°ƒç”¨
     â†“
  onBind()      â† è¿”å› IBinder å¯¹è±¡
     â†“
 [ç»‘å®šä¸­]
     â†“
unbindService()
     â†“
 onUnbind()     â† æ‰€æœ‰å®¢æˆ·ç«¯è§£ç»‘åè°ƒç”¨
     â†“
 onDestroy()
</code></pre><h5 id=æ··åˆæ¨¡å¼æ—¢å¯åŠ¨åˆç»‘å®š>æ··åˆæ¨¡å¼ï¼ˆæ—¢å¯åŠ¨åˆç»‘å®šï¼‰</h5><pre tabindex=0><code>startService() + bindService()
     â†“
 onCreate()
     â†“
onStartCommand() + onBind()
     â†“
 [è¿è¡Œå¹¶ç»‘å®š]
     â†“
unbindService() â† è§£ç»‘åä»ç„¶è¿è¡Œ
     â†“
stopService() or stopSelf()
     â†“
 onDestroy()
</code></pre><hr><h4 id=å¯åŠ¨æœåŠ¡started-service-1>å¯åŠ¨æœåŠ¡ï¼ˆStarted Serviceï¼‰</h4><h5 id=åŸºæœ¬å®ç°>åŸºæœ¬å®ç°</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// MyService.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyService</span> : Service() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> TAG = <span style=color:#e6db74>&#34;MyService&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. åˆ›å»ºæ—¶è°ƒç”¨ï¼ˆåªè°ƒç”¨ä¸€æ¬¡ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onCreate()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Log</span>.d(TAG, <span style=color:#e6db74>&#34;Service åˆ›å»º&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. æ¯æ¬¡ startService() éƒ½è°ƒç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onStartCommand</span>(intent: Intent?, flags: Int, startId: Int): Int {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Log</span>.d(TAG, <span style=color:#e6db74>&#34;Service å¯åŠ¨&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// è·å–ä¼ é€’çš„æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> data = intent<span style=color:#f92672>?.</span>getStringExtra(<span style=color:#e6db74>&#34;data&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ‰§è¡Œåå°ä»»åŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        doWork()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// è¿”å›å€¼å†³å®šç³»ç»Ÿæ€æ­»æœåŠ¡åçš„è¡Œä¸º
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> START_STICKY
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. é”€æ¯æ—¶è°ƒç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onDestroy</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onDestroy()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Log</span>.d(TAG, <span style=color:#e6db74>&#34;Service é”€æ¯&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¿…é¡»å®ç°ï¼Œä½†å¯åŠ¨æœåŠ¡ä¸éœ€è¦ç»‘å®š
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onBind</span>(intent: Intent?): IBinder? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>doWork</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// âš ï¸ ä¸è¦åœ¨ä¸»çº¿ç¨‹åšè€—æ—¶æ“ä½œ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Thread {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æ‰§è¡Œåå°ä»»åŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>Thread</span>.sleep(<span style=color:#ae81ff>5000</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Log</span>.d(TAG, <span style=color:#e6db74>&#34;ä»»åŠ¡å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>            stopSelf()  <span style=color:#75715e>// ä»»åŠ¡å®Œæˆååœæ­¢æœåŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        }.start()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=å¯åŠ¨å’Œåœæ­¢æœåŠ¡>å¯åŠ¨å’Œåœæ­¢æœåŠ¡</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// MainActivity.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> : AppCompatActivity() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨æœåŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>startMyService</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#66d9ef>this</span>, MyService<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>        intent.putExtra(<span style=color:#e6db74>&#34;data&#34;</span>, <span style=color:#e6db74>&#34;Hello Service&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Android 8.0+ å¦‚æœæ˜¯å‰å°æœåŠ¡ï¼Œä½¿ç”¨ startForegroundService
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>Build</span>.<span style=color:#a6e22e>VERSION</span>.SDK_INT <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>Build</span>.<span style=color:#a6e22e>VERSION_CODES</span>.O) {
</span></span><span style=display:flex><span>            startForegroundService(intent)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            startService(intent)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åœæ­¢æœåŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>stopMyService</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#66d9ef>this</span>, MyService<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>        stopService(intent)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=onstartcommandè¿”å›å€¼>onStartCommandè¿”å›å€¼</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onStartCommand</span>(intent: Intent?, flags: Int, startId: Int): Int {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>when</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// START_STICKY: ç³»ç»Ÿæ€æ­»åé‡å¯æœåŠ¡ï¼Œä½† intent ä¸º null
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// é€‚ç”¨ï¼šéŸ³ä¹æ’­æ”¾å™¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>true</span> <span style=color:#f92672>-&gt;</span> START_STICKY
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// START_NOT_STICKY: ç³»ç»Ÿæ€æ­»åä¸é‡å¯
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// é€‚ç”¨ï¼šä¸€æ¬¡æ€§ä»»åŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>false</span> <span style=color:#f92672>-&gt;</span> START_NOT_STICKY
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// START_REDELIVER_INTENT: ç³»ç»Ÿæ€æ­»åé‡å¯ï¼Œé‡æ–°ä¼ é€’ intent
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// é€‚ç”¨ï¼šéœ€è¦ä¿è¯ä»»åŠ¡å®Œæˆï¼ˆå¦‚ä¸‹è½½ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> START_REDELIVER_INTENT
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h4 id=å‰å°æœåŠ¡>å‰å°æœåŠ¡</h4><p><strong>Android 8.0+ä¸¥æ ¼é™åˆ¶åå°æœåŠ¡ï¼š</strong></p><ul><li>åº”ç”¨è¿›å…¥åå°å‡ åˆ†é’Ÿåï¼Œç³»ç»Ÿä¼šåœæ­¢åå°æœåŠ¡</li><li>å‰å°æœåŠ¡ä¸ä¼šè¢«é™åˆ¶ï¼Œä½†å¿…é¡»æ˜¾ç¤ºé€šçŸ¥</li></ul><h5 id=å®ç°å‰å°æœåŠ¡>å®ç°å‰å°æœåŠ¡</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MusicService</span> : Service() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> CHANNEL_ID = <span style=color:#e6db74>&#34;music_channel&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> NOTIFICATION_ID = <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onCreate()
</span></span><span style=display:flex><span>        createNotificationChannel()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onStartCommand</span>(intent: Intent?, flags: Int, startId: Int): Int {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// åˆ›å»ºé€šçŸ¥
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> notification = createNotification()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// âš ï¸ å¿…é¡»åœ¨ 5 ç§’å†…è°ƒç”¨ startForegroundï¼Œå¦åˆ™ ANR
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        startForeground(NOTIFICATION_ID, notification)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ’­æ”¾éŸ³ä¹...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        playMusic()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> START_STICKY
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>createNotificationChannel</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>Build</span>.<span style=color:#a6e22e>VERSION</span>.SDK_INT <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>Build</span>.<span style=color:#a6e22e>VERSION_CODES</span>.O) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>val</span> channel = NotificationChannel(
</span></span><span style=display:flex><span>                CHANNEL_ID,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;éŸ³ä¹æ’­æ”¾&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>NotificationManager</span>.IMPORTANCE_LOW
</span></span><span style=display:flex><span>            ).apply {
</span></span><span style=display:flex><span>                description = <span style=color:#e6db74>&#34;éŸ³ä¹æ’­æ”¾æœåŠ¡&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>val</span> manager = getSystemService(NotificationManager<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>            manager.createNotificationChannel(channel)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>createNotification</span>(): Notification {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ç‚¹å‡»é€šçŸ¥æ‰“å¼€ Activity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#66d9ef>this</span>, MainActivity<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> pendingIntent = <span style=color:#a6e22e>PendingIntent</span>.getActivity(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>,
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>            intent,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PendingIntent</span>.FLAG_IMMUTABLE
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>NotificationCompat</span>.Builder(<span style=color:#66d9ef>this</span>, CHANNEL_ID)
</span></span><span style=display:flex><span>            .setContentTitle(<span style=color:#e6db74>&#34;æ­£åœ¨æ’­æ”¾&#34;</span>)
</span></span><span style=display:flex><span>            .setContentText(<span style=color:#e6db74>&#34;æ­Œæ›²åç§° - è‰ºæœ¯å®¶&#34;</span>)
</span></span><span style=display:flex><span>            .setSmallIcon(<span style=color:#a6e22e>R</span>.drawable.ic_music)
</span></span><span style=display:flex><span>            .setContentIntent(pendingIntent)
</span></span><span style=display:flex><span>            .setOngoing(<span style=color:#66d9ef>true</span>)  <span style=color:#75715e>// ä¸å¯æ»‘åŠ¨åˆ é™¤
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            .addAction(<span style=color:#a6e22e>R</span>.drawable.ic_pause, <span style=color:#e6db74>&#34;æš‚åœ&#34;</span>, createPauseIntent())
</span></span><span style=display:flex><span>            .addAction(<span style=color:#a6e22e>R</span>.drawable.ic_next, <span style=color:#e6db74>&#34;ä¸‹ä¸€é¦–&#34;</span>, createNextIntent())
</span></span><span style=display:flex><span>            .build()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>createPauseIntent</span>(): PendingIntent {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#66d9ef>this</span>, MusicService<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java).apply {
</span></span><span style=display:flex><span>            action = <span style=color:#e6db74>&#34;ACTION_PAUSE&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>PendingIntent</span>.getService(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>,
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>            intent,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PendingIntent</span>.FLAG_IMMUTABLE
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>createNextIntent</span>(): PendingIntent {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#66d9ef>this</span>, MusicService<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java).apply {
</span></span><span style=display:flex><span>            action = <span style=color:#e6db74>&#34;ACTION_NEXT&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>PendingIntent</span>.getService(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>,
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>            intent,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PendingIntent</span>.FLAG_IMMUTABLE
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>playMusic</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ’­æ”¾é€»è¾‘...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onBind</span>(intent: Intent?): IBinder? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=å‰å°æœåŠ¡ç±»å‹android-14>å‰å°æœåŠ¡ç±»å‹ï¼ˆAndroid 14+ï¼‰</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- AndroidManifest.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;manifest&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- å£°æ˜å‰å°æœåŠ¡ç±»å‹ --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;uses-permission</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.permission.FOREGROUND_SERVICE&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;uses-permission</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;application&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;service</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;.MusicService&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:foregroundServiceType=</span><span style=color:#e6db74>&#34;mediaPlayback&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/application&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/manifest&gt;</span>
</span></span></code></pre></div><p><strong>å‰å°æœåŠ¡ç±»å‹</strong></p><ul><li><code>camera</code> - ç›¸æœº</li><li><code>connectedDevice</code> - è¿æ¥è®¾å¤‡</li><li><code>dataSync</code> - æ•°æ®åŒæ­¥</li><li><code>location</code> - ä½ç½®</li><li><code>mediaPlayback</code> - åª’ä½“æ’­æ”¾</li><li><code>mediaProjection</code> - å±å¹•å½•åˆ¶</li><li><code>microphone</code> - éº¦å…‹é£</li><li><code>phoneCall</code> - ç”µè¯</li><li><code>remoteMessaging</code> - è¿œç¨‹æ¶ˆæ¯</li><li><code>shortService</code> - çŸ­æ—¶æœåŠ¡</li><li><code>specialUse</code> - ç‰¹æ®Šç”¨é€”</li></ul><hr><h4 id=ç»‘å®šæœåŠ¡>ç»‘å®šæœåŠ¡</h4><h5 id=ä½¿ç”¨åœºæ™¯>ä½¿ç”¨åœºæ™¯</h5><pre tabindex=0><code>Activity éœ€è¦ï¼š
- è°ƒç”¨ Service çš„æ–¹æ³•
- è·å– Service çš„æ•°æ®
- ç›‘å¬ Service çš„çŠ¶æ€

Example: éŸ³ä¹æ’­æ”¾å™¨æ§åˆ¶
Activity: æ’­æ”¾/æš‚åœ/åˆ‡æ­Œ
Service: æ‰§è¡Œå®é™…æ“ä½œ
</code></pre><h5 id=å®ç°ç»‘å®šæœåŠ¡>å®ç°ç»‘å®šæœåŠ¡</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// MusicPlayerService.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MusicPlayerService</span> : Service() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. å®šä¹‰ Binderï¼ˆæœ¬åœ°æœåŠ¡ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>inner</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MusicBinder</span> : Binder() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getService</span>(): MusicPlayerService = <span style=color:#66d9ef>this</span><span style=color:#a6e22e>@MusicPlayerService</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> binder = MusicBinder()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. è¿”å› Binder
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onBind</span>(intent: Intent?): IBinder = binder
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. æä¾›å…¬å…±æ–¹æ³•ä¾›å®¢æˆ·ç«¯è°ƒç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>play</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;Music&#34;</span>, <span style=color:#e6db74>&#34;æ’­æ”¾éŸ³ä¹&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>pause</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;Music&#34;</span>, <span style=color:#e6db74>&#34;æš‚åœéŸ³ä¹&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getCurrentPosition</span>(): Int {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>  <span style=color:#75715e>// è¿”å›å½“å‰æ’­æ”¾ä½ç½®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=ç»‘å®šæœåŠ¡-1>ç»‘å®šæœåŠ¡</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// MainActivity.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> : AppCompatActivity() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> musicService: MusicPlayerService? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> isBound = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. å®šä¹‰ ServiceConnection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> connection = <span style=color:#66d9ef>object</span> <span style=color:#960050;background-color:#1e0010>: </span><span style=color:#a6e22e>ServiceConnection</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onServiceConnected</span>(name: ComponentName?, service: IBinder?) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æœåŠ¡è¿æ¥æˆåŠŸ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>val</span> binder = service <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>MusicPlayerService</span>.MusicBinder
</span></span><span style=display:flex><span>            musicService = binder.getService()
</span></span><span style=display:flex><span>            isBound = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;Bind&#34;</span>, <span style=color:#e6db74>&#34;æœåŠ¡å·²è¿æ¥&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onServiceDisconnected</span>(name: ComponentName?) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æœåŠ¡æ„å¤–æ–­å¼€ï¼ˆå¦‚å´©æºƒï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            musicService = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>            isBound = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;Bind&#34;</span>, <span style=color:#e6db74>&#34;æœåŠ¡å·²æ–­å¼€&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(savedInstanceState: Bundle?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onCreate(savedInstanceState)
</span></span><span style=display:flex><span>        setContentView(<span style=color:#a6e22e>R</span>.layout.activity_main)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 2. ç»‘å®šæœåŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#66d9ef>this</span>, MusicPlayerService<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>        bindService(intent, connection, <span style=color:#a6e22e>Context</span>.BIND_AUTO_CREATE)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. è°ƒç”¨æœåŠ¡æ–¹æ³•
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onPlayClick</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (isBound) {
</span></span><span style=display:flex><span>            musicService<span style=color:#f92672>?.</span>play()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onPauseClick</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (isBound) {
</span></span><span style=display:flex><span>            musicService<span style=color:#f92672>?.</span>pause()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onDestroy</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onDestroy()
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 4. è§£ç»‘æœåŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (isBound) {
</span></span><span style=display:flex><span>            unbindService(connection)
</span></span><span style=display:flex><span>            isBound = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=aidlè·¨è¿›ç¨‹é€šä¿¡>AIDL(è·¨è¿›ç¨‹é€šä¿¡)</h5><p>ç”¨äºä¸åŒåº”ç”¨ä¹‹é—´çš„é€šä¿¡</p><pre tabindex=0><code class=language-aidl data-lang=aidl>// IMusicService.aidl
package com.example.myapp;

interface IMusicService {
    void play();
    void pause();
    int getCurrentPosition();
}
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// MusicPlayerService.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MusicPlayerService</span> : Service() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å®ç° AIDL æ¥å£
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> binder = <span style=color:#66d9ef>object</span> <span style=color:#960050;background-color:#1e0010>: </span><span style=color:#a6e22e>IMusicService</span>.Stub() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>play</span>() {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æ’­æ”¾é€»è¾‘
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>pause</span>() {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æš‚åœé€»è¾‘
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getCurrentPosition</span>(): Int {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onBind</span>(intent: Intent?): IBinder = binder
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// å®¢æˆ·ç«¯ Activity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> : AppCompatActivity() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> musicService: IMusicService? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> connection = <span style=color:#66d9ef>object</span> <span style=color:#960050;background-color:#1e0010>: </span><span style=color:#a6e22e>ServiceConnection</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onServiceConnected</span>(name: ComponentName?, service: IBinder?) {
</span></span><span style=display:flex><span>            musicService = <span style=color:#a6e22e>IMusicService</span>.<span style=color:#a6e22e>Stub</span>.asInterface(service)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onServiceDisconnected</span>(name: ComponentName?) {
</span></span><span style=display:flex><span>            musicService = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onPlayClick</span>() {
</span></span><span style=display:flex><span>        musicService<span style=color:#f92672>?.</span>play()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h4 id=serviceçš„é™åˆ¶android-80>Serviceçš„é™åˆ¶ï¼ˆAndroid 8.0+ï¼‰</h4><h5 id=åå°æ‰§è¡Œé™åˆ¶>åå°æ‰§è¡Œé™åˆ¶</h5><pre tabindex=0><code>åº”ç”¨è¿›å…¥åå°å‡ åˆ†é’Ÿåï¼š
- stopService() åå°æœåŠ¡è¢«åœæ­¢
- WorkManager ç»§ç»­æ‰§è¡Œï¼ˆæ¨èï¼‰
</code></pre><h5 id=è§£å†³æ–¹æ¡ˆ>è§£å†³æ–¹æ¡ˆ</h5><h6 id=1-ä½¿ç”¨å‰å°æœåŠ¡>1. ä½¿ç”¨å‰å°æœåŠ¡</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// éŸ³ä¹æ’­æ”¾ã€å¯¼èˆªã€ä¸‹è½½
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>startForegroundService(intent)
</span></span><span style=display:flex><span>service.startForeground(NOTIFICATION_ID, notification)
</span></span></code></pre></div><h6 id=2-ä½¿ç”¨workmanger>2. ä½¿ç”¨workManger</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// æ•°æ®åŒæ­¥ã€æ—¥å¿—ä¸Šä¼ 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> workRequest = OneTimeWorkRequestBuilder&lt;MyWorker&gt;().build()
</span></span><span style=display:flex><span><span style=color:#a6e22e>WorkManager</span>.getInstance(context).enqueue(workRequest)
</span></span></code></pre></div><hr><h4 id=broadcastreceiver>BroadcastReceiver</h4><p><strong>BroadcastReceiver</strong> = æ¥æ”¶ç³»ç»Ÿæˆ–åº”ç”¨å‘å‡ºçš„å¹¿æ’­æ¶ˆæ¯</p><pre tabindex=0><code>å‘é€è€… (Sender)              æ¥æ”¶è€… (Receiver)
    â†“                            â†“
å‘é€å¹¿æ’­ â†’ [Android System] â†’ BroadcastReceiver
   (Intent)                    (onReceive)
</code></pre><hr><h4 id=å¹¿æ’­çš„ç±»å‹>å¹¿æ’­çš„ç±»å‹</h4><h5 id=1-ç³»ç»Ÿå¹¿æ’­system-broadcast>1. ç³»ç»Ÿå¹¿æ’­ï¼ˆSystem Broadcastï¼‰</h5><p>ç³»ç»Ÿå‘å‡ºçš„å¹¿æ’­</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// å¸¸è§ç³»ç»Ÿå¹¿æ’­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Intent</span>.ACTION_BOOT_COMPLETED    <span style=color:#75715e>// å¼€æœºå®Œæˆ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Intent</span>.ACTION_BATTERY_LOW       <span style=color:#75715e>// ç”µé‡ä½
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Intent</span>.ACTION_POWER_CONNECTED   <span style=color:#75715e>// å……ç”µå™¨è¿æ¥
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Intent</span>.ACTION_SCREEN_ON         <span style=color:#75715e>// å±å¹•å¼€å¯
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Intent</span>.ACTION_SCREEN_OFF        <span style=color:#75715e>// å±å¹•å…³é—­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Intent</span>.ACTION_TIMEZONE_CHANGED  <span style=color:#75715e>// æ—¶åŒºæ”¹å˜
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Intent</span>.ACTION_LOCALE_CHANGED    <span style=color:#75715e>// è¯­è¨€æ”¹å˜
</span></span></span></code></pre></div><h5 id=åº”ç”¨å†…å¹¿æ’­local-broadcast>åº”ç”¨å†…å¹¿æ’­ï¼ˆLocal Broadcastï¼‰</h5><p>åªåœ¨åº”ç”¨å†…ä¼ é€’ï¼Œæ›´å®‰å…¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// ä½¿ç”¨ LocalBroadcastManagerï¼ˆå·²åºŸå¼ƒï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e>// æ¨èä½¿ç”¨ LiveData æˆ–äº‹ä»¶æ€»çº¿
</span></span></span></code></pre></div><h5 id=3-è‡ªå®šä¹‰å¹¿æ’­custom-broadcast>3. è‡ªå®šä¹‰å¹¿æ’­ï¼ˆCustom Broadcastï¼‰</h5><p>åº”ç”¨è‡ªå·±å®šä¹‰çš„å¹¿æ’­</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> ACTION_CUSTOM = <span style=color:#e6db74>&#34;com.example.ACTION_CUSTOM&#34;</span>
</span></span></code></pre></div><hr><h4 id=æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨>æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨</h4><h5 id=æ–¹å¼1-é™æ€æ³¨å†Œmanifest>æ–¹å¼1: é™æ€æ³¨å†Œï¼ˆManifestï¼‰</h5><p>åº”ç”¨æœªè¿è¡Œæ—¶ä¹Ÿèƒ½æ¥æ”¶å¹¿æ’­</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- AndroidManifest.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;manifest&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- éœ€è¦çš„æƒé™ --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;uses-permission</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.permission.RECEIVE_BOOT_COMPLETED&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;application&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- æ³¨å†Œæ¥æ”¶å™¨ --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;receiver</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;.BootReceiver&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:enabled=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:exported=</span><span style=color:#e6db74>&#34;false&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>&lt;!-- å£°æ˜è¦æ¥æ”¶çš„å¹¿æ’­ --&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;intent-filter&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;action</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.intent.action.BOOT_COMPLETED&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/intent-filter&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/receiver&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/application&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/manifest&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// BootReceiver.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BootReceiver</span> : BroadcastReceiver() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onReceive</span>(context: Context, intent: Intent) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>when</span> (intent.action) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Intent</span>.ACTION_BOOT_COMPLETED <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;Boot&#34;</span>, <span style=color:#e6db74>&#34;è®¾å¤‡å¯åŠ¨å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// å¯åŠ¨æœåŠ¡æˆ–æ‰§è¡Œåˆå§‹åŒ–
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>**Android 8.0+**é™åˆ¶ï¼š</p><ul><li>å¤§éƒ¨åˆ†ç³»ç»Ÿå¹¿æ’­ä¸èƒ½é™æ€æ³¨å†Œ</li><li>åªæœ‰å°‘æ•°ä¾‹å¤–ï¼ˆå¦‚<code>BOOT_COMPLETED</code>ã€<code>LOCALE_CHANGED</code>ï¼‰</li></ul><h5 id=æ–¹å¼2åŠ¨æ€æ³¨å†Œ>æ–¹å¼2:åŠ¨æ€æ³¨å†Œ</h5><p>åº”ç”¨è¿è¡Œæ—¶æ³¨å†Œï¼Œæ›´çµæ´»</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> : AppCompatActivity() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. åˆ›å»ºæ¥æ”¶å™¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> batteryReceiver = <span style=color:#66d9ef>object</span> <span style=color:#960050;background-color:#1e0010>: </span><span style=color:#a6e22e>BroadcastReceiver</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onReceive</span>(context: Context, intent: Intent) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>when</span> (intent.action) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Intent</span>.ACTION_BATTERY_LOW <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>Toast</span>.makeText(context, <span style=color:#e6db74>&#34;ç”µé‡ä½&#34;</span>, <span style=color:#a6e22e>Toast</span>.LENGTH_SHORT).show()
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Intent</span>.ACTION_BATTERY_OKAY <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>Toast</span>.makeText(context, <span style=color:#e6db74>&#34;ç”µé‡æ¢å¤&#34;</span>, <span style=color:#a6e22e>Toast</span>.LENGTH_SHORT).show()
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(savedInstanceState: Bundle?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onCreate(savedInstanceState)
</span></span><span style=display:flex><span>        setContentView(<span style=color:#a6e22e>R</span>.layout.activity_main)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 2. æ³¨å†Œæ¥æ”¶å™¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> filter = IntentFilter().apply {
</span></span><span style=display:flex><span>            addAction(<span style=color:#a6e22e>Intent</span>.ACTION_BATTERY_LOW)
</span></span><span style=display:flex><span>            addAction(<span style=color:#a6e22e>Intent</span>.ACTION_BATTERY_OKAY)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        registerReceiver(batteryReceiver, filter)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onDestroy</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onDestroy()
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 3. å¿…é¡»å–æ¶ˆæ³¨å†Œï¼Œé¿å…å†…å­˜æ³„æ¼
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        unregisterReceiver(batteryReceiver)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>**Android13+**åŠ¨æ€æ³¨å†Œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// Android 13+ éœ€è¦åœ¨è¿è¡Œæ—¶è¯·æ±‚æƒé™
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>Build</span>.<span style=color:#a6e22e>VERSION</span>.SDK_INT <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>Build</span>.<span style=color:#a6e22e>VERSION_CODES</span>.TIRAMISU) {
</span></span><span style=display:flex><span>    registerReceiver(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>receiver</span>,
</span></span><span style=display:flex><span>        filter,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Context</span>.RECEIVER_NOT_EXPORTED  <span style=color:#75715e>// æˆ– RECEIVER_EXPORTED
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    )
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    registerReceiver(<span style=color:#66d9ef>receiver</span>, filter)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h4 id=å‘é€å¹¿æ’­>å‘é€å¹¿æ’­</h4><h5 id=1-æ ‡å‡†å¹¿æ’­normal-broadcast>1. æ ‡å‡†å¹¿æ’­ï¼ˆNormal Broadcastï¼‰</h5><p>æ‰€æœ‰æ¥æ”¶å™¨å‡ ä¹åŒæ—¶æ”¶åˆ°</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// å‘é€å¹¿æ’­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#e6db74>&#34;com.example.ACTION_CUSTOM&#34;</span>)
</span></span><span style=display:flex><span>intent.putExtra(<span style=color:#e6db74>&#34;data&#34;</span>, <span style=color:#e6db74>&#34;Hello Broadcast&#34;</span>)
</span></span><span style=display:flex><span>sendBroadcast(intent)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// æ¥æ”¶å¹¿æ’­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyReceiver</span> : BroadcastReceiver() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onReceive</span>(context: Context, intent: Intent) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> data = intent.getStringExtra(<span style=color:#e6db74>&#34;data&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;Receiver&#34;</span>, <span style=color:#e6db74>&#34;æ”¶åˆ°: </span><span style=color:#e6db74>$data</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=2-æœ‰åºå¹¿æ’­ordered-broadcast>2. æœ‰åºå¹¿æ’­ï¼ˆOrdered Broadcastï¼‰</h5><p>æŒ‰ä¼˜å…ˆçº§ä¸€æ¬¡ä¼ é€’ï¼Œå¯æ‹¦æˆª</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// å‘é€æœ‰åºå¹¿æ’­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#e6db74>&#34;com.example.ACTION_ORDERED&#34;</span>)
</span></span><span style=display:flex><span>sendOrderedBroadcast(intent, <span style=color:#66d9ef>null</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>&lt;!<span style=color:#f92672>--</span> è®¾ç½®ä¼˜å…ˆçº§ <span style=color:#f92672>--</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#66d9ef>receiver</span> android:name=<span style=color:#e6db74>&#34;.HighPriorityReceiver&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;intent-filter android:priority=<span style=color:#e6db74>&#34;1000&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;action android:name=<span style=color:#e6db74>&#34;com.example.ACTION_ORDERED&#34;</span> /&gt;
</span></span></code></pre></div><hr><h4 id=contentprovider>ContentProvider</h4><p><strong>ContentProvider</strong> = è·¨åº”ç”¨å…±äº«æ•°æ®çš„æ ‡å‡†æ¥å£</p><pre tabindex=0><code>åº”ç”¨ A (æ•°æ®æä¾›è€…)         åº”ç”¨ B (æ•°æ®ä½¿ç”¨è€…)
    â†“                           â†“
ContentProvider â†â”€â”€â”€â”€â”€URIâ”€â”€â”€â”€â†’ ContentResolver
    â†“
æ•°æ®åº“/æ–‡ä»¶/ç½‘ç»œ
</code></pre><hr><h4 id=contentproviderçš„ä½œç”¨>ContentProviderçš„ä½œç”¨</h4><h5 id=1-è·¨åº”ç”¨æ•°æ®å…±äº«>1. è·¨åº”ç”¨æ•°æ®å…±äº«</h5><pre tabindex=0><code>è”ç³»äººåº”ç”¨ â†’ ContentProvider â†’ å…¶ä»–åº”ç”¨è¯»å–è”ç³»äºº
ç›¸å†Œåº”ç”¨ â†’ ContentProvider â†’ å…¶ä»–åº”ç”¨è¯»å–å›¾ç‰‡
</code></pre><h5 id=2-ç»Ÿä¸€æ•°æ®è®¿é—®æ¥å£>2. ç»Ÿä¸€æ•°æ®è®¿é—®æ¥å£</h5><pre tabindex=0><code>ä¸ç®¡æ•°æ®å­˜åœ¨å“ªé‡Œï¼ˆæ•°æ®åº“/æ–‡ä»¶/ç½‘ç»œï¼‰
éƒ½é€šè¿‡ç»Ÿä¸€çš„ URI è®¿é—®

content://com.example.provider/users/1
content://com.android.contacts/contacts/1
</code></pre><h5 id=3-æ•°æ®å®‰å…¨æ§åˆ¶>3. æ•°æ®å®‰å…¨æ§åˆ¶</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>å¯ä»¥æ§åˆ¶<span style=color:#960050;background-color:#1e0010>ï¼š</span>
</span></span><span style=display:flex><span>- å“ªäº›åº”ç”¨å¯ä»¥è®¿é—®
</span></span><span style=display:flex><span>- å“ªäº›æ•°æ®å¯ä»¥è®¿é—®<span style=color:#960050;background-color:#1e0010>ï¼ˆ</span>è¯»/å†™æƒé™<span style=color:#960050;background-color:#1e0010>ï¼‰</span>
</span></span><span style=display:flex><span>- æ•°æ®è®¿é—®çš„ç²’åº¦
</span></span></code></pre></div><hr><h4 id=contentprovideræ¶æ„>ContentProvideræ¶æ„</h4><p><strong>URI</strong>ç»“æ„</p><pre tabindex=0><code>content://authority/path/id
   â†‘        â†‘       â†‘    â†‘
  åè®®    æ ‡è¯†ç¬¦   è·¯å¾„  ID

ç¤ºä¾‹ï¼š
content://com.example.provider/users
content://com.example.provider/users/123
content://com.android.contacts/contacts
content://media/external/images/media
</code></pre><p>ç»„ä»¶å…³ç³»</p><pre tabindex=0><code>åº”ç”¨ A                      åº”ç”¨ B
  â†“                          â†“
ContentProvider          ContentResolver
  â†“                          â†“
query()                    query()
insert()                   insert()
update()                   update()
delete()                   delete()
  â†“
å®é™…æ•°æ®å­˜å‚¨ (SQLite/æ–‡ä»¶ç­‰)
</code></pre><hr><h4 id=åˆ›å»ºcontentprovider>åˆ›å»ºContentProvider</h4><h5 id=æ­¥éª¤1å®šä¹‰æ•°æ®æ¨¡å‹>æ­¥éª¤1:å®šä¹‰æ•°æ®æ¨¡å‹</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// Contract ç±»ï¼ˆå®šä¹‰ URI å’Œåˆ—åï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>UserContract</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> AUTHORITY = <span style=color:#e6db74>&#34;com.example.provider&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> CONTENT_URI: Uri = <span style=color:#a6e22e>Uri</span>.parse(<span style=color:#e6db74>&#34;content://</span><span style=color:#e6db74>$AUTHORITY</span><span style=color:#e6db74>/users&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>Columns</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> ID = <span style=color:#e6db74>&#34;_id&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> NAME = <span style=color:#e6db74>&#34;name&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> EMAIL = <span style=color:#e6db74>&#34;email&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> AGE = <span style=color:#e6db74>&#34;age&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=æ­¥éª¤2åˆ›å»ºæ•°æ®åº“helperå¯é€‰>æ­¥éª¤2ï¼šåˆ›å»ºæ•°æ®åº“Helper(å¯é€‰)</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DatabaseHelper</span>(context: Context) : SQLiteOpenHelper(
</span></span><span style=display:flex><span>    context,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;users.db&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(db: SQLiteDatabase) {
</span></span><span style=display:flex><span>        db.execSQL(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            CREATE TABLE users (
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                _id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                name TEXT NOT NULL,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                email TEXT,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                age INTEGER
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            )
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onUpgrade</span>(db: SQLiteDatabase, oldVersion: Int, newVersion: Int) {
</span></span><span style=display:flex><span>        db.execSQL(<span style=color:#e6db74>&#34;DROP TABLE IF EXISTS users&#34;</span>)
</span></span><span style=display:flex><span>        onCreate(db)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=å®ç°contentprovider>å®ç°ContentProvider</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserProvider</span> : ContentProvider() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> dbHelper: DatabaseHelper
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> uriMatcher = UriMatcher(<span style=color:#a6e22e>UriMatcher</span>.NO_MATCH).apply {
</span></span><span style=display:flex><span>        addURI(<span style=color:#a6e22e>UserContract</span>.AUTHORITY, <span style=color:#e6db74>&#34;users&#34;</span>, USERS)
</span></span><span style=display:flex><span>        addURI(<span style=color:#a6e22e>UserContract</span>.AUTHORITY, <span style=color:#e6db74>&#34;users/#&#34;</span>, USER_ID)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>companion</span> <span style=color:#66d9ef>object</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> USERS = <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> USER_ID = <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. åˆå§‹åŒ–ï¼ˆåœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(): Boolean {
</span></span><span style=display:flex><span>        dbHelper = DatabaseHelper(context<span style=color:#f92672>!!</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. æŸ¥è¯¢æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>query</span>(
</span></span><span style=display:flex><span>        uri: Uri,
</span></span><span style=display:flex><span>        projection: Array&lt;String&gt;?,
</span></span><span style=display:flex><span>        selection: String?,
</span></span><span style=display:flex><span>        selectionArgs: Array&lt;String&gt;?,
</span></span><span style=display:flex><span>        sortOrder: String?
</span></span><span style=display:flex><span>    ): Cursor? {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> db = dbHelper.readableDatabase
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>when</span> (uriMatcher.match(uri)) {
</span></span><span style=display:flex><span>            USERS <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                db.query(
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;users&#34;</span>,
</span></span><span style=display:flex><span>                    projection,
</span></span><span style=display:flex><span>                    selection,
</span></span><span style=display:flex><span>                    selectionArgs,
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>                    sortOrder
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            USER_ID <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// æŸ¥è¯¢æŒ‡å®š ID çš„ç”¨æˆ·
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>val</span> id = uri.lastPathSegment
</span></span><span style=display:flex><span>                db.query(
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;users&#34;</span>,
</span></span><span style=display:flex><span>                    projection,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${UserContract.Columns.ID}</span><span style=color:#e6db74> = ?&#34;</span>,
</span></span><span style=display:flex><span>                    arrayOf(id),
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>                    sortOrder
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>throw</span> IllegalArgumentException(<span style=color:#e6db74>&#34;Unknown URI: </span><span style=color:#e6db74>$uri</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. æ’å…¥æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>insert</span>(uri: Uri, values: ContentValues?): Uri? {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> db = dbHelper.writableDatabase
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>when</span> (uriMatcher.match(uri)) {
</span></span><span style=display:flex><span>            USERS <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> id = db.insert(<span style=color:#e6db74>&#34;users&#34;</span>, <span style=color:#66d9ef>null</span>, values)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (id &gt; <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>val</span> newUri = <span style=color:#a6e22e>ContentUris</span>.withAppendedId(<span style=color:#a6e22e>UserContract</span>.CONTENT_URI, id)
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// é€šçŸ¥æ•°æ®å˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    context<span style=color:#f92672>?.</span>contentResolver<span style=color:#f92672>?.</span>notifyChange(newUri, <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>                    newUri
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>throw</span> IllegalArgumentException(<span style=color:#e6db74>&#34;Unknown URI: </span><span style=color:#e6db74>$uri</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. æ›´æ–°æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>update</span>(
</span></span><span style=display:flex><span>        uri: Uri,
</span></span><span style=display:flex><span>        values: ContentValues?,
</span></span><span style=display:flex><span>        selection: String?,
</span></span><span style=display:flex><span>        selectionArgs: Array&lt;String&gt;?
</span></span><span style=display:flex><span>    ): Int {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> db = dbHelper.writableDatabase
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> count = <span style=color:#66d9ef>when</span> (uriMatcher.match(uri)) {
</span></span><span style=display:flex><span>            USERS <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                db.update(<span style=color:#e6db74>&#34;users&#34;</span>, values, selection, selectionArgs)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            USER_ID <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> id = uri.lastPathSegment
</span></span><span style=display:flex><span>                db.update(
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;users&#34;</span>,
</span></span><span style=display:flex><span>                    values,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${UserContract.Columns.ID}</span><span style=color:#e6db74> = ?&#34;</span>,
</span></span><span style=display:flex><span>                    arrayOf(id)
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>throw</span> IllegalArgumentException(<span style=color:#e6db74>&#34;Unknown URI: </span><span style=color:#e6db74>$uri</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (count &gt; <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            context<span style=color:#f92672>?.</span>contentResolver<span style=color:#f92672>?.</span>notifyChange(uri, <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> count
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. åˆ é™¤æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>delete</span>(
</span></span><span style=display:flex><span>        uri: Uri,
</span></span><span style=display:flex><span>        selection: String?,
</span></span><span style=display:flex><span>        selectionArgs: Array&lt;String&gt;?
</span></span><span style=display:flex><span>    ): Int {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> db = dbHelper.writableDatabase
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> count = <span style=color:#66d9ef>when</span> (uriMatcher.match(uri)) {
</span></span><span style=display:flex><span>            USERS <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                db.delete(<span style=color:#e6db74>&#34;users&#34;</span>, selection, selectionArgs)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            USER_ID <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> id = uri.lastPathSegment
</span></span><span style=display:flex><span>                db.delete(
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;users&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${UserContract.Columns.ID}</span><span style=color:#e6db74> = ?&#34;</span>,
</span></span><span style=display:flex><span>                    arrayOf(id)
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>throw</span> IllegalArgumentException(<span style=color:#e6db74>&#34;Unknown URI: </span><span style=color:#e6db74>$uri</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (count &gt; <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            context<span style=color:#f92672>?.</span>contentResolver<span style=color:#f92672>?.</span>notifyChange(uri, <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> count
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 6. è¿”å› MIME ç±»å‹
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getType</span>(uri: Uri): String? {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>when</span> (uriMatcher.match(uri)) {
</span></span><span style=display:flex><span>            USERS <span style=color:#f92672>-&gt;</span> <span style=color:#e6db74>&#34;vnd.android.cursor.dir/vnd.com.example.provider.users&#34;</span>
</span></span><span style=display:flex><span>            USER_ID <span style=color:#f92672>-&gt;</span> <span style=color:#e6db74>&#34;vnd.android.cursor.item/vnd.com.example.provider.users&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>throw</span> IllegalArgumentException(<span style=color:#e6db74>&#34;Unknown URI: </span><span style=color:#e6db74>$uri</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=æ­¥éª¤4æ³¨å†Œprovider>æ­¥éª¤4:æ³¨å†ŒProvider</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- AndroidManifest.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;manifest&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;application&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;provider</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;.UserProvider&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:authorities=</span><span style=color:#e6db74>&#34;com.example.provider&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:exported=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:permission=</span><span style=color:#e6db74>&#34;com.example.READ_USERS&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>&lt;!-- æˆäºˆå…¶ä»–åº”ç”¨è¯»å†™æƒé™ --&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;grant-uri-permission</span> <span style=color:#a6e22e>android:pathPattern=</span><span style=color:#e6db74>&#34;/users/.*&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/provider&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/application&gt;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- å®šä¹‰æƒé™ --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;permission</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.example.READ_USERS&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:protectionLevel=</span><span style=color:#e6db74>&#34;normal&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;permission</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.example.WRITE_USERS&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:protectionLevel=</span><span style=color:#e6db74>&#34;normal&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/manifest&gt;</span>
</span></span></code></pre></div><hr><h4 id=ä½¿ç”¨contentprovider>ä½¿ç”¨ContentProvider</h4><p><strong>æŸ¥è¯¢æ•°æ®</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> : AppCompatActivity() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>queryUsers</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 1. è·å– ContentResolver
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> resolver = contentResolver
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 2. æ„å»ºæŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> uri = <span style=color:#a6e22e>Uri</span>.parse(<span style=color:#e6db74>&#34;content://com.example.provider/users&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> projection = arrayOf(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>UserContract</span>.<span style=color:#a6e22e>Columns</span>.ID,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>UserContract</span>.<span style=color:#a6e22e>Columns</span>.NAME,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>UserContract</span>.<span style=color:#a6e22e>Columns</span>.EMAIL
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> selection = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${UserContract.Columns.AGE}</span><span style=color:#e6db74> &gt; ?&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> selectionArgs = arrayOf(<span style=color:#e6db74>&#34;18&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> sortOrder = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${UserContract.Columns.NAME}</span><span style=color:#e6db74> ASC&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 3. æ‰§è¡ŒæŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> cursor = resolver.query(
</span></span><span style=display:flex><span>            uri,
</span></span><span style=display:flex><span>            projection,
</span></span><span style=display:flex><span>            selection,
</span></span><span style=display:flex><span>            selectionArgs,
</span></span><span style=display:flex><span>            sortOrder
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 4. å¤„ç†ç»“æœ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        cursor<span style=color:#f92672>?.</span>use {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>it</span>.moveToNext()) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> id = <span style=color:#66d9ef>it</span>.getLong(<span style=color:#66d9ef>it</span>.getColumnIndexOrThrow(<span style=color:#a6e22e>UserContract</span>.<span style=color:#a6e22e>Columns</span>.ID))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> name = <span style=color:#66d9ef>it</span>.getString(<span style=color:#66d9ef>it</span>.getColumnIndexOrThrow(<span style=color:#a6e22e>UserContract</span>.<span style=color:#a6e22e>Columns</span>.NAME))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> email = <span style=color:#66d9ef>it</span>.getString(<span style=color:#66d9ef>it</span>.getColumnIndexOrThrow(<span style=color:#a6e22e>UserContract</span>.<span style=color:#a6e22e>Columns</span>.EMAIL))
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;User&#34;</span>, <span style=color:#e6db74>&#34;ID: </span><span style=color:#e6db74>$id</span><span style=color:#e6db74>, Name: </span><span style=color:#e6db74>$name</span><span style=color:#e6db74>, Email: </span><span style=color:#e6db74>$email</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>æ’å…¥æ•°æ®</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>insertUser</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> resolver = contentResolver
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> uri = <span style=color:#a6e22e>Uri</span>.parse(<span style=color:#e6db74>&#34;content://com.example.provider/users&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> values = ContentValues().apply {
</span></span><span style=display:flex><span>        put(<span style=color:#a6e22e>UserContract</span>.<span style=color:#a6e22e>Columns</span>.NAME, <span style=color:#e6db74>&#34;Alice&#34;</span>)
</span></span><span style=display:flex><span>        put(<span style=color:#a6e22e>UserContract</span>.<span style=color:#a6e22e>Columns</span>.EMAIL, <span style=color:#e6db74>&#34;alice@example.com&#34;</span>)
</span></span><span style=display:flex><span>        put(<span style=color:#a6e22e>UserContract</span>.<span style=color:#a6e22e>Columns</span>.AGE, <span style=color:#ae81ff>25</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> newUri = resolver.insert(uri, values)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;Insert&#34;</span>, <span style=color:#e6db74>&#34;æ–°ç”¨æˆ· URI: </span><span style=color:#e6db74>$newUri</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>æ›´æ–°æ•°æ®</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>updateUser</span>(userId: Long) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> resolver = contentResolver
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> uri = <span style=color:#a6e22e>ContentUris</span>.withAppendedId(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Uri</span>.parse(<span style=color:#e6db74>&#34;content://com.example.provider/users&#34;</span>),
</span></span><span style=display:flex><span>        userId
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> values = ContentValues().apply {
</span></span><span style=display:flex><span>        put(<span style=color:#a6e22e>UserContract</span>.<span style=color:#a6e22e>Columns</span>.EMAIL, <span style=color:#e6db74>&#34;newemail@example.com&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> count = resolver.update(uri, values, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;Update&#34;</span>, <span style=color:#e6db74>&#34;æ›´æ–°äº† </span><span style=color:#e6db74>$count</span><span style=color:#e6db74> æ¡è®°å½•&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>åˆ é™¤æ•°æ®</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>deleteUser</span>(userId: Long) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> resolver = contentResolver
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> uri = <span style=color:#a6e22e>ContentUris</span>.withAppendedId(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Uri</span>.parse(<span style=color:#e6db74>&#34;content://com.example.provider/users&#34;</span>),
</span></span><span style=display:flex><span>        userId
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> count = resolver.delete(uri, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;Delete&#34;</span>, <span style=color:#e6db74>&#34;åˆ é™¤äº† </span><span style=color:#e6db74>$count</span><span style=color:#e6db74> æ¡è®°å½•&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h4 id=ç›‘å¬æ•°æ®å˜åŒ–>ç›‘å¬æ•°æ®å˜åŒ–</h4><p><strong>ContentObserver</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> : AppCompatActivity() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> userObserver = <span style=color:#66d9ef>object</span> <span style=color:#960050;background-color:#1e0010>: </span><span style=color:#a6e22e>ContentObserver</span>(Handler(<span style=color:#a6e22e>Looper</span>.getMainLooper())) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onChange</span>(selfChange: Boolean, uri: Uri?) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.onChange(selfChange, uri)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Log</span>.d(<span style=color:#e6db74>&#34;Observer&#34;</span>, <span style=color:#e6db74>&#34;æ•°æ®å˜åŒ–: </span><span style=color:#e6db74>$uri</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#75715e>// é‡æ–°æŸ¥è¯¢æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            queryUsers()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(savedInstanceState: Bundle?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onCreate(savedInstanceState)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ³¨å†Œè§‚å¯Ÿè€…
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        contentResolver.registerContentObserver(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Uri</span>.parse(<span style=color:#e6db74>&#34;content://com.example.provider/users&#34;</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>true</span>,  <span style=color:#75715e>// ç›‘å¬æ‰€æœ‰å­ URI
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            userObserver
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onDestroy</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onDestroy()
</span></span><span style=display:flex><span>        <span style=color:#75715e>// å–æ¶ˆæ³¨å†Œ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        contentResolver.unregisterContentObserver(userObserver)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h4 id=æƒé™æ§åˆ¶>æƒé™æ§åˆ¶</h4><h5 id=å®šä¹‰æƒé™>å®šä¹‰æƒé™</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- AndroidManifest.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;manifest&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- å®šä¹‰æƒé™ --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;permission</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.example.READ_USERS&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:label=</span><span style=color:#e6db74>&#34;è¯»å–ç”¨æˆ·æ•°æ®&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:description=</span><span style=color:#e6db74>&#34;å…è®¸è¯»å–ç”¨æˆ·æ•°æ®&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:protectionLevel=</span><span style=color:#e6db74>&#34;normal&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;permission</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.example.WRITE_USERS&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:label=</span><span style=color:#e6db74>&#34;å†™å…¥ç”¨æˆ·æ•°æ®&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:protectionLevel=</span><span style=color:#e6db74>&#34;normal&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;application&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;provider</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;.UserProvider&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:authorities=</span><span style=color:#e6db74>&#34;com.example.provider&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:exported=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:readPermission=</span><span style=color:#e6db74>&#34;com.example.READ_USERS&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:writePermission=</span><span style=color:#e6db74>&#34;com.example.WRITE_USERS&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/application&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/manifest&gt;</span>
</span></span></code></pre></div><h5 id=è¯·æ±‚æƒé™>è¯·æ±‚æƒé™</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- å…¶ä»–åº”ç”¨çš„ Manifest --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;manifest&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;uses-permission</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.example.READ_USERS&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;uses-permission</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.example.WRITE_USERS&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/manifest&gt;</span>
</span></span></code></pre></div><h5 id=ä¸´æ—¶æˆæƒuriæƒé™>ä¸´æ—¶æˆæƒ(URIæƒé™)</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// æˆäºˆå…¶ä»–åº”ç”¨ä¸´æ—¶è®¿é—®æƒé™
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> intent = Intent(<span style=color:#a6e22e>Intent</span>.ACTION_VIEW)
</span></span><span style=display:flex><span>intent.<span style=color:#66d9ef>data</span> = <span style=color:#a6e22e>Uri</span>.parse(<span style=color:#e6db74>&#34;content://com.example.provider/users/1&#34;</span>)
</span></span><span style=display:flex><span>intent.addFlags(<span style=color:#a6e22e>Intent</span>.FLAG_GRANT_READ_URI_PERMISSION)
</span></span><span style=display:flex><span>startActivity(intent)
</span></span></code></pre></div></section><footer class=article-footer></footer></article><footer class=site-footer><section class=copyright>&copy;
2025 zedçš„åšå®¢</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>
<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Rust on zedçš„åšå®¢</title><link>https://www.dust-zed.site/categories/rust/</link><description>Recent content in Rust on zedçš„åšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 13 Oct 2025 10:33:08 +0800</lastBuildDate><atom:link href="https://www.dust-zed.site/categories/rust/index.xml" rel="self" type="application/rss+xml"/><item><title>Benchmarkå­¦ä¹ </title><link>https://www.dust-zed.site/rust/benchmark%E5%AD%A6%E4%B9%A0/</link><pubDate>Mon, 13 Oct 2025 10:33:08 +0800</pubDate><guid>https://www.dust-zed.site/rust/benchmark%E5%AD%A6%E4%B9%A0/</guid><description>&lt;h4 id="benchmarkæ ¸å¿ƒ">benchmarkæ ¸å¿ƒ
&lt;/h4>&lt;p>æ‰€æœ‰è¯­è¨€çš„&lt;strong>Benchmark&lt;/strong>éƒ½åœ¨åšï¼š&lt;/p>
&lt;ul>
&lt;li>è®¡æ—¶ - æµ‹é‡æ‰§è¡Œæ—¶é—´&lt;/li>
&lt;li>é‡å¤ - å¤šæ¬¡è¿è¡Œå–å¹³å‡&lt;/li>
&lt;li>ç»Ÿè®¡ - è®¡ç®—å‡å€¼ã€æ ‡å‡†å·®&lt;/li>
&lt;li>å¯¹æ¯” - æ¯”è¾ƒä¸åŒå®ç°&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>é€šç”¨æµç¨‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>é¢„çƒ­ â†’ æµ‹é‡ â†’ ç»Ÿè®¡ â†’ æŠ¥å‘Š ï¼ˆé˜²ä¼˜åŒ–ï¼‰
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>é¢„çƒ­&lt;/strong>: è·³è¿‡ç¼“å­˜æœªå‘½ä¸­çš„åˆæµ‹&lt;/p>
&lt;h4 id="criterion">Criterion
&lt;/h4>&lt;p>&lt;code>Criterion&lt;/code>æ˜¯rustä¸­æœ€ç°ä»£åŒ–çš„benchmarkåº“ï¼Œæ¥ä¸‹æ¥è·Ÿç€ä¾‹å­ä¸€æ­¥æ­¥æ·±å…¥äº†benchmarkã€‚&lt;/p>
&lt;h4 id="å…¥é—¨">å…¥é—¨
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#![allow(unused)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> criterion::{black_box, criterion_group, criterion_main, Criterion};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> mycrate::fibonacci;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">criterion_benchmark&lt;/span>(c: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> Criterion) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c.bench_function(&lt;span style="color:#e6db74">&amp;#34;fib 20&amp;#34;&lt;/span>, &lt;span style="color:#f92672">|&lt;/span>b&lt;span style="color:#f92672">|&lt;/span> b.iter(&lt;span style="color:#f92672">||&lt;/span> fibonacci(black_box(&lt;span style="color:#ae81ff">20&lt;/span>))));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">criterion_group!&lt;/span>(benches, criterion_benchmark);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">criterion_main!&lt;/span>(benches);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="1-bench_functionæ–¹æ³•">1. &lt;code>bench_function&lt;/code>æ–¹æ³•
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>c.bench_function(&lt;span style="color:#e6db74">&amp;#34;fib 20&amp;#34;&lt;/span>, &lt;span style="color:#f92672">|&lt;/span>b&lt;span style="color:#f92672">|&lt;/span> b.iter(&lt;span style="color:#f92672">||&lt;/span> fibonacci(black_box(&lt;span style="color:#ae81ff">20&lt;/span>))));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>ä½œç”¨&lt;/strong>ï¼šå®šä¹‰ä¸€ä¸ªåŸºå‡†æµ‹è¯•ç”¨ä¾‹&lt;/li>
&lt;li>&lt;strong>å‚æ•°&lt;/strong>:
&lt;ul>
&lt;li>&lt;code>fib 20&lt;/code>ï¼š æµ‹è¯•ç”¨ä¾‹çš„åç§°ï¼ˆç”¨äºç»“æœæŠ¥å‘Šï¼‰&lt;/li>
&lt;li>é—­åŒ…å‡½æ•°ï¼šåŒ…å«å®é™…çš„æµ‹è¯•é€»è¾‘&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é—­åŒ…å†…éƒ¨&lt;/strong>
&lt;ul>
&lt;li>&lt;code>b&lt;/code>: &lt;code>Bencher&lt;/code>å¯¹è±¡(è‡ªåŠ¨ä¼ å…¥)&lt;/li>
&lt;li>&lt;code>b.iter(|| ...)&lt;/code>ï¼šè¿è¡Œè¢«æµ‹ä»£ç å¤šæ¬¡å¹¶æµ‹é‡æ—¶é—´&lt;/li>
&lt;li>&lt;code>black_box(20)&lt;/code>ï¼šé˜»æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–(ç¡®ä¿çœŸå®è®¡ç®—)&lt;/li>
&lt;li>&lt;code>fibonacci(20)&lt;/code>ï¼šå®é™…è¢«æµ‹å‡½æ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="2-criterion_groupå®">2. &lt;code>criterion_group!&lt;/code>å®
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">criterion_group!&lt;/span>(benches, criterion_benchmark);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>ä½œç”¨&lt;/strong>ï¼šåˆ›å»ºåŸºå‡†æµ‹è¯•ç»„&lt;/li>
&lt;li>&lt;strong>å‚æ•°&lt;/strong>ï¼š
&lt;ul>
&lt;li>&lt;code>benches&lt;/code>ï¼šç»„åç§°ï¼ˆè‡ªå®šä¹‰æ ‡è¯†ç¬¦ï¼‰&lt;/li>
&lt;li>&lt;code>criterion_benchmark&lt;/code>ï¼šåŒ…å«æµ‹è¯•çš„å‡½æ•°åï¼ˆæœ¬ä¾‹ä¸­çš„åŸºå‡†å‡½æ•°ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ç‰¹æ€§&lt;/strong>ï¼š
&lt;ul>
&lt;li>å°†å¤šä¸ªåŸºå‡†æµ‹è¯•ç»„ç»‡æˆç»„&lt;/li>
&lt;li>æ”¯æŒæ·»åŠ å¤šä¸ªæµ‹è¯•å‡½æ•°&lt;/li>
&lt;li>ç”Ÿæˆå¯¹åº”çš„ &lt;code>bench_&lt;/code> å¼€å¤´çš„å‡½æ•°ï¼ˆå¦‚&lt;code>benches_benchmark&lt;/code>ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="3-criterion_mainå®">3. &lt;code>criterion_main!&lt;/code>å®
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">criterion_main!&lt;/span>(benches);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>ä½œç”¨&lt;/strong>ï¼šç”ŸæˆåŸºå‡†æµ‹è¯•çš„å…¥å£å‡½æ•°&lt;/li>
&lt;li>&lt;strong>å‚æ•°&lt;/strong>ï¼š
&lt;ul>
&lt;li>&lt;code>benches&lt;/code>ï¼šå‰é¢å®šä¹‰çš„æµ‹è¯•ç»„å&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>åŠŸèƒ½&lt;/strong>ï¼š
&lt;ul>
&lt;li>è‡ªåŠ¨ç”Ÿæˆ&lt;code>main()&lt;/code>å‡½æ•°&lt;/li>
&lt;li>é…ç½®å¹¶è¿è¡Œæ‰€æœ‰æŒ‡å®šçš„æµ‹è¯•ç»„&lt;/li>
&lt;li>å¤„ç†å‘½ä»¤è¡Œå‚æ•°ï¼ˆå¦‚ &lt;code>--filter&lt;/code>, &lt;code>--savebaseline&lt;/code>ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="4-benchesçš„æ¥æº">4. &lt;code>benches&lt;/code>çš„æ¥æº
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">criterion_group!&lt;/span>(benches, &lt;span style="color:#f92672">..&lt;/span>.);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ^^^^^^ è¿™é‡Œå®šä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">criterion_main!&lt;/span>(benches);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ^^^^^^ è¿™é‡Œä½¿ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>benches&lt;/code> æ˜¯ç”± &lt;code>criterion_group!&lt;/code> &lt;strong>å®åˆ›å»ºçš„è‡ªå®šä¹‰æ ‡è¯†ç¬¦&lt;/strong>&lt;/li>
&lt;li>åœ¨ &lt;code>criterion_main!&lt;/code> ä¸­å¼•ç”¨æ—¶ï¼š
&lt;ol>
&lt;li>æŸ¥æ‰¾åŒåæµ‹è¯•ç»„&lt;/li>
&lt;li>å°†ç»„å†…æµ‹è¯•å‡½æ•°æ·»åŠ åˆ°æ‰§è¡Œé˜Ÿåˆ—&lt;/li>
&lt;li>ç”ŸæˆæŠ¥å‘Šå’Œå›¾è¡¨&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;h4 id="è¿›é˜¶">è¿›é˜¶
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨ benchmark_group ç»„ç»‡æµ‹è¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> group &lt;span style="color:#f92672">=&lt;/span> c.benchmark_group(&lt;span style="color:#e6db74">&amp;#34;data_structures&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.sample_size(&lt;span style="color:#ae81ff">100&lt;/span>); &lt;span style="color:#75715e">// é…ç½®é‡‡æ ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>group.measurement_time(Duration::from_secs(&lt;span style="color:#ae81ff">5&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ... å¤šä¸ªç›¸å…³æµ‹è¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.finish();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="benchmark_groupæ–¹æ³•">&lt;code>benchmark_group&lt;/code>æ–¹æ³•
&lt;/h5>&lt;ul>
&lt;li>ä½œç”¨ï¼š åˆ›å»ºå…±äº«é…ç½®çš„å®¹å™¨ï¼Œä½œä¸ºå¤šä¸ªç›¸å…³æµ‹è¯•çš„é…ç½®è½½ä½“&lt;/li>
&lt;li>å¿…é¡»è¢«åŒ…å«åœ¨ &lt;code>criterion_group!&lt;/code> æ³¨å†Œçš„æµ‹è¯•å‡½æ•°ä¸­ï¼Œå¹¶ç”±å…¶è°ƒåº¦æ‰§è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="ç†è§£ç»Ÿè®¡è¾“å‡º">ç†è§£ç»Ÿè®¡è¾“å‡º
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>time: &lt;span style="color:#f92672">[&lt;/span>123.45 Âµs 125.67 Âµs 128.90 Âµs&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â†‘ â†‘ â†‘
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ä¸‹ç•Œ ä¸­ä½æ•° ä¸Šç•Œ
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>change: &lt;span style="color:#f92672">[&lt;/span>-5.23% +2.34% +10.23%&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> â†‘ â†‘ â†‘
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> æœ€å¥½ é¢„æœŸå˜åŒ– æœ€å
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Found &lt;span style="color:#ae81ff">3&lt;/span> outliers among &lt;span style="color:#ae81ff">100&lt;/span> measurements
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">2&lt;/span> high mild â† ç¨å¾®åé«˜
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">1&lt;/span> high severe â† ä¸¥é‡åé«˜
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä¾‹å­">ä¾‹å­
&lt;/h4>&lt;h5 id="1-å‚æ•°åŒ–æµ‹è¯•">1. å‚æ•°åŒ–æµ‹è¯•
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æµ‹è¯•ä¸åŒè¾“å…¥å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> group &lt;span style="color:#f92672">=&lt;/span> c.benchmark_group(&lt;span style="color:#e6db74">&amp;#34;fibonacci&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#66d9ef">in&lt;/span> [&lt;span style="color:#ae81ff">10&lt;/span>, &lt;span style="color:#ae81ff">15&lt;/span>, &lt;span style="color:#ae81ff">20&lt;/span>, &lt;span style="color:#ae81ff">25&lt;/span>].iter() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group.bench_with_input(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BenchmarkId::from_parameter(i),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> i,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">|&lt;/span>b, &lt;span style="color:#f92672">&amp;amp;&lt;/span>i&lt;span style="color:#f92672">|&lt;/span> b.iter(&lt;span style="color:#f92672">||&lt;/span> fibonacci(black_box(i)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.finish();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-å¯¹æ¯”å¤šä¸ªå®ç°">2. å¯¹æ¯”å¤šä¸ªå®ç°
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> group &lt;span style="color:#f92672">=&lt;/span> c.benchmark_group(&lt;span style="color:#e6db74">&amp;#34;sum&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.bench_function(&lt;span style="color:#e6db74">&amp;#34;for_loop&amp;#34;&lt;/span>, &lt;span style="color:#f92672">|&lt;/span>b&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b.iter(&lt;span style="color:#f92672">||&lt;/span> sum_for_loop(black_box(&lt;span style="color:#f92672">&amp;amp;&lt;/span>data)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.bench_function(&lt;span style="color:#e6db74">&amp;#34;iterator&amp;#34;&lt;/span>, &lt;span style="color:#f92672">|&lt;/span>b&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b.iter(&lt;span style="color:#f92672">||&lt;/span> sum_iterator(black_box(&lt;span style="color:#f92672">&amp;amp;&lt;/span>data)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.finish();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ååé‡æµ‹é‡">ååé‡æµ‹é‡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> group &lt;span style="color:#f92672">=&lt;/span> c.benchmark_group(&lt;span style="color:#e6db74">&amp;#34;throughput&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è®¾ç½®ååé‡å•ä½
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>group.throughput(Throughput::Bytes(data.len() &lt;span style="color:#66d9ef">as&lt;/span> &lt;span style="color:#66d9ef">u64&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group.bench_function(&lt;span style="color:#e6db74">&amp;#34;process&amp;#34;&lt;/span>, &lt;span style="color:#f92672">|&lt;/span>b&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b.iter(&lt;span style="color:#f92672">||&lt;/span> process(black_box(&lt;span style="color:#f92672">&amp;amp;&lt;/span>data)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŠ¥å‘Šä¼šæ˜¾ç¤º MB/s
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="è‡ªå®šä¹‰é…ç½®">è‡ªå®šä¹‰é…ç½®
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>group.sample_size(&lt;span style="color:#ae81ff">1000&lt;/span>); &lt;span style="color:#75715e">// æ ·æœ¬æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>group.warm_up_time(Duration::from_secs(&lt;span style="color:#ae81ff">3&lt;/span>)); &lt;span style="color:#75715e">// é¢„çƒ­æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>group.measurement_time(Duration::from_secs(&lt;span style="color:#ae81ff">10&lt;/span>)); &lt;span style="color:#75715e">// æµ‹é‡æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>group.noise_threshold(&lt;span style="color:#ae81ff">0.05&lt;/span>); &lt;span style="color:#75715e">// å™ªéŸ³é˜ˆå€¼
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ç®€å•ç‰ˆripgrepå®ç°æ€»ç»“</title><link>https://www.dust-zed.site/rust/ripgrep/%E7%AE%80%E5%8D%95%E7%89%88ripgrep%E5%AE%9E%E7%8E%B0%E6%80%BB%E7%BB%93/</link><pubDate>Fri, 10 Oct 2025 15:43:59 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/%E7%AE%80%E5%8D%95%E7%89%88ripgrep%E5%AE%9E%E7%8E%B0%E6%80%BB%E7%BB%93/</guid><description>&lt;h4 id="æ¦‚è¿°">æ¦‚è¿°
&lt;/h4>&lt;p>ä¾æ®å¯¹&lt;code>ripgrep&lt;/code>çš„å­¦ä¹ ï¼Œå®ç°ç®€å•çš„ä¸ªäººç‰ˆæœ¬çš„&lt;code>tbt_ripgrep&lt;/code>ï¼Œç®€å•çš„æœ‰ä»¥ä¸‹åŠŸèƒ½&lt;/p>
&lt;ul>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> åŸºæœ¬æœç´¢&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> æ·»åŠ é€‰é¡¹ï¼ˆå¿½ç•¥å¤§å°å†™ï¼Œè¡Œå·ï¼‰&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> å½©è‰²è¾“å‡º&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> æ”¯æŒé€’å½’æœç´¢ç›®å½•&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> æ˜¾ç¤ºä¸Šä¸‹æ–‡&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> æ€§èƒ½ä¼˜åŒ–ï¼ˆåŠ å¤šçº¿ç¨‹ï¼Œä¼˜åŒ–å¤§æ–‡ä»¶å¤„ç†ï¼Œåšæ€§èƒ½å¯¹æ¯”ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="åŠŸèƒ½å®ç°">åŠŸèƒ½å®ç°
&lt;/h4>&lt;p>å‘½ä»¤è¡Œå‚æ•°è§£æä½¿ç”¨çš„&lt;code>clap&lt;/code>åº“ï¼Œå½©è‰²è¾“å‡ºä¹Ÿæ˜¯ç”¨çš„&lt;code>colored&lt;/code>åº“ï¼Œæ­£åˆ™åŒ¹é…ä¹Ÿæ˜¯ç”¨çš„&lt;code>regex&lt;/code>åº“,åŸºäºä¸Šè¿°ä¸‰ä¸ªåº“æä¾›çš„åŠŸèƒ½ï¼ŒåŠŸèƒ½å®ç°çš„ä¸»è¦éš¾ç‚¹ä¸»è¦åœ¨&lt;strong>ä¸Šä¸‹æ–‡æ˜¾ç¤º&lt;/strong>ä¸&lt;strong>é€’å½’æœç´¢ç›®å½•&lt;/strong>ã€‚å…¶ä¸­é€’å½’æœç´¢ç›®å½•ä¹Ÿæ˜¯åŸºäº&lt;code>walkdir&lt;/code>åº“å®ç°çš„ï¼Œä½†æ˜¯ä¸»è¦æ˜¯æƒ³å­¦ä¹ &lt;code>ripgrep&lt;/code>çš„ç›®å½•å‘ç°æ€è·¯ã€‚&lt;/p>
&lt;hr>
&lt;h4 id="ç¨‹åºå¯¹æ¯”">ç¨‹åºå¯¹æ¯”
&lt;/h4>&lt;ol>
&lt;li>&lt;code>ripgrep&lt;/code>çš„èŒè´£åˆ†ç¦»åšçš„å¾ˆå¥½ï¼Œä»¥&lt;code>Searcher&lt;/code>ä¸ºä¾‹ï¼Œå¦‚æœä»¥æˆ‘è‡ªå·±çš„æƒ³æ³•çš„è¯ï¼Œæ˜¯ä¼šæŠŠ&lt;code>Path&lt;/code>æ”¾è¿›&lt;code>Searcher&lt;/code>ä¸­çš„ï¼Œä½†æ˜¯è¿™æ ·ä¼šè¿™æ ·ï¼Œ&lt;code>search&lt;/code>æ–¹æ³•å°±éœ€è¦å¤„ç†æ–‡ä»¶ç³»ç»Ÿé—®é¢˜ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å†…å®¹ï¼Œä½†é‚£äº›éƒ½ä¸æ˜¯æœç´¢çš„æ ¸å¿ƒé€»è¾‘ï¼š
&lt;ul>
&lt;li>éœ€è¦å¤„ç†æ–‡ä»¶ç³»ç»Ÿé”™è¯¯&lt;/li>
&lt;li>éœ€è¦å¤„ç†ç¬¦å·é“¾æ¥&lt;/li>
&lt;li>éœ€è¦å¤„ç†æ–‡ä»¶ç±»å‹åˆ¤æ–­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>åŸºäºä»¥ä¸Šçš„å·®å¼‚ï¼Œæœ¬è´¨ä¸Šæ˜¯æˆ‘æ²¡æœ‰åšå¥½&lt;strong>èŒè´£åˆ†ç¦»&lt;/strong>ï¼Œæˆ‘æ˜¯åŸºäºâ€œæ˜¯ä»€ä¹ˆâ€å»å®ç°åŠŸèƒ½çš„ï¼Œä½†æ˜¯&lt;code>ripgrep&lt;/code>æ˜¯åŸºäºâ€œåšä»€ä¹ˆâ€å»å®ç°ä»£ç çš„ï¼Œåšå¥½&lt;strong>èŒè´£åˆ†ç¦»&lt;/strong>,æ„Ÿè§‰ä¹Ÿç®—æ˜¯&lt;strong>é¢å‘æŠ½è±¡ç¼–ç¨‹&lt;/strong>çš„æ®Šé€”åŒå½’äº†å§ã€‚&lt;/li>
&lt;li>&lt;strong>æ˜¾ç¤ºä¸Šä¸‹æ–‡&lt;/strong>è™½ç„¶åŠŸèƒ½æ˜¯å®ç°äº†ï¼Œä½†æ˜¯è®¾è®¡çš„ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œå•ä¸ªæ–‡ä»¶çš„æœç´¢ç»“æœéƒ½ä¼šå­˜å‚¨ä¸‹æ¥ï¼Œç„¶åç»Ÿä¸€æ‰“å°å‡ºæ¥ï¼Œå•ä¸ªåŒ¹é…æ–‡ä»¶è¿‡å¤šçš„æ—¶å€™ï¼Œæ•ˆç‡ä½ä¸‹çš„ç¼ºç‚¹å°±ä¼šæ”¾å¤§äº†ï¼Œç›®å‰å¯¹&lt;code>ripgrep&lt;/code>çš„å®ç°è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä½†æ˜¯å¾ˆå¥½å¥‡æ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;code>ripgrep&lt;/code>æ˜¯å¦‚ä½•åšåˆ°æµå¼å¤„ç† + ä¸Šä¸‹æ–‡åŠŸèƒ½å¤„ç†çš„å‘¢ï¼Ÿ&lt;/li>
&lt;li>&lt;code>ripgrep&lt;/code>çš„&lt;code>walk&lt;/code>å®ç°ä¹Ÿæ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„ï¼Œæˆ‘åŸæœ¬çš„å®ç°ä¹Ÿå°±æ˜¯å¯¹&lt;code>walkdir&lt;/code>è¿”å›çš„è¿­ä»£å™¨è¿›è¡Œéå†å°±è¡Œï¼Œä½†æ˜¯&lt;code>ripgrep&lt;/code>å¯¹æ–‡ä»¶éå†è¿›è¡Œäº†åŠŸèƒ½å¤„ç†ï¼Œ&lt;code>WalkBuilder&lt;/code>,&lt;code>WalkEventIter&lt;/code>å’Œ&lt;code>Walk&lt;/code>éƒ½æ˜¯ï¼Œæˆ‘è§‰å¾—è¿™äº›éƒ½æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„&lt;/li>
&lt;/ol>
&lt;hr>
&lt;p>ä¼˜å…ˆè€ƒè™‘&lt;strong>åšä»€ä¹ˆ&lt;/strong>è€Œä¸æ˜¯&lt;strong>æ˜¯ä»€ä¹ˆ&lt;/strong>å»å®ç°åŠŸèƒ½ï¼Œ&lt;strong>é¢å‘è¡Œä¸ºç¼–ç¨‹&lt;/strong>ä¼˜äº&lt;strong>é¢å‘å¯¹è±¡ç¼–ç¨‹&lt;/strong>ï¼Œåšå¥½èŒè´£åˆ†ç¦»ã€‚&lt;/p></description></item><item><title>Regex</title><link>https://www.dust-zed.site/rust/docs_rs_zh/regex/</link><pubDate>Mon, 22 Sep 2025 12:19:53 +0800</pubDate><guid>https://www.dust-zed.site/rust/docs_rs_zh/regex/</guid><description>&lt;p>è¿™ä¸ªcrateæä¾›äº†åœ¨å­—ç¬¦ä¸²ä¸­æœç´¢ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…(&lt;code>regular expression&lt;/code>ç®€ç§°&lt;code>regex&lt;/code>)çš„ä¾‹ç¨‹ã€‚æœ¬åº“æ”¯æŒçš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•å’Œå…¶ä»–æ­£åˆ™å¼•æ“ç›¸ä¼¼ï¼Œä½†æ˜¯ç¼ºå°‘äº†ä¸€äº›æ— æ³•é«˜æ•ˆå®ç°çš„åŠŸèƒ½ã€‚åŒ…æ‹¬ä½†ä¸é™äºï¼Œ&lt;code>look-around&lt;/code>å’Œ&lt;code>backrefernces&lt;/code>ã€‚ç›¸åº”çš„ï¼Œæœ¬åº“çš„æ­£åˆ™æœç´¢æœ€å·®çš„æ—¶é—´å¤æ‚åº¦æ˜¯&lt;code>O(m * n)&lt;/code>ï¼Œ&lt;code>m&lt;/code>å’Œæ­£åˆ™è¡¨è¾¾å¼æˆæ­£æ¯”ï¼Œ&lt;code>n&lt;/code>å’Œè¢«æœç´¢çš„å­—ç¬¦ä¸²æˆæ­£æ¯”ã€‚&lt;/p>
&lt;p>å¦‚æœä½ åªéœ€è¦APIæ–‡æ¡£ï¼Œåªéœ€è¦è·³è½¬è‡³[Regex][https://docs.rs/regex/latest/regex/struct.Regex.html]ç±»å‹ã€‚å¦åˆ™ï¼Œæ­¤å¤„æ˜¯å¿«é€Ÿç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•è§£æç±»ä¼¼grepç¨‹åºçš„è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?m)^([^:]+):([0-9]+):(.+)$&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&lt;/span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">path/to/foo:54:Blue Harvest
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">path/to/bar:90:Something, Something, Something, Dark Side
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">path/to/baz:3:It&amp;#39;s a Trap!
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> results &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">vec!&lt;/span>[];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (_, [path, lineno, line]) &lt;span style="color:#66d9ef">in&lt;/span> re.captures_iter(hay).map(&lt;span style="color:#f92672">|&lt;/span>c&lt;span style="color:#f92672">|&lt;/span> c.extract()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> results.push((path, lineno.parse::&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u64&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>()&lt;span style="color:#f92672">?&lt;/span>, line));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(results, &lt;span style="color:#a6e22e">vec!&lt;/span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;path/to/foo&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">54&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Blue Harvest&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;path/to/bar&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">90&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Something, Something, Something, Dark Side&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;path/to/baz&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;It&amp;#39;s a Trap!&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ¦‚è¿°">æ¦‚è¿°
&lt;/h4>&lt;hr>
&lt;p>æœ¬åº“çš„ä¸»è¦ç±»å‹æ˜¯&lt;code>Regex&lt;/code>ã€‚å…¶é‡è¦çš„æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>Regex::new&lt;/code>ä½¿ç”¨é»˜è®¤é…ç½®ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ã€‚&lt;code>RegexBuilder&lt;/code>å…è®¸é…ç½®éé»˜è®¤é…ç½®ã€‚ï¼ˆä¾‹å¦‚ï¼Œä¸åŒºåˆ†å¤§å°å†™åŒ¹é…ï¼Œè¯¦ç»†æ¨¡å¼ç­‰ã€‚ï¼‰&lt;/li>
&lt;li>&lt;code>Regex::is_match&lt;/code> æŠ¥å‘Šåœ¨ç‰¹å®šçš„haystackæ˜¯å¦å­˜åœ¨åŒ¹é…ã€‚&lt;/li>
&lt;li>&lt;code>Regex::find&lt;/code>æŠ¥å‘ŠåŒ¹é…é¡¹åœ¨haystackçš„å­—èŠ‚åç§»ï¼Œå¦‚æœå­˜åœ¨çš„è¯ã€‚&lt;code>Regex::find_iter&lt;/code>è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”¨äºéå†æ‰€æœ‰åŒ¹é…é¡¹ã€‚&lt;/li>
&lt;li>&lt;code>Regex::captures&lt;/code>è¿”å›&lt;code>Captures&lt;/code>,å®ƒæŠ¥å‘Šäº†åœ¨haystackä¸­åŒ¹é…çš„å­—èŠ‚åç§»é‡ä»¥åŠä»haystackä¸­çš„regexåŒ¹é…çš„æ¯ä¸ªæ•è·ç»„çš„å­—èŠ‚åç§»é‡ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¹Ÿæœ‰&lt;code>RegexSet&lt;/code>ï¼Œå®ƒå…è®¸åœ¨ä¸€æ¬¡æœç´¢ä¸­æœç´¢å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚ç„¶è€Œï¼Œå®ƒåªæŠ¥å‘ŠåŒ¹é…çš„æ¨¡å¼è€Œä¸æŠ¥å‘ŠåŒ¹é…çš„å­—èŠ‚åç§»é‡ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œé¡¶çº§crateæ–‡æ¡£ç»„ç»‡å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="#Usage" >Usage&lt;/a>å±•ç¤ºäº†å¦‚ä½•åœ¨Rustå·¥ç¨‹ä¸­æ·»åŠ &lt;code>regex&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;a class="link" href="#Examples" >Examples&lt;/a>æä¾›äº†æœ‰é™çš„æ­£åˆ™è¡¨è¾¾å¼ç¤ºä¾‹ã€‚&lt;/li>
&lt;li>&lt;a class="link" href="#Performance" >Performance&lt;/a>æä¾›äº†å¦‚ä½•ä¼˜åŒ–æ­£åˆ™æœç´¢é€Ÿåº¦çš„ç®€å•æ€»ç»“ã€‚&lt;/li>
&lt;li>[Unicode][]è®¨è®ºäº†å¯¹non-ASCIIçš„æ”¯æŒã€‚&lt;/li>
&lt;li>[Syntax][]åˆ—ä¸¾äº†æœ¬åº“æ˜ç¡®æ”¯æŒçš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ã€‚&lt;/li>
&lt;li>[Untrusted input][]è®¨è®ºäº†æœ¬åº“å¦‚ä½•å¤„ç†ä¸å—ä¿¡ä»»çš„regexæˆ–haystackã€‚&lt;/li>
&lt;li>[Crate features][]è®°å½•äº†è¿™ä¸ªåº“å¯ä»¥è¢«å¯ç”¨æˆ–ç¦ç”¨çš„ç‰¹æ€§ã€‚&lt;/li>
&lt;li>[Other crates][]ä¸æ­£åˆ™å®¶æ—ä¸­å…¶ä»–åº“é“¾æ¥ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="usage">Usage
&lt;/h4>&lt;p>&lt;code>regex&lt;/code>åœ¨ [crates.io][https://crates.io/crates/regex]ä¸Šï¼Œå¯ä»¥é€šè¿‡åœ¨é¡¹ç›®&lt;code>Cargo.toml&lt;/code>æ–‡ä»¶æ·»åŠ &lt;code>regex&lt;/code>åˆ°ä½ çš„ä¾èµ–é¡¹æ¥ä½¿ç”¨ã€‚æ›´ç®€å•çš„æ–¹å¼ï¼Œåªéœ€è¦&lt;code>cargo run regex&lt;/code>ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Rust é¡¹ç›®ï¼Œæ·»åŠ äº†å¯¹ &lt;code>regex&lt;/code> çš„ä¾èµ–ï¼Œåˆ›å»ºäº†æ­£åˆ™æœç´¢çš„æºä»£ç ï¼Œç„¶åè¿è¡Œäº†ç¨‹åºã€‚&lt;/p>
&lt;p>ç¬¬ä¸€æ­¥ï¼Œåœ¨æ–°ç›®å½•æ–°å»ºé¡¹ç›®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ mkdir regex-example
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ cd regex-example
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ crago init
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬äºŒæ­¥ï¼Œæ·»åŠ &lt;code>regex&lt;/code>ä¾èµ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ cargo add regex
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬ä¸‰æ­¥ï¼šç¼–è¾‘&lt;code>src/main.rs&lt;/code>ï¼Œç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢å…¶æºç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Hello (?&amp;lt;name&amp;gt;\w+)!&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> Some(caps) &lt;span style="color:#f92672">=&lt;/span> re.captures(&lt;span style="color:#e6db74">&amp;#34;Hello Murphy!&amp;#34;&lt;/span>) &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;no match!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;The name is: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>caps[&lt;span style="color:#e6db74">&amp;#34;name&amp;#34;&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬å››æ­¥ï¼Œæ‰§è¡Œ&lt;code>cargo run&lt;/code>è¿è¡Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ cargo run
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiling memchr v2.5.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiling regex-syntax v0.7.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiling aho-corasick v1.0.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiling regex v1.8.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Compiling regex-example v0.1.0 &lt;span style="color:#f92672">(&lt;/span>/tmp/regex-example&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Finished dev &lt;span style="color:#f92672">[&lt;/span>unoptimized + debuginfo&lt;span style="color:#f92672">]&lt;/span> target&lt;span style="color:#f92672">(&lt;/span>s&lt;span style="color:#f92672">)&lt;/span> in 4.22s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Running &lt;span style="color:#e6db74">`&lt;/span>target/debug/regex-example&lt;span style="color:#e6db74">`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The name is: Murphy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¨‹åºç¬¬ä¸€æ¬¡è¿è¡Œå°†å±•ç¤ºæ›´å¤šè¾“å‡ºï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚ä½†æ˜¯åç»­è¿è¡Œä¸éœ€è¦é‡æ–°ç¼–è¯‘ä¾èµ–é¡¹ã€‚ã€&lt;/p>
&lt;h4 id="examples">Examples
&lt;/h4>&lt;hr>
&lt;p>æœ¬èŠ‚æä¾›äº†ä¸€äº›ç¤ºä¾‹ï¼Œä»¥æ•™ç¨‹é£æ ¼å±•ç¤ºå¦‚ä½•ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åœ¨haystackä¸­è¿›è¡Œæœç´¢ã€‚APIæ–‡æ¡£ä¸­è¿˜æœ‰æ›´å¤šç¤ºä¾‹ã€‚&lt;/p>
&lt;p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæœ‰å¿…è¦å®šä¹‰ä¸€äº›æœ¯è¯­ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>regex&lt;/strong>æ˜¯ç±»å‹ä¸º&lt;code>Regex&lt;/code>çš„å€¼ã€‚æˆ‘ä»¬ç”¨&lt;code>re&lt;/code>ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼çš„å˜é‡åã€‚&lt;/li>
&lt;li>&lt;strong>pattern&lt;/strong>ç”¨äºæ„å»ºæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬ç”¨&lt;code>pat&lt;/code>ä½œä¸ºæ¨¡å¼çš„å˜é‡åã€‚&lt;/li>
&lt;li>&lt;strong>haystack&lt;/strong>æ˜¯è¢«æ­£åˆ™è¡¨è¾¾å¼æœç´¢çš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬ç”¨&lt;code>hay&lt;/code>ä½œä¸ºhaystackçš„å˜é‡åã€‚&lt;/li>
&lt;/ul>
&lt;p>æœ‰æ—¶å€™â€œregexâ€å’Œâ€œpatternâ€è¿™ä¸¤ä¸ªè¯ä¼šè¢«äº’æ¢ä½¿ç”¨ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªcrateä¸­ï¼Œå¸¸è§„è¡¨è¾¾å¼çš„ä¸€èˆ¬ä½¿ç”¨æ–¹æ³•æ˜¯å°†ä¸€ä¸ªæ¨¡å¼ç¼–è¯‘æˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç„¶åä½¿ç”¨è¯¥æ­£åˆ™è¡¨è¾¾å¼æ¥æœç´¢ã€åˆ†å‰²æˆ–æ›¿æ¢å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;h5 id="example-find-a-middle-intial">Example: find a middle intial
&lt;/h5>&lt;hr>
&lt;p>æˆ‘ä»¬ä»ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­å¼€å§‹ï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºæŸ¥æ‰¾ç‰¹å®šçš„åç§°ï¼Œä½†ä½¿ç”¨é€šé…ç¬¦æ¥åŒ¹é…ä¸­é—´åã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// We use &amp;#39;unwrap()&amp;#39; here because it would be a bug in our program if the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// pattern failed to compile to a regex. Panicking in the presence of a bug
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// is okay.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Homer (.)\. Simpson&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Homer J. Simpson&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> Some(caps) &lt;span style="color:#f92672">=&lt;/span> re.captures(hay) &lt;span style="color:#66d9ef">else&lt;/span> { &lt;span style="color:#66d9ef">return&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;J&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>caps[&lt;span style="color:#ae81ff">1&lt;/span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ç¬¬ä¸€ä¸ªä¾‹å­æœ‰äº›å€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>.&lt;/code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ¨¡å¼å…ƒå­—ç¬¦ï¼Œè¡¨ç¤ºâ€œåŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ï¼Œé™¤äº†æ¢è¡Œç¬¦ã€‚â€ï¼ˆæ›´ç²¾ç¡®åœ°è¯´ï¼Œåœ¨è¿™ä¸ª crate ä¸­ï¼Œè¡¨ç¤ºâ€œåŒ¹é…ä»»ä½• UTF-8 ç¼–ç çš„ä»»ä½• Unicode æ ‡é‡å€¼ï¼Œé™¤äº† \nã€‚â€ï¼‰&lt;/li>
&lt;li>æˆ‘ä»¬å¯ä»¥ç”¨è½¬ä¹‰å­—ç¬¦æ¥åŒ¹é…å®é™…çš„ç‚¹å·ï¼Œå³&lt;code> \.&lt;/code>ã€‚&lt;/li>
&lt;li>æˆ‘ä»¬ä½¿ç”¨ Rust çš„åŸå§‹å­—ç¬¦ä¸²æ¥é¿å…åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼è¯­æ³•å’Œ Rust çš„å­—ç¬¦ä¸²å­—é¢é‡è¯­æ³•ä¸­å¤„ç†è½¬ä¹‰åºåˆ—ã€‚å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨&lt;code>\\.&lt;/code>å»åŒ¹é…å­—ç¬¦&lt;code>.&lt;/code>ã€‚&lt;code>r&amp;quot;\.&amp;quot;&lt;/code>å’Œ&lt;code>\\.&lt;/code>æ˜¯ç­‰æ•ˆçš„æ¨¡å¼ã€‚&lt;/li>
&lt;li>æˆ‘ä»¬å°†é€šé…ç¬¦&lt;code> \.&lt;/code> æŒ‡ä»¤æ”¾åœ¨æ‹¬å·ä¸­ã€‚è¿™äº›æ‹¬å·å…·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œè¡¨ç¤ºâ€œå°† haystack ä¸­ä¸è¿™äº›æ‹¬å·åŒ¹é…çš„éƒ¨åˆ†ä½œä¸ºæ•è·ç»„å¯ç”¨â€ã€‚æ‰¾åˆ°åŒ¹é…åï¼Œæˆ‘ä»¬ä½¿ç”¨ &amp;amp;caps[1] è®¿é—®æ­¤æ•è·ç»„ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦åˆ™ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code>re.captures(hay) &lt;/code>æ‰§è¡Œæœç´¢ï¼Œå¹¶åœ¨æ²¡æœ‰åŒ¹é…æ—¶ä»æˆ‘ä»¬çš„å‡½æ•°ä¸­è¿”å›ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡è¯¢é—®ä¸æ•è·ç»„ç´¢å¼•ä¸º&lt;code>1&lt;/code>çš„éƒ¨åˆ†åŒ¹é…çš„haystackçš„é‚£ä¸€éƒ¨åˆ†æ¥å¼•ç”¨ä¸­é—´åã€‚ï¼ˆç´¢å¼•ä¸º0çš„æ•è·ç»„æ˜¯éšå¼çš„ï¼Œæ€»æ˜¯å¯¹åº”æ•´ä¸ªåŒ¹é…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‚£å°±æ˜¯&lt;code>Homer J. Simpson&lt;/code>ã€‚ï¼‰&lt;/p>
&lt;h5 id="example-named-capture-groups">Example: named capture groups
&lt;/h5>&lt;hr>
&lt;p>åœ¨æˆ‘ä»¬ä¸Šé¢çš„ä¸­é—´åˆå§‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®è°ƒæ•´ä¸€ä¸‹æ¨¡å¼ï¼Œç»™åŒ¹é…ä¸­é—´åˆå§‹çš„ç»„å‘½åï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Note that (?P&amp;lt;middle&amp;gt;.) is a different way to spell the same thing.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Homer (?&amp;lt;middle&amp;gt;.)\. Simpson&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Homer J. Simpson&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> Some(caps) &lt;span style="color:#f92672">=&lt;/span> re.captures(hay) &lt;span style="color:#66d9ef">else&lt;/span> {&lt;span style="color:#66d9ef">return&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;J&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>caps[&lt;span style="color:#e6db74">&amp;#34;middle&amp;#34;&lt;/span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»™ä¸€ç»„å‘½ååœ¨æ¨¡å¼ä¸­æœ‰å¤šä¸ªç»„æ—¶å¾ˆæœ‰ç”¨ã€‚å®ƒä½¿å¼•ç”¨è¿™äº›ç»„çš„ä»£ç æ›´å®¹æ˜“ç†è§£ã€‚&lt;/p>
&lt;h5 id="example-validating-a-particular-date-format">Example: validating a particular date format
&lt;/h5>&lt;hr>
&lt;p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ç¡®è®¤ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆhaystackï¼‰æ˜¯å¦å®Œå…¨åŒ¹é…æŸä¸ªç‰¹å®šçš„æ—¥æœŸæ ¼å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;^\d{4}-\d{2}-\d{2}$&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert!&lt;/span>(re.is_match(&lt;span style="color:#e6db74">&amp;#34;2010-03-14&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ &lt;code>^&lt;/code> å’Œ &lt;code>$&lt;/code> é”šç‚¹çš„ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªcrateä¸­ï¼Œæ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼æœç´¢éƒ½ä¼šåœ¨å…¶æ¨¡å¼çš„å¼€å¤´éšå¼åœ°åŠ ä¸Š&lt;code>(?s:.)*?&lt;/code>ï¼Œè¿™ä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åœ¨haystackçš„ä»»ä½•ä½ç½®è¿›è¡ŒåŒ¹é…ã€‚æ­£å¦‚ä¸Šé¢æ‰€æåˆ°çš„ï¼Œé”šç‚¹å¯ä»¥ç”¨æ¥ç¡®ä¿æ•´ä¸ªhaystackåŒ¹é…ä¸€ä¸ªæ¨¡å¼ã€‚&lt;/p>
&lt;p>è¿™ä¸ª crate é»˜è®¤æ˜¯ Unicode æ„ŸçŸ¥çš„ï¼Œè¿™æ„å‘³ç€ &lt;code>\d &lt;/code>å¯èƒ½ä¼šåŒ¹é…ä½ å¯èƒ½é¢„æœŸçš„æ›´å¤šå†…å®¹ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;^\d{4}-\d{2}-\d{2}$&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert!&lt;/span>(re.is_match(&lt;span style="color:#e6db74">&amp;#34;ğŸšğŸ˜ğŸ™ğŸ˜-ğŸ˜ğŸ›-ğŸ™ğŸœ&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¦ä»…åŒ¹é…ASCIIåè¿›åˆ¶æ•°å­—ï¼Œä»¥ä¸‹æ‰€æœ‰å†…å®¹éƒ½æ˜¯ç­‰æ•ˆçš„ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>[0-9]&lt;/code>&lt;/li>
&lt;li>&lt;code>[?-u:\d]&lt;/code>&lt;/li>
&lt;li>&lt;code>[[:digit:]]&lt;/code>&lt;/li>
&lt;li>&lt;code>[\d&amp;amp;&amp;amp;\p{ascii}]&lt;/code>&lt;/li>
&lt;/ul>
&lt;h5 id="example-find-dates-in-a-haystack">Example: find dates in a haystack
&lt;/h5>&lt;hr>
&lt;p>åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•éªŒè¯æ•´ä¸ªhaystackæ˜¯å¦å¯¹åº”äºç‰¹å®šçš„æ—¥æœŸæ ¼å¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä»ä¸€å¤§å †æ•°æ®ä¸­æå–å‡ºç‰¹å®šæ ¼å¼çœ‹èµ·æ¥åƒæ—¥æœŸçš„æ‰€æœ‰ä¸œè¥¿ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿè¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¿­ä»£å™¨APIæ¥æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…é¡¹ï¼ˆè¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»ç§»é™¤äº†é”šç‚¹å¹¶åˆ‡æ¢åˆ°æŸ¥æ‰¾ä»…åŒ…å«ASCIIå­—ç¬¦çš„æ•°å­—ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;[0-9]{4}-[0-9]{2}-[0-9]{2}&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;What do 1865-04-14, 1881-07-02, 1901-09-06 and 1963-11-22 have in common?&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// &amp;#39;m&amp;#39; is a &amp;#39;Match&amp;#39;, and &amp;#39;as_str()&amp;#39; returns the matching part of the haystack.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> dates: Vec&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> re.find_iter(hay).map(&lt;span style="color:#f92672">|&lt;/span>m&lt;span style="color:#f92672">|&lt;/span> m.as_str()).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(dates, &lt;span style="color:#a6e22e">vec!&lt;/span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;1865-04-14&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;1881-07-02&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;1901-09-06&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;1963-11-22&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥éå†æ•è·å€¼ï¼ˆ&lt;code>Captures&lt;/code>ï¼‰è€Œä¸æ˜¯åŒ¹é…å€¼ï¼ˆ&lt;code>Match&lt;/code>ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡æ•è·ç»„è®¿é—®æ—¥æœŸçš„æ¯ä¸ªç»„ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&amp;lt;&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>pattern)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ•è·ç»„çš„æ¨¡å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ•è·ç»„çš„åç§°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å‘½åè¯­æ³•çš„å¼€å§‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ•è·ç»„çš„å¼€å§‹&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?&amp;lt;y&amp;gt;[0-9]{4})-(?&amp;lt;m&amp;gt;[0-9]{2})-(?&amp;lt;d&amp;gt;[0-9]{2})&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;What do 1865-04-14, 1881-07-02, 1901-09-06 and 1963-11-22 have in common?&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// &amp;#39;m&amp;#39; is a &amp;#39;Match&amp;#39;, and &amp;#39;as_str()&amp;#39; returns the matching part of the haystack.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> dates: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> re.captures_iter(hay).map(&lt;span style="color:#f92672">|&lt;/span>caps&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// The unwraps are okay because every capture group must match if the whole
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// regex matches, and in this context, we know we have a match.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// Note that we use `caps.name(&amp;#34;y&amp;#34;).unwrap().as_str()` instead of
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// `&amp;amp;caps[&amp;#34;y&amp;#34;]` because the lifetime of the former is the same as the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// lifetime of `hay` above, but the lifetime of the latter is tied to the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// lifetime of `caps` due to how the `Index` trait is defined.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> year &lt;span style="color:#f92672">=&lt;/span> caps.name(&lt;span style="color:#e6db74">&amp;#34;y&amp;#34;&lt;/span>).unwrap().as_str();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> month &lt;span style="color:#f92672">=&lt;/span> caps.name(&lt;span style="color:#e6db74">&amp;#34;m&amp;#34;&lt;/span>).unwrap().as_str();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> day &lt;span style="color:#f92672">=&lt;/span> caps.name(&lt;span style="color:#e6db74">&amp;#34;d&amp;#34;&lt;/span>).unwrap().as_str();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (year, month, day)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(dates, &lt;span style="color:#a6e22e">vec!&lt;/span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1865&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;04&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;14&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1881&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;07&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;02&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1901&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;09&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;06&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1963&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;11&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;22&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="example-simpler-capture-group-extraction">Example: simpler capture group extraction
&lt;/h5>&lt;hr>
&lt;p>å¯ä»¥ä½¿ç”¨&lt;code> Captures::extract&lt;/code> å°†å‰ä¸€ä¸ªç¤ºä¾‹ä¸­çš„ä»£ç ç®€åŒ–ä¸€äº›ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;([0-9]{4})-([0-9]{2})-([0-9]{2})&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;What do 1865-04-14, 1881-07-02, 1901-09-06 and 1963-11-22 have in common?&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> dates: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> re.captures_iter(hay).map(&lt;span style="color:#f92672">|&lt;/span>caps&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (_, [year, month, day]) &lt;span style="color:#f92672">=&lt;/span> caps.extract();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (year, month, day)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(dates, &lt;span style="color:#a6e22e">vec!&lt;/span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1865&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;04&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;14&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1881&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;07&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;02&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1901&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;09&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;06&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">&amp;#34;1963&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;11&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;22&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Captures::extract&lt;/code> é€šè¿‡ç¡®ä¿åŒ¹é…çš„ç»„æ•°ä¸é€šè¿‡ &lt;code>[year, month, day] &lt;/code>è¯­æ³•è¯·æ±‚çš„ç»„æ•°åŒ¹é…æ¥å·¥ä½œã€‚å¦‚æœå®ƒä»¬åŒ¹é…ï¼Œé‚£ä¹ˆæ¯ä¸ªå¯¹åº”æ•è·ç»„çš„å­å­—ç¬¦ä¸²å°†è‡ªåŠ¨ä»¥é€‚å½“å¤§å°çš„æ•°ç»„è¿”å›ã€‚Rust çš„æ•°ç»„æ¨¡å¼åŒ¹é…è¯­æ³•è´Ÿè´£å…¶ä½™éƒ¨åˆ†ã€‚&lt;/p>
&lt;h5 id="replacement-with-named-capture-groups">replacement with named capture groups
&lt;/h5>&lt;hr>
&lt;p>åœ¨ä¹‹å‰çš„ä¾‹å­åŸºç¡€ä¸Šï¼Œä¹Ÿè®¸æˆ‘ä»¬æƒ³é‡æ–°æ’åˆ—æ—¥æœŸæ ¼å¼ã€‚å¯ä»¥é€šè¿‡æ‰¾åˆ°æ¯ä¸ªåŒ¹é…é¡¹å¹¶ç”¨ä¸åŒçš„å†…å®¹æ›¿æ¢å®ƒæ¥å®ç°ã€‚&lt;code>Regex::replace_all&lt;/code> è¿™ä¸ªå‡½æ•°æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼ŒåŒ…æ‹¬æ”¯æŒåœ¨æ›¿æ¢å­—ç¬¦ä¸²ä¸­å¼•ç”¨å‘½åç»„ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?&amp;lt;y&amp;gt;\d{4})-(?&amp;lt;m&amp;gt;\d{2})-(?&amp;lt;d&amp;gt;\d{2})&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> before &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;1973-01-05, 1975-08-25 and 1980-10-18&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> after &lt;span style="color:#f92672">=&lt;/span> re.replace_all(before, &lt;span style="color:#e6db74">&amp;#34;$m/$d/$y&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(after, &lt;span style="color:#e6db74">&amp;#34;01/05/1973, 08/25/1975 and 10/18/1980&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ›¿æ¢æ–¹æ³•å®é™…ä¸Šåœ¨æ›¿æ¢ä¸­æ˜¯å¤šæ€çš„ï¼Œè¿™æä¾›äº†æ¯”è¿™é‡Œçœ‹åˆ°çš„æ›´å¤šçš„çµæ´»æ€§ã€‚ï¼ˆæœ‰å…³ &lt;code>Regex::replace&lt;/code> çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ–‡æ¡£ã€‚ï¼‰&lt;/p>
&lt;h5 id="example-verbose-mode">Example: verbose mode
&lt;/h5>&lt;hr>
&lt;p>å½“ä½ çš„æ­£åˆ™è¡¨è¾¾å¼å˜å¾—å¤æ‚æ—¶ï¼Œä½ å¯èƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨å…¶ä»–å·¥å…·ï¼Œè€Œä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åšæŒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code>x&lt;/code> æ ‡å¿—å¯ç”¨ä¸æ˜¾ç€çš„ç©ºç™½æ¨¡å¼æˆ–â€œè¯¦ç»†æ¨¡å¼â€ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç©ºç™½è¢«è§†ä¸ºä¸æ˜¾ç€ï¼Œå¯ä»¥ç¼–å†™æ³¨é‡Šã€‚è¿™å¯èƒ½ä¼šä½¿ä½ çš„æ¨¡å¼æ›´æ˜“äºç†è§£ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?x)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> (?P&amp;lt;y&amp;gt;\d{4}) # the year, including all Unicode digits
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> -
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> (?P&amp;lt;m&amp;gt;\d{2}) # the month, including all Unicode digits
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> -
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> (?P&amp;lt;d&amp;gt;\d{2}) # the day, including all Unicode digits
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> before &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;1973-01-05, 1975-08-25 and 1980-10-18&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> after &lt;span style="color:#f92672">=&lt;/span> re.replace_all(before, &lt;span style="color:#e6db74">&amp;#34;$m/$d/$y&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(after, &lt;span style="color:#e6db74">&amp;#34;01/05/1973, 08/25/1975 and 10/18/1980&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä½ å¸Œæœ›åœ¨è¿™ç§æ¨¡å¼ä¸‹åŒ¹é…ç©ºç™½å­—ç¬¦ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨ &lt;code>\s&lt;/code>, &lt;code>\n&lt;/code>, &lt;code>\t&lt;/code> ç­‰ã€‚è¦è½¬ä¹‰å•ä¸ªç©ºæ ¼å­—ç¬¦ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code>\&lt;/code>ï¼Œä½¿ç”¨å…¶åå…­è¿›åˆ¶å­—ç¬¦ä»£ç  &lt;code>\x20&lt;/code> æˆ–æš‚æ—¶ç¦ç”¨&lt;code> x&lt;/code> æ ‡å¿—ï¼Œä¾‹å¦‚ï¼Œ&lt;code>(?-x: )&lt;/code>ã€‚&lt;/p>
&lt;h5 id="example-match-multiple-regular-expressions-simultaneously">Example: match multiple regular expressions simultaneously
&lt;/h5>&lt;p>è¿™å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ &lt;code>RegexSet&lt;/code> åœ¨ä¸€æ¬¡æ‰«æä¸­åŒ¹é…å¤šä¸ªï¼ˆå¯èƒ½é‡å çš„ï¼‰æ­£åˆ™è¡¨è¾¾å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::RegexSet;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> set &lt;span style="color:#f92672">=&lt;/span> RegexSet::new(&lt;span style="color:#f92672">&amp;amp;&lt;/span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\w+&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\d+&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\pL+&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;foo&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;bar&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;barfoo&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;foobar&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Iterate over and collect all of the matches. Each match corresponds to the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ID of the matching pattern.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> matches: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> set.matches(&lt;span style="color:#e6db74">&amp;#34;foobar&amp;#34;&lt;/span>).into_iter().collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(matches, &lt;span style="color:#a6e22e">vec!&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>, &lt;span style="color:#ae81ff">6&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// You can also test whether a particular regex matched:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> matches &lt;span style="color:#f92672">=&lt;/span> set.matches(&lt;span style="color:#e6db74">&amp;#34;foobar&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert!&lt;/span>(&lt;span style="color:#f92672">!&lt;/span>matches.matched(&lt;span style="color:#ae81ff">5&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert!&lt;/span>(matches.matched(&lt;span style="color:#ae81ff">6&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="performance">Performance
&lt;/h4>&lt;hr>
&lt;p>æœ¬èŠ‚ç®€è¦è®¨è®ºäº†æ­£åˆ™è¡¨è¾¾å¼åœ¨é€Ÿåº¦å’Œèµ„æºä½¿ç”¨æ–¹é¢çš„å‡ ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;h5 id="only-ask-for-what-you-need">Only ask for what you need
&lt;/h5>&lt;hr>
&lt;p>åœ¨ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢æ—¶ï¼Œé€šå¸¸å¯ä»¥è¯·æ±‚ä¸‰ç§ä¸åŒç±»å‹çš„ä¿¡æ¯ï¼š&lt;/p>
&lt;ol>
&lt;li>æ­£åˆ™è¡¨è¾¾å¼åœ¨haystackä¸­åŒ¹é…å—ï¼Ÿ&lt;/li>
&lt;li>æ­£åˆ™è¡¨è¾¾å¼åœ¨haystackåŒ¹é…çš„ä½ç½®ï¼Ÿ&lt;/li>
&lt;li>æ¯ä¸ªæ•è·ç»„åœ¨haystackä¸­åŒ¹é…çš„ä½ç½®åœ¨å“ªé‡Œï¼Ÿ&lt;/li>
&lt;/ol>
&lt;p>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªåº“å¯ä»¥æä¾›ä¸€ä¸ªå‡½æ•°æ¥å›ç­”#3ï¼Œè¿™ä¼šè‡ªåŠ¨åŒ…å«#1å’Œ#2ã€‚ç„¶è€Œï¼Œè®¡ç®—æ•è·ç»„åŒ¹é…ä½ç½®å¯èƒ½ä¼šæ˜¾è‘—æ›´æ˜‚è´µï¼Œæ‰€ä»¥å¦‚æœä½ ä¸éœ€è¦çš„è¯æœ€å¥½ä¸è¦è¿™æ ·åšã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œåªéœ€è¦è¯·æ±‚ä½ éœ€è¦çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åªéœ€è¦æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦åŒ¹é…ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸è¦ä½¿ç”¨&lt;code>Regex::find&lt;/code>ã€‚è€Œæ˜¯ä½¿ç”¨&lt;code>Regex::is_match&lt;/code>ã€‚&lt;/p>
&lt;h5 id="unicode-can-impact-usage-and-search-speed">Unicode can impact usage and search speed
&lt;/h5>&lt;hr>
&lt;p>è¿™ä¸ªcrateå¯¹Unicodeæœ‰ä¸€çº§æ”¯æŒå¹¶é»˜è®¤å¯ç”¨ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä¸ºäº†æ”¯æŒå®ƒæ‰€éœ€çš„é¢å¤–å†…å­˜å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå¹¶ä¸”é€šå¸¸ä¸ä¼šå½±å“æœç´¢é€Ÿåº¦ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½ä¼šæœ‰å½±å“ã€‚&lt;/p>
&lt;p>åœ¨å†…å­˜ä½¿ç”¨æ–¹é¢ï¼ŒUnicodeçš„ä¸»è¦å½±å“ä¸»è¦é€šè¿‡Unicodeå­—ç¬¦ç±»ä½“ç°ã€‚Unicodeå­—ç¬¦ç±»é€šå¸¸ç›¸å½“å¤§ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ\wåŒ¹é…å¤§çº¦14ä¸‡ä¸ªä¸åŒçš„ä»£ç ç‚¹ã€‚è¿™éœ€è¦é¢å¤–çš„å†…å­˜ï¼Œå¹¶ä¸”é€šå¸¸ä¼šå‡æ…¢æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘çš„é€Ÿåº¦ã€‚è™½ç„¶è¿™é‡Œå¶å°”ä½¿ç”¨ä¸€ä¸ª\wé€šå¸¸ä¸ä¼šè¢«æ³¨æ„åˆ°ï¼Œä½†å†™\w{100}ä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªç›¸å½“å¤§çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å®é™…ä¸Šï¼Œ\wæ¯”å…¶ä»…é™ASCIIçš„ç‰ˆæœ¬å¤§å¾—å¤šï¼Œå› æ­¤å¦‚æœæ‚¨çš„éœ€æ±‚ä»…é™äºASCIIï¼Œé‚£ä¹ˆä½¿ç”¨ASCIIç±»å¯èƒ½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ä»…é™ASCIIçš„\wå¯ä»¥ä»¥å¤šç§æ–¹å¼æ‹¼å†™ã€‚ä»¥ä¸‹æ‰€æœ‰å†…å®¹éƒ½æ˜¯ç­‰ä»·çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>[0-9A-Za-z_]&lt;/code>&lt;/li>
&lt;li>&lt;code>(?-u:\w)&lt;/code>&lt;/li>
&lt;li>&lt;code>[[:word:]]&lt;/code>&lt;/li>
&lt;li>&lt;code>[\w&amp;amp;&amp;amp;\p{ascii}]&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åœ¨æœç´¢é€Ÿåº¦æ–¹é¢ï¼ŒUnicodeé€šå¸¸èƒ½å¤Ÿå¾ˆå¥½åœ°å¤„ç†ï¼Œå³ä½¿åœ¨ä½¿ç”¨å¤§å‹Unicodeå­—ç¬¦ç±»æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç„¶è€Œï¼Œä¸€äº›æ›´å¿«çš„å†…éƒ¨æ­£åˆ™è¡¨è¾¾å¼å¼•æ“æ— æ³•å¤„ç†Unicodeæ„ŸçŸ¥çš„å•è¯è¾¹ç•Œæ–­è¨€ã€‚å› æ­¤ï¼Œå¦‚æœä½ ä¸éœ€è¦Unicodeæ„ŸçŸ¥çš„å•è¯è¾¹ç•Œæ–­è¨€ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨(?-u:\b)ä»£æ›¿\bï¼Œå…¶ä¸­å‰è€…ä½¿ç”¨ASCII-onlyçš„å•è¯å­—ç¬¦å®šä¹‰ã€‚&lt;/p>
&lt;h5 id="literals-might-accelerate-searches">Literals might accelerate searches
&lt;/h5>&lt;hr>
&lt;p>è¿™ä¸ªcrateåœ¨è¯†åˆ«æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­çš„å­—é¢é‡å¹¶ä½¿ç”¨å®ƒä»¬åŠ é€Ÿæœç´¢æ–¹é¢é€šå¸¸è¡¨ç°è‰¯å¥½ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œåœ¨ä½ çš„æ¨¡å¼ä¸­åŒ…å«æŸç§å­—é¢é‡å¯èƒ½ä¼šä½¿æœç´¢æ˜¾è‘—åŠ å¿«ã€‚ä¾‹å¦‚ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ \w+@\w+ ä¸­ï¼Œå¼•æ“ä¼šæŸ¥æ‰¾ @ çš„å‡ºç°ï¼Œç„¶åå°è¯•åå‘åŒ¹é… \w+ æ¥æ‰¾åˆ°èµ·å§‹ä½ç½®ã€‚&lt;/p>
&lt;h5 id="avoid-re-compiling-regexes-especially-in-a-loop">Avoid re-compiling regexes, especially in a loop
&lt;/h5>&lt;hr>
&lt;p>åœ¨å¾ªç¯ä¸­ç¼–è¯‘ç›¸åŒçš„æ¨¡å¼æ˜¯ä¸€ç§åæ¨¡å¼ï¼Œå› ä¸ºæ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘é€šå¸¸å¾ˆæ˜‚è´µã€‚ï¼ˆç¼–è¯‘æ—¶é—´å–å†³äºæ¨¡å¼çš„å¤§å°ï¼Œå¯èƒ½ä»å‡ å¾®ç§’åˆ°å‡ æ¯«ç§’ä¸ç­‰ã€‚ï¼‰ä¸ä»…ç¼–è¯‘æœ¬èº«æ˜‚è´µï¼Œè€Œä¸”è¿™è¿˜ä¼šé˜»æ­¢æ­£åˆ™è¡¨è¾¾å¼å¼•æ“å†…éƒ¨é‡ç”¨åˆ†é…çš„ä¼˜åŒ–ã€‚&lt;/p>
&lt;p>åœ¨ Rust ä¸­ï¼Œå¦‚æœæ­£åˆ™è¡¨è¾¾å¼åœ¨è¾…åŠ©å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œä¼ é€’å®ƒä»¬å¯èƒ½ä¼šæœ‰äº›éº»çƒ¦ã€‚ç›¸åï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ &lt;code>std::sync::LazyLock&lt;/code> æˆ– &lt;code>once_cell&lt;/code> crateï¼Œå¦‚æœä½ ä¸èƒ½ä½¿ç”¨æ ‡å‡†åº“ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ &lt;code>std::sync::LazyLock&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::sync::LazyLock;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">some_helper_function&lt;/span>(haystack: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">RE&lt;/span>: &lt;span style="color:#a6e22e">LazyLock&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Regex&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> LazyLock::new(&lt;span style="color:#f92672">||&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;...&amp;#34;&lt;/span>).unwrap());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">RE&lt;/span>.is_match(haystack)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert!&lt;/span>(some_helper_function(&lt;span style="color:#e6db74">&amp;#34;abc&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert!&lt;/span>(&lt;span style="color:#f92672">!&lt;/span>some_helper_function(&lt;span style="color:#e6db74">&amp;#34;ac&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…·ä½“æ¥è¯´ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è¿›è¡Œç¼–è¯‘ã€‚åœ¨åç»­ä½¿ç”¨ä¸­ï¼Œå®ƒä¼šé‡ç”¨ä¹‹å‰æ„å»ºçš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æ³¨æ„å¦‚ä½•å°†æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰ä¸ºç‰¹å®šå‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚&lt;/p>
&lt;h5 id="sharing-a-regex-across-threads-can-resule-in-contention">Sharing a regex across threads can resule in contention
&lt;/h5>&lt;hr>
&lt;p>è™½ç„¶å•ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åŒæ—¶ä»å¤šä¸ªçº¿ç¨‹è‡ªç”±ä½¿ç”¨ï¼Œä½†å¿…é¡»æ”¯ä»˜ä¸€å®šçš„åŒæ­¥æˆæœ¬ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œé™¤éæ¯ä¸ªçº¿ç¨‹çš„ä¸»è¦ä»»åŠ¡æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢ï¼Œå¹¶ä¸”å¤§å¤šæ•°æœç´¢éƒ½åœ¨è¾ƒçŸ­çš„å­—ç¬¦ä¸²ä¸­è¿›è¡Œï¼Œå¦åˆ™ä¸ä¼šè§‚å¯Ÿåˆ°è¿™ç§æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…±äº«èµ„æºçš„å†…éƒ¨ç«äº‰å¯èƒ½ä¼šæ¿€å¢ï¼Œå¢åŠ å»¶è¿Ÿï¼Œä»è€Œå¯èƒ½å‡æ…¢æ¯ä¸ªå•ç‹¬çš„æœç´¢ã€‚&lt;/p>
&lt;p>å¯ä»¥é€šè¿‡åœ¨å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¹‹å‰å…‹éš†æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å…‹éš†çš„æ­£åˆ™è¡¨è¾¾å¼ä»ç„¶ä¼šå…±äº«å…¶ç¼–è¯‘çŠ¶æ€çš„ç›¸åŒå†…éƒ¨åªè¯»éƒ¨åˆ†ï¼ˆå®ƒæ˜¯å¼•ç”¨è®¡æ•°çš„ï¼‰ï¼Œä½†æ¯ä¸ªçº¿ç¨‹å°†è·å¾—å¯¹è¿è¡Œæœç´¢æ—¶ä½¿ç”¨çš„å¯å˜ç©ºé—´çš„ä¼˜åŒ–è®¿é—®ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ ·åšä¸ä¼šå¢åŠ é¢å¤–çš„å†…å­˜æˆæœ¬ã€‚å”¯ä¸€çš„æˆæœ¬æ˜¯éœ€è¦æ˜¾å¼å…‹éš†æ­£åˆ™è¡¨è¾¾å¼æ‰€å¢åŠ çš„ä»£ç å¤æ‚æ€§ã€‚ï¼ˆå¦‚æœä½ åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«åŒä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯ä¸ªçº¿ç¨‹ä»ç„¶ä¼šè·å¾—è‡ªå·±çš„å¯å˜ç©ºé—´ï¼Œä½†è®¿é—®è¯¥ç©ºé—´ä¼šæ›´æ…¢ã€‚ï¼‰&lt;/p>
&lt;h4 id="unicode">Unicode
&lt;/h4>&lt;hr>
&lt;p>æœ¬èŠ‚è®¨è®ºäº†è¯¥æ­£åˆ™è¡¨è¾¾å¼åº“å¯¹Unicodeçš„æ”¯æŒæƒ…å†µã€‚åœ¨å±•ç¤ºä¸€äº›ç¤ºä¾‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ€»ç»“ä¸€ä¸‹ç›¸å…³è¦ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>è¿™ä¸ª crate å‡ ä¹å®Œå…¨å®ç°äº† Unicode æŠ€æœ¯æ ‡å‡† #18 ä¸­è§„å®šçš„â€œåŸºæœ¬ Unicode æ”¯æŒâ€ï¼ˆçº§åˆ« 1ï¼‰ã€‚æ”¯æŒçš„è¯¦ç»†ä¿¡æ¯åœ¨ regex crate ä»“åº“çš„æ ¹ç›®å½•ä¸‹çš„ UNICODE.md æ–‡ä»¶ä¸­æœ‰è¯¦ç»†è¯´æ˜ã€‚å‡ ä¹ä¸æ”¯æŒ Unicode æŠ€æœ¯æ ‡å‡† #18 ä¸­è§„å®šçš„â€œæ‰©å±• Unicode æ”¯æŒâ€ï¼ˆçº§åˆ« 2ï¼‰ã€‚&lt;/li>
&lt;li>é¡¶çº§æ­£åˆ™è¡¨è¾¾å¼åƒè¿­ä»£éå†haystackä¸­çš„æ¯ä¸ªä»£ç ç‚¹ä¸€æ ·è¿è¡Œæœç´¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒ¹é…çš„åŸºæœ¬åŸå­æ˜¯ä¸€ä¸ªå•ä¸€çš„ä»£ç ç‚¹ã€‚&lt;/li>
&lt;li>&lt;code>bytes::Regex&lt;/code> åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½å…è®¸ç¦ç”¨ Unicode æ¨¡å¼ï¼Œå¯¹æ•´ä¸ªæ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼è¿›è¡Œç¦ç”¨ã€‚å½“ Unicode æ¨¡å¼è¢«ç¦ç”¨æ—¶ï¼Œæœç´¢ä¼šåƒéå† haystack ä¸­çš„æ¯ä¸ªå­—èŠ‚ä¸€æ ·è¿›è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒ¹é…çš„åŸºæœ¬å•å…ƒæ˜¯ä¸€ä¸ªå­—èŠ‚ã€‚ï¼ˆé¡¶çº§ Regex ä¹Ÿå…è®¸ç¦ç”¨ Unicodeï¼Œä»è€Œåƒé€å­—èŠ‚åŒ¹é…ä¸€æ ·è¿›è¡ŒåŒ¹é…ï¼Œä½†ä»…åœ¨è¿™æ ·åšä¸ä¼šå…è®¸åŒ¹é…æ— æ•ˆçš„ UTF-8 æ—¶ã€‚ï¼‰&lt;/li>
&lt;li>å½“Unicodeæ¨¡å¼å¯ç”¨ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰æ—¶ï¼Œ&lt;code>.&lt;/code>å°†åŒ¹é…ä¸€ä¸ªå®Œæ•´çš„Unicodeæ ‡é‡å€¼ï¼Œå³ä½¿å®ƒä½¿ç”¨å¤šä¸ªå­—èŠ‚è¿›è¡Œç¼–ç ã€‚å½“Unicodeæ¨¡å¼ç¦ç”¨ï¼ˆä¾‹å¦‚ï¼Œ(?-u:.ï¼‰ï¼‰æ—¶ï¼Œ&lt;code>.&lt;/code>å°†å§‹ç»ˆåŒ¹é…ä¸€ä¸ªå­—èŠ‚ã€‚&lt;/li>
&lt;li>å­—ç¬¦ç±» &lt;code>\w&lt;/code>, &lt;code>\d&lt;/code> å’Œ &lt;code>\s&lt;/code> é»˜è®¤æ˜¯ Unicode æ„ŸçŸ¥çš„ã€‚ä½¿ç”¨&lt;code> (?-u:\w)&lt;/code>, &lt;code>(?-u:\d) &lt;/code>å’Œ &lt;code>(?-u:\s)&lt;/code> å¯ä»¥è·å–å®ƒä»¬çš„ ASCII ä»…å®šä¹‰ã€‚&lt;/li>
&lt;li>åŒæ ·ï¼Œ&lt;code>\b&lt;/code> å’Œ &lt;code>\B&lt;/code> ä½¿ç”¨ Unicode å®šä¹‰çš„â€œå•è¯â€å­—ç¬¦ã€‚è¦è·å–ä»…é™ ASCII çš„å•è¯è¾¹ç•Œï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>(?-u:\b)&lt;/code> å’Œ &lt;code>(?-u:\B)&lt;/code>ã€‚è¿™ä¹Ÿé€‚ç”¨äºç‰¹æ®Šçš„å•è¯è¾¹ç•Œæ–­è¨€ã€‚ï¼ˆå³ &lt;code>\b{start}&lt;/code>ï¼Œ&lt;code>\b{end}&lt;/code>ï¼Œ&lt;code>\b{start-half}&lt;/code>ï¼Œ&lt;code>\b{end-half}&lt;/code>ã€‚ï¼‰&lt;/li>
&lt;li>åœ¨å¤šè¡Œæ¨¡å¼ä¸‹ï¼Œ&lt;code>^ &lt;/code>å’Œ&lt;code> $&lt;/code> ä¸æ˜¯ Unicode æ„ŸçŸ¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬åªè¯†åˆ«&lt;code> \n&lt;/code>ï¼ˆå‡è®¾æœªå¯ç”¨ CRLF æ¨¡å¼ï¼‰ï¼Œè€Œä¸è¯†åˆ« Unicode å®šä¹‰çš„å…¶ä»–ä»»ä½•è¡Œç»ˆæ­¢ç¬¦ã€‚&lt;/li>
&lt;li>ä¸åŒºåˆ†å¤§å°å†™çš„æœç´¢æ˜¯Unicodeæ„ŸçŸ¥çš„ï¼Œå¹¶ä½¿ç”¨ç®€å•çš„å¤§å°å†™æŠ˜å ã€‚&lt;/li>
&lt;li>Unicodeé€šç”¨ç±»åˆ«ã€è„šæœ¬å’Œè®¸å¤šå¸ƒå°”å±æ€§å¯ä»¥é€šè¿‡é»˜è®¤çš„\p{å±æ€§åç§°}è¯­æ³•è®¿é—®ã€‚&lt;/li>
&lt;li>åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼ŒåŒ¹é…éƒ½æ˜¯ä½¿ç”¨å­—èŠ‚åç§»é‡æŠ¥å‘Šçš„ã€‚æ›´ç²¾ç¡®åœ°è¯´ï¼Œæ˜¯ä½¿ç”¨UTF-8ä»£ç å•å…ƒåç§»é‡ã€‚è¿™å…è®¸å¯¹haystackè¿›è¡Œå¸¸æ•°æ—¶é—´çš„ç´¢å¼•å’Œåˆ‡ç‰‡ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ¨¡å¼æœ¬èº«ä»…è¢«è§£é‡Šä¸ºUnicodeæ ‡é‡å€¼çš„åºåˆ—ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä½ çš„æ¨¡å¼ä¸­ç›´æ¥ä½¿ç”¨Unicodeå­—ç¬¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?i)Î”+&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;Î”Î´Î”&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>((&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">6&lt;/span>), (m.start(), m.end()));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// alternatively:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">6&lt;/span>, m.range());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚ä¸Šæ‰€è¿°ï¼ŒUnicodeé€šç”¨ç±»åˆ«ã€è„šæœ¬ã€è„šæœ¬æ‰©å±•ã€ç‰ˆæœ¬ä»¥åŠä¸€äº›å¸ƒå°”å±æ€§éƒ½å¯ä»¥ä½œä¸ºå­—ç¬¦ç±»ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åŒ¹é…ä¸€ä¸²æ•°å­—ã€å¸Œè…Šå­—æ¯æˆ– Cherokee å­—æ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;[\pN\p{Greek}\p{Cherokee}]+&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;abcÎ”á Î²â… á´Î³Î´â…¡xyz&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">23&lt;/span>, m.range());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="opt-out-of-unicode-support">Opt out of Unicode support
&lt;/h5>&lt;hr>
&lt;p>&lt;code>bytes::Regex&lt;/code>ç±»å‹å¯ä»¥æœç´¢&lt;code>&amp;amp;[u8]&lt;/code>haystackã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œhaystacks é€šå¸¸åƒä¸» &lt;code>Regex&lt;/code> ç±»å‹ä¸€æ ·è¢«å½“ä½œ UTF-8 å¤„ç†ã€‚ç„¶è€Œï¼Œå¯ä»¥é€šè¿‡å…³é—­&lt;code>u&lt;/code>æ ‡å¿—æ¥ç¦ç”¨æ­¤è¡Œä¸ºï¼Œå³ä½¿è¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´åŒ¹é…æ— æ•ˆçš„UTF-8ã€‚ä¾‹å¦‚ï¼Œå½“å…³é—­&lt;code>u&lt;/code>æ ‡å¿—æ—¶ï¼Œ&lt;code>.&lt;/code>å°†åŒ¹é…ä»»ä½•å­—èŠ‚è€Œä¸æ˜¯ä»»ä½•Unicodeæ ‡é‡å€¼ã€‚&lt;/p>
&lt;p>ç¦ç”¨ &lt;code>u&lt;/code> æ ‡å¿—ä¹Ÿå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ &lt;code>&amp;amp;str&lt;/code> åŸºäºçš„ Regex ç±»å‹ï¼Œä½†ä»…åœ¨ç»´æŠ¤ UTF-8 ä¸å˜æ€§çš„æƒ…å†µä¸‹å…è®¸ã€‚ä¾‹å¦‚ï¼Œ&lt;code>(?-u:\w)&lt;/code> æ˜¯ä¸€ä¸ªä»…åŒ…å« ASCII å­—ç¬¦çš„ \w å­—ç¬¦ç±»ï¼Œå¹¶ä¸”åœ¨ &lt;code>&amp;amp;str&lt;/code> åŸºäºçš„ Regex ä¸­æ˜¯åˆæ³•çš„ï¼Œä½† &lt;code>(?-u:\W)&lt;/code>å°†å°è¯•åŒ¹é…ä¸åœ¨&lt;code>(?-u:\w)&lt;/code>ä¸­çš„ä»»ä½•å­—èŠ‚ï¼Œè¿™åè¿‡æ¥åŒ…æ‹¬æ— æ•ˆçš„ UTF-8 å­—èŠ‚ã€‚åŒæ ·ï¼Œ&lt;code>(?-u:\xFF)&lt;/code>å°†å°è¯•åŒ¹é…åŸå§‹å­—èŠ‚ &lt;code>\xFF&lt;/code>ï¼ˆè€Œä¸æ˜¯ U+00FFï¼‰ï¼Œè¿™æ˜¯æ— æ•ˆçš„ UTF-8ï¼Œå› æ­¤åœ¨ &lt;code>&amp;amp;str&lt;/code> åŸºäºçš„æ­£åˆ™è¡¨è¾¾å¼ä¸­æ˜¯éæ³•çš„ã€‚&lt;/p>
&lt;p>æœ€åï¼Œç”±äºUnicodeæ”¯æŒéœ€è¦æ‰“åŒ…å¤§å‹Unicodeæ•°æ®è¡¨ï¼Œè¯¥crateæä¾›äº†æ§åˆ¶å°å¼€å…³æ¥ç¦ç”¨è¿™äº›æ•°æ®è¡¨çš„ç¼–è¯‘ï¼Œè¿™åœ¨ç¼©å°äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°å’Œå‡å°‘ç¼–è¯‘æ—¶é—´æ–¹é¢å¯èƒ½å¾ˆæœ‰ç”¨ã€‚æœ‰å…³å¦‚ä½•å®ç°è¿™ä¸€ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…crateåŠŸèƒ½éƒ¨åˆ†ã€‚&lt;/p>
&lt;h4 id="syntax">Syntax
&lt;/h4>&lt;hr>
&lt;p>æœ¬åº“æ”¯æŒçš„è¯­æ³•å¦‚ä¸‹ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼Œæ­£åˆ™è¡¨è¾¾å¼è§£æå™¨å’ŒæŠ½è±¡è¯­æ³•åœ¨å•ç‹¬çš„ crate &lt;code>regex-syntax&lt;/code> ä¸­æš´éœ²ã€‚&lt;/p>
&lt;h5 id="matching-one-character">Matching one character
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-tcl" data-lang="tcl">&lt;span style="display:flex;">&lt;span>. é™¤äº†æ¢è¡Œç¬¦&lt;span style="color:#960050;background-color:#1e0010">ï¼ˆ&lt;/span>åŒ…æ‹¬å¸¦æœ‰ s æ ‡å¿—çš„æ¢è¡Œç¬¦&lt;span style="color:#960050;background-color:#1e0010">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">[&lt;/span>0-9&lt;span style="color:#66d9ef">]&lt;/span> ä»»ä½• ASCII æ•°å­—
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>d æ•°å­— &lt;span style="color:#66d9ef">(&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p&lt;span style="color:#66d9ef">{&lt;/span>Nd&lt;span style="color:#66d9ef">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>D éæ•°å­—
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>pX ç”±ä¸€ä¸ªå­—æ¯åç§°æ ‡è¯†çš„Unicodeå­—ç¬¦ç±»
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p&lt;span style="color:#66d9ef">{&lt;/span>Greek&lt;span style="color:#66d9ef">}&lt;/span> Unicodeå­—ç¬¦ç±»&lt;span style="color:#960050;background-color:#1e0010">ï¼ˆ&lt;/span>é€šç”¨ç±»åˆ«æˆ–è„šæœ¬&lt;span style="color:#960050;background-color:#1e0010">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>PX ç”±ä¸€ä¸ªå­—æ¯åç§°æ ‡è¯†çš„å¦å®šUnicodeå­—ç¬¦ç±»
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>P&lt;span style="color:#66d9ef">{&lt;/span>Greek&lt;span style="color:#66d9ef">}&lt;/span> å¦å®šçš„Unicodeå­—ç¬¦ç±»&lt;span style="color:#960050;background-color:#1e0010">ï¼ˆ&lt;/span>é€šç”¨ç±»åˆ«æˆ–è„šæœ¬&lt;span style="color:#960050;background-color:#1e0010">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="character-classes">Character classes
&lt;/h5>&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>[xyz] A character class matching either x, y or z (&lt;span style="color:#66d9ef">union&lt;/span>).
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#f92672">^&lt;/span>xyz] A character class matching any character except x, y and z.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[a&lt;span style="color:#f92672">-&lt;/span>z] A character class matching any character &lt;span style="color:#66d9ef">in&lt;/span> range a&lt;span style="color:#f92672">-&lt;/span>z.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">alpha&lt;/span>:]] &lt;span style="color:#66d9ef">ASCII&lt;/span> character class ([A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#f92672">^&lt;/span>alpha:]] Negated &lt;span style="color:#66d9ef">ASCII&lt;/span> character class ([&lt;span style="color:#f92672">^&lt;/span>A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[x[&lt;span style="color:#f92672">^&lt;/span>xyz]] Nested&lt;span style="color:#f92672">/&lt;/span>grouping character class (matching any character except y and z)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[a&lt;span style="color:#f92672">-&lt;/span>y&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span>xyz] Intersection (matching x or y)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span>[&lt;span style="color:#f92672">^&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>]] Subtraction using intersection and negation (matching &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span> except &lt;span style="color:#ae81ff">4&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#f92672">--&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>] Direct subtraction (matching &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span> except &lt;span style="color:#ae81ff">4&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[a&lt;span style="color:#f92672">-&lt;/span>g&lt;span style="color:#f92672">~~&lt;/span>b&lt;span style="color:#f92672">-&lt;/span>h] Symmetric difference (matching &lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>a&lt;span style="color:#960050;background-color:#1e0010">`&lt;/span> and &lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>h&lt;span style="color:#960050;background-color:#1e0010">`&lt;/span> only)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>[&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>]] Escaping &lt;span style="color:#66d9ef">in&lt;/span> character classes (matching [ or ])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[a&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span>b] An empty character class matching nothing
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»»ä½•å‘½åå­—ç¬¦ç±»éƒ½å¯ä»¥å‡ºç°åœ¨æ–¹æ‹¬å·&lt;code> [... ]&lt;/code> å­—ç¬¦ç±»ä¸­ã€‚ä¾‹å¦‚ï¼Œ&lt;code>[\p{Greek}[:digit:]]&lt;/code> åŒ¹é…ä»»ä½• ASCII æ•°å­—æˆ–å¸Œè…Šå­—æ¯è¡¨ä¸­çš„ä»»ä½•ä»£ç ç‚¹ã€‚&lt;code>[\p{Greek}&amp;amp;&amp;amp;\pL]&lt;/code> åŒ¹é…å¸Œè…Šå­—æ¯ã€‚&lt;/p>
&lt;p>å­—ç¬¦ç±»ä¸­çš„ä¼˜å…ˆçº§ï¼Œä»æœ€ç»‘å®šåˆ°æœ€ä¸ç»‘å®šï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>èŒƒå›´ï¼š&lt;code>[a-cd]&lt;/code> == &lt;code>[[a-c]d]&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¹¶é›†ï¼š&lt;code>[ab&amp;amp;&amp;amp;bc]&lt;/code> == &lt;code>[[ab]&amp;amp;&amp;amp;[bc]]&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>äº¤é›†ã€å·®é›†ã€å¯¹ç§°å·®é›†ã€‚è¿™ä¸‰ç§è¿ç®—ç¬¦å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼Œå¹¶æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºè¿›è¡Œè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œ&lt;code>[\pL--\p{Greek}&amp;amp;&amp;amp;\p{Uppercase}]&lt;/code> == &lt;code>[[\pL--\p{Greek}]&amp;amp;&amp;amp;\p{Uppercase}]&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦å®šï¼š&lt;code>[^a-z&amp;amp;&amp;amp;b]&lt;/code> == &lt;code>[^[a-z&amp;amp;&amp;amp;b]]&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h5 id="composites">Composites
&lt;/h5>&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>xy concatenation (x followed by y)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">|&lt;/span>y alternation (x or y, prefer x)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> haystack &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;samwise&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// If &amp;#39;samwise&amp;#39; comes first in our alternation, then it is
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// preferred as a match, even if the regex engine could
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// technically detect that &amp;#39;sam&amp;#39; led to a match earlier.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;samwise|sam&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;samwise&amp;#34;&lt;/span>, re.find(haystack).unwrap().as_str());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// But if &amp;#39;sam&amp;#39; comes first, then it will match instead.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// In this case, it is impossible for &amp;#39;samwise&amp;#39; to match
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// because &amp;#39;sam&amp;#39; is a prefix of it.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;sam|samwise&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;sam&amp;#34;&lt;/span>, re.find(haystack).unwrap().as_str());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="repetitions">Repetitions
&lt;/h5>&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">*&lt;/span> zero or more of x (greedy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">+&lt;/span> one or more of x (greedy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">?&lt;/span> zero or one of x (greedy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">*?&lt;/span> zero or more of x (ungreedy&lt;span style="color:#f92672">/&lt;/span>lazy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">+?&lt;/span> one or more of x (ungreedy&lt;span style="color:#f92672">/&lt;/span>lazy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x&lt;span style="color:#f92672">??&lt;/span> zero or one of x (ungreedy&lt;span style="color:#f92672">/&lt;/span>lazy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n,m} at least n x and at most m x (greedy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n,} at least n x (greedy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n} exactly n x
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n,m}&lt;span style="color:#f92672">?&lt;/span> at least n x and at most m x (ungreedy&lt;span style="color:#f92672">/&lt;/span>lazy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n,}&lt;span style="color:#f92672">?&lt;/span> at least n x (ungreedy&lt;span style="color:#f92672">/&lt;/span>lazy)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x{n}&lt;span style="color:#f92672">?&lt;/span> exactly n x
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="empty-matches">Empty Matches
&lt;/h5>&lt;hr>
&lt;p>ç©ºæ­£åˆ™è¡¨è¾¾å¼æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”åŒ¹é…ç©ºå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œç©ºæ­£åˆ™è¡¨è¾¾å¼åœ¨ä½ç½®0ã€1ã€2å’Œ3å¤„åŒ¹é…abcã€‚åœ¨ä½¿ç”¨é¡¶çº§&lt;code>Regex&lt;/code>å¯¹&lt;code>&amp;amp;str&lt;/code> haystacksè¿›è¡ŒåŒ¹é…æ—¶ï¼Œç©ºåŒ¹é…ä¼šåˆ†å‰²ä»£ç ç‚¹ï¼Œå› æ­¤æ°¸è¿œä¸ä¼šè¿”å›ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨&lt;code>bytes::Regex&lt;/code>æ—¶ï¼Œå…è®¸è¿™æ ·çš„åŒ¹é…ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> regex::Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> ranges: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> re.find_iter(&lt;span style="color:#e6db74">&amp;#34;ğŸ’©&amp;#34;&lt;/span>).map(&lt;span style="color:#f92672">|&lt;/span>m&lt;span style="color:#f92672">|&lt;/span> m.range()).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(ranges, &lt;span style="color:#a6e22e">vec!&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> regex::bytes::Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> ranges: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> re.find_iter(&lt;span style="color:#e6db74">&amp;#34;ğŸ’©&amp;#34;&lt;/span>.as_bytes()).map(&lt;span style="color:#f92672">|&lt;/span>m&lt;span style="color:#f92672">|&lt;/span> m.range()).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(ranges, &lt;span style="color:#a6e22e">vec!&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ï¼Œç©ºæ­£åˆ™è¡¨è¾¾å¼ä¸æ°¸è¿œæ— æ³•åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸åŒçš„ã€‚ä¾‹å¦‚ï¼Œæ­£åˆ™è¡¨è¾¾å¼ [a&amp;amp;&amp;amp;b] æ˜¯ä¸€ä¸ªå­—ç¬¦ç±»ï¼Œè¡¨ç¤º a å’Œ b çš„äº¤é›†ã€‚è¿™ä¸ªäº¤é›†æ˜¯ç©ºçš„ï¼Œè¿™æ„å‘³ç€å­—ç¬¦ç±»æ˜¯ç©ºçš„ã€‚ç”±äºç©ºé›†ä¸­æ²¡æœ‰ä¸œè¥¿ï¼Œ[a&amp;amp;&amp;amp;b] ä¸åŒ¹é…ä»»ä½•ä¸œè¥¿ï¼Œç”šè‡³ä¸åŒ¹é…ç©ºå­—ç¬¦ä¸²ã€‚&lt;/p>
&lt;h5 id="grouping-and-flags">Grouping and flags
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>(exp) &lt;span style="color:#960050;background-color:#1e0010">ç¼–å·æ•è·ç»„ï¼ˆæŒ‰æ‰“å¼€æ‹¬å·ç´¢å¼•ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&lt;/span>P&lt;span style="color:#f92672">&amp;lt;&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>exp) &lt;span style="color:#960050;background-color:#1e0010">å‘½åï¼ˆä¹Ÿå¯ç¼–å·ï¼‰æ•è·ç»„ï¼ˆåç§°å¿…é¡»ä¸ºå­—æ¯æ•°å­—ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&amp;lt;&lt;/span>name&lt;span style="color:#f92672">&amp;gt;&lt;/span>exp) &lt;span style="color:#960050;background-color:#1e0010">å‘½åï¼ˆä¹Ÿå¯ç¼–å·ï¼‰æ•è·ç»„ï¼ˆåç§°å¿…é¡»ä¸ºå­—æ¯æ•°å­—ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&lt;/span>:&lt;span style="color:#a6e22e">exp&lt;/span>) &lt;span style="color:#960050;background-color:#1e0010">éæ•è·ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&lt;/span>flags) &lt;span style="color:#960050;background-color:#1e0010">åœ¨å½“å‰ç»„å†…è®¾ç½®æ ‡å¿—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">?&lt;/span>flags:&lt;span style="color:#a6e22e">exp&lt;/span>) &lt;span style="color:#960050;background-color:#1e0010">è®¾ç½®&lt;/span>expçš„æ ‡å¿—&lt;span style="color:#960050;background-color:#1e0010">ï¼ˆéæ•è·ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ•è·ç»„åç§°å¿…é¡»æ˜¯ä»»ä½•ç”±å­—æ¯ã€æ•°å­—å’Œ Unicode ä»£ç ç‚¹ç»„æˆçš„åºåˆ—ï¼Œæ­¤å¤–è¿˜å¯ä»¥åŒ…å« &lt;code>.&lt;/code>ã€&lt;code>_&lt;/code>ã€&lt;code>[&lt;/code> å’Œ&lt;code> ]&lt;/code>ã€‚åç§°å¿…é¡»ä»¥ &lt;code>_&lt;/code> æˆ–å­—æ¯ä»£ç ç‚¹å¼€å¤´ã€‚å­—æ¯ç ç‚¹å¯¹åº”äºå­—æ¯Unicodeå±æ€§ï¼Œè€Œæ•°å­—ç ç‚¹å¯¹åº”äºåè¿›åˆ¶æ•°å­—ã€å­—æ¯æ•°å­—å’Œå…¶ä»–æ•°å­—é€šç”¨ç±»åˆ«çš„å¹¶é›†ã€‚&lt;/p>
&lt;p>æ ‡å¿—æ˜¯å•ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ&lt;code>(?x)&lt;/code> è®¾ç½®æ ‡å¿— &lt;code>x&lt;/code>ï¼Œ&lt;code>(?-x)&lt;/code> æ¸…é™¤æ ‡å¿— &lt;code>x&lt;/code>ã€‚å¯ä»¥åŒæ—¶è®¾ç½®æˆ–æ¸…é™¤å¤šä¸ªæ ‡å¿—ï¼š&lt;code>(?xy)&lt;/code> åŒæ—¶è®¾ç½®æ ‡å¿— &lt;code>x&lt;/code> å’Œ &lt;code>y&lt;/code>ï¼Œ&lt;code>(?x-y)&lt;/code> è®¾ç½®æ ‡å¿— &lt;code>x&lt;/code> å¹¶æ¸…é™¤æ ‡å¿— &lt;code>y&lt;/code>ã€‚&lt;/p>
&lt;p>æ‰€æœ‰æ ‡å¿—é»˜è®¤æƒ…å†µä¸‹æ˜¯ç¦ç”¨çš„ï¼Œé™¤éå¦æœ‰è¯´æ˜ã€‚å®ƒä»¬æ˜¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>i &lt;span style="color:#960050;background-color:#1e0010">ä¸åŒºåˆ†å¤§å°å†™ï¼šå­—æ¯åŒ¹é…å¤§å°å†™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>m &lt;span style="color:#960050;background-color:#1e0010">å¤šè¡Œæ¨¡å¼ï¼š&lt;/span>&lt;span style="color:#f92672">^&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å’Œ&lt;/span> &lt;span style="color:#75715e">$&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">åŒ¹é…è¡Œçš„å¼€å§‹&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">ç»“æŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>s &lt;span style="color:#960050;background-color:#1e0010">å…è®¸&lt;/span> . &lt;span style="color:#960050;background-color:#1e0010">åŒ¹é…&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>n
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>R &lt;span style="color:#960050;background-color:#1e0010">å¯ç”¨&lt;/span>CRLFæ¨¡å¼&lt;span style="color:#960050;background-color:#1e0010">ï¼šå½“å¯ç”¨å¤šè¡Œæ¨¡å¼æ—¶ï¼Œä½¿ç”¨\&lt;/span>r&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>n
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>U &lt;span style="color:#960050;background-color:#1e0010">äº¤æ¢&lt;/span> x&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å’Œ&lt;/span> x&lt;span style="color:#f92672">*?&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">çš„å«ä¹‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>u Unicode &lt;span style="color:#960050;background-color:#1e0010">æ”¯æŒï¼ˆé»˜è®¤å¯ç”¨ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>x &lt;span style="color:#960050;background-color:#1e0010">è¯¦ç»†æ¨¡å¼ï¼Œå¿½ç•¥ç©ºç™½å­—ç¬¦å¹¶å…è®¸è¡Œæ³¨é‡Šï¼ˆä»¥&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>#&lt;span style="color:#960050;background-color:#1e0010">`&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å¼€å§‹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¯¦ç»†æ¨¡å¼ä¸‹ï¼Œç©ºç™½å­—ç¬¦åœ¨ä»»ä½•åœ°æ–¹éƒ½ä¼šè¢«å¿½ç•¥ï¼ŒåŒ…æ‹¬åœ¨å­—ç¬¦ç±»ä¸­ã€‚è¦æ’å…¥ç©ºç™½å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨å…¶è½¬ä¹‰å½¢å¼æˆ–åå…­è¿›åˆ¶å­—é¢é‡ã€‚ä¾‹å¦‚ï¼Œ&lt;code>\ &lt;/code> æˆ– &lt;code>\x20&lt;/code> ç”¨äºè¡¨ç¤º ASCII ç©ºæ ¼ã€‚&lt;/p>
&lt;p>åœ¨æ¨¡å¼ä¸­å¯ä»¥åˆ‡æ¢æ ‡å¿—ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå‰åŠéƒ¨åˆ†ä¸åŒºåˆ†å¤§å°å†™ï¼ŒååŠéƒ¨åˆ†åŒºåˆ†å¤§å°å†™ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">&amp;#34;r(?i)a+(?-i)b+&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;AaAaAabbBBBb&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(m.as_str(), &lt;span style="color:#e6db74">&amp;#34;AaAaAabb&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ï¼Œ&lt;code>a+&lt;/code> åŒ¹é…&lt;code>a&lt;/code> æˆ–&lt;code>A&lt;/code>ï¼Œä½† &lt;code>b+&lt;/code> åªåŒ¹é… &lt;code>b&lt;/code>ã€‚&lt;/p>
&lt;p>å¤šè¡Œæ¨¡å¼æ„å‘³ç€ ^ å’Œ $ ä¸å†ä»…åŒ¹é…è¾“å…¥çš„å¼€å§‹/ç»“æŸä½ç½®ï¼Œè¿˜åŒ¹é…è¡Œçš„å¼€å§‹/ç»“æŸä½ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?m)^line \d+&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;line one&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">line 2&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(m.as_str(), &lt;span style="color:#e6db74">&amp;#34;line 2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ ^ åŒ¹é…åœ¨æ–°è¡Œä¹‹åï¼Œå³ä½¿åœ¨è¾“å…¥çš„æœ«å°¾ä¹Ÿæ˜¯å¦‚æ­¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?m)^&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find_iter(&lt;span style="color:#e6db74">&amp;#34;test&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>).last().unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>((m.start(), m.end()), (&lt;span style="color:#ae81ff">5&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“åŒæ—¶å¯ç”¨CRLFæ¨¡å¼å’Œå¤šè¡Œæ¨¡å¼æ—¶ï¼Œ&lt;code>^&lt;/code>å’Œ&lt;code>$&lt;/code>å°†åŒ¹é…&lt;code>\r&lt;/code>æˆ–&lt;code>\n&lt;/code>ï¼Œä½†æ°¸è¿œä¸ä¼šåœ¨&lt;code>\r\n&lt;/code>ä¸­é—´ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?mR)^foo$&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\r\n&lt;/span>&lt;span style="color:#e6db74">foo&lt;/span>&lt;span style="color:#ae81ff">\r\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(m.as_str(), &lt;span style="color:#e6db74">&amp;#34;foo&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Unicodeæ¨¡å¼ä¹Ÿå¯ä»¥é€‰æ‹©æ€§åœ°ç¦ç”¨ï¼Œå°½ç®¡åªæœ‰åœ¨ç»“æœä¸ä¼šåŒ¹é…æ— æ•ˆçš„UTF-8æ—¶æ‰è¿™æ ·åšã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ä½¿ç”¨ASCIIå•è¯è¾¹ç•Œè€Œä¸æ˜¯Unicodeå•è¯è¾¹ç•Œï¼Œè¿™å¯èƒ½ä¼šä½¿æŸäº›æ­£åˆ™è¡¨è¾¾å¼æœç´¢è¿è¡Œå¾—æ›´å¿«ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> regex::Regex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> re &lt;span style="color:#f92672">=&lt;/span> Regex::new(&lt;span style="color:#e6db74">r&lt;/span>&lt;span style="color:#e6db74">&amp;#34;(?-u:\b).+(?-u:\b)&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> re.find(&lt;span style="color:#e6db74">&amp;#34;$$abc$$&amp;#34;&lt;/span>).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">assert_eq!&lt;/span>(m.as_str(), &lt;span style="color:#e6db74">&amp;#34;abc&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="escape-sequences">Escape sequences
&lt;/h5>&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">*&lt;/span> literal &lt;span style="color:#f92672">*&lt;/span>, applies to all &lt;span style="color:#66d9ef">ASCII&lt;/span> except [&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>a bell (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x07)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>f form feed (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x0C)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>t horizontal tab
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>n new line
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>r carriage &lt;span style="color:#66d9ef">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>v vertical tab (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x0B)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>A matches at the beginning of a haystack
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>z matches at the end of a haystack
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>b word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>B negated word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>b{start}, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span> start&lt;span style="color:#f92672">-&lt;/span>of&lt;span style="color:#f92672">-&lt;/span>word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>b{end}, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> end&lt;span style="color:#f92672">-&lt;/span>of&lt;span style="color:#f92672">-&lt;/span>word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>b{start&lt;span style="color:#f92672">-&lt;/span>half} half of a start&lt;span style="color:#f92672">-&lt;/span>of&lt;span style="color:#f92672">-&lt;/span>word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>b{end&lt;span style="color:#f92672">-&lt;/span>half} half of a end&lt;span style="color:#f92672">-&lt;/span>of&lt;span style="color:#f92672">-&lt;/span>word boundary assertion
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">123&lt;/span> octal character code, up to three digits (when enabled)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x7F hex character code (exactly two digits)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x{&lt;span style="color:#ae81ff">10&lt;/span>FFFF} any hex character code corresponding to a Unicode code point
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u007F hex character code (exactly four digits)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u{&lt;span style="color:#ae81ff">7&lt;/span>F} any hex character code corresponding to a Unicode code point
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#66d9ef">U0000007F&lt;/span> hex character code (exactly eight digits)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>U{&lt;span style="color:#ae81ff">7&lt;/span>F} any hex character code corresponding to a Unicode code point
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{Letter} Unicode character class
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>P{Letter} negated Unicode character class
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>d, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>s, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>w Perl character class
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>D, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>S, &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>W negated Perl character class
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="perl-character-classes-unicode-friendly">Perl character classes (Unicode friendly)
&lt;/h5>&lt;hr>
&lt;p>è¿™äº›ç±»åŸºäºUTS#18ä¸­æä¾›çš„å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>d digit (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{Nd})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>D not digit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>s whitespace (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{White_Space})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>S not whitespace
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>w word character (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{Alphabetic} &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{M} &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>d &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{Pc} &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>p{Join_Control})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>W not word character
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ascii-character-classes">ASCII character classes
&lt;/h5>&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">alnum&lt;/span>:]] alphanumeric ([&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">alpha&lt;/span>:]] alphabetic ([A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">ascii&lt;/span>:]] &lt;span style="color:#66d9ef">ASCII&lt;/span> ([&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x00&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x7F])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">blank&lt;/span>:]] blank ([&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>t ])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">cntrl&lt;/span>:]] control ([&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x00&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x1F&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>x7F])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">digit&lt;/span>:]] digits ([&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">graph&lt;/span>:]] graphical ([&lt;span style="color:#f92672">!-~&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">lower&lt;/span>:]] lower case ([a&lt;span style="color:#f92672">-&lt;/span>z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">print&lt;/span>:]] printable ([ &lt;span style="color:#f92672">-~&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">punct&lt;/span>:]] punctuation ([&lt;span style="color:#f92672">!-/&lt;/span>:&lt;span style="color:#f92672">-@&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">`&lt;/span>{&lt;span style="color:#f92672">-~&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">space&lt;/span>:]] whitespace ([&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>t&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>n&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>v&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>f&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>r ])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">upper&lt;/span>:]] upper case ([A&lt;span style="color:#f92672">-&lt;/span>Z])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">word&lt;/span>:]] word characters ([&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>A&lt;span style="color:#f92672">-&lt;/span>Za&lt;span style="color:#f92672">-&lt;/span>z_])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[[:&lt;span style="color:#a6e22e">xdigit&lt;/span>:]] hex digit ([&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>A&lt;span style="color:#f92672">-&lt;/span>Fa&lt;span style="color:#f92672">-&lt;/span>f])
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>[åŸåœ°å€][https://docs.rs/regex/latest/regex/ ]&lt;/p>
&lt;hr>
&lt;h4 id="å•è¯">å•è¯
&lt;/h4>&lt;ul>
&lt;li>&lt;code>verbose&lt;/code>:
&lt;ul>
&lt;li>&lt;code>adj.&lt;/code> å†—é•¿çš„ï¼Œå•°å—¦çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>routine&lt;/code>:
&lt;ul>
&lt;li>&lt;code>n.&lt;/code> å¸¸è§„ï¼Œ æ— èŠ&lt;/li>
&lt;li>&lt;code>adj.&lt;/code> å¸¸è§„çš„ï¼Œæ— èŠçš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>subsequent&lt;/code>ï¼š
&lt;ul>
&lt;li>&lt;code>adj.&lt;/code>éšåçš„ï¼Œåæ¥çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>wildcard&lt;/code>:
&lt;ul>
&lt;li>&lt;code>n.&lt;/code>é€šé…ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>tweak&lt;/code>
&lt;ul>
&lt;li>&lt;code>adj.&lt;/code>ç¨å¾®è°ƒæ•´ï¼Œæ‹§ï¼Œæ‰¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>polymorphic&lt;/code>
&lt;ul>
&lt;li>&lt;code>adj.&lt;/code>å¤šæ€çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>insignificant&lt;/code>
&lt;ul>
&lt;li>&lt;code>adj.&lt;/code>å¾®ä¸è¶³é“çš„ï¼›æ— è¶³è½»é‡çš„ï¼›æ— æ„ä¹‰çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>comprehend&lt;/code>
&lt;ul>
&lt;li>&lt;code>vt.&lt;/code>ç†è§£ï¼Œé¢†æ‚Ÿï¼ŒåŒ…å«&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>simultaneously&lt;/code>
&lt;ul>
&lt;li>&lt;code>adv.&lt;/code>åŒæ—¶åœ°ï¼ŒåŒæ­¥åœ°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>overlap&lt;/code>
&lt;ul>
&lt;li>&lt;code>vt.&lt;/code>ä¸&amp;hellip;é‡å ï¼›æœ‰é‡å &lt;/li>
&lt;li>&lt;code>n.&lt;/code>é‡å éƒ¨åˆ†&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>concern&lt;/code>
&lt;ul>
&lt;li>&lt;code>n.&lt;/code>å…³å¿ƒï¼Œæ‹…å¿ƒ&lt;/li>
&lt;li>&lt;code>vt.&lt;/code>ä½¿æ‹…å¿ƒï¼Œæ¶‰åŠ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="contention">&lt;code>contention&lt;/code>
&lt;/h2>&lt;/li>
&lt;/ul></description></item><item><title>Tokioæ ¸å¿ƒæ¨¡å‹è§£æ</title><link>https://www.dust-zed.site/rust/tokio/tokio%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9E%8B%E8%A7%A3%E6%9E%90/</link><pubDate>Fri, 19 Sep 2025 13:50:29 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/tokio%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9E%8B%E8%A7%A3%E6%9E%90/</guid><description>&lt;h1 id="tokio-æ ¸å¿ƒæ¨¡å‹è§£æ">Tokio æ ¸å¿ƒæ¨¡å‹è§£æ
&lt;/h1>&lt;p>è®©æˆ‘ä»¬ä»é¡¶å±‚è®¾è®¡å¼€å§‹ï¼Œé€æ­¥æ·±å…¥ Tokio çš„å¼‚æ­¥è¿è¡Œæ—¶æ¨¡å‹ã€‚&lt;/p>
&lt;h2 id="1-æ ¸å¿ƒæŠ½è±¡æ¨¡å‹">1. æ ¸å¿ƒæŠ½è±¡æ¨¡å‹
&lt;/h2>&lt;pre tabindex="0">&lt;code>+-------------------------------------------------+
| Runtime (è¿è¡Œæ—¶) |
| +-------------------------------------------+ |
| | Reactor (ååº”å™¨) | |
| | - I/O å¤šè·¯å¤ç”¨ (epoll/kqueue/IOCP) | |
| | - å¤„ç† I/O äº‹ä»¶é€šçŸ¥ | |
| +-------------------------------------------+ |
| |
| +-------------------------------------------+ |
| | Scheduler (è°ƒåº¦å™¨) | |
| | - å¤šçº¿ç¨‹å·¥ä½œçªƒå–è°ƒåº¦ | |
| | - ä»»åŠ¡é˜Ÿåˆ—ç®¡ç† | |
| +-------------------------------------------+ |
| |
| +-------------------------------------------+ |
| | Timer (å®šæ—¶å™¨) | |
| | - ç®¡ç†å®šæ—¶ä»»åŠ¡ | |
| | - åŸºäºæ—¶é—´è½®çš„å®šæ—¶å™¨å®ç° | |
| +-------------------------------------------+ |
+-------------------------------------------------+
&lt;/code>&lt;/pre>&lt;h2 id="2-ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸæ¨¡å‹">2. ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸæ¨¡å‹
&lt;/h2>&lt;h3 id="21-ä»»åŠ¡çŠ¶æ€æœº">2.1 ä»»åŠ¡çŠ¶æ€æœº
&lt;/h3>&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">stateDiagram-v2
[*] --&amp;gt; Created: åˆ›å»º
Created --&amp;gt; Scheduled: è°ƒåº¦
Scheduled --&amp;gt; Running: æ‰§è¡Œ
Running --&amp;gt; Pending: ç­‰å¾…I/O
Pending --&amp;gt; Scheduled: I/Oå°±ç»ª
Running --&amp;gt; Complete: å®Œæˆ
Running --&amp;gt; Panicked: ææ…Œ
Running --&amp;gt; Cancelled: å–æ¶ˆ
Pending --&amp;gt; Cancelled: å–æ¶ˆ
Panicked --&amp;gt; [*]
Complete --&amp;gt; [*]
Cancelled --&amp;gt; [*]
&lt;/code>&lt;/pre>&lt;h3 id="22-çŠ¶æ€ä½è¡¨ç¤º">2.2 çŠ¶æ€ä½è¡¨ç¤º
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// çŠ¶æ€ä½åŸŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">RUNNING&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b0001&lt;/span>; &lt;span style="color:#75715e">// ä»»åŠ¡æ­£åœ¨æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">COMPLETE&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b0010&lt;/span>; &lt;span style="color:#75715e">// ä»»åŠ¡å·²å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">NOTIFIED&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b0100&lt;/span>; &lt;span style="color:#75715e">// ä»»åŠ¡å·²é€šçŸ¥è°ƒåº¦å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">JOIN_INTEREST&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b1000&lt;/span>; &lt;span style="color:#75715e">// æœ‰ä»»åŠ¡åœ¨ç­‰å¾…Join
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">JOIN_WAKER&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b1_0000&lt;/span>; &lt;span style="color:#75715e">// å·²è®¾ç½®Join Waker
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">CANCELLED&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0b10_0000&lt;/span>; &lt;span style="color:#75715e">// ä»»åŠ¡å·²å–æ¶ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="3-æ ¸å¿ƒæ•°æ®ç»“æ„">3. æ ¸å¿ƒæ•°æ®ç»“æ„
&lt;/h2>&lt;h3 id="31-ä»»åŠ¡ç»“æ„-rawtask">3.1 ä»»åŠ¡ç»“æ„ (RawTask)
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">RawTask&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> header: &lt;span style="color:#a6e22e">Header&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡å¤´ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> scheduler: &lt;span style="color:#a6e22e">Scheduler&lt;/span>, &lt;span style="color:#75715e">// è°ƒåº¦å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> state: &lt;span style="color:#a6e22e">State&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> future: &lt;span style="color:#a6e22e">Future&lt;/span>, &lt;span style="color:#75715e">// è¦æ‰§è¡Œçš„Future
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> output: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Output&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// Futureçš„è¾“å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="32-è°ƒåº¦å™¨æ¨¡å‹">3.2 è°ƒåº¦å™¨æ¨¡å‹
&lt;/h3>&lt;pre tabindex="0">&lt;code>+----------------+ +----------------+ +----------------+
| Local Queue | &amp;lt;-&amp;gt; | Global Queue | &amp;lt;-&amp;gt; | Worker Threads |
+----------------+ +----------------+ +----------------+
^ ^ ^
| | |
v v v
+----------------+ +----------------+ +----------------+
| Task Producer | | Work Stealing | | Task Consumer |
| (spawn) | | (è´Ÿè½½å‡è¡¡) | | (poll) |
+----------------+ +----------------+ +----------------+
&lt;/code>&lt;/pre>&lt;h2 id="4-æ‰§è¡Œæµç¨‹">4. æ‰§è¡Œæµç¨‹
&lt;/h2>&lt;h3 id="41-ä»»åŠ¡åˆ›å»ºä¸è°ƒåº¦">4.1 ä»»åŠ¡åˆ›å»ºä¸è°ƒåº¦
&lt;/h3>&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">sequenceDiagram
participant A as ç”¨æˆ·ä»£ç 
participant B as Runtime
participant C as è°ƒåº¦å™¨
participant D as å·¥ä½œçº¿ç¨‹
A-&amp;gt;&amp;gt;B: spawn(future)
B-&amp;gt;&amp;gt;C: åˆ›å»ºä»»åŠ¡å¹¶åŠ å…¥é˜Ÿåˆ—
C-&amp;gt;&amp;gt;D: å·¥ä½œçº¿ç¨‹çªƒå–ä»»åŠ¡
D-&amp;gt;&amp;gt;D: æ‰§è¡Œfuture.poll()
alt Futureè¿”å›Pending
D-&amp;gt;&amp;gt;B: æ³¨å†ŒWaker
else Futureè¿”å›Ready
D-&amp;gt;&amp;gt;B: è®¾ç½®è¾“å‡ºç»“æœ
end
&lt;/code>&lt;/pre>&lt;h3 id="42-io-å°±ç»ªå¤„ç†">4.2 I/O å°±ç»ªå¤„ç†
&lt;/h3>&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">sequenceDiagram
participant A as Reactor
participant B as è°ƒåº¦å™¨
participant C as ä»»åŠ¡
A-&amp;gt;&amp;gt;B: I/O å°±ç»ªäº‹ä»¶
B-&amp;gt;&amp;gt;C: å”¤é†’å…³è”çš„Waker
C-&amp;gt;&amp;gt;B: å°†ä»»åŠ¡åŠ å…¥å°±ç»ªé˜Ÿåˆ—
B-&amp;gt;&amp;gt;C: è°ƒåº¦æ‰§è¡Œ
&lt;/code>&lt;/pre>&lt;h2 id="5-å…³é”®ä¼˜åŒ–æŠ€æœ¯">5. å…³é”®ä¼˜åŒ–æŠ€æœ¯
&lt;/h2>&lt;h3 id="51-æ— é”é˜Ÿåˆ—">5.1 æ— é”é˜Ÿåˆ—
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨crossbeamçš„æ— é”é˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">TaskQueue&lt;/span> &lt;span style="color:#f92672">=&lt;/span> crossbeam_deque::Worker&lt;span style="color:#f92672">&amp;lt;&lt;/span>Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>Task&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="52-å·¥ä½œçªƒå–">5.2 å·¥ä½œçªƒå–
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å·¥ä½œçº¿ç¨‹å°è¯•ä»å…¶ä»–é˜Ÿåˆ—çªƒå–ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">steal_work&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Task&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éšæœºé€‰æ‹©å—å®³è€…é˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> len &lt;span style="color:#f92672">=&lt;/span> self.workers.len();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> start &lt;span style="color:#f92672">=&lt;/span> self.rng.&lt;span style="color:#66d9ef">usize&lt;/span>(&lt;span style="color:#f92672">..&lt;/span>len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#66d9ef">in&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">..&lt;/span>len {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> idx &lt;span style="color:#f92672">=&lt;/span> (start &lt;span style="color:#f92672">+&lt;/span> i) &lt;span style="color:#f92672">%&lt;/span> len;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(task) &lt;span style="color:#f92672">=&lt;/span> self.workers[idx].steal() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(task);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="53-é›¶æˆæœ¬æŠ½è±¡">5.3 é›¶æˆæœ¬æŠ½è±¡
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨æ³›å‹å’Œç¼–è¯‘æœŸå¤šæ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">spawn&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>F, T&lt;span style="color:#f92672">&amp;gt;&lt;/span>(future: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">JoinHandle&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">where&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> F: &lt;span style="color:#a6e22e">Future&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Output &lt;span style="color:#f92672">=&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T: Send &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç¼–è¯‘æ—¶ç”Ÿæˆç‰¹å®šç±»å‹çš„ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="6-å†…å­˜æ¨¡å‹">6. å†…å­˜æ¨¡å‹
&lt;/h2>&lt;h3 id="61-ä»»åŠ¡åˆ†é…">6.1 ä»»åŠ¡åˆ†é…
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è‡ªå®šä¹‰å†…å­˜åˆ†é…å™¨ä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> layout &lt;span style="color:#f92672">=&lt;/span> Layout::new::&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .extend(Layout::new::&lt;span style="color:#f92672">&amp;lt;&lt;/span>Scheduler&lt;span style="color:#f92672">&amp;gt;&lt;/span>())&lt;span style="color:#f92672">?&lt;/span>.&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .extend(Layout::new::&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>())&lt;span style="color:#f92672">?&lt;/span>.&lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> ptr &lt;span style="color:#f92672">=&lt;/span> alloc(layout);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="62-å¼•ç”¨è®¡æ•°">6.2 å¼•ç”¨è®¡æ•°
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨åŸå­å¼•ç”¨è®¡æ•°ç®¡ç†ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Task&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> header: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Drop &lt;span style="color:#66d9ef">for&lt;/span> Task {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">drop&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> Arc::strong_count(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self.header) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœ€åä¸€ä¸ªå¼•ç”¨ï¼Œé‡Šæ”¾èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="7-è°ƒè¯•ä¸è¿½è¸ª">7. è°ƒè¯•ä¸è¿½è¸ª
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[cfg(tokio_unstable)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">TaskMeta&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&amp;#39;static &lt;span style="color:#66d9ef">str&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> location: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&amp;#39;static &lt;span style="color:#a6e22e">std&lt;/span>::panic::Location&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;static&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="8-ä½¿ç”¨æ¨¡å‹">8. ä½¿ç”¨æ¨¡å‹
&lt;/h2>&lt;h3 id="81-åŸºæœ¬ä½¿ç”¨">8.1 åŸºæœ¬ä½¿ç”¨
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[tokio::main]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> handle &lt;span style="color:#f92672">=&lt;/span> tokio::spawn(&lt;span style="color:#66d9ef">async&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¼‚æ­¥ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Hello, Tokio!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç­‰å¾…ä»»åŠ¡å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> result &lt;span style="color:#f92672">=&lt;/span> handle.&lt;span style="color:#66d9ef">await&lt;/span>.unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="82-ä»»åŠ¡é—´é€šä¿¡">8.2 ä»»åŠ¡é—´é€šä¿¡
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨é€šé“è¿›è¡Œä»»åŠ¡é—´é€šä¿¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> (tx, &lt;span style="color:#66d9ef">mut&lt;/span> rx) &lt;span style="color:#f92672">=&lt;/span> tokio::sync::mpsc::channel(&lt;span style="color:#ae81ff">32&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç”Ÿäº§è€…ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>tokio::spawn(&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">move&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tx.send(&lt;span style="color:#e6db74">&amp;#34;Hello&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">await&lt;/span>.unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¶ˆè´¹è€…ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>tokio::spawn(&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">move&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(message) &lt;span style="color:#f92672">=&lt;/span> rx.recv().&lt;span style="color:#66d9ef">await&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;received: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, message);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="9-æ€§èƒ½è€ƒé‡">9. æ€§èƒ½è€ƒé‡
&lt;/h2>&lt;ol>
&lt;li>&lt;strong>ä»»åŠ¡å¤§å°&lt;/strong>ï¼šä¿æŒä»»åŠ¡å°å·§é«˜æ•ˆ&lt;/li>
&lt;li>&lt;strong>é¿å…é˜»å¡&lt;/strong>ï¼šä¸è¦åœ¨å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œé˜»å¡æ“ä½œ&lt;/li>
&lt;li>&lt;strong>æ‰¹é‡å¤„ç†&lt;/strong>ï¼šåˆå¹¶å°çš„I/Oæ“ä½œä¸ºæ‰¹é‡æ“ä½œ&lt;/li>
&lt;li>&lt;strong>åˆç†ä½¿ç”¨spawn&lt;/strong>ï¼šé¿å…åˆ›å»ºè¿‡å¤šä»»åŠ¡&lt;/li>
&lt;/ol>
&lt;h2 id="10-è°ƒè¯•æŠ€å·§">10. è°ƒè¯•æŠ€å·§
&lt;/h2>&lt;ol>
&lt;li>å¯ç”¨ &lt;code>tokio_unstable&lt;/code> ç‰¹æ€§è·å–æ›´å¤šè°ƒè¯•ä¿¡æ¯&lt;/li>
&lt;li>ä½¿ç”¨ &lt;code>tracing&lt;/code> è¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ª&lt;/li>
&lt;li>ç›‘æ§è¿è¡Œæ—¶æŒ‡æ ‡ï¼ˆä»»åŠ¡æ•°ã€é˜Ÿåˆ—é•¿åº¦ç­‰ï¼‰&lt;/li>
&lt;/ol>
&lt;p>è¿™ä¸ªæ¨¡å‹å±•ç¤ºäº† Tokio å¦‚ä½•é«˜æ•ˆåœ°ç®¡ç†å¼‚æ­¥ä»»åŠ¡ã€‚ç†è§£è¿™äº›æ ¸å¿ƒæ¦‚å¿µåï¼Œæ‚¨å¯ä»¥æ›´æ·±å…¥åœ°ç ”ç©¶ç‰¹å®šç»„ä»¶çš„å®ç°ç»†èŠ‚ã€‚&lt;/p></description></item><item><title>Tokioä»»åŠ¡ç³»ç»Ÿè§£æ</title><link>https://www.dust-zed.site/rust/tokio/tokio%E4%BB%BB%E5%8A%A1%E7%B3%BB%E7%BB%9F%E8%A7%A3%E6%9E%90/</link><pubDate>Fri, 19 Sep 2025 12:38:14 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/tokio%E4%BB%BB%E5%8A%A1%E7%B3%BB%E7%BB%9F%E8%A7%A3%E6%9E%90/</guid><description>&lt;p>Tokioçš„ä»»åŠ¡ç³»ç»Ÿæ˜¯å…¶å¼‚æ­¥è¿è¡Œæ—¶çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£è°ƒåº¦å’Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚è®©æˆ‘ä»¬æ·±å…¥åˆ†æå…¶è®¾è®¡å’Œå®ç°ã€‚&lt;/p>
&lt;h3 id="1-æ ¸å¿ƒç»„ä»¶">1. æ ¸å¿ƒç»„ä»¶
&lt;/h3>&lt;h4 id="11-ä»»åŠ¡è¡¨ç¤º">1.1 ä»»åŠ¡è¡¨ç¤º
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Task&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>S: &amp;#39;static&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> raw: &lt;span style="color:#a6e22e">RawTask&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _p: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>S&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>RawTask&lt;/code>ï¼šå®é™…çš„ä»»åŠ¡æ•°æ®ï¼ŒåŒ…å«ä»»åŠ¡çŠ¶æ€ã€è°ƒåº¦å™¨ç­‰ã€‚&lt;/li>
&lt;li>&lt;code>PhantomData&amp;lt;S&amp;gt;&lt;/code>ï¼šå…³è”è°ƒåº¦å™¨ç±»å‹ï¼Œç”¨äºç±»å‹å®‰å…¨&lt;/li>
&lt;/ul>
&lt;h4 id="12-ä»»åŠ¡å¤´header">1.2 ä»»åŠ¡å¤´(Header)
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Header&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state: &lt;span style="color:#a6e22e">State&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> queue_next: &lt;span style="color:#a6e22e">UnsafeCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;..&lt;/span>.&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡é˜Ÿåˆ—æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> vtable: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&amp;#39;static &lt;span style="color:#a6e22e">Vtable&lt;/span>, &lt;span style="color:#75715e">// è™šå‡½æ•°è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> owner_id: &lt;span style="color:#a6e22e">UnsafeCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;..&lt;/span>.&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡æ‰€æœ‰è€…ID
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="2-ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ">2. ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ
&lt;/h4>&lt;h4 id="21-åˆ›å»ºä»»åŠ¡">2.1 åˆ›å»ºä»»åŠ¡
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">new_task&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, S&lt;span style="color:#f92672">&amp;gt;&lt;/span>(task: &lt;span style="color:#a6e22e">T&lt;/span>, scheduler: &lt;span style="color:#a6e22e">S&lt;/span>, id: &lt;span style="color:#a6e22e">Id&lt;/span>) -&amp;gt; (Task&lt;span style="color:#f92672">&amp;lt;&lt;/span>S&lt;span style="color:#f92672">&amp;gt;&lt;/span>, Notified&lt;span style="color:#f92672">&amp;lt;&lt;/span>S&lt;span style="color:#f92672">&amp;gt;&lt;/span>, JoinHandle&lt;span style="color:#f92672">&amp;lt;&lt;/span>T::Output&lt;span style="color:#f92672">&amp;gt;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">where&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T: &lt;span style="color:#a6e22e">Future&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> S: &lt;span style="color:#a6e22e">Schedule&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> raw &lt;span style="color:#f92672">=&lt;/span> RawTask::new::&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, S&lt;span style="color:#f92672">&amp;gt;&lt;/span>(task, scheduler, id, spawned_at);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºä¸‰ç§å¥æŸ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> task &lt;span style="color:#f92672">=&lt;/span> Task { raw, _p: &lt;span style="color:#a6e22e">PhantomData&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> notified &lt;span style="color:#f92672">=&lt;/span> Notified(Task { raw, _p: &lt;span style="color:#a6e22e">PhantomData&lt;/span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> join &lt;span style="color:#f92672">=&lt;/span> JoinHandle::new(raw);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (task, notified, join)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>RawTask&lt;/code>å®ç°äº†Copyï¼Œæ•…è¿™é‡Œå¯ä»¥è¿™æ ·åšï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦çŸ¥é“&lt;code>RawTask&lt;/code>çš„åˆå§‹å¼•ç”¨è®¡æ•°çŠ¶æ€ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">super&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">new&lt;/span>() -&amp;gt; &lt;span style="color:#a6e22e">State&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> val: &lt;span style="color:#a6e22e">AtomicUsize&lt;/span>::new(&lt;span style="color:#66d9ef">INTIAL_STATE&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆå§‹çŠ¶æ€è®¾ç½®ä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">INITIAL_STATE&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#66d9ef">REF_ONE&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>) &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#66d9ef">JOIN_INTEREST&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#66d9ef">NOTIFIED&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ„å‘³ç€ï¼š&lt;/p>
&lt;ol>
&lt;li>åˆå§‹å¼•ç”¨è®¡æ•°æ˜¯&lt;code>REF_ONE * 3&lt;/code>&lt;/li>
&lt;li>åŒæ—¶è®¾ç½®äº† &lt;code>JOIN_INTEREST&lt;/code> å’Œ &lt;code>NOTIFIED&lt;/code> æ ‡å¿—ä½&lt;/li>
&lt;/ol>
&lt;p>ä¸€ä¸ªä»»åŠ¡åˆ›å»ºä¼šè¿”å›ä¸‰ä¸ªå¥æŸ„ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>Task&lt;/code>ï¼šç”¨äºå–æ¶ˆæˆ–é‡Šæ”¾ä»»åŠ¡&lt;/li>
&lt;li>&lt;code>Notified&lt;/code>ï¼šè¡¨ç¤ºä»»åŠ¡å·²å‡†å¤‡å¥½æ‰§è¡Œ&lt;/li>
&lt;li>&lt;code>JoinHandle&lt;/code>ï¼šç”¨äºç­‰å¾…ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ&lt;/li>
&lt;/ol>
&lt;h3 id="3-æ ¸å¿ƒæœºåˆ¶">3. æ ¸å¿ƒæœºåˆ¶
&lt;/h3>&lt;h4 id="31-ä»»åŠ¡è°ƒåº¦">3.1 ä»»åŠ¡è°ƒåº¦
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åœ¨è°ƒåº¦å™¨ä¸­çš„æ‰§è¡Œå¾ªç¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> task &lt;span style="color:#f92672">=&lt;/span> self.next_task(); &lt;span style="color:#75715e">// è·å–ä¸‹ä¸€ä¸ªå°±ç»ªä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> task.run(); &lt;span style="color:#75715e">// æ‰§è¡Œä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="32-å”¤é†’æœºåˆ¶">3.2 å”¤é†’æœºåˆ¶
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Waker å®ç°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Waker&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> header: &lt;span style="color:#a6e22e">NonNull&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> std::task::Wake &lt;span style="color:#66d9ef">for&lt;/span> Waker {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">wake&lt;/span>(self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.wake_by_ref();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">wake_by_ref&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°†ä»»åŠ¡æ ‡è®°ä¸ºå°±ç»ªå¹¶é‡æ–°è°ƒåº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">unsafe&lt;/span> { (self.header.as_ref().vtable.schedule)(self.header) };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="4-å†…å­˜ç®¡ç†">4. å†…å­˜ç®¡ç†
&lt;/h3>&lt;h4 id="41-ä»»åŠ¡åˆ†é…">4.1 ä»»åŠ¡åˆ†é…
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T: &lt;span style="color:#a6e22e">Future&lt;/span>, S: &lt;span style="color:#a6e22e">Schedule&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> RawTask&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, S&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">new&lt;/span>(future: &lt;span style="color:#a6e22e">T&lt;/span>, scheduler: &lt;span style="color:#a6e22e">S&lt;/span>, id: &lt;span style="color:#a6e22e">Id&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">NonNull&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. è®¡ç®—å†…å­˜å¸ƒå±€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// 2. åˆ†é…å†…å­˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// 3. åˆå§‹åŒ– Header å’Œ Future
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// 4. è¿”å›æŒ‡å‘ Header çš„æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="42-å†…å­˜å¸ƒå±€">4.2 å†…å­˜å¸ƒå±€
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> Header &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// åŒ…å«ä»»åŠ¡å…ƒæ•°æ®å’Œè™šå‡½æ•°è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> Scheduler (S) &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// è°ƒåº¦å™¨å®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> Future (T) &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// å®é™…çš„ Future
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> Output Slot &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// å­˜å‚¨ Future çš„è¾“å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> Traces &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// è°ƒè¯•å’Œè·Ÿè¸ªä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="5-å¹¶å‘æ§åˆ¶">5. å¹¶å‘æ§åˆ¶
&lt;/h3>&lt;h4 id="51-çŠ¶æ€ç®¡ç†">5.1 çŠ¶æ€ç®¡ç†
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">State&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨åŸå­æ“ä½œç®¡ç†çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// - è¿è¡Œä¸­æ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// - å®Œæˆæ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// - å–æ¶ˆæ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// - å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> value: &lt;span style="color:#a6e22e">AtomicUsize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…·ä½“æ¥è¯´ï¼š&lt;/p>
&lt;ul>
&lt;li>é«˜ä½çš„æ¯”ç‰¹ä½ç”¨äºå¼•ç”¨è®¡æ•°(&lt;code>REF_COUNT_MASK&lt;/code>)&lt;/li>
&lt;li>ä½ä½çš„æ¯”ç‰¹ä½ç”¨äºä»»åŠ¡çŠ¶æ€(&lt;code>STATE_MASK&lt;/code>)&lt;/li>
&lt;/ul>
&lt;h4 id="52-é”ä¼˜åŒ–">5.2 é”ä¼˜åŒ–
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨æ— é”ç®—æ³•ä¼˜åŒ–çƒ­ç‚¹è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">transition_to_running&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">TransitionToRunning&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨åŸå­æ“ä½œæ›´æ–°çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// é¿å…ä½¿ç”¨äº’æ–¥é”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="7-è®¾è®¡æ¨¡å¼">7. è®¾è®¡æ¨¡å¼
&lt;/h3>&lt;h4 id="71-ç±»å‹æ“¦é™¤">7.1 ç±»å‹æ“¦é™¤
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨è™šå‡½æ•°è¡¨å®ç°ç±»å‹æ“¦é™¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Vtable&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> poll: &lt;span style="color:#a6e22e">unsafe&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span>(NonNull&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dealloc: &lt;span style="color:#a6e22e">unsafe&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span>(NonNull&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="72-é›¶æˆæœ¬æŠ½è±¡">7.2 é›¶æˆæœ¬æŠ½è±¡
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä½¿ç”¨æ³›å‹å’Œç¼–è¯‘æœŸå¤šæ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, S&lt;span style="color:#f92672">&amp;gt;&lt;/span> Task&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, S&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é›¶æˆæœ¬æŠ½è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>PhantomDataçš„ä½œç”¨</title><link>https://www.dust-zed.site/rust/phantomdata%E7%9A%84%E4%BD%9C%E7%94%A8/</link><pubDate>Fri, 19 Sep 2025 10:20:18 +0800</pubDate><guid>https://www.dust-zed.site/rust/phantomdata%E7%9A%84%E4%BD%9C%E7%94%A8/</guid><description>&lt;p>&lt;code>PhantomData&lt;/code>åœ¨Rustä¸­æ˜¯ä¸ºæ³›å‹æä¾›é€»è¾‘ä¸Šçš„è¡¥å……ï¼Œå®ƒå¸®åŠ©ç¼–è¯‘å™¨ç†è§£å’ŒéªŒè¯æ³›å‹å‚æ•°çš„ä½¿ç”¨æ–¹å¼ã€‚&lt;/p>
&lt;h4 id="æ ¸å¿ƒä½œç”¨">æ ¸å¿ƒä½œç”¨
&lt;/h4>&lt;p>&lt;code>PhantomData&lt;/code>æ˜¯ä¸€ä¸ªé›¶ç±»å‹å¤§å°ï¼ˆZSTï¼‰ï¼Œå®ƒä¸ä¼šåœ¨è¿è¡Œæ—¶å ç”¨ä»»ä½•å†…å­˜ï¼Œä½†åœ¨ç¼–è¯‘æœŸæä¾›é‡è¦ä¿¡æ¯ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç±»å‹æ ‡è®°&lt;/strong>ï¼šå‘Šè¯‰ç¼–è¯‘å™¨â€œè¿™ä¸ªç±»å‹é€»è¾‘ä¸Šæ‹¥æœ‰&lt;code>T&lt;/code>â€&lt;/li>
&lt;li>&lt;strong>ç”Ÿå‘½å‘¨æœŸè¿½è¸ª&lt;/strong>ï¼šå¸®ç»„ç¼–è¯‘å™¨éªŒè¯ç”Ÿå‘½å‘¨æœŸçš„æ­£ç¡®æ€§&lt;/li>
&lt;li>&lt;strong>å˜ä½“æ§åˆ¶&lt;/strong>:å½±å“æ³›å‹å‚æ•°çš„åå˜/é€†å˜è¡Œä¸º&lt;/li>
&lt;li>&lt;strong>Dropæ£€æŸ¥&lt;/strong>ï¼šå½±å“&lt;code>Drop&lt;/code>æ£€æŸ¥å™¨çš„è¡Œä¸º&lt;/li>
&lt;/ol>
&lt;p>åœ¨&lt;code>JoinHandle&amp;lt;T&amp;gt;&lt;/code>ä¸­çš„å…·ä½“ä½œç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">JoinHandle&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> raw: &lt;span style="color:#a6e22e">RawTask&lt;/span>, &lt;span style="color:#75715e">// åŸå§‹ä»»åŠ¡æŒ‡é’ˆï¼Œä¸ç›´æ¥åŒ…å« T
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> _p: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// é€»è¾‘ä¸Šè¡¨ç¤ºè¿™ä¸ªå¥æŸ„æ‹¥æœ‰ T çš„æ‰€æœ‰æƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œ&lt;code>PhantomData&amp;lt;T&amp;gt;&lt;/code>è¡¨ç¤ºï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>æ‰€æœ‰æƒæ ‡è®°&lt;/strong>: &lt;code>JoinHandle&amp;lt;T&amp;gt;&lt;/code>é€»è¾‘ä¸Šâ€œæ‹¥æœ‰â€ä¸€ä¸ª&lt;code>T&lt;/code>ç±»å‹çš„å€¼&lt;/li>
&lt;li>&lt;strong>ç±»å‹å…³è”&lt;/strong>: å°†&lt;code>RawTask&lt;/code>ä¸è¿”å›ç±»å‹&lt;code>T&lt;/code>å…³è”èµ·æ¥&lt;/li>
&lt;li>&lt;strong>Dropæ£€æŸ¥&lt;/strong>ï¼š ç¡®ä¿å½“&lt;code>JoinHandle&amp;lt;T&amp;gt;&lt;/code>è¢«dropæ—¶ï¼Œ&lt;code>T&lt;/code>çš„ææ„å‡½æ•°ä¼šè¢«æ­£ç¡®è°ƒç”¨&lt;/li>
&lt;/ol>
&lt;h4 id="å…¶ä»–å¸¸è§ä½¿ç”¨åœºæ™¯">å…¶ä»–å¸¸è§ä½¿ç”¨åœºæ™¯
&lt;/h4>&lt;h5 id="1-ä¸å®‰å…¨çš„ä»£ç ä¸­æ ‡è®°æ‰€æœ‰æƒ">1. ä¸å®‰å…¨çš„ä»£ç ä¸­æ ‡è®°æ‰€æœ‰æƒï¼š
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">MyPtr&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr: &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> &lt;span style="color:#66d9ef">u8&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _marker: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//é€»è¾‘ä¸Šæ‹¥æœ‰T
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-ç”Ÿå‘½å‘¨æœŸæ ‡è®°">2. ç”Ÿå‘½å‘¨æœŸæ ‡è®°
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Slice&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;a&lt;/span>, T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data: &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> T,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> len: &lt;span style="color:#66d9ef">usize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _marker: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;a&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// è¡¨ç¤ºåŒ…å«å¯¹ T çš„ç”Ÿå‘½å‘¨æœŸ &amp;#39;a çš„å¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-å˜ä½“æ§åˆ¶">3. å˜ä½“æ§åˆ¶
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Producer&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data: &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> (),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _marker: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">fn&lt;/span>() -&amp;gt; &lt;span style="color:#a6e22e">T&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// ä½¿ T åå˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-ç±»å‹å®‰å…¨æŠ½è±¡">4. ç±»å‹å®‰å…¨æŠ½è±¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Token&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _private: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// åˆ›å»ºç±»å‹çº§åˆ«çš„æ ‡è®°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ€»ç»“">æ€»ç»“
&lt;/h4>&lt;p>&lt;code>PhantomData&lt;/code>æ˜¯Rustç±»å‹ç³»ç»Ÿä¸­ä¸€ä¸ªå¼ºå¤§å·¥å…·ï¼Œå®ƒå…è®¸åœ¨ä¸å®é™…å­˜å‚¨å€¼çš„æƒ…å†µä¸‹ï¼Œè¡¨è¾¾ç±»å‹ä¹‹é—´çš„å…³ç³»å’Œçº¦æŸã€‚&lt;/p></description></item><item><title>å¯¹Callbackçš„ç†è§£</title><link>https://www.dust-zed.site/rust/%E5%AF%B9callback%E7%9A%84%E7%90%86%E8%A7%A3/</link><pubDate>Fri, 12 Sep 2025 03:02:50 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E5%AF%B9callback%E7%9A%84%E7%90%86%E8%A7%A3/</guid><description>&lt;p>ä¸ªäººç†è§£ï¼šå›è°ƒçš„æœ¬è´¨å°±æ˜¯å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œè€Œå‡½æ•° è¿‘ä¼¼ &lt;strong>æ“ä½œ&lt;/strong>ã€‚æ‰€ä»¥, æœ‰åˆ«äºæ™®é€šå‚æ•°ä¼ é€’çš„æ˜¯&lt;strong>æ•°æ®&lt;/strong>ï¼Œ&lt;code>Callback&lt;/code>ä¼ é€’çš„æ˜¯&lt;strong>æ“ä½œ&lt;/strong>æˆ–&lt;strong>é€»è¾‘&lt;/strong>&lt;/p>
&lt;h4 id="ä¼˜åŠ¿">ä¼˜åŠ¿
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>è§£è€¦&lt;/strong>: å®Œæˆé€»è¾‘çš„åˆ†ç¦»,è¦&lt;strong>åšä»€ä¹ˆ(è°ƒç”¨è€…)&lt;strong>ä¸&lt;/strong>ä½•æ—¶åšåˆ†ç¦»(è¢«è°ƒç”¨è€…)&lt;/strong>&lt;/li>
&lt;li>&lt;strong>å†…å­˜é«˜æ•ˆ&lt;/strong>ï¼šé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†æµå¼æ•°æ®æˆ–å¤§é‡æ•°æ®(ä¾‹å¦‚é¿å…æ”¾åˆ°é›†åˆåœ¨éå†)&lt;/li>
&lt;li>&lt;strong>çµæ´»æ€§&lt;/strong>ï¼šå…è®¸è°ƒç”¨è€…è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œæé«˜ä»£ç å¤ç”¨æ€§&lt;/li>
&lt;li>&lt;strong>å®æ—¶å¤„ç†&lt;/strong>ï¼šæ•°æ®å¯ä»¥ç«‹å³å¤„ç†ï¼Œé™ä½å»¶è¿Ÿ&lt;/li>
&lt;li>&lt;strong>èµ„æºæ§åˆ¶&lt;/strong>ï¼šå¯ä»¥è½»æ¾å®ç°æå‰ç»ˆæ­¢ã€é”™è¯¯å¤„ç†ç­‰æ§åˆ¶æµ&lt;/li>
&lt;li>&lt;strong>ç»„åˆæ€§&lt;/strong>ï¼šå¯ä»¥æ–¹ä¾¿åœ°ç»„åˆå¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå®ç°å¤æ‚çš„æ•°æ®å¤„ç†ç®¡é“&lt;/li>
&lt;li>&lt;strong>äº‹ä»¶é©±åŠ¨&lt;/strong>ï¼šå¤©ç„¶é€‚åˆäº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹æ¨¡å¼&lt;/li>
&lt;li>&lt;strong>æ¥å£ä¸€è‡´æ€§&lt;/strong>ï¼šæä¾›ç»Ÿä¸€çš„æ¥å£å¤„ç†ä¸åŒç±»å‹çš„æ“ä½œ&lt;/li>
&lt;/ol>
&lt;h4 id="æ§åˆ¶åè½¬">æ§åˆ¶åè½¬
&lt;/h4>&lt;ul>
&lt;li>æ™®é€šå‡½æ•°è°ƒç”¨ï¼šè°ƒç”¨è€…æ§åˆ¶æ‰§è¡Œæµç¨‹&lt;/li>
&lt;li>å›è°ƒï¼šè¢«è°ƒç”¨è€…å†³å®šä½•æ—¶æ‰§è¡Œæ“ä½œ&lt;/li>
&lt;li>æ§åˆ¶æƒä»è°ƒç”¨è€…è½¬ç§»åˆ°è¢«è°ƒç”¨è€…&lt;/li>
&lt;/ul></description></item><item><title>æ—¶é—´è½®ç®—æ³•</title><link>https://www.dust-zed.site/rust/tokio/%E6%97%B6%E9%97%B4%E8%BD%AE%E7%AE%97%E6%B3%95/</link><pubDate>Thu, 11 Sep 2025 21:51:21 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/%E6%97%B6%E9%97%B4%E8%BD%AE%E7%AE%97%E6%B3%95/</guid><description>&lt;p>æ—¶é—´è½®(Time Wheel)æ˜¯Tokioå®šæ—¶å™¨å®ç°çš„æ ¸å¿ƒç®—æ³•ï¼Œå®ƒé€šè¿‡åˆ†å±‚çš„æ–¹å¼é«˜æ•ˆç®¡ç†å¤§é‡å®šæ—¶å™¨ã€‚&lt;/p>
&lt;h3 id="1-åŸºæœ¬æ¦‚å¿µ">1. åŸºæœ¬æ¦‚å¿µ
&lt;/h3>&lt;h4 id="11-wheelç»“æ„ä¸å±‚çº§å…³ç³»">1.1 Wheelç»“æ„ä¸å±‚çº§å…³ç³»
&lt;/h4>&lt;h5 id="111-æ—¶é—´è½®ç»“æ„">1.1.1 æ—¶é—´è½®ç»“æ„
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Wheel&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">///å½“å‰æ—¶é—´è½®å·²è¿‡å»çš„æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> elapsed: &lt;span style="color:#66d9ef">u64&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">///æ—¶é—´è½®çš„åˆ†å±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> levels: Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>[Level; &lt;span style="color:#66d9ef">NUM_LEVELS&lt;/span>]&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">///Entries queued for firing
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> pending: &lt;span style="color:#a6e22e">EntryList&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="112-å±‚çº§">1.1.2 å±‚çº§
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Level&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> slot: [EntryList; &lt;span style="color:#66d9ef">LEVEL_MULT&lt;/span>], &lt;span style="color:#75715e">//æ§½ä½æ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> level: &lt;span style="color:#66d9ef">usize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> occupied: &lt;span style="color:#66d9ef">u64&lt;/span>, &lt;span style="color:#75715e">// bit fieldæŒ‡ç¤ºslotæ˜¯å¦å ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="113-æ§½ä½">1.1.3 æ§½ä½
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Slot&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> head: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>NonNull&lt;span style="color:#f92672">&amp;lt;&lt;/span>TimerShared&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="12-åˆ†å±‚è®¾è®¡">1.2 åˆ†å±‚è®¾è®¡
&lt;/h4>&lt;p>Tokioä½¿ç”¨å¤šçº§æ—¶é—´è½®ï¼ˆé€šå¸¸ä¸º6çº§ï¼‰ï¼Œæ¯çº§åŒ…å«å›ºå®šæ•°é‡çš„æ§½ä½ï¼Œæ¯çº§åŒ…å«å›ºå®šæ•°é‡çš„æ§½ä½(slots)ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¬¬0çº§ï¼š64ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^0æ¯«ç§’&lt;/li>
&lt;li>ç¬¬1çº§ï¼š64ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^1æ¯«ç§’&lt;/li>
&lt;li>ç¬¬2çº§ï¼š32ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^2æ¯«ç§’&lt;/li>
&lt;li>ç¬¬3çº§ï¼š32ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^3æ¯«ç§’&lt;/li>
&lt;li>ç¬¬4çº§ï¼š32ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^4æ¯«ç§’&lt;/li>
&lt;li>ç¬¬5çº§ï¼š32ä¸ªæ§½ä½ï¼Œæ¯ä¸ª64^5æ¯«ç§’&lt;/li>
&lt;/ul>
&lt;h4 id="æ—¶é—´è½®çš„å·¥ä½œæµç¨‹">æ—¶é—´è½®çš„å·¥ä½œæµç¨‹
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>æ·»åŠ ä¸€ä¸ª500msåè§¦å‘çš„å®šæ—¶å™¨&lt;/strong>ï¼š
&lt;ul>
&lt;li>ç¬¬0çº§ï¼š500 &amp;gt; 64ms â†’ ä¸é€‚ç”¨&lt;/li>
&lt;li>ç¬¬1çº§ï¼š500 / 64 = 7.8 â†’ æ”¾å…¥ç¬¬7ä¸ªæ§½ä½&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>æ—¶é—´æ¨è¿›&lt;/strong>ï¼š
&lt;ul>
&lt;li>æ¯æ¯«ç§’æ£€æŸ¥ç¬¬0çº§&lt;/li>
&lt;li>æ¯64msæ£€æŸ¥ç¬¬1çº§&lt;/li>
&lt;li>ä¾æ­¤ç±»æ¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é™çº§&lt;/strong>ï¼š
&lt;ul>
&lt;li>å½“é«˜å±‚çº§çš„æ—¶é—´è½®è½¬åŠ¨æ—¶ï¼Œå°†å®šæ—¶å™¨é‡æ–°åˆ†é…åˆ°æ›´ç²¾ç¡®çš„å±‚çº§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>è¿™ç§å¤šçº§è®¾è®¡ä½¿å¾—tokioèƒ½å¤Ÿï¼š&lt;/p>
&lt;ul>
&lt;li>ç²¾ç¡®å¤„ç†çŸ­æœŸå®šæ—¶å™¨(æ¯«ç§’çº§)&lt;/li>
&lt;li>é«˜æ•ˆç®¡ç†é•¿æœŸå®šæ—¶å™¨( å¹´)&lt;/li>
&lt;li>ä¿æŒè¾ƒä½çš„å†…å­˜å ç”¨å’Œè®¡ç®—å¼€é”€&lt;/li>
&lt;li>æ ¹æ®&lt;code>elapsed&lt;/code>ç¡®å®šéœ€è¦æ£€æŸ¥çš„æ—¶é—´è½®å±‚çº§å’Œæ§½ä½&lt;/li>
&lt;/ul>
&lt;p>æ—¶é—´è½®å’Œæ—¶è‹±é’Ÿï¼ˆæ—¶é’ˆã€åˆ†é’ˆã€ç§’é’ˆï¼‰å¯ä»¥è¿›è¡Œç±»æ¯”ç†è§£ã€‚&lt;/p></description></item><item><title>Timeçš„é˜…è¯»å­¦ä¹ è®°å½•</title><link>https://www.dust-zed.site/rust/tokio/time%E7%9A%84%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</link><pubDate>Thu, 11 Sep 2025 16:20:08 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/time%E7%9A%84%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</guid><description>&lt;h4 id="sourcers">source.rs
&lt;/h4>&lt;ul>
&lt;li>ç”¨äºç®¡ç†æ—¶é—´æˆ³è½¬æ¢&lt;/li>
&lt;li>&lt;code>start_time&lt;/code>è®°å½•è¿è¡Œæ—¶å¯åŠ¨çš„ç»å¯¹æ—¶é—´ç‚¹&lt;/li>
&lt;/ul>
&lt;h4 id="entryrs">entry.rs
&lt;/h4>&lt;h5 id="1-æ ¸å¿ƒæ•°æ®ç»“æ„">1. æ ¸å¿ƒæ•°æ®ç»“æ„
&lt;/h5>&lt;ul>
&lt;li>&lt;code>TimerEntry&lt;/code>ï¼šè¡¨ç¤ºä¸€ä¸ªå®šæ—¶å™¨æ¡ç›®&lt;/li>
&lt;li>&lt;code>TimerShared&lt;/code>ï¼šå®šæ—¶å™¨çš„å…±äº«çŠ¶æ€ï¼ŒåŒ…å«å¹¶å‘æ§åˆ¶é€»è¾‘&lt;/li>
&lt;li>&lt;code>StateCell&lt;/code>ï¼šç®¡ç†å®šæ—¶å™¨çŠ¶æ€çš„åŸå­æ“ä½œå°è£…&lt;/li>
&lt;/ul>
&lt;h5 id="2-ä¸»è¦åŠŸèƒ½">2. ä¸»è¦åŠŸèƒ½
&lt;/h5>&lt;h6 id="å®šæ—¶å™¨çŠ¶æ€ç®¡ç†">å®šæ—¶å™¨çŠ¶æ€ç®¡ç†
&lt;/h6>&lt;ul>
&lt;li>ä½¿ç”¨åŸå­æ“ä½œå®ç°æ— é”çŠ¶æ€è½¬æ¢&lt;/li>
&lt;li>æ”¯æŒå®šæ—¶å™¨çš„æ³¨å†Œã€å–æ¶ˆå’Œè§¦å‘&lt;/li>
&lt;li>&lt;code>StateCell&lt;/code>æœ‰ä¸‰ç§çŠ¶æ€
&lt;ul>
&lt;li>å…·ä½“çš„è¿‡æœŸæ—¶é—´æˆ³ï¼ˆå®šæ—¶å™¨å·²è°ƒåº¦ï¼Œå¾…è§¦å‘ï¼‰&lt;/li>
&lt;li>&lt;code>STATE_PENDING_FIRE&lt;/code>ï¼ˆå®šæ—¶å™¨å·²åˆ°æœŸï¼Œæ­£å‡†å¤‡è§¦å‘ï¼‰&lt;/li>
&lt;li>&lt;code>STATE_DEREGISTERED&lt;/code>(å·²å–æ¶ˆ/å®Œæˆ)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#960050;background-color:#1e0010">å·²è°ƒåº¦&lt;/span>] &lt;span style="color:#f92672">--&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ—¶é—´åˆ°&lt;/span> &lt;span style="color:#f92672">-&lt;/span>-&amp;gt; [&lt;span style="color:#960050;background-color:#1e0010">å¾…è§¦å‘&lt;/span>] &lt;span style="color:#f92672">--&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">è§¦å‘å®Œæˆ&lt;/span> &lt;span style="color:#f92672">-&lt;/span>-&amp;gt; [&lt;span style="color:#960050;background-color:#1e0010">å·²å–æ¶ˆ&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">^&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">+------------------&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å–æ¶ˆ&lt;/span> &lt;span style="color:#f92672">-------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>TimerShared&lt;/code>è´Ÿè´£ç®¡ç†å®šæ—¶å™¨çš„å…±äº«çŠ¶æ€å’Œå¹¶å‘å®‰å…¨ï¼Œåˆ†ç¦»äº†å®šæ—¶å™¨çš„æ³¨å†Œæ—¶é—´ï¼Œç”¨äºæ—¶é—´è½®è°ƒåº¦&lt;/li>
&lt;li>&lt;code>TimerEntry&lt;/code>æ˜¯ç”¨æˆ·å¯è§çš„å¥æŸ„ï¼ŒåŒ…å«å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/li>
&lt;/ul>
&lt;h4 id="modrs">mod.rs
&lt;/h4>&lt;p>è´Ÿè´£ç®¡ç†æ‰€æœ‰ä¸æ—¶é—´ç›¸å…³çš„åŠŸèƒ½&lt;/p>
&lt;h5 id="æ ¸å¿ƒç»“æ„">æ ¸å¿ƒç»“æ„
&lt;/h5>&lt;ul>
&lt;li>Driverç»“æ„ä½“ï¼Œæ—¶é—´é©±åŠ¨çš„ä¸»è¦å®ç°ï¼Œè´Ÿè´£
&lt;ul>
&lt;li>ç®¡ç†æ—¶é—´è½®ï¼ˆtime wheelï¼‰å®ä¾‹&lt;/li>
&lt;li>å¤„ç†å®šæ—¶å™¨çš„æ³¨å†Œã€å–æ¶ˆå’Œè§¦å‘&lt;/li>
&lt;li>ä¸I/Oé©±åŠ¨ååŒå·¥ä½œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Inner&lt;/code>å’Œ&lt;code>InnerState&lt;/code>
&lt;ul>
&lt;li>åŒ…å«æ—¶é—´è½®å®ä¾‹&lt;/li>
&lt;li>ç®¡ç†é©±åŠ¨çŠ¶æ€ï¼ˆå¦‚æ˜¯å¦å·²å…³é—­ï¼‰&lt;/li>
&lt;li>æä¾›çº¿ç¨‹å®‰å…¨çš„å†…éƒ¨çŠ¶æ€è®¿é—®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="å…³é”®æ–¹æ³•">å…³é”®æ–¹æ³•
&lt;/h5>&lt;p>process_at_timeæ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>å¤„ç†å½“å‰æ—¶é—´ç‚¹æ‰€æœ‰åˆ°æœŸçš„å®šæ—¶å™¨&lt;/li>
&lt;li>å¤„ç†ç³»ç»Ÿæ—¶é—´å›é€€çš„æƒ…å†µ&lt;/li>
&lt;li>æ‰¹é‡å”¤é†’ç­‰å¾…çš„ä»»åŠ¡&lt;/li>
&lt;/ul>
&lt;p>reregisteræ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>é‡æ–°æ³¨å†Œå®šæ—¶å™¨åˆ°æ–°çš„æ—¶é—´ç‚¹&lt;/li>
&lt;li>çº¿ç¨‹å®‰å…¨çš„æ›´æ–°å®šæ—¶å™¨&lt;/li>
&lt;li>å¤„ç†é©±åŠ¨å…³é—­çš„æƒ…å†µ&lt;/li>
&lt;/ul></description></item><item><title>Park çº¿ç¨‹æŒ‚èµ·çš„å®ç°</title><link>https://www.dust-zed.site/rust/tokio/park-%E7%BA%BF%E7%A8%8B%E6%8C%82%E8%B5%B7%E7%9A%84%E5%AE%9E%E7%8E%B0/</link><pubDate>Wed, 10 Sep 2025 10:04:26 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/park-%E7%BA%BF%E7%A8%8B%E6%8C%82%E8%B5%B7%E7%9A%84%E5%AE%9E%E7%8E%B0/</guid><description>&lt;p>&lt;code>park.rs&lt;/code>æ˜¯Tokioè¿è¡Œæ—¶ä¸­ç”¨äºçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤çš„æ ¸å¿ƒã€‚&lt;/p>
&lt;h4 id="æ ¸å¿ƒç»“æ„">æ ¸å¿ƒç»“æ„
&lt;/h4>&lt;h5 id="parkthread-å’Œ-unparkthread">ParkThread å’Œ UnParkThread
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">ParkThread&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inner: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Inner&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">UnParkThread&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inner: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Inner&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹ä¸€çœ‹ï¼Œè¿™ä¸¤æ ¹æœ¬å°±æ˜¯ç›¸åŒçš„ç»“æ„ï¼Œä½†æ˜¯å®ƒä»¬æ˜¯ç”¨åœ¨ä¸åŒåœ°æ–¹çš„ï¼Œä»¥åŠimplå—æœ‰åŒºåˆ«ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">tokio_thread_local!&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">CURRENT_PARKER&lt;/span>: &lt;span style="color:#a6e22e">ParkThread&lt;/span> &lt;span style="color:#f92672">=&lt;/span> ParkThread::new();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯æœ€é‡è¦çš„åŒºåˆ«ï¼Œ&lt;code>ParkThread&lt;/code>ç”¨åœ¨äº†çº¿ç¨‹å±€éƒ¨å˜é‡ä¸Šï¼Œè€Œ&lt;code>UnParkThread&lt;/code>æ²¡æœ‰çº¿ç¨‹å±€éƒ¨é™åˆ¶ï¼Œå¦å¤–&lt;code>UnParkThread&lt;/code>åªå®ç°äº†&lt;code>unpark&lt;/code>æ–¹æ³•ï¼Œç›®çš„æ˜¯è®©å…¶ä»–çº¿ç¨‹åªèƒ½å”¤é†’ã€‚&lt;/p>
&lt;h5 id="inner">Inner
&lt;/h5>&lt;p>&lt;code>Inner&lt;/code>ç»“æ„ä½“ä½¿ç”¨åŸå­æ“ä½œç®¡ç†çº¿ç¨‹çŠ¶æ€ï¼Œè¿™ç§çŠ¶æ€ç®¡ç†æ˜¯æ„å»ºæ— é”å¹¶å‘åŸè¯­çš„åŸºç¡€ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">EMPTY&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#75715e">//åˆå§‹çŠ¶æ€æˆ–unparkçŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">PARKED&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; &lt;span style="color:#75715e">//çº¿ç¨‹å·²æŒ‚èµ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">NOTIFIED&lt;/span>: &lt;span style="color:#66d9ef">usize&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>; &lt;span style="color:#75715e">//çº¿ç¨‹å·²è¢«é€šçŸ¥å”¤é†’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Inner&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state: &lt;span style="color:#a6e22e">AtomicUsize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mutex: &lt;span style="color:#a6e22e">Mutex&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>()&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> condvar: &lt;span style="color:#a6e22e">Condvar&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¸ºä»€ä¹ˆç›´æ¥ç”¨&lt;code>Mutex&amp;lt;Usize&amp;gt;&lt;/code>è€Œæ˜¯å¤šç”¨äº†ä¸€ä¸ª&lt;code>AtomicUsize&lt;/code>
&lt;ul>
&lt;li>&lt;code>AtomicUsize&lt;/code>æ˜¯æ— é”çš„ï¼Œæ¯”è·å– &lt;code>Mutex&lt;/code>å¿«&lt;/li>
&lt;li>å†…å­˜é¡ºåºä¿è¯&lt;/li>
&lt;li>çŠ¶æ€æ›´æ–°ä½¿ç”¨åŸå­æ“ä½œï¼Œå‡å°‘é”çš„æŒæœ‰æ—¶é—´&lt;/li>
&lt;li>é”ç²’åº¦æ§åˆ¶ï¼Œ&lt;code>Mutex&lt;/code>åªä¿æŠ¤æ¡ä»¶å˜é‡çš„ç­‰å¾…/é€šçŸ¥æ—¶æœº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="å…·ä½“åŠŸèƒ½çš„å®ç°">å…·ä½“åŠŸèƒ½çš„å®ç°
&lt;/h4>&lt;h5 id="park">park()
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">park&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .state
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .compare_exchange(&lt;span style="color:#66d9ef">NOTIFIED&lt;/span>, &lt;span style="color:#66d9ef">EMPTY&lt;/span>, SeqCst, SeqCst)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .is_ok() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>; &lt;span style="color:#75715e">// â€œè™šå‡å”¤é†’â€ä¿æŠ¤ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹unparkï¼Œæ­¤çº¿ç¨‹åˆparkï¼Œé¿å…äº†æ²¡å¿…è¦çš„çº¿ç¨‹æŒ‚èµ·å’Œå”¤é†’æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è·å–é”,å¹¶ä¿®æ”¹çŠ¶æ€è‡³parked
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> m: &lt;span style="color:#a6e22e">std&lt;/span>::sync::MutexGuard&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_, ()&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> self.mutex.lock();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self.state.compare_exchange(&lt;span style="color:#66d9ef">EMPTY&lt;/span>, &lt;span style="color:#66d9ef">PARKED&lt;/span>, SeqCst, SeqCst) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(_) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(&lt;span style="color:#66d9ef">NOTIFIED&lt;/span>) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> old &lt;span style="color:#f92672">=&lt;/span> self.state.swap(&lt;span style="color:#66d9ef">EMPTY&lt;/span>, SeqCst);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">debug_assert_eq!&lt;/span>(old, &lt;span style="color:#66d9ef">NOTIFIED&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;park state changed unexpectedly&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(actual) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">panic!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;inconsistent park state; actual = &lt;/span>&lt;span style="color:#e6db74">{actual}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> m &lt;span style="color:#f92672">=&lt;/span> self.condvar.wait(m).unwrap(); &lt;span style="color:#75715e">//é‡Šæ”¾é”å¹¶æŒ‚èµ·çº¿ç¨‹ç­‰å¾…notify
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .state
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .compare_exchange(&lt;span style="color:#66d9ef">NOTIFIED&lt;/span>, &lt;span style="color:#66d9ef">EMPTY&lt;/span>, SeqCst, SeqCst)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .is_ok()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>; &lt;span style="color:#75715e">//ç¡®ä¿æœ‰æ•ˆå”¤é†’ï¼ŒNOTIFIED -&amp;gt; EMPTY,å¿½ç•¥é”™è¯¯å”¤é†’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="åŒé‡æ£€æŸ¥æ¨¡å¼">åŒé‡æ£€æŸ¥æ¨¡å¼
&lt;/h6>&lt;ul>
&lt;li>ç¬¬ä¸€æ¬¡æ£€æŸ¥é¿å…ä¸å¿…è¦çš„é”è·å–&lt;/li>
&lt;li>ç¬¬äºŒæ¬¡æ£€æŸ¥å¤„ç†ç«æ€æ¡ä»¶&lt;/li>
&lt;/ul>
&lt;h6 id="è™šå‡å”¤é†’å¤„ç†">è™šå‡å”¤é†’å¤„ç†
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> m &lt;span style="color:#f92672">=&lt;/span> self.condvar.wait(m).unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self.state.compare_exchange(&lt;span style="color:#66d9ef">NOTIFIED&lt;/span>, &lt;span style="color:#66d9ef">EMPTY&lt;/span>, SeqCst, SeqCst).is_ok() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå¾ªç¯ç¡®ä¿åªæœ‰æ”¶åˆ°çœŸæ­£çš„é€šçŸ¥æ‰ä¼šè¿”å›ï¼Œå¤„ç†äº†æ¡ä»¶å˜é‡çš„è™šå‡å”¤é†’é—®é¢˜ã€‚&lt;/p>
&lt;h5 id="unpark">unpark
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">unpark&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//æ— è®ºä»€ä¹ˆçŠ¶æ€éƒ½ç½®ä¸ºNOTIFIED
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.state.swap(&lt;span style="color:#66d9ef">NOTIFIED&lt;/span>, SeqCst) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">EMPTY&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">NOTIFIED&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">PARKED&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _ &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">panic!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;inconsistent state in unpark&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//é€šè¿‡lockç¡®ä¿ç›®æ ‡çº¿ç¨‹å·²ç»æ˜¯PARKEDäº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> drop(self.mutex.lock());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.condvar.notify_one();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡æ§åˆ¶ParkThreadå’ŒUnParkThreadçš„æ–¹æ³•ï¼Œå®Œæˆäº†åŠŸèƒ½åˆ†ç¦»ï¼Œé…åˆä¹‹å‰çš„&lt;code>ThreadLocal&lt;/code>,å®Œæˆäº†çº¿ç¨‹è‡ªå·±æŒ‚èµ·ï¼Œç„¶åå…¶ä»–çº¿ç¨‹å¯ä»¥å”¤é†’æ­¤çº¿ç¨‹çš„åŠŸèƒ½ã€‚åŒæ—¶UnParkThreadä¹Ÿå¯ä»¥è½¬ä¸º&lt;code>Waker&lt;/code>ã€‚&lt;/p>
&lt;h5 id="shutdown">shutdown
&lt;/h5>&lt;p>é€šçŸ¥çº¿ç¨‹è¯¥é†’äº†ï¼Œå…·ä½“çš„shutdownæ“ä½œç”±è°ƒç”¨è€…å¤„ç†ã€‚&lt;/p>
&lt;h5 id="cachedparkthread">CachedParkThread
&lt;/h5>&lt;ol>
&lt;li>ç¼“å­˜&lt;code>Waker&lt;/code>é¿å…é‡å¤åˆ†é…&lt;/li>
&lt;li>æä¾›&lt;code>block_on&lt;/code>æ–¹æ³•ï¼Œè¿™æ˜¯è¿è¡Œæ—¶æ‰§è¡Œfutureçš„åŸºç¡€&lt;/li>
&lt;li>é€šè¿‡çº¿ç¨‹å±€éƒ¨å­˜å‚¨ç®¡ç†æ¯ä¸ªçº¿ç¨‹çš„parker&lt;/li>
&lt;li>&lt;code>_anchor: PhantomData&amp;lt;Rc&amp;lt;()&amp;gt;&amp;gt;&lt;/code>éšå«äº†&lt;code>!Send + !Sync&lt;/code>ï¼ŒCachedParkThread ä¸å¯è·¨çº¿ç¨‹ã€‚&lt;/li>
&lt;/ol></description></item><item><title>å†…å­˜æ’åº</title><link>https://www.dust-zed.site/rust/%E5%86%85%E5%AD%98%E6%8E%92%E5%BA%8F/</link><pubDate>Mon, 08 Sep 2025 11:16:22 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E5%86%85%E5%AD%98%E6%8E%92%E5%BA%8F/</guid><description>&lt;h4 id="1-ä¸ºä»€ä¹ˆéœ€è¦å†…å­˜æ’åº">1. ä¸ºä»€ä¹ˆéœ€è¦å†…å­˜æ’åº
&lt;/h4>&lt;p>åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¼šè¿›è¡Œå„ç§ä¼˜åŒ–(å¦‚æŒ‡ä»¤é‡æ’åº)æ¥æä¾›æ€§èƒ½ã€‚å†…å­˜æ’åºå®šä¹‰äº†è¿™äº›ä¼˜åŒ–åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„è¡Œä¸ºã€‚&lt;/p>
&lt;h4 id="rustä¸­çš„å†…å­˜æ’åºçº§åˆ«">Rustä¸­çš„å†…å­˜æ’åºçº§åˆ«
&lt;/h4>&lt;p>Rusté€šè¿‡&lt;code>std::sync::atomic::Ordering&lt;/code>æä¾›äº†å‡ ç§å†…å­˜æ’åºçº§åˆ«ï¼š&lt;/p>
&lt;h5 id="21-relaxed">2.1 Relaxed
&lt;/h5>&lt;ul>
&lt;li>æœ€å¼±çš„å†…å­˜æ’åº&lt;/li>
&lt;li>åªä¿è¯å½“å‰æ“ä½œçš„åŸå­æ€§&lt;/li>
&lt;li>ä¸ä¿è¯æ“ä½œä¹‹é—´çš„é¡ºåº&lt;/li>
&lt;li>é€‚ç”¨åœºæ™¯ï¼šç®€å•çš„è®¡æ•°å™¨ã€ç»Ÿè®¡ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::sync::atomic::{AtomicUsize, Ordering};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> counter &lt;span style="color:#f92672">=&lt;/span> AtomicUsize::new(&lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>counter.fetch_add(&lt;span style="color:#ae81ff">1&lt;/span>, Ordering::Relaxed);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="22-releaseå’Œacquire">2.2 Releaseå’ŒAcquire
&lt;/h5>&lt;ul>
&lt;li>&lt;code>Release&lt;/code>ï¼š
&lt;ul>
&lt;li>&lt;strong>å†™å±éšœ&lt;/strong>ï¼Œç¡®ä¿Releaseæ“ä½œä¹‹å‰çš„æ‰€æœ‰å†…å­˜æ“ä½œï¼ˆè¯»/å†™ï¼‰éƒ½å®Œæˆ&lt;/li>
&lt;li>&lt;strong>å¯è§æ€§ä¿è¯&lt;/strong>ï¼Œç¡®ä¿è¿™äº›ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹å¯è§&lt;/li>
&lt;li>å‘å¸ƒæ•°æ®åˆ°å…±äº«å†…å­˜ï¼Œæ ‡è®°æ•°æ®å‡†å¤‡å°±ç»ª&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Acquire&lt;/code>
&lt;ul>
&lt;li>&lt;strong>è¯»å±éšœ&lt;/strong>ï¼šç¡®ä¿åœ¨Acquireæ“ä½œä¹‹åçš„æ‰€æœ‰å†…å­˜æ“ä½œï¼ˆè¯»/å†™ï¼‰éƒ½èƒ½çœ‹åˆ°ä¹‹å‰Releaseæ“ä½œçš„æ‰€æœ‰ä¿®æ”¹&lt;/li>
&lt;li>&lt;strong>å¯è§æ€§ä¿è¯&lt;/strong>ï¼šç¡®ä¿çœ‹åˆ°å…¶ä»–çº¿ç¨‹Releaseæ“ä½œä¹‹å‰çš„æ‰€æœ‰ä¿®æ”¹&lt;/li>
&lt;li>ä»å…±äº«å†…å­˜è¯»å–æ•°æ®ï¼Œæ£€æŸ¥æ•°æ®æ˜¯å¦å°±ç»ª&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="23-acqrel">2.3 AcqRel
&lt;/h5>&lt;ul>
&lt;li>ç»„åˆè¯­ä¹‰ï¼ŒåŒæ—¶å…·æœ‰&lt;code>Release&lt;/code>å’Œ&lt;code>Acquire&lt;/code>çš„è¯­ä¹‰&lt;/li>
&lt;/ul>
&lt;h5 id="24-seqcst">2.4 Seqcst
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>æœ€å¼ºä¿è¯&lt;/strong>ï¼šé™¤äº†&lt;code>Acquire/Release&lt;/code>å¤–ï¼Œè¿˜ä¿è¯å…¨å±€ä¸€è‡´æ€§&lt;/li>
&lt;li>&lt;strong>é¢å¤–ä¿è¯&lt;/strong>ï¼š
&lt;ul>
&lt;li>æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ“ä½œé¡ºåºä¸€è‡´ï¼Œæ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ“ä½œé¡ºåºæ˜¯ä¸€è‡´çš„
&lt;ul>
&lt;li>è¦ä¹ˆçœ‹åˆ° (3) -&amp;gt; (1) -&amp;gt; (4) -&amp;gt; (2)&lt;/li>
&lt;li>è¦ä¹ˆçœ‹åˆ° (1) -&amp;gt; (3) -&amp;gt; (2) -&amp;gt; (4)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å»ºç«‹å…¨å±€æ“ä½œé¡ºåº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="å°ç»“">å°ç»“
&lt;/h4>&lt;p>&lt;code>Relaxed&lt;/code>æ˜¯åªé’ˆå¯¹åŸå­å˜é‡çš„ï¼Œå…¶ä»–å†…å­˜æ’åºæ˜¯é’ˆå¯¹å…±äº«å†…å­˜çš„ï¼Œå……å½“ç€å†…å­˜å±éšœçš„ä½œç”¨ã€‚&lt;/p></description></item><item><title>Runtimeçš„æ ¸å¿ƒæ¦‚å¿µ</title><link>https://www.dust-zed.site/rust/tokio/runtime%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/</link><pubDate>Sat, 06 Sep 2025 18:53:34 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/runtime%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/</guid><description>&lt;h4 id="1-runtimeåŸºæœ¬æ¶æ„">1. RuntimeåŸºæœ¬æ¶æ„
&lt;/h4>&lt;p>Tokioçš„runtimeæ˜¯å¼‚æ­¥åº”ç”¨çš„æ ¸å¿ƒï¼Œä¸»è¦è´Ÿè´£ï¼š&lt;/p>
&lt;ul>
&lt;li>ä»»åŠ¡è°ƒåº¦&lt;/li>
&lt;li>I/Oäº‹ä»¶å¾ªç¯&lt;/li>
&lt;li>å®šæ—¶å™¨ç®¡ç†&lt;/li>
&lt;li>çº¿ç¨‹æ± ç®¡ç†&lt;/li>
&lt;/ul>
&lt;p>è®©æˆ‘ä»¬çœ‹çœ‹runtimeçš„ä¸»è¦ç»„ä»¶ï¼š&lt;/p>
&lt;h5 id="11-runtimeç»“æ„ä½“">1.1 Runtimeç»“æ„ä½“
&lt;/h5>&lt;p>&lt;code>Runtime&lt;/code>ç»“æ„ä½“æ˜¯æ•´ä¸ªå¼‚æ­¥è¿è¡Œæ—¶çš„å…¥å£ç‚¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Runtime&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Task scheduler
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> scheduler: &lt;span style="color:#a6e22e">Scheduler&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// handles to runtime, also contains driver handles
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> handle: &lt;span style="color:#a6e22e">Handle&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Blocking pool handle, used to signal shutdown
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> blocking_pool: &lt;span style="color:#a6e22e">BlockingPool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="2-æ ¸å¿ƒç»„ä»¶">2. æ ¸å¿ƒç»„ä»¶
&lt;/h4>&lt;h5 id="21-scheduler">2.1 scheduler
&lt;/h5>&lt;p>&lt;strong>ä½œç”¨ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>è´Ÿè´£ä»»åŠ¡çš„è°ƒåº¦å’Œæ‰§è¡Œ&lt;/li>
&lt;li>ç®¡ç†ä»»åŠ¡é˜Ÿåˆ—å’Œä»»åŠ¡çŠ¶æ€&lt;/li>
&lt;li>å†³å®šä»»åŠ¡çš„æ‰§è¡Œé¡ºåº&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è®¾è®¡åŸå› &lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å°†è°ƒåº¦é€»è¾‘ä¸è¿è¡Œæ—¶å…¶ä»–éƒ¨åˆ†è§£è€¦&lt;/li>
&lt;li>æ”¯æŒä¸åŒçš„è°ƒåº¦ç­–ç•¥ï¼ˆå•çº¿ç¨‹/å¤šçº¿ç¨‹ï¼‰&lt;/li>
&lt;li>ä½¿è°ƒåº¦å™¨å¯ä»¥ç‹¬ç«‹æµ‹è¯•å’Œä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;h5 id="22-handle">2.2 handle
&lt;/h5>&lt;p>&lt;strong>ä½œç”¨ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æä¾›å¯¹è¿è¡Œæ—¶çš„è½»é‡çº§å¼•ç”¨&lt;/li>
&lt;li>å…è®¸åœ¨è¿è¡Œæ—¶å¤–éƒ¨åˆ†å‘ä»»åŠ¡&lt;/li>
&lt;li>åŒ…å«å¯¹I/Oé©±åŠ¨ã€å®šæ—¶å™¨ç­‰ç»„ä»¶çš„è®¿é—®&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è®¾è®¡åŸå› &lt;/strong>&lt;/p>
&lt;ul>
&lt;li>é¿å…ç›´æ¥æš´éœ²&lt;code>Runtime&lt;/code>çš„æ‰€æœ‰æƒ&lt;/li>
&lt;li>å…è®¸å¤šä¸ªåœ°æ–¹æŒæœ‰å¯¹è¿è¡Œæ—¶çš„å¼•ç”¨&lt;/li>
&lt;li>æ”¯æŒè·¨çº¿ç¨‹å‘é€ä»»åŠ¡&lt;/li>
&lt;li>ä¾¿äºåœ¨å¼‚æ­¥ä»£ç ä¸­è·å–å½“å‰è¿è¡Œæ—¶&lt;/li>
&lt;/ul>
&lt;h5 id="23-blockingpool">2.3 BlockingPool
&lt;/h5>&lt;p>&lt;strong>ä½œç”¨ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ç®¡ç†é˜»å¡æ“ä½œçš„å·¥ä½œçº¿ç¨‹æ± &lt;/li>
&lt;li>æ‰§è¡Œå¯èƒ½é˜»å¡çš„æ“ä½œï¼Œå¦‚æ–‡ä»¶I/Oæˆ–CPUå¯†é›†å‹è®¡ç®—&lt;/li>
&lt;li>é˜²æ­¢é˜»å¡æ“ä½œå½±å“å¼‚æ­¥ä»»åŠ¡è°ƒåº¦&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è®¾è®¡åŸå› &lt;/strong>&lt;/p>
&lt;ul>
&lt;li>éš”ç¦»é˜»å¡æ“ä½œï¼Œé¿å…å½±å“äº‹ä»¶å¾ªç¯&lt;/li>
&lt;li>æä¾›æ˜ç¡®çš„APIæ¥å¤„ç†é˜»å¡æ“ä½œ&lt;/li>
&lt;li>å…è®¸æ§åˆ¶é˜»å¡æ“ä½œçš„å¹¶å‘åº¦&lt;/li>
&lt;/ul>
&lt;h4 id="3-æ•´ä½“è®¾è®¡è€ƒé‡">3. æ•´ä½“è®¾è®¡è€ƒé‡
&lt;/h4>&lt;h5 id="1-å…³æ³¨ç‚¹åˆ†ç¦»">1. å…³æ³¨ç‚¹åˆ†ç¦»
&lt;/h5>&lt;ul>
&lt;li>&lt;code>scheduler&lt;/code>å¤„ç†ä»»åŠ¡è°ƒåº¦&lt;/li>
&lt;li>&lt;code>handle&lt;/code>æä¾›è¿è¡Œæ—¶è®¿é—®&lt;/li>
&lt;li>&lt;code>blocking_pool&lt;/code>å¤„ç†é˜»å¡æ“ä½œ&lt;/li>
&lt;/ul>
&lt;h5 id="2-æ‰€æœ‰æƒç®¡ç†">2. æ‰€æœ‰æƒç®¡ç†
&lt;/h5>&lt;ul>
&lt;li>&lt;code>Runtime&lt;/code>æ‹¥æœ‰æ‰€æœ‰èµ„æºçš„æ‰€æœ‰æƒ&lt;/li>
&lt;li>&lt;code>Handle&lt;/code>æä¾›äº†å…±äº«è®¿é—®çš„æ–¹å¼&lt;/li>
&lt;li>èµ„æºåœ¨&lt;code>Runtime&lt;/code>è¢«dropæ—¶æ­£ç¡®æ¸…ç†&lt;/li>
&lt;/ul>
&lt;h5 id="3-æ€§èƒ½ä¼˜åŒ–">3. æ€§èƒ½ä¼˜åŒ–
&lt;/h5>&lt;ul>
&lt;li>è½»é‡çº§çš„&lt;code>Handle&lt;/code>å¯ä»¥å¤§é‡å¤åˆ¶&lt;/li>
&lt;li>é˜»å¡æ“ä½œä¸ä¼šé˜»å¡äº‹ä»¶å¾ªç¯&lt;/li>
&lt;li>è°ƒåº¦å™¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©å•çº¿ç¨‹æˆ–å¤šçº¿ç¨‹å®ç°&lt;/li>
&lt;/ul>
&lt;h5 id="4-çµæ´»æ€§">4. çµæ´»æ€§
&lt;/h5>&lt;ul>
&lt;li>æ”¯æŒä¸åŒçš„è¿è¡Œæ—¶é…ç½®&lt;/li>
&lt;li>å¯ä»¥æ‰©å±•æ–°çš„è°ƒåº¦ç­–ç•¥&lt;/li>
&lt;li>ä¾¿äºæµ‹è¯•å’Œæ¨¡æ‹Ÿ&lt;/li>
&lt;/ul>
&lt;h4 id="handleä¸ºä»€ä¹ˆæ˜¯runtimeçš„è½»é‡çº§å¼•ç”¨">Handleä¸ºä»€ä¹ˆæ˜¯Runtimeçš„è½»é‡çº§å¼•ç”¨
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>&lt;code>Runtime&lt;/code>ä¸­çš„&lt;code>scheduler&lt;/code>å­—æ®µ&lt;/p>
&lt;ul>
&lt;li>è¿™æ˜¯ä¸»è¦çš„&lt;code>Scheduler&lt;/code>å®ä¾‹&lt;/li>
&lt;li>å®ƒæ‹¥æœ‰ä»»åŠ¡é˜Ÿåˆ—å’Œå…¶ä»–èµ„æº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Handle&lt;/code>ä¸­çš„å¼•ç”¨&lt;/p>
&lt;ul>
&lt;li>ä¸æ˜¯å¼•ç”¨&lt;code>Scheduler&lt;/code>æœ¬èº«&lt;/li>
&lt;li>è€Œæ˜¯å¼•ç”¨&lt;code>Scheduler&lt;/code>å†…éƒ¨çš„å…±äº«çŠ¶æ€&lt;/li>
&lt;li>è¿™äº›çŠ¶æ€é€šå¸¸æ˜¯é€šè¿‡&lt;code>Arc&lt;/code>åŒ…è£…çš„ç‹¬ç«‹ç»“æ„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å…·ä½“å®ç°&lt;/p>
&lt;ul>
&lt;li>&lt;code>CurrentThread&lt;/code>è°ƒåº¦å™¨å¯èƒ½ä½¿ç”¨&lt;code>Rc&amp;lt;RefCell&amp;lt;...&amp;gt;&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>MultiThread&lt;/code>è°ƒåº¦å™¨ä½¿ç”¨&lt;code>Arc&lt;/code>è¿›è¡Œçº¿ç¨‹é—´å…±äº«&lt;/li>
&lt;li>è¿™äº›å†…éƒ¨ç»“æ„åœ¨&lt;code>Scheduler&lt;/code>åˆå§‹åŒ–åˆ›å»º&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æ‰€æœ‰æƒå…³ç³»&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">CurrentThread&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å†…éƒ¨ä½¿ç”¨ Rc å…±äº«çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> shared: &lt;span style="color:#a6e22e">Rc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Shared&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Handle&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…±äº«ç›¸åŒçš„ Rc&amp;lt;Shared&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> shared: &lt;span style="color:#a6e22e">Rc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Shared&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºHandleæ—¶ï¼Œä¼šå…‹éš†&lt;code>Arc/Rc&lt;/code>å¢åŠ å¼•ç”¨è®¡æ•°&lt;/li>
&lt;li>è¿™æ ·çš„è®¾è®¡ä½“ç°äº†&lt;code>Scheduler&lt;/code>æ˜¯&lt;code>Runtime&lt;/code>çš„æ ¸å¿ƒ&lt;/li>
&lt;/ul>
&lt;h4 id="æ–‡ä»¶ioä¸ºä»€ä¹ˆä½¿ç”¨é˜»å¡çº¿ç¨‹æ± ">æ–‡ä»¶I/Oä¸ºä»€ä¹ˆä½¿ç”¨é˜»å¡çº¿ç¨‹æ± 
&lt;/h4>&lt;ul>
&lt;li>ç½‘ç»œI/Oï¼šç°ä»£æ“ä½œç³»ç»Ÿæä¾›äº†ä¸“é—¨çš„éé˜»å¡APIï¼ˆå¦‚Linuxçš„epollï¼ŒmacOSçš„kqueueï¼‰&lt;/li>
&lt;li>æ–‡ä»¶I/Oï¼šå¤§å¤šæ•°æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»ŸAPIåº•å±‚ä»ç„¶æ˜¯é˜»å¡çš„&lt;/li>
&lt;li>æ€§èƒ½è€ƒé‡ï¼šæ–‡ä»¶æ“ä½œé€šå¸¸æ¯”ç½‘ç»œæ“ä½œå¿«å¾—å¤šï¼›ä½¿ç”¨éé˜»å¡APIåè€Œå¢åŠ å¼€é”€ï¼›ç£ç›˜I/Oçš„å»¶è¿Ÿé€šå¸¸æ¯”ç½‘ç»œI/Oæ›´å¯é¢„æµ‹ã€‚&lt;/li>
&lt;/ul></description></item><item><title>Wakerå’ŒContextæœºåˆ¶</title><link>https://www.dust-zed.site/rust/tokio/waker%E5%92%8Ccontext%E6%9C%BA%E5%88%B6/</link><pubDate>Fri, 05 Sep 2025 18:51:54 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/waker%E5%92%8Ccontext%E6%9C%BA%E5%88%B6/</guid><description>&lt;h4 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Context&lt;/strong>ï¼šæä¾›å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæœ€é‡è¦çš„æ˜¯åŒ…å«Waker&lt;/li>
&lt;li>&lt;strong>Waker&lt;/strong>ï¼šç”¨äºå”¤é†’è¢«æŒ‚èµ·çš„å¼‚æ­¥ä»»åŠ¡çš„æœºåˆ¶&lt;/li>
&lt;li>&lt;strong>Poll&lt;/strong>ï¼šFutureçš„è½®è¯¢çŠ¶æ€, &lt;code>Ready&lt;/code>æˆ–&lt;code>Pending&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="contextçš„å®šä¹‰">Contextçš„å®šä¹‰
&lt;/h4>&lt;p>&lt;code>Context&lt;/code> æ˜¯Rustæ ‡å‡†åº“ä¸­&lt;code>std::task&lt;/code>æ¨¡å—æä¾›çš„ç»“æ„ä½“ï¼Œå®ƒä¸»è¦åŒ…å«ï¼š&lt;/p>
&lt;ol>
&lt;li>å¯¹&lt;code>Waker&lt;/code>çš„å¼•ç”¨&lt;/li>
&lt;li>å¯é€‰çš„ä»»åŠ¡æœ¬åœ°å­˜å‚¨&lt;/li>
&lt;/ol>
&lt;p>åœ¨Tokioä¸­ï¼Œ&lt;code>Context&lt;/code>ä¸»è¦ç”¨äºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Future &lt;span style="color:#66d9ef">for&lt;/span> MyFuture {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> ();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">poll&lt;/span>(self: &lt;span style="color:#a6e22e">Pin&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> Self&lt;span style="color:#f92672">&amp;gt;&lt;/span>, cx: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> Context&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">Poll&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Self::Output&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨ cx.waker() è·å– Waker
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// å½“ I/O æœªå°±ç»ªæ—¶ï¼Œä¿å­˜ Waker ä»¥ä¾¿åç»­å”¤é†’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="wakerçš„æ ¸å¿ƒå®ç°">Wakerçš„æ ¸å¿ƒå®ç°
&lt;/h4>&lt;p>åœ¨Tokioä¸­ï¼Œ&lt;code>Waker&lt;/code>æ˜¯å¼‚æ­¥ä»»åŠ¡é€šçŸ¥æœºåˆ¶çš„æ ¸å¿ƒã€‚å…ˆçœ‹çœ‹Tokioä¸­çš„å…³é”®å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">super&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">WakerRef&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;a&lt;/span>, S: &amp;#39;static&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> waker: &lt;span style="color:#a6e22e">ManuallyDrop&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Waker&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _p: &lt;span style="color:#a6e22e">PhantomData&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;a&lt;/span> Header, S)&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="wakerçš„åˆ›å»º">Wakerçš„åˆ›å»º
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">raw_waker&lt;/span>(header: &lt;span style="color:#a6e22e">NonNull&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Header&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">RawWaker&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> ptr &lt;span style="color:#f92672">=&lt;/span> header.as_ptr() &lt;span style="color:#66d9ef">as&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RawWaker::new(ptr, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">WAKER_VTABLE&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="wakerçš„vtable">Wakerçš„VTable
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">WAKER_VTABLE&lt;/span>: &lt;span style="color:#a6e22e">RawWakerVTable&lt;/span> &lt;span style="color:#f92672">=&lt;/span> RawWakerVTable::new(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> clone_waker, &lt;span style="color:#75715e">// å…‹éš† Waker
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> wake_by_val, &lt;span style="color:#75715e">// æ¶ˆè´¹ Waker å¹¶å”¤é†’ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> wake_by_ref, &lt;span style="color:#75715e">// ä¸æ¶ˆè´¹ Waker çš„æƒ…å†µä¸‹å”¤é†’ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> drop_waker, &lt;span style="color:#75715e">// é‡Šæ”¾ Waker èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="wakerçš„ç”Ÿå‘½å‘¨æœŸ">wakerçš„ç”Ÿå‘½å‘¨æœŸ
&lt;/h5>&lt;ol>
&lt;li>åˆ›å»ºï¼š å½“ä»»åŠ¡è¢«åˆ›å»ºæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Waker&lt;/li>
&lt;li>å”¤é†’ï¼šå½“I/Oäº‹ä»¶å°±ç»ªæˆ–å®šæ—¶å™¨è§¦å‘&lt;/li>
&lt;li>æ¶ˆè´¹ï¼šä»»åŠ¡è¢«å”¤é†’åï¼ŒWakerä¼šè¢«æ¶ˆè´¹æ‰&lt;/li>
&lt;li>é‡å»ºï¼šå¦‚æœéœ€è¦å†æ¬¡å”¤é†’ä»»åŠ¡ï¼Œéœ€è¦é‡æ–°åˆ›å»ºWaker&lt;/li>
&lt;/ol>
&lt;h4 id="å·¥ä½œæµç¨‹ç¤ºä¾‹">å·¥ä½œæµç¨‹ç¤ºä¾‹
&lt;/h4>&lt;p>ç®€æ˜“çš„ä»»åŠ¡å”¤é†’æµç¨‹ï¼š&lt;/p>
&lt;h5 id="1-ä»»åŠ¡åˆ›å»º">1. ä»»åŠ¡åˆ›å»º
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> task &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">async&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¼‚æ­¥ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tokio::spawn(task);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-wakeråˆ›å»º">2. Wakeråˆ›å»º
&lt;/h5>&lt;ul>
&lt;li>Tokioè¿è¡Œæ—¶ä¸ºä»»åŠ¡åˆ›å»ºWaker&lt;/li>
&lt;li>WakeråŒ…å«æŒ‡å‘ä»»åŠ¡çŠ¶æ€çš„æŒ‡é’ˆ&lt;/li>
&lt;/ul>
&lt;h5 id="3-ioæ³¨å†Œ">3. I/Oæ³¨å†Œ
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å½“è°ƒç”¨ç±»ä¼¼ TcpStream::read æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> ready &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">ready!&lt;/span>(self.io.poll_read_ready(cx)&lt;span style="color:#f92672">?&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-ä»»åŠ¡æŒ‚èµ·">4. ä»»åŠ¡æŒ‚èµ·
&lt;/h5>&lt;ul>
&lt;li>å¦‚æœI/Oæœªå°±ç»ªï¼Œä¿å­˜Waker&lt;/li>
&lt;li>è¿”å›&lt;code>Poll::Pending&lt;/code>&lt;/li>
&lt;/ul>
&lt;h5 id="5-äº‹ä»¶å°±ç»ª">5. äº‹ä»¶å°±ç»ª
&lt;/h5>&lt;ul>
&lt;li>I/Oäº‹ä»¶å°±ç»ªï¼Œä¿å­˜Waker&lt;/li>
&lt;li>äº‹ä»¶å¾ªç¯è°ƒç”¨ä¿å­˜çš„Wakerçš„&lt;code>wake()&lt;/code>æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;h5 id="6-ä»»åŠ¡æ¢å¤">6. ä»»åŠ¡æ¢å¤
&lt;/h5>&lt;ul>
&lt;li>Wakerå°†ä»»åŠ¡æ”¾å›å°±ç»ªé˜Ÿåˆ—&lt;/li>
&lt;li>è°ƒåº¦å™¨å†æ¬¡è½®è¯¢è¯¥ä»»åŠ¡&lt;/li>
&lt;/ul></description></item><item><title>æ™®é€šå¯¹è±¡å’Œtraitå¯¹è±¡</title><link>https://www.dust-zed.site/rust/%E6%99%AE%E9%80%9A%E5%AF%B9%E8%B1%A1%E5%92%8Ctrait%E5%AF%B9%E8%B1%A1/</link><pubDate>Fri, 05 Sep 2025 18:49:07 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E6%99%AE%E9%80%9A%E5%AF%B9%E8%B1%A1%E5%92%8Ctrait%E5%AF%B9%E8%B1%A1/</guid><description>&lt;h4 id="æ™®é€šå¯¹è±¡çš„å†…å­˜ç»“æ„">æ™®é€šå¯¹è±¡çš„å†…å­˜ç»“æ„
&lt;/h4>&lt;ul>
&lt;li>åªåŒ…å«æ•°æ®æˆå‘˜&lt;/li>
&lt;li>æ–¹æ³•ä¸å ç”¨å†…å­˜ç©ºé—´&lt;/li>
&lt;li>æ–¹æ³•è°ƒç”¨æ˜¯é™æ€åˆ†å‘çš„ï¼Œæ–¹æ³•å­˜å‚¨åœ¨ä»£ç æ®µä¸­ï¼Œè°ƒç”¨æ—¶ç›´æ¥è·³è½¬åˆ°å›ºå®šåœ°å€&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Point&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x: &lt;span style="color:#66d9ef">i32&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> y: &lt;span style="color:#66d9ef">i32&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">///å†…å­˜ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span>&lt;span style="color:#f92672">+------+------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> x: &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#f92672">|&lt;/span> y: &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// 8 å­—èŠ‚ (i32 æ˜¯ 4 å­—èŠ‚)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">+------+------+&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="traitå¯¹è±¡å†…å­˜ç»“æ„">traitå¯¹è±¡å†…å­˜ç»“æ„
&lt;/h4>&lt;ul>
&lt;li>ç”±ä¸¤ä¸ªæŒ‡é’ˆç»„æˆ
&lt;ul>
&lt;li>æ•°æ®æŒ‡é’ˆï¼šæŒ‡å‘å®é™…æ•°æ®çš„æŒ‡é’ˆ&lt;/li>
&lt;li>è™šè¡¨æŒ‡é’ˆï¼šæŒ‡å‘è™šè¡¨çš„æŒ‡é’ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>è™šè¡¨åŒ…å«
&lt;ul>
&lt;li>ææ„å‡½æ•°æŒ‡é’ˆ&lt;/li>
&lt;li>ç±»å‹å¤§å°å’Œå¯¹é½ä¿¡æ¯&lt;/li>
&lt;li>traitä¸­æ‰€æœ‰æ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">trait&lt;/span> Shape {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">area&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">f64&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">scale&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, factor: &lt;span style="color:#66d9ef">f64&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Circle&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> radius: &lt;span style="color:#66d9ef">f64&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Shape &lt;span style="color:#66d9ef">for&lt;/span> Circle {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">area&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">f64&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std::&lt;span style="color:#66d9ef">f64&lt;/span>::consts::&lt;span style="color:#66d9ef">PI&lt;/span> &lt;span style="color:#f92672">*&lt;/span> self.radius &lt;span style="color:#f92672">*&lt;/span> self.radius
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">scale&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, factor: &lt;span style="color:#66d9ef">f64&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.radius &lt;span style="color:#f92672">*=&lt;/span> factor;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> circle: Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> Shape&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> Box::new(Circle { radius: &lt;span style="color:#ae81ff">1.0&lt;/span> });
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å†…å­˜å¸ƒå±€">å†…å­˜å¸ƒå±€
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+------------------+&lt;/span> &lt;span style="color:#f92672">+------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ•°æ®æŒ‡é’ˆ&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">-&lt;/span>-&amp;gt; &lt;span style="color:#f92672">|&lt;/span> radius: &lt;span style="color:#66d9ef">f64&lt;/span> &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+------------------+&lt;/span> &lt;span style="color:#f92672">+------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">è™šè¡¨æŒ‡é’ˆ&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">-&lt;/span>-&amp;gt; &lt;span style="color:#f92672">+------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">+------------------+&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æŒ‡å‘&lt;/span> Circle &lt;span style="color:#960050;background-color:#1e0010">çš„è™šè¡¨&lt;/span> &lt;span style="color:#f92672">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">+------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">|&lt;/span> drop_in_place &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// ææ„å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">|&lt;/span> size &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// ç±»å‹å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">|&lt;/span> align &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// å¯¹é½æ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">|&lt;/span> area() &lt;span style="color:#960050;background-color:#1e0010">å‡½æ•°æŒ‡é’ˆ&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// ç¬¬ä¸€ä¸ª trait æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">|&lt;/span> scale() &lt;span style="color:#960050;background-color:#1e0010">å‡½æ•°æŒ‡é’ˆ&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#75715e">// ç¬¬äºŒä¸ª trait æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">+------------------+&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ–¹æ³•è°ƒç”¨è¿‡ç¨‹">æ–¹æ³•è°ƒç”¨è¿‡ç¨‹
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>æ™®é€šå¯¹è±¡æ–¹æ³•&lt;/strong>: æ™®é€šå¯¹è±¡æ–¹æ³•å­˜å‚¨åœ¨ä»£ç æ®µä¸­ï¼Œä¸å ç”¨å¯¹è±¡å†…å­˜ï¼Œè°ƒç”¨æ—¶ç›´æ¥è·³è½¬åˆ°å›ºå®šåœ°å€ã€‚&lt;/li>
&lt;li>&lt;strong>traitå¯¹è±¡æ–¹æ³•&lt;/strong>ï¼š
&lt;ul>
&lt;li>è·å–è™šè¡¨æŒ‡é’ˆ&lt;/li>
&lt;li>ä»è™šè¡¨ä¸­è·å–å‡½æ•°æŒ‡é’ˆ&lt;/li>
&lt;li>è°ƒç”¨å‡½æ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>Rustä¸­åŸºç¡€ç½‘ç»œç¼–ç¨‹</title><link>https://www.dust-zed.site/rust/rust%E4%B8%AD%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</link><pubDate>Fri, 05 Sep 2025 02:04:09 +0800</pubDate><guid>https://www.dust-zed.site/rust/rust%E4%B8%AD%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</guid><description>&lt;h3 id="rust-ç½‘ç»œç¼–ç¨‹åŸºç¡€tcp-ä¸-udp">Rust ç½‘ç»œç¼–ç¨‹åŸºç¡€ï¼šTCP ä¸ UDP
&lt;/h3>&lt;h4 id="tcp-ä¸-udp-åŸºç¡€æ¦‚å¿µ">TCP ä¸ UDP åŸºç¡€æ¦‚å¿µ
&lt;/h4>&lt;h5 id="tcp-ä¼ è¾“æ§åˆ¶åè®®">TCP (ä¼ è¾“æ§åˆ¶åè®®)
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>é¢å‘è¿æ¥&lt;/strong>ï¼šé€šä¿¡å‰éœ€è¦å»ºç«‹è¿æ¥ï¼Œä½¿ç”¨ &lt;code>TcpStream&lt;/code> è¡¨ç¤ºè¿æ¥&lt;/li>
&lt;li>&lt;strong>å¯é æ€§&lt;/strong>ï¼šä¿è¯æ•°æ®æŒ‰åºåˆ°è¾¾ï¼Œè‡ªåŠ¨å¤„ç†ä¸¢åŒ…é‡ä¼ &lt;/li>
&lt;li>&lt;strong>æµå¼åè®®&lt;/strong>ï¼šæ•°æ®æ²¡æœ‰æ˜ç¡®è¾¹ç•Œï¼Œéœ€è¦åº”ç”¨å±‚å¤„ç†æ¶ˆæ¯åˆ†å¸§&lt;/li>
&lt;li>&lt;strong>æµé‡æ§åˆ¶&lt;/strong>ï¼šå†…ç½®æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶æœºåˆ¶&lt;/li>
&lt;li>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šæ–‡ä»¶ä¼ è¾“ã€ç½‘é¡µæµè§ˆã€ç”µå­é‚®ä»¶ç­‰éœ€è¦å¯é ä¼ è¾“çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;h4 id="udp-ç”¨æˆ·æ•°æ®æŠ¥åè®®">UDP (ç”¨æˆ·æ•°æ®æŠ¥åè®®)
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>æ— è¿æ¥&lt;/strong>ï¼šæ¯ä¸ªæ•°æ®åŒ…ç‹¬ç«‹å‘é€ï¼Œä½¿ç”¨ &lt;code>UdpSocket&lt;/code> è¿›è¡Œé€šä¿¡&lt;/li>
&lt;li>&lt;strong>ä¸å¯é &lt;/strong>ï¼šä¸ä¿è¯æ•°æ®åŒ…é¡ºåºå’Œå¯è¾¾æ€§&lt;/li>
&lt;li>&lt;strong>æ•°æ®æŠ¥&lt;/strong>ï¼šæ¯ä¸ªæ•°æ®åŒ…æœ‰æ˜ç¡®è¾¹ç•Œ&lt;/li>
&lt;li>&lt;strong>ä½å»¶è¿Ÿ&lt;/strong>ï¼šæ²¡æœ‰è¿æ¥å»ºç«‹å’Œç¡®è®¤å¼€é”€&lt;/li>
&lt;li>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šå®æ—¶éŸ³è§†é¢‘ã€åœ¨çº¿æ¸¸æˆã€DNS æŸ¥è¯¢ç­‰å¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨&lt;/li>
&lt;/ul>
&lt;h3 id="rust-ä¸­çš„-tcp-ç¼–ç¨‹">Rust ä¸­çš„ TCP ç¼–ç¨‹
&lt;/h3>&lt;h4 id="æœåŠ¡ç«¯">æœåŠ¡ç«¯
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> tokio::net::{TcpListener, TcpStream};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">server&lt;/span>(addr: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>(), Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> std::error::Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> listener &lt;span style="color:#f92672">=&lt;/span> TcpListener::bind(addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Server listening on &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (&lt;span style="color:#66d9ef">mut&lt;/span> stream, addr) &lt;span style="color:#f92672">=&lt;/span> listener.accept().&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Client connected from: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºæ–°ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> tokio::spawn(&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">move&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†è¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> handle_connection(stream).&lt;span style="color:#66d9ef">await&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> tokio::net::TcpStream;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">client&lt;/span>(addr: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>(), Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> std::error::Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> stream &lt;span style="color:#f92672">=&lt;/span> TcpStream::connect(addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Connected to server at &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‘é€å’Œæ¥æ”¶æ•°æ®...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="rust-ä¸­çš„-udp-ç¼–ç¨‹">Rust ä¸­çš„ UDP ç¼–ç¨‹
&lt;/h3>&lt;h4 id="æœåŠ¡ç«¯-1">æœåŠ¡ç«¯
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> tokio::net::UdpSocket;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">server&lt;/span>(addr: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>(), Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> std::error::Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> socket &lt;span style="color:#f92672">=&lt;/span> UdpSocket::bind(addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;UDP server listening on &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> buf &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">vec!&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#66d9ef">u8&lt;/span>; &lt;span style="color:#ae81ff">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (len, addr) &lt;span style="color:#f92672">=&lt;/span> socket.recv_from(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> buf).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Received &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74"> bytes from &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, len, addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ•°æ®å¹¶å›å¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> socket.send_to(&lt;span style="color:#f92672">&amp;amp;&lt;/span>buf[&lt;span style="color:#f92672">..&lt;/span>len], &lt;span style="color:#f92672">&amp;amp;&lt;/span>addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å®¢æˆ·ç«¯-1">å®¢æˆ·ç«¯
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> tokio::net::UdpSocket;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::net::SocketAddr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">client&lt;/span>(server_addr: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">str&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>(), Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> std::error::Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç»‘å®šåˆ°ä»»æ„å¯ç”¨ç«¯å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> bind_addr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> server_addr.contains(&lt;span style="color:#e6db74">&amp;#39;:&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;[::]:0&amp;#34;&lt;/span> &lt;span style="color:#75715e">// IPv6
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;0.0.0.0:0&amp;#34;&lt;/span> &lt;span style="color:#75715e">// IPv4
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> socket &lt;span style="color:#f92672">=&lt;/span> UdpSocket::bind(bind_addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> server_addr: &lt;span style="color:#a6e22e">SocketAddr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> server_addr.parse()&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¯é€‰ï¼šè¿æ¥åˆ°æœåŠ¡å™¨åœ°å€ï¼Œä¹‹åå¯ä»¥ä½¿ç”¨ send/recv è€Œé send_to/recv_from
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> socket.connect(&lt;span style="color:#f92672">&amp;amp;&lt;/span>server_addr).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‘é€æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> socket.send(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Hello, UDP!&amp;#34;&lt;/span>).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¥æ”¶å“åº”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> buf &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#66d9ef">u8&lt;/span>; &lt;span style="color:#ae81ff">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> len &lt;span style="color:#f92672">=&lt;/span> socket.recv(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> buf).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Received: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, String::from_utf8_lossy(&lt;span style="color:#f92672">&amp;amp;&lt;/span>buf[&lt;span style="color:#f92672">..&lt;/span>len]));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å…³é”®åŒºåˆ«æ€»ç»“">å…³é”®åŒºåˆ«æ€»ç»“
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>è¿æ¥å¤„ç†&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>TCP éœ€è¦æ˜¾å¼æ¥å—è¿æ¥ (&lt;code>accept&lt;/code>)&lt;/li>
&lt;li>UDP ç›´æ¥å‘é€/æ¥æ”¶æ•°æ®æŠ¥&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ•°æ®è¾¹ç•Œ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>TCP æ˜¯æµå¼åè®®ï¼Œéœ€è¦åº”ç”¨å±‚å¤„ç†æ¶ˆæ¯è¾¹ç•Œ&lt;/li>
&lt;li>UDP ä¿æŒæ¶ˆæ¯è¾¹ç•Œï¼Œæ¯ä¸ª &lt;code>recv_from&lt;/code> å¯¹åº”ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¯é æ€§&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>TCP ä¿è¯å¯é ä¼ è¾“&lt;/li>
&lt;li>UDP ä¸ä¿è¯ï¼Œéœ€è¦åº”ç”¨å±‚å¤„ç†ä¸¢åŒ…å’Œä¹±åº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ€§èƒ½&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>TCP æœ‰è¿æ¥å»ºç«‹å’Œç¡®è®¤å¼€é”€&lt;/li>
&lt;li>UDP å»¶è¿Ÿæ›´ä½ï¼Œé€‚åˆå®æ—¶åº”ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="ç«¯å£å’Œè¿æ¥">ç«¯å£å’Œè¿æ¥
&lt;/h4>&lt;h5 id="1-ç›‘å¬ç«¯å£">1. ç›‘å¬ç«¯å£
&lt;/h5>&lt;ul>
&lt;li>ä¸€ä¸ªç«¯å£åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ç›‘å¬&lt;/li>
&lt;/ul>
&lt;h5 id="2-è¿æ¥ä¸ç«¯å£çš„å…³ç³»">2. è¿æ¥ä¸ç«¯å£çš„å…³ç³»
&lt;/h5>&lt;ul>
&lt;li>ä¸€ä¸ªç«¯å£å¯ä»¥æ‰¿è½½å¤šä¸ªè¿æ¥&lt;/li>
&lt;li>æ¯ä¸ªè¿æ¥ç”±å››å…ƒç»„å”¯ä¸€æ ‡è¯†
&lt;ul>
&lt;li>æºIP&lt;/li>
&lt;li>æºç«¯å£&lt;/li>
&lt;li>ç›®æ ‡IP&lt;/li>
&lt;li>ç›®æ ‡ç«¯å£&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="å¥—æ¥å­—ä¸è¿æ¥">å¥—æ¥å­—ä¸è¿æ¥
&lt;/h5>&lt;ul>
&lt;li>æ¯ä¸ªTcpè¿æ¥å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„å¥—æ¥å­—&lt;/li>
&lt;li>ç›‘å¬å¥—æ¥å­—è´Ÿè´£æ¥å—æ–°è¿æ¥&lt;/li>
&lt;li>å·²è¿æ¥å¥—æ¥å­—å¤„ç†å…·ä½“çš„ä¼ è¾“&lt;/li>
&lt;li>Tcpçš„â€œæœ‰è¿æ¥â€æœ¬è´¨æ˜¯æŒ‡&lt;strong>é€šä¿¡åŒæ–¹ç»´æŠ¤å…±åŒçš„çŠ¶æ€ä¿¡æ¯&lt;/strong>ï¼Œè€ŒUdpçš„â€œæ— è¿æ¥â€æ˜¯æŒ‡&lt;strong>æ¯ä¸ªæ•°æ®åŒ…éƒ½æ˜¯ç‹¬ç«‹å¤„ç†çš„&lt;/strong>ï¼Œä¸ä¾èµ–ä¹‹å‰çš„é€šä¿¡çŠ¶æ€ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="é€‰æ‹©å»ºè®®">é€‰æ‹©å»ºè®®
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>é€‰æ‹© TCP å½“ï¼š&lt;/p>
&lt;ul>
&lt;li>éœ€è¦å¯é çš„æ•°æ®ä¼ è¾“&lt;/li>
&lt;li>æ•°æ®ä¼ è¾“çš„å®Œæ•´æ€§æ¯”å®æ—¶æ€§æ›´é‡è¦&lt;/li>
&lt;li>ä¼ è¾“å¤§é‡æ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>é€‰æ‹© UDP å½“ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½å»¶è¿Ÿæ¯”å¯é æ€§æ›´é‡è¦&lt;/li>
&lt;li>å¯ä»¥å®¹å¿å°‘é‡æ•°æ®ä¸¢å¤±&lt;/li>
&lt;li>éœ€è¦å¹¿æ’­æˆ–å¤šæ’­åŠŸèƒ½&lt;/li>
&lt;li>ä¼ è¾“å°æ•°æ®åŒ…ä¸”é¢‘ç¹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸¤ç§åè®®å„æœ‰ä¼˜åŠ¿ï¼Œé€‰æ‹©å“ªç§å–å†³äºæ‚¨çš„å…·ä½“åº”ç”¨éœ€æ±‚ã€‚&lt;/p></description></item><item><title>Pinå’ŒUnpin</title><link>https://www.dust-zed.site/rust/tokio/pin%E5%92%8Cunpin/</link><pubDate>Thu, 04 Sep 2025 15:03:11 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/pin%E5%92%8Cunpin/</guid><description>&lt;h4 id="pinå’Œunpinçš„åŸºæœ¬æ¦‚å¿µ">Pinå’ŒUnpinçš„åŸºæœ¬æ¦‚å¿µ
&lt;/h4>&lt;h5 id="pinçš„ä½œç”¨">Pinçš„ä½œç”¨
&lt;/h5>&lt;p>&lt;code>Pin&amp;lt;P&amp;gt;&lt;/code>æ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œç”¨äºå›ºå®š(pin)å†…å­˜ä¸­çš„å€¼ï¼Œé˜²æ­¢å®ƒè¢«ç§»åŠ¨ã€‚è¿™å¯¹äºè‡ªå¼•ç”¨ç»“æ„ä½“å’Œå¼‚æ­¥ç¼–ç¨‹ä¸­çš„Futureç‰¹åˆ«é‡è¦ã€‚&lt;/p>
&lt;h5 id="unpinçš„ç‰¹è´¨">Unpinçš„ç‰¹è´¨
&lt;/h5>&lt;p>&lt;code>Unpin&lt;/code>æ˜¯ä¸€ä¸ªè‡ªåŠ¨æ´¾ç”Ÿçš„æ ‡è®°traitï¼Œè¡¨ç¤ºç±»å‹å¯ä»¥å®‰å…¨åœ°ç§»å‡º&lt;code>Pin&lt;/code>ã€‚å¤§å¤šæ•°ç±»å‹éƒ½è‡ªåŠ¨å®ç°äº†&lt;code>Unpin&lt;/code>ã€‚å®ç°äº†&lt;code>Unpin&lt;/code>çš„ç±»å‹å¯ä»¥å®‰å…¨åœ°ä»&lt;code>Pin&lt;/code>ä¸­ç§»å‡ºã€‚&lt;/p>
&lt;h4 id="asyncawaitä¸ºä½•éœ€è¦pin">async/awaitä¸ºä½•éœ€è¦Pin
&lt;/h4>&lt;ul>
&lt;li>&lt;code>async&lt;/code>å—å¯èƒ½åŒ…å«è‡ªå¼•ç”¨ï¼Œ&lt;code>async&lt;/code>è½¬å˜ä¸º&lt;code>Future&lt;/code>ç»“æ„ä½“,å®ƒæ˜¯ä¸€ä¸ªçŠ¶æ€æœº&lt;/li>
&lt;li>å½“&lt;code>.await&lt;/code>æš‚åœæ‰§è¡Œæ—¶ï¼Œå±€éƒ¨å˜é‡ä¼šä¿å­˜åœ¨ç”Ÿæˆçš„Futureä¸­&lt;/li>
&lt;li>å¦‚æœè¿™äº›å˜é‡ç›¸äº’å¼•ç”¨ï¼Œç§»åŠ¨Futureä¼šå¯¼è‡´æ‚¬å‚æŒ‡é’ˆ&lt;/li>
&lt;/ul>
&lt;h4 id="ç”Ÿå‘½å‘¨æœŸç®¡ç†å±‚æ¬¡">ç”Ÿå‘½å‘¨æœŸç®¡ç†å±‚æ¬¡
&lt;/h4>&lt;h5 id="1-å˜é‡çº§åˆ«">1. å˜é‡çº§åˆ«
&lt;/h5>&lt;ul>
&lt;li>å±€éƒ¨å˜é‡è¢«ç§»åŠ¨åˆ°FutureçŠ¶æ€æœºä¸­&lt;/li>
&lt;li>ç”Ÿå‘½å‘¨æœŸä¸Futureå®ä¾‹ç»‘å®š&lt;/li>
&lt;/ul>
&lt;h5 id="2-futureçº§åˆ«">2. Futureçº§åˆ«
&lt;/h5>&lt;ul>
&lt;li>ç”±æ‰§è¡Œå™¨æ‹¥æœ‰å’Œç®¡ç†&lt;/li>
&lt;li>æ‰§è¡Œå™¨å†³å®šä½•æ—¶pollï¼Œä½•æ—¶drop&lt;/li>
&lt;/ul>
&lt;h5 id="3-æ‰§è¡Œå™¨çº§åˆ«">3. æ‰§è¡Œå™¨çº§åˆ«
&lt;/h5>&lt;ul>
&lt;li>ç®¡ç†æ‰€æœ‰Futureçš„ç”Ÿå‘½å‘¨æœŸ&lt;/li>
&lt;li>è´Ÿè´£è°ƒåº¦å’Œç®¡ç†&lt;/li>
&lt;/ul>
&lt;h5 id="4-æ ˆå¸§ä¸çŠ¶æ€æœº">4. æ ˆå¸§ä¸çŠ¶æ€æœº
&lt;/h5>&lt;ul>
&lt;li>åŒæ­¥ï¼šå˜é‡ç”Ÿå‘½å‘¨æœŸç”±æ ˆå¸§ç®¡ç†&lt;/li>
&lt;li>å¼‚æ­¥ï¼šå˜é‡ç”Ÿå‘½å‘¨æœŸç”±çŠ¶æ€æœºç®¡ç†&lt;/li>
&lt;/ul>
&lt;h4 id="ä»»åŠ¡é˜Ÿåˆ—ä¸future">ä»»åŠ¡é˜Ÿåˆ—ä¸Future
&lt;/h4>&lt;h5 id="ä¸€æ¬¡æ€§ç§»åŠ¨">ä¸€æ¬¡æ€§ç§»åŠ¨
&lt;/h5>&lt;ul>
&lt;li>Futureè¢«ç§»åŠ¨åˆ°æ‰§è¡Œå™¨åï¼Œç”±Pinä¿è¯ä¸ä¼šå†æ¬¡ç§»åŠ¨&lt;/li>
&lt;li>æ‰§è¡Œå™¨å†…éƒ¨ä½¿ç”¨æŒ‡é’ˆæ¥å¼•ç”¨Future&lt;/li>
&lt;/ul>
&lt;h5 id="ä»»åŠ¡é˜Ÿåˆ—çš„å®ç°">ä»»åŠ¡é˜Ÿåˆ—çš„å®ç°
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¼ªä»£ç ï¼šä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ Future
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Task&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future: &lt;span style="color:#a6e22e">Pin&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> Future&lt;span style="color:#f92672">&amp;lt;&lt;/span>Output &lt;span style="color:#f92672">=&lt;/span> ()&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä»»åŠ¡é˜Ÿåˆ—å­˜å‚¨çš„æ˜¯ Box&amp;lt;Task&amp;gt;ï¼Œè€Œä¸æ˜¯ç›´æ¥å­˜å‚¨ Future
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> task_queue: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>Task&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">..&lt;/span>.;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å·¥ä½œçªƒå–è°ƒåº¦">å·¥ä½œçªƒå–è°ƒåº¦
&lt;/h5>&lt;ul>
&lt;li>å½“ä»»åŠ¡åœ¨çº¿ç¨‹é—´è½¬ç§»æ—¶ï¼Œè½¬ç§»çš„æ˜¯&lt;code>Box&amp;lt;Task&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>Box&lt;/code>çš„ç§»åŠ¨ä¸ä¼šå½±å“å†…éƒ¨Futureçš„å†…å­˜åœ°å€&lt;/li>
&lt;li>Pin ä¿è¯çš„æ˜¯ &lt;code>Box&lt;/code> å†…éƒ¨çš„ Future ä¸ä¼šè¢«ç§»å‡º&lt;/li>
&lt;/ul></description></item><item><title>ä¸ºä½•æŠ½è±¡</title><link>https://www.dust-zed.site/rust/%E4%B8%BA%E4%BD%95%E6%8A%BD%E8%B1%A1/</link><pubDate>Wed, 03 Sep 2025 22:56:23 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E4%B8%BA%E4%BD%95%E6%8A%BD%E8%B1%A1/</guid><description>&lt;h4 id="æŠ½è±¡çš„æ ¸å¿ƒç›®çš„">æŠ½è±¡çš„æ ¸å¿ƒç›®çš„
&lt;/h4>&lt;p>æŠ½è±¡çš„ä¸»è¦ç›®çš„æ˜¯&lt;strong>ç®¡ç†å˜åŒ–&lt;/strong>ï¼Œå…·ä½“æ¥è¯´ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>è¯†åˆ«å˜åŒ–ç‚¹&lt;/strong>ï¼šç¡®å®šå“ªäº›éƒ¨åˆ†å¯èƒ½ä¼šå˜åŒ–&lt;/li>
&lt;li>&lt;strong>éš”ç¦»å˜åŒ–&lt;/strong>ï¼šå°†å˜åŒ–é™åˆ¶åœ¨å±€éƒ¨&lt;/li>
&lt;li>&lt;strong>ç»Ÿä¸€æ¥å£&lt;/strong>ï¼šä¸ºä¸åŒçš„å®ç°æä¾›ä¸€è‡´çš„äº¤äº’æ–¹å¼&lt;/li>
&lt;/ol>
&lt;h4 id="æŠ½è±¡çš„æ ¸å¿ƒä»·å€¼">æŠ½è±¡çš„æ ¸å¿ƒä»·å€¼
&lt;/h4>&lt;p>åœ¨å˜åŒ–ä¸­å¯»æ±‚å¹³è¡¡ç¨³å®š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç¨³å®šå±‚&lt;/strong>ï¼šæŠ½è±¡å®šä¹‰â€œåšä»€ä¹ˆâ€ï¼ˆæ¥å£/å¥‘çº¦ï¼‰&lt;/li>
&lt;li>&lt;strong>å˜åŒ–å±‚&lt;/strong>ï¼šå®ç°å¤„ç†â€œæ€ä¹ˆåšâ€ï¼ˆå…·ä½“ç»†èŠ‚ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="solidåŸåˆ™">SOLIDåŸåˆ™
&lt;/h4>&lt;h5 id="1-å•ä¸€èŒè´£åŸåˆ™">1. å•ä¸€èŒè´£åŸåˆ™
&lt;/h5>&lt;p>ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› &lt;/p>
&lt;ul>
&lt;li>æ¯ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€é¡¹èŒè´£&lt;/li>
&lt;li>å°†ä¸åŒçš„åŠŸèƒ½åˆ†ç¦»åˆ°ä¸åŒçš„ç±»ä¸­&lt;/li>
&lt;/ul>
&lt;h5 id="2-å¼€é—­åŸåˆ™">2. å¼€é—­åŸåˆ™
&lt;/h5>&lt;p>è½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ï¼‰åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡æ·»åŠ æ–°ä»£ç å¼€æ‰©å±•åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰ä»£ç &lt;/li>
&lt;li>ä½¿ç”¨æŠ½è±¡æ¥å®šä¹‰å¥‘çº¦&lt;/li>
&lt;/ul>
&lt;h5 id="3-é‡Œæ°æ›¿æ¢åŸåˆ™">3. é‡Œæ°æ›¿æ¢åŸåˆ™
&lt;/h5>&lt;p>å­ç±»å‹å¿…é¡»èƒ½å¤Ÿæ›¿æ¢å…¶çˆ¶ç±»å‹è€Œä¸å½±å“ç¨‹åºçš„æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;ul>
&lt;li>å­ç±»åº”è¯¥æ‰©å±•çˆ¶ç±»çš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯æ”¹å˜å®ƒ&lt;/li>
&lt;li>å­ç±»ä¸åº”è¯¥åŠ å¼ºå‰ç½®æ¡ä»¶æˆ–å‰Šå¼±åç½®æ¡ä»¶&lt;/li>
&lt;li>å­ç±»ä¸åº”è¯¥æŠ›å‡ºçˆ¶ç±»ä¸ä¼šæŠ›å‡ºçš„å¼‚å¸¸&lt;/li>
&lt;/ul>
&lt;h5 id="4-æ¥å£éš”ç¦»åŸåˆ™">4. æ¥å£éš”ç¦»åŸåˆ™
&lt;/h5>&lt;p>å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–ä»–ä»¬ä¸ä½¿ç”¨çš„æ¥å£&lt;/p>
&lt;ul>
&lt;li>å°†å¤§æ¥å£æ‹†åˆ†ä¸ºæ›´å°ã€æ›´å…·ä½“çš„æ¥å£&lt;/li>
&lt;li>ç±»ä¸åº”è¯¥å®ç°ä»–ä»¬ä¸éœ€è¦çš„æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;h5 id="5-ä¾èµ–å€’ç½®">5. ä¾èµ–å€’ç½®
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">é«˜å±‚æ¨¡å—&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">ä¾èµ–&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æŠ½è±¡æ¥å£&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å®ç°&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">ä½å±‚æ¨¡å—&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Tokioæ•´ä½“ç»“æ„</title><link>https://www.dust-zed.site/rust/tokio/tokio%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84/</link><pubDate>Wed, 03 Sep 2025 12:28:49 +0800</pubDate><guid>https://www.dust-zed.site/rust/tokio/tokio%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84/</guid><description>&lt;h3 id="tokioæ¶æ„è®¾è®¡">Tokioæ¶æ„è®¾è®¡
&lt;/h3>&lt;p>Tokioæ˜¯ä¸€ä¸ªåŸºäºRustçš„ä¸€æ­¥è¿è¡Œæ—¶ï¼Œå…¶è®¾è®¡éå¸¸ç²¾å¦™ã€‚&lt;/p>
&lt;h4 id="1-æ ¸å¿ƒç»„ä»¶">1. æ ¸å¿ƒç»„ä»¶
&lt;/h4>&lt;h5 id="11-reactorååº”å™¨">1.1 Reactorï¼ˆååº”å™¨ï¼‰
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>I/Oå¤šè·¯å¤ç”¨&lt;/strong>ï¼šåŸºäºæ“ä½œç³»ç»Ÿæä¾›çš„epoll/kqueue/IOCPç­‰æœºåˆ¶&lt;/li>
&lt;li>&lt;strong>äº‹ä»¶å¾ªç¯&lt;/strong>ï¼š è´Ÿè´£ç›‘å¬å’Œåˆ†å‘I/Oäº‹ä»¶&lt;/li>
&lt;li>&lt;strong>éé˜»å¡I/O&lt;/strong>ï¼šæ‰€æœ‰I/Oæ“ä½œéƒ½æ˜¯éé˜»å¡çš„&lt;/li>
&lt;/ul>
&lt;h5 id="12-scheduler">1.2 Scheduler
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>å·¥ä½œçªƒå–&lt;/strong>ï¼šä½¿ç”¨å·¥ä½œçªƒå–ç®—æ³•åœ¨å¤šçº¿ç¨‹é—´åˆ†é…ä»»åŠ¡&lt;/li>
&lt;li>&lt;strong>å¤šçº¿ç¨‹æ‰§è¡Œå™¨&lt;/strong>ï¼š é»˜è®¤ä½¿ç”¨å¤šçº¿ç¨‹æ‰§è¡Œå™¨æé«˜å¹¶å‘æ€§èƒ½&lt;/li>
&lt;li>&lt;strong>ä»»åŠ¡è°ƒåº¦&lt;/strong>ï¼š è´Ÿè´£ä»»åŠ¡çš„è°ƒåº¦å’Œæ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;h5 id="13-å¼‚æ­¥ä»»åŠ¡">1.3 å¼‚æ­¥ä»»åŠ¡
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>FutureæŠ½è±¡&lt;/strong>ï¼šåŸºäºRustçš„Future trait&lt;/li>
&lt;li>&lt;strong>é›¶æˆæœ¬æŠ½è±¡&lt;/strong>ï¼šåˆ©ç”¨Rustçš„æ‰€æœ‰æƒç³»ç»Ÿå®ç°é›¶æˆæœ¬æŠ½è±¡&lt;/li>
&lt;li>&lt;strong>ä»»åŠ¡çªƒå–&lt;/strong>ï¼š ä»»åŠ¡å¯ä»¥åœ¨ä¸åŒçº¿ç¨‹é—´è¿ç§»ä»¥å¹³è¡¡è´Ÿè½½&lt;/li>
&lt;/ul>
&lt;h4 id="2-è®¾è®¡å“²å­¦">2. è®¾è®¡å“²å­¦
&lt;/h4>&lt;h5 id="21-é›¶æˆæœ¬æŠ½è±¡">2.1 é›¶æˆæœ¬æŠ½è±¡
&lt;/h5>&lt;ul>
&lt;li>ä½¿ç”¨Rustçš„é›¶æˆæœ¬æŠ½è±¡åŸåˆ™&lt;/li>
&lt;li>è¿è¡Œæ—¶æ£€æŸ¥è½¬å˜ä¸ºç¼–è¯‘æ—¶æ£€æŸ¥&lt;/li>
&lt;li>æœ€å°åŒ–è¿è¡Œæ—¶å¼€é”€&lt;/li>
&lt;/ul>
&lt;h5 id="22-æ¨¡å—åŒ–è®¾è®¡">2.2 æ¨¡å—åŒ–è®¾è®¡
&lt;/h5>&lt;ul>
&lt;li>æ ¸å¿ƒç»„ä»¶è§£è€¦&lt;/li>
&lt;li>å¯æŒ‰éœ€é€‰æ‹©åŠŸèƒ½&lt;/li>
&lt;li>å¯æ‰©å±•æ€§å¼º&lt;/li>
&lt;/ul>
&lt;h5 id="23-æ€§èƒ½ä¼˜å…ˆ">2.3 æ€§èƒ½ä¼˜å…ˆ
&lt;/h5>&lt;ul>
&lt;li>æ— é”æ•°æ®ç»“æ„&lt;/li>
&lt;li>æœ€å°åŒ–å†…å­˜åˆ†é…&lt;/li>
&lt;li>æ‰¹å¤„ç†ç³»ç»Ÿè°ƒç”¨&lt;/li>
&lt;/ul>
&lt;h4 id="3-å…³é”®å®ç°ç»†èŠ‚">3. å…³é”®å®ç°ç»†èŠ‚
&lt;/h4>&lt;h5 id="31-ä»»åŠ¡è°ƒåº¦">3.1 ä»»åŠ¡è°ƒåº¦
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç®€åŒ–çš„ä»»åŠ¡ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Task&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»»åŠ¡çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> state: &lt;span style="color:#a6e22e">AtomicUsize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»»åŠ¡æ‰§è¡Œä½“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> future: &lt;span style="color:#a6e22e">Mutex&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Pin&lt;span style="color:#f92672">&amp;lt;&lt;/span>Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> Future&lt;span style="color:#f92672">&amp;lt;&lt;/span>Output &lt;span style="color:#f92672">=&lt;/span> ()&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä»»åŠ¡é˜Ÿåˆ—ç›¸å…³
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> next: &lt;span style="color:#a6e22e">UnsafeCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;*&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> Task&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="32-ioé©±åŠ¨">3.2 I/Oé©±åŠ¨
&lt;/h5>&lt;ul>
&lt;li>ä½¿ç”¨mioåº“æä¾›è·¨å¹³å°I/Oå¤šè·¯å¤ç”¨&lt;/li>
&lt;li>åŸºäºreadinessæ¨¡å‹&lt;/li>
&lt;li>é›¶æ‹·è´æ”¯æŒ&lt;/li>
&lt;/ul>
&lt;h4 id="4-é«˜çº§ç‰¹æ€§">4. é«˜çº§ç‰¹æ€§
&lt;/h4>&lt;h5 id="41-å¼‚æ­¥ç­‰å¾…">4.1 å¼‚æ­¥ç­‰å¾…
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¼‚æ­¥å‡½æ•°ç¤ºä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">process&lt;/span>(socket: &lt;span style="color:#a6e22e">TcpStream&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">io&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>()&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> buf &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#ae81ff">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¼‚æ­¥è¯»å–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> n &lt;span style="color:#f92672">=&lt;/span> socket.read(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> buf).&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ•°æ®...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="42-å®šæ—¶å™¨">4.2 å®šæ—¶å™¨
&lt;/h5>&lt;ul>
&lt;li>åˆ†å±‚æ—¶é—´è½®å®ç°&lt;/li>
&lt;li>é«˜ç²¾åº¦å®šæ—¶å™¨&lt;/li>
&lt;li>ä½å¼€é”€&lt;/li>
&lt;/ul>
&lt;h4 id="5-æ€§èƒ½ä¼˜åŒ–">5. æ€§èƒ½ä¼˜åŒ–
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>é›¶æˆæœ¬æŠ½è±¡&lt;/strong>ï¼šåˆ©ç”¨Rustçš„æ‰€æœ‰æƒç³»ç»Ÿ&lt;/li>
&lt;li>&lt;strong>æ— é”ç¼–ç¨‹&lt;/strong>ï¼š å‡å°‘é”äº‰ç”¨&lt;/li>
&lt;li>&lt;strong>æ‰¹å¤„ç†&lt;/strong>ï¼šåˆå¹¶ç³»ç»Ÿè°ƒç”¨&lt;/li>
&lt;li>&lt;strong>å†…å­˜æ± &lt;/strong>ï¼šå‡å°‘å†…å­˜åˆ†é…&lt;/li>
&lt;/ol>
&lt;h4 id="6-ç”Ÿæ€ç³»ç»Ÿ">6. ç”Ÿæ€ç³»ç»Ÿ
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>tokio-util&lt;/strong>ï¼šå®ç”¨å·¥å…·&lt;/li>
&lt;li>&lt;strong>tokio-stream&lt;/strong>ï¼šæµå¤„ç†&lt;/li>
&lt;li>&lt;strong>tokio-tungstenite&lt;/strong>: WebSocket&lt;/li>
&lt;li>&lt;strong>tonic&lt;/strong>: gRPCå®ç°&lt;/li>
&lt;/ul>
&lt;h4 id="7è®¾è®¡å–èˆ">7.è®¾è®¡å–èˆ
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>å¤æ‚æ€§&lt;/strong>ï¼šä¸ºäº†æ€§èƒ½æ¥æ”¶æ›´é«˜çš„å®ç°å¤æ‚åº¦&lt;/li>
&lt;li>&lt;strong>å­¦ä¹ æ›²çº¿&lt;/strong>ï¼š éœ€è¦ç†è§£Rustå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹&lt;/li>
&lt;li>&lt;strong>è°ƒè¯•éš¾åº¦&lt;/strong>ï¼š å¼‚æ­¥è°ƒè¯•ç›¸å¯¹å›°éš¾&lt;/li>
&lt;/ol>
&lt;h4 id="8æœ€ä½³å®è·µ">8.æœ€ä½³å®è·µ
&lt;/h4>&lt;ol>
&lt;li>é¿å…åœ¨å¼‚æ­¥ä»£ç ä¸­æ‰§è¡Œé˜»å¡æ“ä½œ&lt;/li>
&lt;li>åˆç†ä½¿ç”¨&lt;code>spawn_blocking&lt;/code>&lt;/li>
&lt;li>æ³¨æ„ä»»åŠ¡å–æ¶ˆå’Œæ¸…ç†&lt;/li>
&lt;li>åˆç†è®¾ç½®å·¥ä½œçº¿ç¨‹&lt;/li>
&lt;/ol>
&lt;p>Tokio çš„è®¾è®¡ä½“ç°äº† Rust è¯­è¨€çš„æ ¸å¿ƒç†å¿µï¼šé›¶æˆæœ¬æŠ½è±¡ã€å†…å­˜å®‰å…¨å’Œå¹¶å‘å®‰å…¨ã€‚å®ƒçš„æ¶æ„è®¾è®¡ä½¿å…¶æˆä¸ºæ„å»ºé«˜æ€§èƒ½ã€å¯é ç½‘ç»œåº”ç”¨çš„ç†æƒ³é€‰æ‹©ã€‚&lt;/p>
&lt;hr>
&lt;h4 id="å¼‚æ­¥æ¦‚å¿µ">å¼‚æ­¥æ¦‚å¿µ
&lt;/h4>&lt;h5 id="future-traitåŸºç¡€">Future TraitåŸºç¡€
&lt;/h5>&lt;p>&lt;code>Future&lt;/code>æ˜¯Rustå¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒtraitï¼Œå®šä¹‰åœ¨æ ‡å‡†åº“&lt;code>std::future&lt;/code>ä¸­ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">trait&lt;/span> Future {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">poll&lt;/span>(self: &lt;span style="color:#a6e22e">Pin&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> Self&lt;span style="color:#f92672">&amp;gt;&lt;/span>, cx: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> Context&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">Poll&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Self::Output&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="å…³é”®ç‚¹">å…³é”®ç‚¹
&lt;/h6>&lt;ul>
&lt;li>&lt;code>Output&lt;/code>ï¼šFutureå®Œæˆæ—¶äº§ç”Ÿçš„å€¼ç±»å‹&lt;/li>
&lt;li>&lt;code>poll&lt;/code>ï¼šæ£€æŸ¥Futureæ˜¯å¦å®Œæˆ
&lt;ul>
&lt;li>è¿”å›&lt;code>Poll::Ready(Output)&lt;/code>ï¼šå®Œæˆå¹¶è¿”å›ç»“æœ&lt;/li>
&lt;li>è¿”å›&lt;code>Poll::Pending&lt;/code>ï¼šæœªå®Œæˆï¼Œç¨åéœ€è¦å†æ¬¡è½®è¯¢&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="asyncawaitè¯­æ³•ç³–">Async/Awaitè¯­æ³•ç³–
&lt;/h5>&lt;p>&lt;code>async/await&lt;/code>æ˜¯Rustæä¾›çš„è¯­æ³•ç³–ï¼Œè®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ï¼š&lt;/p>
&lt;h6 id="1-åŸºæœ¬ç”¨æ³•">1. åŸºæœ¬ç”¨æ³•
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">fetch_data&lt;/span>() -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, io::Error&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¼‚æ­¥æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> data &lt;span style="color:#f92672">=&lt;/span> read_from_network().&lt;span style="color:#66d9ef">await&lt;/span>&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="2-å±•å¼€å½¢å¼">2. å±•å¼€å½¢å¼
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">FetchDataFuture&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state: &lt;span style="color:#a6e22e">State&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">State&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Start,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> AwaitingRead(ReadFuture),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Done,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Future &lt;span style="color:#66d9ef">for&lt;/span> FetchDataFuture {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>String, io::Error&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">poll&lt;/span>(&lt;span style="color:#66d9ef">mut&lt;/span> self: &lt;span style="color:#a6e22e">Pin&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> Self&lt;span style="color:#f92672">&amp;gt;&lt;/span>, cx: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> Context&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">Poll&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Self::Output&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self.state {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State::Start &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> read_fut &lt;span style="color:#f92672">=&lt;/span> read_from_network();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.state &lt;span style="color:#f92672">=&lt;/span> State::AwaitingRead(read_fut);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State::AwaitingRead(&lt;span style="color:#66d9ef">ref&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> fut) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> Pin::new(fut).poll(cx) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Poll::Ready(Ok(data)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Poll::Ready(Ok(data));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Poll::Ready(Err(e)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Poll::Ready(Err(e));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Poll::Pending &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Poll::Pending;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State::Done &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">panic!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;poll called after completion&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å…³é”®æ¦‚å¿µ">å…³é”®æ¦‚å¿µ
&lt;/h4>&lt;h6 id="1-é›¶æˆæœ¬æŠ½è±¡">1. é›¶æˆæœ¬æŠ½è±¡
&lt;/h6>&lt;ul>
&lt;li>å¼‚æ­¥ä»£ç åœ¨ç¼–è¯‘æ—¶è½¬æ¢ä¸ºçŠ¶æ€æœº&lt;/li>
&lt;li>æ²¡æœ‰è¿è¡Œæ—¶å¼€é”€ï¼Œä¸æ‰‹å†™çš„å›è°ƒä»£ç æ€§èƒ½ç›¸å½“&lt;/li>
&lt;/ul>
&lt;h6 id="2-æ‰§è¡Œå™¨executor">2. æ‰§è¡Œå™¨(Executor)
&lt;/h6>&lt;ul>
&lt;li>è´Ÿè´£è°ƒåº¦å’Œæ‰§è¡ŒFuture&lt;/li>
&lt;li>Tokioæä¾›äº†é«˜æ€§èƒ½çš„æ‰§è¡Œå™¨å®ç°&lt;/li>
&lt;/ul>
&lt;h6 id="3-wakeræœºåˆ¶">3. Wakeræœºåˆ¶
&lt;/h6>&lt;ul>
&lt;li>å½“Futureè¿”å›&lt;code>Poll::Pending&lt;/code>æ—¶ï¼Œä¼šæ³¨å†Œä¸€ä¸ªWaker&lt;/li>
&lt;li>å½“Futureå¯ä»¥ç»§ç»­æ‰§è¡Œæ—¶ï¼Œé€šè¿‡Wakeré€šçŸ¥æ‰§è¡Œå™¨&lt;/li>
&lt;/ul>
&lt;h6 id="4-taskä¸future">4. Taskä¸Future
&lt;/h6>&lt;ul>
&lt;li>&lt;code>Task&lt;/code>æ˜¯æ‰§è¡Œå•å…ƒï¼Œæ˜¯Tokioè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè´Ÿè´£æ‰§è¡Œä¸€ä¸ªé¡¶å±‚çš„Futureåˆ°å®Œæˆ&lt;/li>
&lt;li>&lt;code>Future&lt;/code>æ˜¯è®¡ç®—å•å…ƒï¼Œä»£è¡¨ä¸€ä¸ªå¼‚æ­¥è®¡ç®—ï¼Œä¸€ä¸ªTaskå¯ä»¥åŒ…å«å¤šä¸ªåµŒå¥—çš„Futureï¼Œè¿™äº›åµŒå¥—çš„Futureå…±äº«åŒä¸€ä¸ªTaskçš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚&lt;/li>
&lt;/ul></description></item><item><title>Reqwestæ¨¡å—æ¶æ„è§£æ</title><link>https://www.dust-zed.site/rust/reqwest/reqwest%E6%A8%A1%E5%9D%97%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90/</link><pubDate>Tue, 02 Sep 2025 16:42:46 +0800</pubDate><guid>https://www.dust-zed.site/rust/reqwest/reqwest%E6%A8%A1%E5%9D%97%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90/</guid><description>&lt;p>ä»é¡¶å±‚ç»“æ„æ¥ç†è§£reqwestçš„æ¨¡å—ç»„ç»‡ï¼š&lt;/p>
&lt;h4 id="æ ¸å¿ƒæ¨¡å—">æ ¸å¿ƒæ¨¡å—
&lt;/h4>&lt;h5 id="1-async_impl">1. async_impl/
&lt;/h5>&lt;ul>
&lt;li>å¼‚æ­¥HTTPå®¢æˆ·ç«¯å®ç°&lt;/li>
&lt;li>åŒ…å«&lt;code>Client&lt;/code>ã€&lt;code>Reqwest&lt;/code>ã€&lt;code>Response&lt;/code>ç­‰æ ¸å¿ƒç±»å‹&lt;/li>
&lt;li>åŸºäº&lt;code>hyper&lt;/code>åº“å®ç°&lt;/li>
&lt;/ul>
&lt;h5 id="2-blocking">2. blocking/
&lt;/h5>&lt;ul>
&lt;li>åŒæ­¥HTTPå®¢æˆ·ç«¯&lt;/li>
&lt;li>å†…éƒ¨ä½¿ç”¨&lt;code>std::thread&lt;/code>å°è£…å¼‚æ­¥è°ƒç”¨&lt;/li>
&lt;li>æä¾›é˜»å¡å¼API&lt;/li>
&lt;/ul>
&lt;h5 id="3-dns">3. dns/
&lt;/h5>&lt;ul>
&lt;li>DNSè§£æåŠŸèƒ½&lt;/li>
&lt;li>æ”¯æŒç³»ç»ŸDNSå’Œè‡ªå®šä¹‰è§£æå™¨&lt;/li>
&lt;li>åŒ…å«&lt;code>GaiResolver&lt;/code>ç­‰å®ç°&lt;/li>
&lt;/ul>
&lt;h5 id="4-proxy">4. proxy/
&lt;/h5>&lt;ul>
&lt;li>ä»£ç†æ”¯æŒ&lt;/li>
&lt;li>å¤„ç†HTTP/HTTPS/SOCKSä»£ç†&lt;/li>
&lt;li>ä»£ç†è‡ªåŠ¨å‘ç°å’Œè®¤è¯&lt;/li>
&lt;/ul>
&lt;h5 id="5-tls">5. tls
&lt;/h5>&lt;ul>
&lt;li>å®‰å…¨ä¼ è¾“å±‚å®ç°&lt;/li>
&lt;li>æ”¯æŒnative-tlså’Œrustls&lt;/li>
&lt;li>è¯ä¹¦å’Œèº«ä»½ç®¡ç†&lt;/li>
&lt;/ul>
&lt;h5 id="6-redirect">6. redirect/
&lt;/h5>&lt;ul>
&lt;li>é‡å®šå‘å¤„ç†&lt;/li>
&lt;li>æ”¯æŒè‡ªå®šä¹‰é‡å®šå‘ç­–ç•¥&lt;/li>
&lt;li>å¤„ç†3xxçŠ¶æ€ç &lt;/li>
&lt;/ul>
&lt;h5 id="7-wasm">7. wasm/
&lt;/h5>&lt;ul>
&lt;li>WebAssemblyå¹³å°ç‰¹å®šå®ç°&lt;/li>
&lt;li>ä½¿ç”¨æµè§ˆå™¨Fetch API&lt;/li>
&lt;li>é’ˆå¯¹Webç¯å¢ƒä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;h4 id="è¾…åŠ©æ¨¡å—">è¾…åŠ©æ¨¡å—
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>cookie/&lt;/strong> - Cookieç®¡ç†&lt;/li>
&lt;li>&lt;strong>multipart/&lt;/strong> - å¤šéƒ¨åˆ†è¡¨å•æ•°æ®å¤„ç†&lt;/li>
&lt;li>&lt;strong>retry/&lt;/strong> - è¯·æ±‚é‡è¯•æœºåˆ¶&lt;/li>
&lt;li>&lt;strong>util/&lt;/strong> - å·¥å…·å‡½æ•°å’Œè¾…åŠ©ç±»å‹&lt;/li>
&lt;/ul>
&lt;h4 id="ç‰¹æ€§å¼€å…³">ç‰¹æ€§å¼€å…³
&lt;/h4>&lt;p>é€šè¿‡Cargo featuresæ§åˆ¶åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>default-tls&lt;/code> - é»˜è®¤TLSå®ç°&lt;/li>
&lt;li>&lt;code>native-tls&lt;/code> - ä½¿ç”¨ç³»ç»ŸåŸç”ŸTLS&lt;/li>
&lt;li>&lt;code>rustls&lt;/code> - ä½¿ç”¨rustlsçº¯Rustå®ç°&lt;/li>
&lt;li>&lt;code>blocking&lt;/code> - å¯ç”¨åŒæ­¥API&lt;/li>
&lt;li>&lt;code>cookies&lt;/code> - Cookieæ”¯æŒ&lt;/li>
&lt;li>&lt;code>json&lt;/code> - JSONåºåˆ—åŒ–æ”¯æŒ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//lib.rs
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#[cfg(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;blocking&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">mod&lt;/span> blocking;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[cfg(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;cookies&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">mod&lt;/span> cookie;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ &lt;code>Cargo.toml&lt;/code> ä¸­é€šè¿‡ features æ§åˆ¶å“ªäº›å®ç°è¢«ç¼–è¯‘ã€‚&lt;/p></description></item><item><title>RustçŸ¥è¯†é—®ç­”</title><link>https://www.dust-zed.site/rust/rust%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94/</link><pubDate>Mon, 01 Sep 2025 17:16:28 +0800</pubDate><guid>https://www.dust-zed.site/rust/rust%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94/</guid><description>&lt;h5 id="ä¸ºä»€ä¹ˆfnonceåªèƒ½è°ƒç”¨ä¸€æ¬¡">ä¸ºä»€ä¹ˆFnOnceåªèƒ½è°ƒç”¨ä¸€æ¬¡
&lt;/h5>&lt;h6 id="æºç åˆ†æ">æºç åˆ†æ
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">trait&lt;/span> FnOnce&lt;span style="color:#f92672">&amp;lt;&lt;/span>Args&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">extern&lt;/span> &lt;span style="color:#e6db74">&amp;#34;rust-call&amp;#34;&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">call_once&lt;/span>(self, args: &lt;span style="color:#a6e22e">Args&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">Self&lt;/span>::Output;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>&lt;code>self&lt;/code>çš„å«ä¹‰
&lt;ul>
&lt;li>æ¥æ”¶å®ç°äº†&lt;code>FnOnce&lt;/code>çš„å…·ä½“ç±»å‹çš„å€¼&lt;/li>
&lt;li>è¿™ä¸ªå€¼ä¼šè¢«ç§»åŠ¨(move)è¿›æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h6 id="å…·ä½“ä¾‹å­">å…·ä½“ä¾‹å­
&lt;/h6>&lt;p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé—­åŒ…:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> s &lt;span style="color:#f92672">=&lt;/span> String::from(&lt;span style="color:#e6db74">&amp;#34;hello&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> f &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">||&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, s); &lt;span style="color:#75715e">// è·å– s çš„æ‰€æœ‰æƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> s.len()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“è¿™ä¸ªé—­åŒ…å®ç°&lt;code>FnOnce&lt;/code>æ—¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ç±»ä¼¼è¿™æ ·ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Closure&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s: String, &lt;span style="color:#75715e">// æ•è·çš„ç¯å¢ƒå˜é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> FnOnce&lt;span style="color:#f92672">&amp;lt;&lt;/span>()&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> Closure {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">usize&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">call_once&lt;/span>(self, _args: ()) -&amp;gt; &lt;span style="color:#66d9ef">usize&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, self.s);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.s.len()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="è°ƒç”¨ç¤ºä¾‹">è°ƒç”¨ç¤ºä¾‹
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> result &lt;span style="color:#f92672">=&lt;/span> f(); &lt;span style="color:#75715e">// ç­‰ä»·äº FnOnce::call_once(f, ())
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿™é‡Œä¸èƒ½å†è°ƒç”¨ f()ï¼Œå› ä¸º f å·²ç»è¢«ç§»åŠ¨
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€ç»ˆfæ‰€æœ‰æƒè¢«è½¬ç§»è¿›&lt;code>call_once&lt;/code>ï¼Œå¹¶éšç€call_onceçš„ç»“æŸè€Œ&lt;code>drop&lt;/code>äº†ï¼Œfè¢«é‡Šæ”¾äº†ï¼Œå†…éƒ¨æ•è·çš„æ‰€æœ‰æƒè‡ªç„¶ä¹Ÿè¢«é‡Šæ”¾ã€‚&lt;/p>
&lt;p>&lt;code>FnOnce&lt;/code>ã€&lt;code>FnMut&lt;/code>ã€&lt;code>Fn&lt;/code>è¿™äº›æ˜¯æ ¹æ®å¦‚ä½•æ•è·ç¯å¢ƒè€ŒåŒºåˆ†çš„ï¼Œå¹¶ä¸å½±å“å‡½æ•°ç­¾åï¼Œ&lt;code>FnMut&lt;/code>ä¹Ÿå¯ä»¥æ¥æ”¶&lt;strong>æ‰€æœ‰æƒå‚æ•°&lt;/strong>&lt;/p>
&lt;h5 id="ä»€ä¹ˆæ˜¯é›¶æˆæœ¬æŠ½è±¡">ä»€ä¹ˆæ˜¯é›¶æˆæœ¬æŠ½è±¡
&lt;/h5>&lt;p>é›¶æˆæœ¬æŠ½è±¡çš„æ ¸å¿ƒå°±æ˜¯ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç¼–è¯‘æœŸå®Œæˆå·¥ä½œ&lt;/strong>ï¼šç±»å‹æ£€æŸ¥ã€æ³›å‹å•æ€åŒ–ã€å†…è”ä¼˜åŒ–ç­‰åœ¨ç¼–è¯‘æ—¶å®Œæˆ&lt;/li>
&lt;li>&lt;strong>é›¶è¿è¡Œæ—¶å¼€é”€&lt;/strong>ï¼šä¸å¼•å…¥é¢å¤–çš„è¿è¡Œæ—¶æ£€æŸ¥æˆ–é—´æ¥è°ƒç”¨&lt;/li>
&lt;li>&lt;strong>æ— é¢å¤–å†…å­˜åˆ†é…&lt;/strong>ï¼šé¿å…ä¸å¿…è¦çš„å †åˆ†é…ï¼Œå°½å¯èƒ½ä½¿ç”¨æ ˆå†…å­˜&lt;/li>
&lt;li>&lt;strong>é€æ˜ä¼˜åŒ–&lt;/strong>ï¼šé«˜çº§æŠ½è±¡åœ¨ç¼–è¯‘åç”Ÿæˆçš„æœºå™¨ç ä¸æ‰‹å†™åº•å±‚ä»£ç ç›¸å½“&lt;/li>
&lt;/ol>
&lt;p>è¿™æ­£æ˜¯ Rust èƒ½åœ¨æä¾›é«˜çº§è¯­è¨€ç‰¹æ€§çš„åŒæ—¶ï¼Œä»èƒ½ä¿æŒä¸ C/C++ ç›¸åª²ç¾çš„æ€§èƒ½çš„å…³é”®æ‰€åœ¨ã€‚&lt;/p></description></item><item><title>æ–‡ä»¶ç³»ç»Ÿ</title><link>https://www.dust-zed.site/rust/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</link><pubDate>Mon, 01 Sep 2025 17:12:26 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</guid><description>&lt;h4 id="æ–‡ä»¶ç³»ç»Ÿ">æ–‡ä»¶ç³»ç»Ÿ
&lt;/h4>&lt;ul>
&lt;li>&lt;code>metadata&lt;/code>:æœ¬è´¨ä¸Šå°±æ˜¯æè¿°æ–‡ä»¶ä¿¡æ¯çš„æ•°æ®&lt;/li>
&lt;li>ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶
&lt;ul>
&lt;li>é…ç½®æ–‡ä»¶ï¼šå­˜å‚¨&lt;strong>é»˜è®¤é…ç½®&lt;/strong>æˆ–&lt;strong>é™æ€é…ç½®&lt;/strong>&lt;/li>
&lt;li>ç¯å¢ƒå˜é‡ï¼šæä¾›&lt;strong>åŠ¨æ€è¦†ç›–&lt;/strong>æˆ–&lt;strong>ç¯å¢ƒç‰¹å®šé…ç½®&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>æŒ‚è½½ï¼ˆMountï¼‰&lt;/strong>ï¼š å°†&lt;strong>å­˜å‚¨è®¾å¤‡&lt;/strong>æˆ–&lt;strong>æ–‡ä»¶ç³»ç»Ÿ&lt;/strong>è¿æ¥åˆ°æ“ä½œç³»ç»Ÿç›®å½•æ ‘ä¸­ç‰¹å®šä½ç½®çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿æ¥ç‚¹ç§°ä¸º&lt;strong>æŒ‚è½½ç‚¹ï¼ˆMount Pointï¼‰&lt;/strong>ã€‚ç±»æ¯”é—¨å’Œä»“åº“çš„å…³ç³»ã€‚&lt;/li>
&lt;li>æ–‡ä»¶è®¾å¤‡å·&lt;/li>
&lt;/ul></description></item><item><title>æ¶æ„è®¾è®¡</title><link>https://www.dust-zed.site/rust/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/</link><pubDate>Mon, 01 Sep 2025 17:05:55 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/</guid><description>&lt;h4 id="å¦‚ä½•åšå¥½èŒè´£åˆ†ç¦»">å¦‚ä½•åšå¥½èŒè´£åˆ†ç¦»
&lt;/h4>&lt;ul>
&lt;li>ä»â€œæ€ä¹ˆå®ç°â€åˆ°â€œæ€ä¹ˆç»„åˆâ€
&lt;ul>
&lt;li>ä¸€ä½“å¼æ€ç»´ï¼šå†™ä¸€ä¸ªå‡½æ•°å®Œæˆæ‰€æœ‰åŠŸèƒ½&lt;/li>
&lt;li>åˆ†ç¦»å¼æ€ç»´ï¼šè¦è®¾è®¡å‡ ä¸ªç»„ä»¶ï¼Œç„¶åç»„åˆå®ƒä»¬å®ç°åŠŸèƒ½&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä»â€œåŠŸèƒ½ä¼˜å…ˆâ€åˆ°â€œæµ‹è¯•ä¼˜å…ˆâ€
&lt;ul>
&lt;li>ä¸€ä½“å¼æ€ç»´ï¼šå…ˆå®ç°åŠŸèƒ½ï¼Œå†è€ƒè™‘æµ‹è¯•&lt;/li>
&lt;li>åˆ†ç¦»å¼æ€ç»´ï¼šå…ˆè€ƒè™‘æ€ä¹ˆæµ‹è¯•ï¼Œå€’æ¨å‡ºèŒè´£åˆ†ç¦»&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>ripgrep&lt;/code>çš„åˆ†ç¦»å¼æ¶æ„
&lt;ul>
&lt;li>cliå‚æ•° â†’ &lt;code>LowArgs&lt;/code> â†’ &lt;code>HiArgs&lt;/code>&lt;/li>
&lt;li>æœç´¢ç›®æ ‡ï¼šåˆ†ä¸ºæ–‡ä»¶å‘ç°å’Œç›®æ ‡æœç´¢&lt;/li>
&lt;li>æ–‡ä»¶éå†å†æ¬¡åˆ†ç¦»ï¼šWalkDirï¼ˆè´Ÿè´£ç›®å½•æ ‘å½¢ç»“æ„è½¬ä¸ºçº¿æ€§çš„Iterï¼‰â†’ WalkEventDirï¼ˆè´Ÿè´£å‘é€äº‹ä»¶ï¼‰â†’ Walkï¼ˆæ·»åŠ å¿½ç•¥è§„åˆ™ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr></description></item><item><title>è¯­æ³•é€ŸæŸ¥</title><link>https://www.dust-zed.site/rust/%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5/</link><pubDate>Mon, 01 Sep 2025 16:22:39 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5/</guid><description>&lt;h4 id="é›†åˆæˆ–è¿­ä»£å™¨">é›†åˆæˆ–è¿­ä»£å™¨
&lt;/h4>&lt;ul>
&lt;li>&lt;code>drain()&lt;/code>æ–¹æ³•ï¼šæ ¸å¿ƒåŠŸèƒ½æ˜¯ç§»é™¤é›†åˆä¸­æŒ‡å®šèŒƒå›´çš„å…ƒç´ ï¼ŒåŒæ—¶ä¿æŒé›†åˆçš„è¿ç»­æ€§ï¼Œæ˜¯ä¸€ç§æ¯”**å¤šæ¬¡è°ƒç”¨remove()**æ›´é«˜æ•ˆçš„æ‰¹é‡å¤„ç†æ–¹å¼&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="æ‰€æœ‰æƒ">æ‰€æœ‰æƒ
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>æ‰€æœ‰æƒ&lt;/strong>å’Œ&lt;strong>å¯å˜æ€§&lt;/strong>æ˜¯ç‹¬ç«‹çš„&lt;/li>
&lt;li>&lt;strong>æ‰€æœ‰æƒå®Œæ•´æ€§&lt;/strong>ä¿æŠ¤é’ˆå¯¹é›†åˆ
&lt;ul>
&lt;li>é›†åˆéœ€è¦ä¿è¯æ‰€æœ‰å…ƒç´ ä½ç½®æœ‰æ•ˆ&lt;/li>
&lt;li>é›†åˆåœ¨å†…å­˜ä¸­æ˜¯è¿ç»­çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç»“æ„ä½“å…è®¸&lt;strong>å­—æ®µè¢«è½¬ç§»èµ°æ‰€æœ‰æƒ&lt;/strong>
&lt;ul>
&lt;li>ç»“æ„ä½“å­—æ®µå…·æœ‰ç‹¬ç«‹æ€§ï¼Œå¸ƒå±€åœ¨ç¼–è¯‘æ—¶å¯çŸ¥&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸï¼Œå€¼å°†è¢«ä¸¢å¼ƒ&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="å˜é‡å’Œç±»å‹">å˜é‡å’Œç±»å‹
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>&lt;code>ref&lt;/code>å’Œ&lt;code>&amp;amp;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&amp;amp;ç”¨äºåˆ›å»ºå¼•ç”¨&lt;/li>
&lt;li>&amp;amp;ç”¨äºæ¨¡å¼åŒ¹é…æ—¶ï¼Œè¡Œä½¿çš„æ˜¯è§£æ„æ“ä½œï¼ˆä¸€èˆ¬ä½œç”¨æ˜¯éšå¼è§£å¼•ç”¨ï¼‰&lt;/li>
&lt;li>refç”¨äºæ¨¡å¼åŒ¹é…ï¼Œè·å–å¼•ç”¨è€Œä¸æ˜¯è·å–æ‰€æœ‰æƒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>'a : 'b&lt;/code>è¡¨ç¤º &lt;code>'a&lt;/code> &amp;gt;= &lt;code>'b&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>T: 'static&lt;/code>:è¡¨ç¤ºç±»å‹&lt;strong>Tå†…éƒ¨å­—æ®µ&lt;/strong>è¦ä¹ˆæ²¡æœ‰å¼•ç”¨ï¼Œè¦ä¹ˆå¼•ç”¨éƒ½æ˜¯&lt;code>'static&lt;/code>çš„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>trait My Trait: 'static&lt;/code>æˆ–&lt;code>Box&amp;lt;dyn MyTrait + 'static&amp;gt;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å®ç°ç±»å‹&lt;/strong>å¿…é¡»æ»¡è¶³ï¼š&lt;code>Self: 'static&lt;/code>æˆ–è€…æ²¡æœ‰å¼•ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>(PathBuf, Path)&lt;/code>ã€&lt;code>(String, str)&lt;/code>å’Œ&lt;code>(BytesMut/Vec&amp;lt;u8&amp;gt;, &amp;amp;[u8]&lt;/code>&lt;/p>
&lt;ul>
&lt;li>Pathï¼Œstréƒ½æ˜¯DSTç±»å‹&lt;/li>
&lt;li>PathBufå’ŒStringéƒ½æ˜¯æ‹¥æœ‰æ‰€æœ‰æƒçš„&lt;/li>
&lt;li>æ–‡ä»¶è·¯å¾„é•¿åº¦å’Œå­—ç¬¦ä¸²é•¿åº¦åœ¨ç¼–è¯‘æ—¶æœªçŸ¥&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>&amp;amp;buf&lt;/code>å’Œ&lt;code>&amp;amp;buf[..]&lt;/code>çš„åŒºåˆ«&lt;/p>
&lt;ul>
&lt;li>&lt;code>&amp;amp;buf&lt;/code>è·å–æ•´ä¸ªæ•°ç»„çš„å¼•ç”¨ï¼Œç±»å‹æ˜¯&lt;code>&amp;amp;[u8; N]&lt;/code>æˆ–&lt;code>&amp;amp;Vec&amp;lt;u8&amp;gt;&lt;/code>ï¼ˆå›ºå®šå¤§å°æ•°ç»„ï¼‰&lt;/li>
&lt;li>&lt;code>&amp;amp;buf[..]&lt;/code>è·å–æ•°ç»„çš„åˆ‡ç‰‡å¼•ç”¨ï¼Œç±»å‹æ˜¯&lt;code>&amp;amp;[u8]&lt;/code>ï¼ˆåŠ¨æ€å¤§å°åˆ‡ç‰‡ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æ ¼å¼åŒ–è¾“å‡ºè¯­æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>{[&lt;span style="color:#960050;background-color:#1e0010">å‚æ•°ç´¢å¼•&lt;/span>]:[&lt;span style="color:#960050;background-color:#1e0010">å¡«å……å­—ç¬¦&lt;/span>][&lt;span style="color:#960050;background-color:#1e0010">å¯¹é½æ–¹å¼&lt;/span>][&lt;span style="color:#960050;background-color:#1e0010">å®½åº¦&lt;/span>][.&lt;span style="color:#960050;background-color:#1e0010">ç²¾åº¦&lt;/span>][&lt;span style="color:#960050;background-color:#1e0010">ç±»å‹&lt;/span>]}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>fmt::Formatter&lt;/code>æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ ¼å¼åŒ–ç¼“å†²åŒºï¼Œå¯ä»¥è¾“å‡ºåˆ°å­—ç¬¦ä¸²ã€stdoutã€æ–‡ä»¶ç­‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="ç»“æ„ä½“">ç»“æ„ä½“
&lt;/h4>&lt;ul>
&lt;li>Rustä¸å…è®¸å°†structä¸­æŸä¸ªå­—æ®µæ ‡è®°ä¸ºå¯å˜&lt;/li>
&lt;li>Rustä¸­æºæ–‡ä»¶ï¼ˆ&lt;code>.rs&lt;/code>ï¼‰éšæ€§çš„è§†ä¸ºä¸€ä¸ªæ¨¡å—ï¼ŒåŒºåˆ«äº&lt;code>mod&lt;/code>çš„æ˜¾å¼å£°æ˜&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="é—­åŒ…">é—­åŒ…
&lt;/h4>&lt;ul>
&lt;li>æ ¹æ®é—­åŒ…æ•è·ç¯å¢ƒæ–¹å¼å¯åˆ†ä¸ºä¸‰ç§ï¼Œæ³¨æ„åŒºåˆ†é—­åŒ… &lt;strong>æ•è·çš„ç¯å¢ƒå˜é‡&lt;/strong>å’Œ&lt;strong>é—­åŒ…çš„å‚æ•°&lt;/strong>
&lt;ul>
&lt;li>&lt;code>FnOnce&lt;/code>è·å–æ‰€æœ‰æƒ&lt;/li>
&lt;li>&lt;code>FnMut&lt;/code>è·å–å¯å˜å¼•ç”¨&lt;/li>
&lt;li>&lt;code>Fn&lt;/code>è·å–ä¸å¯å˜å¼•ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="å¹¶å‘ç¼–ç¨‹">å¹¶å‘ç¼–ç¨‹
&lt;/h4>&lt;ul>
&lt;li>å¹¶å‘ç¼–ç¨‹ä¸»è¦æœ‰ä¸¤ç§æ ¸å¿ƒèŒƒå¼ï¼š&lt;strong>å…±äº«çŠ¶æ€å¹¶å‘&lt;/strong>å’Œ&lt;strong>æ¶ˆæ¯ä¼ é€’å¹¶å‘&lt;/strong>&lt;/li>
&lt;li>&lt;code>std::thread::scope&lt;/code>
&lt;ul>
&lt;li>ç›¸å½“äº&lt;code>thread::spwan&lt;/code> + &lt;code>thread::join&lt;/code>ï¼Œä½†æ˜¯å®ƒä»¬åªèƒ½å€Ÿç”¨&lt;code>'static&lt;/code>æˆ–è€…&lt;code>move&lt;/code>å˜é‡&lt;/li>
&lt;li>&lt;code>scope&lt;/code>æ²¡æœ‰ä»¥ä¸Šé™åˆ¶ï¼Œæœ‰ç¼–è¯‘å™¨çš„æ”¯æŒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Mutex&lt;/code>å’Œ&lt;code>MutexGuard&lt;/code>
&lt;ul>
&lt;li>&lt;code>Mutex&lt;/code>æ˜¯äº’æ–¥é”æœ¬èº«&lt;/li>
&lt;li>&lt;code>MutexGuard&lt;/code>æŒ‡è®¿é—®å—äº’æ–¥é”ä¿æŠ¤æ•°æ®çš„â€œè®¸å¯è¯â€æˆ–â€œé’¥åŒ™â€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>park()/unpark&lt;/code>å’Œ&lt;code>sleep()&lt;/code>
&lt;ul>
&lt;li>&lt;code>park()/unpark()&lt;/code>ç²¾å‡†çš„æ§åˆ¶çº¿ç¨‹çš„ç¡çœ ï¼ˆparkï¼‰ä¸å”¤é†’ï¼ˆunparkï¼‰&lt;/li>
&lt;li>&lt;code>sleep()&lt;/code>åŸºäºæ—¶é—´è‡ªåŠ¨å”¤é†’ï¼Œæ— æ³•æå‰å”¤é†’&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>Option</title><link>https://www.dust-zed.site/rust/std/option/</link><pubDate>Mon, 01 Sep 2025 10:59:09 +0800</pubDate><guid>https://www.dust-zed.site/rust/std/option/</guid><description>&lt;p>æ ‡å‡†åº“&lt;code>Option&lt;/code>æºç å­¦ä¹ &lt;/p>
&lt;h4 id="åŸºç¡€ç»“æ„">åŸºç¡€ç»“æ„
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[derive(Copy, PartialEq, PartialOrd, Eq, Ord, Debug, Hash)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[rustc_diagnostic_item = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;Option&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">enum&lt;/span> Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// No value
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#75715e">#[lang = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;None&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Some value `T`
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#75715e">#[lang = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;Some&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span> T),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>&lt;code>#[lang = &amp;quot;...&amp;quot;]&lt;/code>å±æ€§è¡¨ç¤ºè¿™æ˜¯è¯­è¨€é¡¹&lt;/li>
&lt;li>æ³›å‹å‚æ•°Tæ”¯æŒä»»ä½•ç±»å‹&lt;/li>
&lt;li>è‡ªåŠ¨æ´¾ç”Ÿå¤šä¸ªtrait(&lt;code>Copy&lt;/code>ï¼Œ&lt;code>PartialEq&lt;/code>ç­‰)&lt;/li>
&lt;/ul>
&lt;h4 id="2-æ ¸å¿ƒæ–¹æ³•mapå’Œmap_or">2. æ ¸å¿ƒæ–¹æ³•:&lt;code>map&lt;/code>å’Œ&lt;code>map_or&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">map&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; &lt;span style="color:#a6e22e">U&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, f: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Some(f(x)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">map_or&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; &lt;span style="color:#a6e22e">U&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, default: &lt;span style="color:#a6e22e">U&lt;/span>, f: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">U&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(t) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> f(t),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> default,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-1">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>mapä¿ç•™Some/Noneç»“æ„&lt;/li>
&lt;li>map_oræä¾›é»˜è®¤å€¼&lt;/li>
&lt;li>ä½¿ç”¨FnOnceå› ä¸ºé—­åŒ…æœ€å¤šè¢«è°ƒç”¨ä¸€æ¬¡&lt;/li>
&lt;/ul>
&lt;h4 id="3è§£å¼•ç”¨å®ç°">3.è§£å¼•ç”¨å®ç°
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T: &lt;span style="color:#a6e22e">Deref&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> Deref &lt;span style="color:#66d9ef">for&lt;/span> Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Target&lt;/span> &lt;span style="color:#f92672">=&lt;/span> Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T::Target&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">deref&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Self&lt;/span>::Target {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(t) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Some(t.deref()),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-2">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>ä¸º&lt;code>Option&amp;lt;Box&amp;lt;T&amp;gt;&amp;gt;&lt;/code>ç­‰ç±»å‹æä¾›è‡ªåŠ¨è§£å¼•ç”¨&lt;/li>
&lt;li>å®ç°&lt;code>Deref&lt;/code>è€Œä¸æ˜¯ç›´æ¥å®ç°æ–¹æ³•ï¼Œä¿æŒä¸€è‡´æ€§&lt;/li>
&lt;/ul>
&lt;h4 id="4-and_thenå’Œor_else">4. &lt;code>and_then&lt;/code>å’Œ&lt;code>or_else&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">and_then&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>(self, f: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> f(x),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">or_else&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>F: FnOnce() -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>(self, f: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Some(x),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> f(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-3">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>&lt;code>and_then&lt;/code>ç”¨äºé“¾å¼æ“ä½œ&lt;/li>
&lt;li>&lt;code>or_else&lt;/code>æä¾›å›é€€é€»è¾‘&lt;/li>
&lt;li>é—­åŒ…&lt;code>F&lt;/code>åªåœ¨éœ€è¦æ—¶è°ƒç”¨&lt;/li>
&lt;/ul>
&lt;h4 id="5-transposeæ–¹æ³•">5. &lt;code>transpose&lt;/code>æ–¹æ³•
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;transpose_result&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.33.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">transpose&lt;/span>(self) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Ok(ok)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(Some(ok)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Err(err)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Err(err),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(None),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-4">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>åœ¨&lt;code>Option&lt;/code>å’Œ&lt;code>Result&lt;/code>ä¹‹é—´è½¬æ¢&lt;/li>
&lt;li>ä¿æŒé”™è¯¯ä¼ æ’­è¯­ä¹‰&lt;/li>
&lt;/ul>
&lt;h4 id="6-zipå’Œzip_with">6. &lt;code>zip&lt;/code>å’Œ&lt;code>zip_with&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;option_zip_option&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.46.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">zip&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, other: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>(T, U)&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> (self, other) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (Some(a), Some(b)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Some((a, b)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _ &lt;span style="color:#f92672">=&amp;gt;&lt;/span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[unstable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;option_zip&amp;#34;&lt;/span>&lt;span style="color:#75715e">, issue = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;70086&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">zip_with&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>(self, f: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>U&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> f(x),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-5">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>&lt;code>zip&lt;/code>ç»„åˆä¸¤ä¸ª&lt;code>Option&lt;/code>å€¼&lt;/li>
&lt;li>&lt;code>zip_with&lt;/code>æä¾›æ›´çµæ´»çš„è½¬æ¢&lt;/li>
&lt;li>ä½¿ç”¨å…ƒç»„æ¨¡å¼åŒ¹é…å¤„ç†ç»„åˆé€»è¾‘&lt;/li>
&lt;/ul>
&lt;h4 id="7-æ€§èƒ½ä¼˜åŒ–optiont">7. æ€§èƒ½ä¼˜åŒ–ï¼š&lt;code>Option&amp;lt;&amp;amp;T&amp;gt;&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¼–è¯‘å™¨å¯¹ Option&amp;lt;&amp;amp;T&amp;gt; æœ‰ç‰¹æ®Šä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// size_of::&amp;lt;Option&amp;lt;&amp;amp;T&amp;gt;&amp;gt;() == size_of::&amp;lt;&amp;amp;T&amp;gt;()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> Option&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">copied&lt;/span>(self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">where&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T: Copy,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.map(&lt;span style="color:#f92672">|&amp;amp;&lt;/span>t&lt;span style="color:#f92672">|&lt;/span> t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">cloned&lt;/span>(self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">where&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T: Clone,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.map(&lt;span style="color:#f92672">|&lt;/span>t&lt;span style="color:#f92672">|&lt;/span> t.clone())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-6">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>é›¶æˆæœ¬æŠ½è±¡&lt;/li>
&lt;li>ä¸ºå¼•ç”¨ç±»å‹æä¾›ç‰¹åŒ–å®ç°&lt;/li>
&lt;li>&lt;code>Copy&lt;/code>å’Œ&lt;code>Clone&lt;/code>çš„åŒºåˆ«å¤„ç†&lt;/li>
&lt;/ul></description></item><item><title>Result</title><link>https://www.dust-zed.site/rust/std/result/</link><pubDate>Mon, 01 Sep 2025 10:21:06 +0800</pubDate><guid>https://www.dust-zed.site/rust/std/result/</guid><description>&lt;p>æ ‡å‡†åº“çš„&lt;code>Result&lt;/code>æºç å­¦ä¹ ã€‚&lt;/p>
&lt;h4 id="1-åŸºç¡€ç»“æ„">1. åŸºç¡€ç»“æ„
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[must_use = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;this `Result` may be an `Err` variant, which should be handled&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">enum&lt;/span> Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Contains the success value
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#75715e">#[lang = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;Ok&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span> T),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Contains the error value
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#75715e">#[lang = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;Err&amp;#34;&lt;/span>&lt;span style="color:#75715e">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span> E),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>&lt;code>#[must_use]&lt;/code>å±æ€§ç¡®ä¿å¼€å‘è€…å¿…é¡»å¤„ç†å¯èƒ½çš„é”™è¯¯&lt;/li>
&lt;li>ä½¿ç”¨æ³›å‹&lt;code>T&lt;/code>å’Œ&lt;code>E&lt;/code>æ”¯æŒä»»ä½•ç±»å‹&lt;/li>
&lt;li>&lt;code>#[lang]&lt;/code>å±æ€§è¡¨ç¤ºè¿™æ˜¯è¯­è¨€é¡¹(lang item)&lt;/li>
&lt;/ul>
&lt;h4 id="2-åŸºç¡€æ–¹æ³•is_okå’Œis_err">2. åŸºç¡€æ–¹æ³•ï¼š&lt;code>is_ok&lt;/code>å’Œ&lt;code>is_err&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_ok&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">matches!&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>self, Ok(_))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-1">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>&lt;code>#[inline]&lt;/code>æç¤ºç¼–è¯‘å™¨å†…è”ä¼˜åŒ–&lt;/li>
&lt;li>&lt;code>const fn&lt;/code> è¡¨ç¤ºç¼–è¯‘æœŸå¯æ±‚å€¼&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>matches!&lt;/code>å®è¿›è¡Œæ¨¡å¼åŒ¹é…&lt;/li>
&lt;/ul>
&lt;h4 id="3-æ‰€æœ‰æƒç®¡ç†as_ref">3. æ‰€æœ‰æƒç®¡ç†ï¼š&lt;code>as_ref&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">as_ref&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&amp;amp;&lt;/span>T, &lt;span style="color:#f92672">&amp;amp;&lt;/span>E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> &lt;span style="color:#f92672">*&lt;/span>self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(&lt;span style="color:#66d9ef">ref&lt;/span> x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(x),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(&lt;span style="color:#66d9ef">ref&lt;/span> x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Err(x),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-2">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>è¿”å›å¼•ç”¨é¿å…æ‰€æœ‰æƒè½¬ç§»&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>ref&lt;/code>æ¨¡å¼åŒ¹é…è·å–å¼•ç”¨&lt;/li>
&lt;li>ä¿æŒåŸå§‹&lt;code>Result&lt;/code>ä¸å˜&lt;/li>
&lt;/ul>
&lt;h4 id="4-ç»„åˆå­map">4. ç»„åˆå­ï¼š&lt;code>map&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">map&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; &lt;span style="color:#a6e22e">U&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, op: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(t) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(op(t)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(e) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Err(e),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-3">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>é«˜é˜¶å‡½æ•°çš„ä½¿ç”¨&lt;/li>
&lt;li>&lt;code>FnOnce&lt;/code> trait boundå…è®¸æ¶ˆè´¹å€¼çš„é—­åŒ…&lt;/li>
&lt;li>æ¨¡å¼åŒ¹é…è§£æ„&lt;code>self&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="5-é“¾å¼è°ƒç”¨and_then">5. é“¾å¼è°ƒç”¨ï¼š&lt;code>and_then&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">and_then&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, F: FnOnce(T) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, E&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>(self, op: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>U, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(t) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> op(t),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(e) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Err(e),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-4">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>é”™è¯¯ä¼ æ’­æ¨¡å¼&lt;/li>
&lt;li>é—­åŒ…ä½œä¸ºå‚æ•°&lt;/li>
&lt;li>ç»„åˆæ“ä½œçš„ä¼˜é›…æ–¹å¼&lt;/li>
&lt;/ul>
&lt;h4 id="6-æ“ä½œç¬¦">6. &lt;code>?&lt;/code>æ“ä½œç¬¦
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[unstable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;try_trait_v2&amp;#34;&lt;/span>&lt;span style="color:#75715e">, issue = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;84277&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[rustc_const_unstable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;const_convert&amp;#34;&lt;/span>&lt;span style="color:#75715e">, issue = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;88674&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> ops::Try &lt;span style="color:#66d9ef">for&lt;/span> Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> T;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Residual&lt;/span> &lt;span style="color:#f92672">=&lt;/span> Result&lt;span style="color:#f92672">&amp;lt;!&lt;/span>, E&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">from_output&lt;/span>(output: &lt;span style="color:#a6e22e">Self&lt;/span>::Output) -&amp;gt; &lt;span style="color:#a6e22e">Self&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(output)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">branch&lt;/span>(self) -&amp;gt; &lt;span style="color:#a6e22e">ControlFlow&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Self::Residual, Self::Output&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(v) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> ControlFlow::Continue(v),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(e) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> ControlFlow::Break(Err(e)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-5">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>æ“ä½œç¬¦é‡è½½&lt;/li>
&lt;li>æ§åˆ¶æµæŠ½è±¡&lt;/li>
&lt;li>ç¼–è¯‘å™¨é­”æ³•èƒŒåçš„å®ç°&lt;/li>
&lt;/ul>
&lt;h4 id="7-è¿­ä»£å™¨é›†æˆ">7. è¿­ä»£å™¨é›†æˆ
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[stable(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span style="color:#75715e">, since = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> IntoIterator &lt;span style="color:#66d9ef">for&lt;/span> Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, E&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Item&lt;/span> &lt;span style="color:#f92672">=&lt;/span> T;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">IntoIter&lt;/span> &lt;span style="color:#f92672">=&lt;/span> IntoIter&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[inline]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">into_iter&lt;/span>(self) -&amp;gt; &lt;span style="color:#a6e22e">IntoIter&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> IntoIter { inner: &lt;span style="color:#a6e22e">self&lt;/span>.ok() }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å­¦ä¹ ç‚¹-6">å­¦ä¹ ç‚¹
&lt;/h5>&lt;ul>
&lt;li>è¿­ä»£å™¨æ¨¡å¼&lt;/li>
&lt;li>ç±»å‹è½¬æ¢&lt;/li>
&lt;li>é›¶æˆæœ¬æŠ½è±¡&lt;/li>
&lt;/ul></description></item><item><title>ripgrepçš„å®Œæ•´æ¶æ„</title><link>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84%E5%AE%8C%E6%95%B4%E6%9E%B6%E6%9E%84/</link><pubDate>Wed, 27 Aug 2025 10:28:07 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84%E5%AE%8C%E6%95%B4%E6%9E%B6%E6%9E%84/</guid><description>&lt;h3 id="å®Œæ•´çš„æ•°æ®æµ">å®Œæ•´çš„æ•°æ®æµ
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">å‘½ä»¤è¡Œå‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (parse.rs, defs.rs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">ç»“æ„åŒ–é…ç½®&lt;/span> (HiArgs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (hiargs.rs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">æ‰§è¡Œç»„ä»¶æ„å»º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> WalkBuilder (&lt;span style="color:#960050;background-color:#1e0010">æ–‡ä»¶å‘ç°&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> SearchWorker (&lt;span style="color:#960050;background-color:#1e0010">å†…å®¹æœç´¢&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> Printer (&lt;span style="color:#960050;background-color:#1e0010">ç»“æœè¾“å‡º&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">å¹¶è¡Œæ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (WalkParallel &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å·¥ä½œçªƒå–é˜Ÿåˆ—&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">æ–‡ä»¶å‘ç°æµ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (ignore &lt;span style="color:#960050;background-color:#1e0010">è§„åˆ™è¿‡æ»¤&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Haystack &lt;span style="color:#960050;background-color:#1e0010">æµ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (Searcher &lt;span style="color:#960050;background-color:#1e0010">ç­–ç•¥é€‰æ‹©&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">æœç´¢ç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> (Printer &lt;span style="color:#960050;background-color:#1e0010">æ ¼å¼åŒ–&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">ç”¨æˆ·è¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ–‡ä»¶å‘ç°ä¸æ–‡ä»¶æœç´¢">æ–‡ä»¶å‘ç°ä¸æ–‡ä»¶æœç´¢
&lt;/h3>&lt;h5 id="å•çº¿ç¨‹æ¨¡å¼">å•çº¿ç¨‹æ¨¡å¼ï¼š
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ–‡ä»¶å‘ç°é˜¶æ®µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> unsorted &lt;span style="color:#f92672">=&lt;/span> args.walk_builder()&lt;span style="color:#f92672">?&lt;/span>.build()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .filter_map(&lt;span style="color:#f92672">|&lt;/span>result&lt;span style="color:#f92672">|&lt;/span> haystack_builder.build_from_result(result));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> haystacks &lt;span style="color:#f92672">=&lt;/span> args.sort(unsorted);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æœç´¢é˜¶æ®µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">for&lt;/span> haystack &lt;span style="color:#66d9ef">in&lt;/span> haystacks {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> search_result &lt;span style="color:#f92672">=&lt;/span> searcher.search(&lt;span style="color:#f92672">&amp;amp;&lt;/span>haystack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å¹¶è¡Œæ¨¡å¼">å¹¶è¡Œæ¨¡å¼
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>args.walk_builder()&lt;span style="color:#f92672">?&lt;/span>.build_parallel().run(&lt;span style="color:#f92672">||&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Box::new(&lt;span style="color:#66d9ef">move&lt;/span> &lt;span style="color:#f92672">|&lt;/span>result&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> haystack &lt;span style="color:#f92672">=&lt;/span> haystack_builder.build_from_result(result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> search_result &lt;span style="color:#f92672">=&lt;/span> searcher.search(&lt;span style="color:#f92672">&amp;amp;&lt;/span>haystack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ç¼“å†²æœºåˆ¶åˆ†æ">ç¼“å†²æœºåˆ¶åˆ†æ
&lt;/h4>&lt;h5 id="å•çº¿ç¨‹æ¨¡å¼-1">å•çº¿ç¨‹æ¨¡å¼
&lt;/h5>&lt;ul>
&lt;li>å®Œæ•´ç¼“å†²ï¼šæ‰€æœ‰æ–‡ä»¶å…ˆå‘ç°å®Œæ¯•ï¼Œå­˜å‚¨åœ¨haystacksé›†åˆä¸­&lt;/li>
&lt;li>æ’åºæ”¯æŒï¼šæ”¯æŒ &amp;ndash;sorté€‰é¡¹ï¼Œå› ä¸ºæœ‰å®Œæ•´çš„æ–‡ä»¶åˆ—è¡¨&lt;/li>
&lt;li>å†…å­˜ä½¿ç”¨ï¼šæ–‡ä»¶è·¯å¾„å…¨éƒ¨åœ¨å†…å­˜ä¸­&lt;/li>
&lt;/ul>
&lt;h5 id="å¹¶è¡Œæ¨¡å¼-1">å¹¶è¡Œæ¨¡å¼
&lt;/h5>&lt;ul>
&lt;li>æµå¼å¤„ç†ï¼š æ–‡ä»¶å‘ç°å’Œæœç´¢åŒæ—¶è¿›è¡Œ&lt;/li>
&lt;li>æ— ç¼“å†²ï¼š æ²¡å‘ç°ä¸€ä¸ªæ–‡ä»¶ç«‹å³æœç´¢ï¼Œä¸ç­‰å¾…å…¶ä»–æ–‡ä»¶&lt;/li>
&lt;li>å·¥ä½œçªƒå–ï¼š å¤šä¸ªçº¿ç¨‹&lt;strong>å¹¶è¡Œå‘ç°&lt;/strong>å’Œ&lt;strong>æœç´¢æ–‡ä»¶&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h4 id="æœç´¢å†…éƒ¨çš„ç¼“å†²æœºåˆ¶">æœç´¢å†…éƒ¨çš„ç¼“å†²æœºåˆ¶
&lt;/h4>&lt;p>åœ¨&lt;code>Searcher&lt;/code>å†…éƒ¨æœ‰å¤šç§ç¼“å†²ç­–ç•¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Searcher&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> line_buffer: &lt;span style="color:#a6e22e">RefCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>LineBuffer&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> multi_line_buffer: &lt;span style="color:#a6e22e">RefCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u8&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> decode_buffer: &lt;span style="color:#a6e22e">RefCell&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u8&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ä¸‰ç§æœç´¢ç­–ç•¥">ä¸‰ç§æœç´¢ç­–ç•¥
&lt;/h5>&lt;ol>
&lt;li>å†…å­˜æ˜ å°„ï¼šé›¶æ‹·è´ï¼Œç›´æ¥è®¿é—®æ–‡ä»¶å†…å®¹&lt;/li>
&lt;li>æµå¼è¯»å–ï¼šå›ºå®šå¤§å°ç¼“å†²åŒºï¼Œé€è¡Œå¤„ç†&lt;/li>
&lt;li>å…¨æ–‡ç¼“å†²ï¼šå¤šè¡Œæœç´¢æ—¶ï¼Œæ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜&lt;/li>
&lt;/ol>
&lt;h5 id="å…³é”®è®¾è®¡å†³ç­–">å…³é”®è®¾è®¡å†³ç­–
&lt;/h5>&lt;h6 id="ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡">ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡
&lt;/h6>&lt;ol>
&lt;li>æ€§èƒ½ä¼˜åŒ–ï¼šå¹¶è¡Œæ¨¡å¼é¿å…äº†æ–‡ä»¶åˆ—è¡¨çš„å†…å­˜å¼€é”€&lt;/li>
&lt;li>å†…å­˜æ§åˆ¶ï¼šæµå¼å¤„ç†æ”¯æŒä»»æ„å¤§å°çš„æ–‡ä»¶&lt;/li>
&lt;li>ç”¨æˆ·ä½“éªŒï¼šç»“æœå¯ä»¥ç«‹å³è¾“å‡ºï¼Œä¸éœ€è¦ç­‰å¾…æ‰€æœ‰æ–‡ä»¶æ‰«æå®Œæˆ&lt;/li>
&lt;/ol>
&lt;h6 id="ç¼“å†²åŒºå¤§å°æ§åˆ¶">ç¼“å†²åŒºå¤§å°æ§åˆ¶
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// LineBuffer é»˜è®¤é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>capacity: &lt;span style="color:#ae81ff">64&lt;/span> &lt;span style="color:#f92672">*&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>), &lt;span style="color:#75715e">//64kb è¡Œç¼“å†²
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ€»ç»“">æ€»ç»“
&lt;/h4>&lt;ol>
&lt;li>ä¸æ˜¯ä¸€å‘ç°ä¸€æœç´¢ï¼šripgrepæœ‰ä¸¤ç§æ¨¡å¼
&lt;ul>
&lt;li>å•çº¿ç¨‹ï¼š å…ˆå‘ç°æ‰€æœ‰æ–‡ä»¶ â†’ ç¼“å†²æ’åº â†’ é€ä¸ªæœç´¢&lt;/li>
&lt;li>å¹¶è¡Œï¼š å‘ç°å’Œæœç´¢åŒæ—¶è¿›è¡Œï¼Œæ— æ–‡ä»¶çº§ç¼“å†²&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç¼“å†²åŒºå­˜åœ¨äºå¤šä¸ªå±‚æ¬¡ï¼š
&lt;ul>
&lt;li>æ–‡ä»¶åˆ—è¡¨çº§ï¼šå•çº¿ç¨‹æ¨¡å¼æœ‰å®Œæ•´ç¼“å†²&lt;/li>
&lt;li>æ–‡ä»¶å†…å®¹çº§ï¼šæ¯ä¸ªæ–‡ä»¶å†…éƒ¨æœ‰è¡Œç¼“å†²ï¼ˆ64KBï¼‰&lt;/li>
&lt;li>è¾“å‡ºçº§ï¼šå¹¶è¡Œæ¨¡å¼æœ‰è¾“å‡ºç¼“å†²åŒº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h5 id="æ ¸å¿ƒæ¶æ„å¯¹æ¯”">æ ¸å¿ƒæ¶æ„å¯¹æ¯”
&lt;/h5>&lt;h6 id="å•çº¿ç¨‹æ¨¡å¼æœ‰ç¼“å†²">å•çº¿ç¨‹æ¨¡å¼ï¼ˆæœ‰ç¼“å†²ï¼‰
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">æ–‡ä»¶å‘ç°&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> [&lt;span style="color:#960050;background-color:#1e0010">æ–‡ä»¶åˆ—è¡¨ç¼“å†²&lt;/span>] &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ’åº&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">é€ä¸ªæœç´¢&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">è¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>æ”¯æŒ &lt;code>--sort&lt;/code> é€‰é¡¹&lt;/li>
&lt;li>å†…å­˜ä½¿ç”¨ï¼šO(æ–‡ä»¶æ•°é‡)&lt;/li>
&lt;/ul>
&lt;h6 id="å¹¶è¡Œæ¨¡å¼æµå¼å¤„ç†">å¹¶è¡Œæ¨¡å¼ï¼ˆæµå¼å¤„ç†ï¼‰
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">æ–‡ä»¶å‘ç°&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">âŸ·&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æœç´¢&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> [&lt;span style="color:#960050;background-color:#1e0010">è¾“å‡ºç¼“å†²&lt;/span>] &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">è¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å®æ—¶å¤„ç†ï¼Œä½å†…å­˜å ç”¨&lt;/li>
&lt;li>å·¥ä½œçªƒå–é˜Ÿåˆ—åè°ƒå¤šçº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;h4 id="æ€§èƒ½å½±å“">æ€§èƒ½å½±å“
&lt;/h4>&lt;p>&lt;strong>ä¼˜åŠ¿&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å¹¶è¡Œæ¨¡å¼&lt;/strong>ï¼šå†…å­˜æ•ˆç‡é«˜ï¼Œç»“æœè¾“å‡ºå¿«&lt;/li>
&lt;li>&lt;strong>å•çº¿ç¨‹æ¨¡å¼&lt;/strong>ï¼šæ”¯æŒæ’åºï¼Œé€‚åˆå°è§„æ¨¡æœç´¢&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æƒè¡¡&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>å¹¶è¡Œæ¨¡å¼ç‰ºç‰²äº†æ’åºèƒ½åŠ›æ¢å–æ€§èƒ½&lt;/li>
&lt;li>å•çº¿ç¨‹æ¨¡å¼éœ€è¦æ›´å¤šå†…å­˜ä½†è¾“å‡ºæœ‰åº&lt;/li>
&lt;/ul></description></item><item><title>Walkæ•´ä½“æ¶æ„</title><link>https://www.dust-zed.site/rust/ripgrep/walk%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/</link><pubDate>Wed, 27 Aug 2025 09:07:07 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/walk%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/</guid><description>&lt;h3 id="walkæ•´ä½“æ¶æ„è®¾è®¡è¯¦è§£">Walkæ•´ä½“æ¶æ„è®¾è®¡è¯¦è§£
&lt;/h3>&lt;p>è®©æˆ‘ä»¬ä»æœ€æ ¸å¿ƒçš„è®¾è®¡ç†å¿µå¼€å§‹ï¼Œç³»ç»Ÿåœ°è§£é‡Šwalkçš„æ•´ä½“å·¥ä½œæœºåˆ¶ã€‚&lt;/p>
&lt;h5 id="1-æ ¸å¿ƒæ¶æ„ä¸‰å±‚è®¾è®¡æ¨¡å¼">1. æ ¸å¿ƒæ¶æ„ï¼šä¸‰å±‚è®¾è®¡æ¨¡å¼
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¬¬ä¸€å±‚ï¼šæ„å»ºå™¨ - é…ç½®æ”¶é›†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>WalkBuilder::new(&lt;span style="color:#e6db74">&amp;#34;/path/to/search&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .max_depth(Some(&lt;span style="color:#ae81ff">5&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .follow_links(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .threads(&lt;span style="color:#ae81ff">4&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¬¬äºŒå±‚ï¼šæ‰§è¡Œå™¨ - ä¸¤ç§æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .build() &lt;span style="color:#75715e">// â†’ Walk (å•çº¿ç¨‹è¿­ä»£å™¨)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .build_parallel() &lt;span style="color:#75715e">// â†’ WalkParallel (å¹¶è¡Œæ‰§è¡Œå™¨)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¬¬ä¸‰å±‚ï¼šæ•°æ®æŠ½è±¡ - ç»Ÿä¸€è¡¨ç¤º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// â†’ Iterator&amp;lt;Item = Result&amp;lt;DirEntry, Error&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-äº‹ä»¶é©±åŠ¨çš„éå†æ¨¡å‹">2. äº‹ä»¶é©±åŠ¨çš„éå†æ¨¡å‹
&lt;/h5>&lt;p>Walkçš„æ ¸å¿ƒåˆ›æ–°æ˜¯æŠŠç›®å½•éå†æŠ½è±¡ä¸º&lt;strong>äº‹ä»¶æµ&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">WalkEvent&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Dir(walkdir::DirEntry), &lt;span style="color:#75715e">// è¿›å…¥ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> File(walkdir::DirEntry), &lt;span style="color:#75715e">// å‘ç°æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Exit &lt;span style="color:#75715e">// é€€å‡ºç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å·¥ä½œæµç¨‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">/&lt;/span>root&lt;span style="color:#f92672">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> file1.txt &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::File(file1.txt)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> dir1&lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::Dir(dir1)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> file2.txt &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::File(file2.txt)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> subdir&lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::Dir(subdir)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> file3.txt &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::File(file3.txt)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::Exit (subdir)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::Exit (dir1)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> file4.txt &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> WalkEvent::File(file4.txt)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-walk-vs-walkparallelçš„è®¾è®¡å·®å¼‚">3. Walk vs WalkParallelçš„è®¾è®¡å·®å¼‚
&lt;/h5>&lt;p>&lt;strong>Walk&lt;/strong> - æ ‡å‡†è¿­ä»£å™¨æ¨¡å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Iterator &lt;span style="color:#66d9ef">for&lt;/span> Walk {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">next&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>DirEntry, Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. ä» WalkEventIter è·å–ä¸‹ä¸€ä¸ªäº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> ev &lt;span style="color:#f92672">=&lt;/span> self.it.as_mut().and_then(&lt;span style="color:#f92672">|&lt;/span>it&lt;span style="color:#f92672">|&lt;/span> it.next());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> ev {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(WalkEvent::Dir(ent)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. æ£€æŸ¥æ˜¯å¦åº”è¯¥è·³è¿‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> self.skip_entry(&lt;span style="color:#f92672">&amp;amp;&lt;/span>ent)&lt;span style="color:#f92672">?&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.it.skip_current_dir(); &lt;span style="color:#75715e">// å‰ªæ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. æ›´æ–° ignore è§„åˆ™ä¸Šä¸‹æ–‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> (ig_new, err) &lt;span style="color:#f92672">=&lt;/span> self.ig.add_child(ent.path());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig &lt;span style="color:#f92672">=&lt;/span> ig_new;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Ok(ent));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(WalkEvent::File(ent)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.skip_entry(&lt;span style="color:#f92672">&amp;amp;&lt;/span>ent)&lt;span style="color:#f92672">?&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Ok(ent));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(WalkEvent::Exit) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. æ¢å¤çˆ¶ç›®å½•çš„ ignore ä¸Šä¸‹æ–‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.ig &lt;span style="color:#f92672">=&lt;/span> self.ig.parent().unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>WalkParallel&lt;/strong> - å·¥ä½œçªƒå–æ¨¡å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> WalkParallel {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>F&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, mkf: &lt;span style="color:#a6e22e">F&lt;/span>) &lt;span style="color:#66d9ef">where&lt;/span> F: FnMut() -&amp;gt; Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> FnMut(Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>DirEntry, Error&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">WalkState&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. åˆ›å»ºå·¥ä½œçªƒå–é˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> stacks &lt;span style="color:#f92672">=&lt;/span> Stack::new_for_each_thread(threads, stack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. å¯åŠ¨å¤šä¸ªå·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std::thread::scope(&lt;span style="color:#f92672">|&lt;/span>s&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> handles: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> stacks.into_iter().map(&lt;span style="color:#f92672">|&lt;/span>stack&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Worker {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor: &lt;span style="color:#a6e22e">mkf&lt;/span>(), &lt;span style="color:#75715e">// ç”¨æˆ·å›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> stack, &lt;span style="color:#75715e">// å·¥ä½œé˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> quit_now, &lt;span style="color:#75715e">// å…¨å±€é€€å‡ºæ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> active_workers, &lt;span style="color:#75715e">// æ´»è·ƒå·¥ä½œè€…è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// ... å…¶ä»–é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).map(&lt;span style="color:#f92672">|&lt;/span>worker&lt;span style="color:#f92672">|&lt;/span> s.spawn(&lt;span style="color:#66d9ef">move&lt;/span> &lt;span style="color:#f92672">||&lt;/span> worker.run())).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> handle &lt;span style="color:#66d9ef">in&lt;/span> handles { handle.join().unwrap(); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-å…³é”®è®¾è®¡æ¨¡å¼">4. å…³é”®è®¾è®¡æ¨¡å¼
&lt;/h5>&lt;p>&lt;strong>çŠ¶æ€ç®¡ç†&lt;/strong>ï¼šIgnoreè§„åˆ™çš„å±‚æ¬¡åŒ–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Walk&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ig_root: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">// æ ¹ç›®å½•è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ig: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">// å½“å‰ç›®å½•è§„åˆ™ (éšéå†åŠ¨æ€å˜åŒ–)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿›å…¥å­ç›®å½•æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> (ig_new, err) &lt;span style="color:#f92672">=&lt;/span> self.ig.add_child(child_path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>self.ig &lt;span style="color:#f92672">=&lt;/span> ig_new; &lt;span style="color:#75715e">// ç»§æ‰¿çˆ¶ç›®å½•è§„åˆ™ + å­ç›®å½•è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é€€å‡ºç›®å½•æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>self.ig &lt;span style="color:#f92672">=&lt;/span> self.ig.parent().unwrap(); &lt;span style="color:#75715e">// æ¢å¤çˆ¶ç›®å½•è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ—©æœŸè¿‡æ»¤ä¼˜åŒ–&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">skip_entry&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self, ent: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">DirEntry&lt;/span>) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">bool&lt;/span>, Error&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¼˜å…ˆçº§é¡ºåº (ä»å¿«åˆ°æ…¢)ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> ent.depth() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> { &lt;span style="color:#66d9ef">return&lt;/span> Ok(&lt;span style="color:#66d9ef">false&lt;/span>); } &lt;span style="color:#75715e">// 1. æ ¹ç›®å½•æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> should_skip_entry(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self.ig, ent) { &lt;span style="color:#66d9ef">return&lt;/span> Ok(&lt;span style="color:#66d9ef">true&lt;/span>); } &lt;span style="color:#75715e">// 2. ignore è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> path_equals(ent, stdout) { &lt;span style="color:#66d9ef">return&lt;/span> Ok(&lt;span style="color:#66d9ef">true&lt;/span>); } &lt;span style="color:#75715e">// 3. stdout æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> skip_filesize(&lt;span style="color:#f92672">..&lt;/span>.) { &lt;span style="color:#66d9ef">return&lt;/span> Ok(&lt;span style="color:#66d9ef">true&lt;/span>); } &lt;span style="color:#75715e">// 4. æ–‡ä»¶å¤§å°æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>filter(ent) { &lt;span style="color:#66d9ef">return&lt;/span> Ok(&lt;span style="color:#66d9ef">true&lt;/span>); } &lt;span style="color:#75715e">// 5. è‡ªå®šä¹‰è¿‡æ»¤å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(&lt;span style="color:#66d9ef">false&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å·¥ä½œçªƒå–é˜Ÿåˆ—çš„æ™ºèƒ½ç»ˆæ­¢&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">get_work&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Work&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self.recv() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Message::Work(work)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(work),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Message::Quit) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> None,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é”®ï¼šåŸå­æ€§æ£€æŸ¥æ‰€æœ‰å·¥ä½œè€…æ˜¯å¦éƒ½ç©ºé—²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> self.deactivate_worker() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰€æœ‰å·¥ä½œè€…éƒ½ç©ºé—² = æ²¡æœ‰æ›´å¤šå·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.send_quit(); &lt;span style="color:#75715e">// å¹¿æ’­é€€å‡ºä¿¡å·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> None;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç­‰å¾…æ–°å·¥ä½œæˆ–ä»å…¶ä»–é˜Ÿåˆ—çªƒå–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.wait_for_work();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="5-æ•´ä½“å·¥ä½œæµç¨‹æ€»ç»“">5. æ•´ä½“å·¥ä½œæµç¨‹æ€»ç»“
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">ç”¨æˆ·è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WalkBuilder &lt;span style="color:#960050;background-color:#1e0010">æ”¶é›†é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">é€‰æ‹©æ‰§è¡Œæ¨¡å¼ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”œâ”€â”€&lt;/span> Walk: &lt;span style="color:#960050;background-color:#1e0010">å•çº¿ç¨‹è¿­ä»£å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â”‚&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">åŸºäº&lt;/span> WalkDir &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">äº‹ä»¶è½¬æ¢&lt;/span> &lt;span style="color:#f92672">+&lt;/span> ignore &lt;span style="color:#960050;background-color:#1e0010">è¿‡æ»¤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> WalkParallel: &lt;span style="color:#960050;background-color:#1e0010">å¹¶è¡Œæ‰§è¡Œå™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â””â”€â”€&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å·¥ä½œçªƒå–é˜Ÿåˆ—&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å¤šçº¿ç¨‹åä½œ&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ™ºèƒ½ç»ˆæ­¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">äº§ç”Ÿ&lt;/span> DirEntry &lt;span style="color:#960050;background-color:#1e0010">æµ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">ç”¨æˆ·å¤„ç†ç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ ¸å¿ƒä¼˜åŠ¿&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ç»Ÿä¸€æŠ½è±¡ï¼šæ— è®ºå•çº¿ç¨‹è¿˜æ˜¯å¹¶è¡Œï¼Œç”¨æˆ·çœ‹åˆ°çš„éƒ½æ˜¯&lt;code>DirEntry&lt;/code>æµ&lt;/li>
&lt;li>æ™ºèƒ½è¿‡æ»¤ï¼šå¤šå±‚æ¬¡ã€æ—©æœŸè¿‡æ»¤ï¼Œé¿å…ä¸å¿…è¦çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ&lt;/li>
&lt;li>åŠ¨æ€é€‚åº”ï¼š ignoreè§„åˆ™è·Ÿéšç›®å½•å±‚æ¬¡åŠ¨æ€è°ƒæ•´&lt;/li>
&lt;li>é«˜æ•ˆå¹¶è¡Œï¼š å·¥ä½œçªƒå– + æ™ºèƒ½ç»ˆæ­¢ï¼Œæœ€å¤§åŒ–CPUåˆ©ç”¨ç‡&lt;/li>
&lt;/ul>
&lt;h4 id="walkbuilderæ„å»ºæ¨¡å¼è¯¦è§£">WalkBuilderæ„å»ºæ¨¡å¼è¯¦è§£
&lt;/h4>&lt;h5 id="æ ¸å¿ƒç»“æ„è®¾è®¡">æ ¸å¿ƒç»“æ„è®¾è®¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">WalkBuilder&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> paths: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>PathBuf&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// å¤šè·¯å¾„æ”¯æŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ig_builder: &lt;span style="color:#a6e22e">IgnoreBuilder&lt;/span>, &lt;span style="color:#75715e">// ignore è§„åˆ™æ„å»ºå™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> max_depth: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">usize&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// é€’å½’æ·±åº¦é™åˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> max_filesize: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u64&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æ–‡ä»¶å¤§å°é™åˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> follow_links: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// ç¬¦å·é“¾æ¥è·Ÿéš
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> same_file_system: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> sorter: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Sorter&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æ’åºç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> threads: &lt;span style="color:#66d9ef">usize&lt;/span>, &lt;span style="color:#75715e">// çº¿ç¨‹æ•°é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> skip: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>Handle&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// stdout è·³è¿‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> filter: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Filter&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// è‡ªå®šä¹‰è¿‡æ»¤å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="æµç•…æ¥å£æ¨¡å¼çš„ä¼˜é›…å®ç°">æµç•…æ¥å£æ¨¡å¼çš„ä¼˜é›…å®ç°
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å…¸å‹çš„é“¾å¼è°ƒç”¨æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> walker &lt;span style="color:#f92672">=&lt;/span> WalkBuilder::new(&lt;span style="color:#e6db74">&amp;#34;/path/to/search&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .max_depth(Some(&lt;span style="color:#ae81ff">3&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .follow_links(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .threads(&lt;span style="color:#ae81ff">4&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .standard_filters(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .hidden(&lt;span style="color:#66d9ef">false&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .git_ignore(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .build_parallel();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å…³é”®è®¾è®¡æ¨¡å¼">å…³é”®è®¾è®¡æ¨¡å¼
&lt;/h5>&lt;h6 id="1-å§”æ‰˜æ¨¡å¼">1. å§”æ‰˜æ¨¡å¼
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// WalkBuilder å°† ignore ç›¸å…³é…ç½®å§”æ‰˜ç»™ IgnoreBuilder
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// WalkDiræ˜¯åŸºç¡€çš„æ–‡ä»¶ç³»ç»ŸBuilder
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">hidden&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, yes: &lt;span style="color:#66d9ef">bool&lt;/span>) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig_builder.hidden(yes); &lt;span style="color:#75715e">// å§”æ‰˜ç»™å†…éƒ¨æ„å»ºå™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">git_ignore&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, yes: &lt;span style="color:#66d9ef">bool&lt;/span>) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig_builder.git_ignore(yes);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="2-åˆ†ç»„é…ç½®æ¨¡å¼">2. åˆ†ç»„é…ç½®æ¨¡å¼
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">standard_filters&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, yes: &lt;span style="color:#66d9ef">bool&lt;/span>) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸€æ¬¡æ€§é…ç½®å¤šä¸ªç›¸å…³é€‰é¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.hidden(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .parents(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .ignore(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .git_ignore(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .git_global(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .git_exclude(yes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="3--ç­–ç•¥æ¨¡å¼çš„æ’åºè®¾è®¡">3. ç­–ç•¥æ¨¡å¼çš„æ’åºè®¾è®¡
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">Sorter&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ByName(Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> Fn(&lt;span style="color:#f92672">&amp;amp;&lt;/span>OsStr, &lt;span style="color:#f92672">&amp;amp;&lt;/span>OsStr) -&amp;gt; &lt;span style="color:#a6e22e">Ordering&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send &lt;span style="color:#f92672">+&lt;/span> Sync &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static&lt;span style="color:#f92672">&amp;gt;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ByPath(Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> Fn(&lt;span style="color:#f92672">&amp;amp;&lt;/span>Path, &lt;span style="color:#f92672">&amp;amp;&lt;/span>Path) -&amp;gt; &lt;span style="color:#a6e22e">Ordering&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send &lt;span style="color:#f92672">+&lt;/span> Sync &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static&lt;span style="color:#f92672">&amp;gt;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">sort_by_file_name&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>F&lt;span style="color:#f92672">&amp;gt;&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, cmp: &lt;span style="color:#a6e22e">F&lt;/span>) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> WalkBuilder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">where&lt;/span> F: Fn(&lt;span style="color:#f92672">&amp;amp;&lt;/span>OsStr, &lt;span style="color:#f92672">&amp;amp;&lt;/span>OsStr) -&amp;gt; &lt;span style="color:#a6e22e">Ordering&lt;/span> &lt;span style="color:#f92672">+&lt;/span> Send &lt;span style="color:#f92672">+&lt;/span> Sync &lt;span style="color:#f92672">+&lt;/span> &amp;#39;static
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.sorter &lt;span style="color:#f92672">=&lt;/span> Some(Sorter::ByName(Arc::new(cmp)));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="æ„å»ºè¿‡ç¨‹çš„ä¸¤ä¸ªå…³é”®è½¬æ¢">æ„å»ºè¿‡ç¨‹çš„ä¸¤ä¸ªå…³é”®è½¬æ¢
&lt;/h5>&lt;h6 id="build---å•çº¿ç¨‹è¿­ä»£å™¨æ„å»º">build() - å•çº¿ç¨‹è¿­ä»£å™¨æ„å»º
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">build&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">Walk&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. ä¸ºæ¯ä¸ªè·¯å¾„åˆ›å»º WalkDir è¿­ä»£å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> its &lt;span style="color:#f92672">=&lt;/span> self.paths.iter().map(&lt;span style="color:#f92672">|&lt;/span>p&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> wd &lt;span style="color:#f92672">=&lt;/span> WalkDir::new(p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wd &lt;span style="color:#f92672">=&lt;/span> wd.follow_links(self.follow_links &lt;span style="color:#f92672">||&lt;/span> p.is_file());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wd &lt;span style="color:#f92672">=&lt;/span> wd.same_file_system(self.same_file_system);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. åº”ç”¨æ’åºç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(&lt;span style="color:#66d9ef">ref&lt;/span> sorter) &lt;span style="color:#f92672">=&lt;/span> self.sorter {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> sorter {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Sorter::ByName(cmp) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> wd &lt;span style="color:#f92672">=&lt;/span> wd.sort_by(&lt;span style="color:#66d9ef">move&lt;/span> &lt;span style="color:#f92672">|&lt;/span>a, b&lt;span style="color:#f92672">|&lt;/span> cmp(a.file_name(), b.file_name())),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Sorter::ByPath(cmp) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> wd &lt;span style="color:#f92672">=&lt;/span> wd.sort_by(&lt;span style="color:#66d9ef">move&lt;/span> &lt;span style="color:#f92672">|&lt;/span>a, b&lt;span style="color:#f92672">|&lt;/span> cmp(a.path(), b.path())),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (p.to_path_buf(), Some(WalkEventIter::from(wd)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. æ„å»º ignore è§„åˆ™æ ¹èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> ig_root &lt;span style="color:#f92672">=&lt;/span> self.ig_builder.build();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Walk { its, ig_root, &lt;span style="color:#75715e">/* ... */&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="build_parallel---å¹¶è¡Œæ‰§è¡Œå™¨æ„å»º">build_parallel() - å¹¶è¡Œæ‰§è¡Œå™¨æ„å»º
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">build_parallel&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">WalkParallel&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WalkParallel {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> paths: &lt;span style="color:#a6e22e">self&lt;/span>.paths.clone().into_iter(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ig_root: &lt;span style="color:#a6e22e">self&lt;/span>.ig_builder.build(), &lt;span style="color:#75715e">// å…±äº« ignore è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> max_depth: &lt;span style="color:#a6e22e">self&lt;/span>.max_depth,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> threads: &lt;span style="color:#a6e22e">self&lt;/span>.threads,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç›´æ¥ä¼ é€’é…ç½®ï¼Œæ— éœ€è½¬æ¢ä¸ºè¿­ä»£å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="walkbuilder-æ„å»ºæ¨¡å¼çš„æ™ºèƒ½é…ç½®ç®¡ç†">WalkBuilder æ„å»ºæ¨¡å¼çš„æ™ºèƒ½é…ç½®ç®¡ç†
&lt;/h4>&lt;h6 id="æ™ºèƒ½é»˜è®¤å€¼å¤„ç†">æ™ºèƒ½é»˜è®¤å€¼å¤„ç†
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> WalkParallel {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">threads&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">usize&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self.threads &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#75715e">// æ™ºèƒ½é»˜è®¤å€¼ï¼šæœ€å°‘2ä¸ªçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.threads
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="é…ç½®éªŒè¯å’Œä¼˜åŒ–">é…ç½®éªŒè¯å’Œä¼˜åŒ–
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">visit&lt;/span>(&lt;span style="color:#66d9ef">mut&lt;/span> self, builder: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> &lt;span style="color:#66d9ef">dyn&lt;/span> ParallelVisitorBuilder&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> threads &lt;span style="color:#f92672">=&lt;/span> self.threads();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> stack &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">vec!&lt;/span>[];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. é¢„å¤„ç†æ ¹è·¯å¾„ï¼ŒåŒºåˆ†æ–‡ä»¶å’Œç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> path &lt;span style="color:#66d9ef">in&lt;/span> paths {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (dent, root_device) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> path &lt;span style="color:#f92672">==&lt;/span> Path::new(&lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (DirEntry::new_stdin(), None) &lt;span style="color:#75715e">// ç‰¹æ®Šå¤„ç† stdin
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾å¤‡å·æ£€æŸ¥ï¼ˆsame_file_system æ”¯æŒï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> root_device &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.same_file_system {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> device_num(&lt;span style="color:#f92672">&amp;amp;&lt;/span>path) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(root_device) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Some(root_device),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é”™è¯¯å¤„ç†ï¼šå•ä¸ªè·¯å¾„å¤±è´¥ä¸å½±å“å…¶ä»–è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> visitor.visit(Err(err)).is_quit() { &lt;span style="color:#66d9ef">return&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºåˆå§‹ DirEntry
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> DirEntryRaw::from_path(&lt;span style="color:#ae81ff">0&lt;/span>, path, &lt;span style="color:#66d9ef">false&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(dent) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> (DirEntry::new_raw(dent, None), root_device),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> visitor.visit(Err(err)).is_quit() { &lt;span style="color:#66d9ef">return&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. ç”Ÿæˆåˆå§‹å·¥ä½œé¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> stack.push(Message::Work(Work {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dent,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ignore: &lt;span style="color:#a6e22e">self&lt;/span>.ig_root.clone(), &lt;span style="color:#75715e">// å…±äº«æ ¹ ignore è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> root_device,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. æ—©æœŸé€€å‡ºä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> stack.is_empty() { &lt;span style="color:#66d9ef">return&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. å¯åŠ¨å·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> stacks &lt;span style="color:#f92672">=&lt;/span> Stack::new_for_each_thread(threads, stack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å…³é”®è®¾è®¡æ¨¡å¼æ€»ç»“">å…³é”®è®¾è®¡æ¨¡å¼æ€»ç»“
&lt;/h4>&lt;h5 id="1-åˆ†å±‚å§”æ‰˜æ¨¡å¼">1. åˆ†å±‚å§”æ‰˜æ¨¡å¼
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>WalkBuilder (&lt;span style="color:#960050;background-color:#1e0010">å¤–å±‚é…ç½®&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å§”æ‰˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>IgnoreBuilder (ignore &lt;span style="color:#960050;background-color:#1e0010">è§„åˆ™é…ç½®&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">â†“&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">æ„å»º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Ignore (&lt;span style="color:#960050;background-color:#1e0010">è¿è¡Œæ—¶è§„åˆ™åŒ¹é…å™¨&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-é…ç½®æ”¶é›†ä¸å»¶è¿Ÿæ„å»º">2. é…ç½®æ”¶é›†ä¸å»¶è¿Ÿæ„å»º
&lt;/h5>&lt;ul>
&lt;li>æ”¶é›†é˜¶æ®µï¼š WalkBuilderæ”¶é›†æ‰€æœ‰é…ç½®é€‰é¡¹&lt;/li>
&lt;li>éªŒè¯é˜¶æ®µï¼šbuild()æ—¶è¿›è¡Œé…ç½®éªŒè¯å’Œè½¬æ¢&lt;/li>
&lt;li>æ‰§è¡Œé˜¶æ®µï¼šWalk/WalkParallelä½¿ç”¨æœ€ç»ˆé…ç½®æ‰§è¡Œéå†&lt;/li>
&lt;/ul>
&lt;h5 id="3-å¤šæ€æ‰§è¡Œç­–ç•¥">3. å¤šæ€æ‰§è¡Œç­–ç•¥
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> WalkBuilder {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">build&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">Walk&lt;/span> { &lt;span style="color:#75715e">/* å•çº¿ç¨‹ç­–ç•¥ */&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">build_parallel&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">WalkParallel&lt;/span> { &lt;span style="color:#75715e">/* å¹¶è¡Œç­–ç•¥ */&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-é”™è¯¯æ¢å¤ä¸éƒ¨åˆ†æˆåŠŸ">4. é”™è¯¯æ¢å¤ä¸éƒ¨åˆ†æˆåŠŸ
&lt;/h5>&lt;ul>
&lt;li>å•ä¸ªè·¯å¾„å¤±è´¥ä¸å½±å“å…¶ä»–è·¯å¾„çš„å¤„ç†&lt;/li>
&lt;li>ignoreæ–‡ä»¶è§£æé”™è¯¯ä¸é˜»æ­¢éå†ç»§ç»­&lt;/li>
&lt;li>æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ä½†ä¿æŒç³»ç»Ÿå¥å£®æ€§&lt;/li>
&lt;/ul>
&lt;h4 id="walkçš„æ–‡ä»¶å‘ç°ä¸éå†">Walkçš„æ–‡ä»¶å‘ç°ä¸éå†
&lt;/h4>&lt;p>&lt;code>Walk&lt;/code>å®ç°äº†&lt;code>Iterator&lt;/code>traitï¼Œå…¶æ ¸å¿ƒæ˜¯&lt;code>next()&lt;/code>æ–¹æ³•ï¼Œè´Ÿè´£æ–‡ä»¶å‘ç°å’Œéå†ã€‚&lt;code>Walk&lt;/code>åŒ…è£…äº†&lt;code>WalkEventIter&lt;/code>ï¼Œè€Œ&lt;code>WalkEventIter&lt;/code>åŒ…è£…äº†&lt;code>WalkDir&lt;/code>ã€‚&lt;code>WalkDir&lt;/code>æä¾›åŸºç¡€çš„æ–‡ä»¶ç³»ç»Ÿéå†åŠŸèƒ½ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„æ ‘å½¢ç»“æ„è½¬åŒ–ä¸ºäº†çº¿å½¢çš„Iterï¼›&lt;code>WalkEventDir&lt;/code>åˆ™æ˜¯å°†&lt;code>WalkDir&lt;/code>è½¬æ¢ä¸º&lt;code>WalkEvent&lt;/code>æµï¼›&lt;code>Walk&lt;/code>è´Ÿè´£æ·»åŠ ignoreè§„åˆ™å’Œè¿‡æ»¤é€»è¾‘ã€‚&lt;/p>
&lt;h5 id="1-æ ¸å¿ƒæ•°æ®ç»“æ„">1. æ ¸å¿ƒæ•°æ®ç»“æ„
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Walk&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> its: &lt;span style="color:#a6e22e">std&lt;/span>::vec::IntoIter&lt;span style="color:#f92672">&amp;lt;&lt;/span>(PathBuf, Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>WalkEventIter&lt;span style="color:#f92672">&amp;gt;&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//åˆå§‹è·¯å¾„è¿­ä»£å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> it: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>WalkEventIter&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//å½“å‰ç›®å½•è¿­ä»£å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ig_root: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">//æ ¹ç›®å½•çš„å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ig: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">//å½“å‰ç›®å½•çš„å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">//...å…¶ä»–å­—æ®µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2åˆå§‹åŒ–é˜¶æ®µ">2.åˆå§‹åŒ–é˜¶æ®µ
&lt;/h5>&lt;ul>
&lt;li>å¦‚æœå½“å‰è¿­ä»£å™¨itä¸ºNoneï¼Œä»itsè·å–ä¸‹ä¸€ä¸ªè·¯å¾„&lt;/li>
&lt;li>å¦‚æœitsä¹Ÿè€—å°½ï¼Œè¿”å›Noneè¡¨ç¤ºéå†ç»“æŸ&lt;/li>
&lt;/ul>
&lt;h5 id="3ä¸»å¾ªç¯ç»“æ„">3.ä¸»å¾ªç¯ç»“æ„
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">next&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>DirEntry, Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. è·å–ä¸‹ä¸€ä¸ªäº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// 2. å¤„ç†äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// 3. è¿”å›ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶/ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-äº‹ä»¶è·å–é€»è¾‘">4. äº‹ä»¶è·å–é€»è¾‘
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> ev &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.it.as_mut().and_then(&lt;span style="color:#f92672">|&lt;/span>it&lt;span style="color:#f92672">|&lt;/span> it.next()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(ev) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> ev, &lt;span style="color:#75715e">// æœ‰äº‹ä»¶åˆ™å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> { &lt;span style="color:#75715e">// å½“å‰è¿­ä»£å™¨è€—å°½
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.its.next() { &lt;span style="color:#75715e">// è·å–ä¸‹ä¸€ä¸ªè·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> None, &lt;span style="color:#75715e">// æ‰€æœ‰è·¯å¾„å¤„ç†å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Some((_, None)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Ok(DirEntry::new_stdin())), &lt;span style="color:#75715e">// æ ‡å‡†è¾“å…¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Some((path, Some(it))) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> { &lt;span style="color:#75715e">// æ–°è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.it &lt;span style="color:#f92672">=&lt;/span> Some(it);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> path.is_dir() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ›´æ–°å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> (ig, err) &lt;span style="color:#f92672">=&lt;/span> self.ig_root.add_parents(path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig &lt;span style="color:#f92672">=&lt;/span> ig;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(err) &lt;span style="color:#f92672">=&lt;/span> err {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Err(err));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig &lt;span style="color:#f92672">=&lt;/span> self.ig_root.clone(); &lt;span style="color:#75715e">// é‡ç½®ä¸ºæ ¹è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>; &lt;span style="color:#75715e">// ç»§ç»­å¤„ç†æ–°è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="5äº‹ä»¶å¤„ç†">5.äº‹ä»¶å¤„ç†
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">match&lt;/span> ev {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Err(Error::from_walkdir(err))),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€€å‡ºç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(WalkEvent::Exit) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig &lt;span style="color:#f92672">=&lt;/span> self.ig.parent().unwrap(); &lt;span style="color:#75715e">// æ¢å¤çˆ¶ç›®å½•çš„å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(WalkEvent::Dir(ent)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> de &lt;span style="color:#f92672">=&lt;/span> DirEntry::new_entry(ent, self.ig.clone());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>de.is_dir().unwrap_or(&lt;span style="color:#66d9ef">false&lt;/span>) { &lt;span style="color:#75715e">// å¯èƒ½æ˜¯ç¬¦å·é“¾æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Ok(de));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(err) &lt;span style="color:#f92672">=&lt;/span> de.into_error() { &lt;span style="color:#75715e">// æ£€æŸ¥é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Err(err));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åº”ç”¨å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.ig.add_child(&lt;span style="color:#f92672">&amp;amp;&lt;/span>de.path) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(Some((child_ig, err_opt))) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ig &lt;span style="color:#f92672">=&lt;/span> child_ig; &lt;span style="color:#75715e">// æ›´æ–°ä¸ºå­ç›®å½•çš„å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(err) &lt;span style="color:#f92672">=&lt;/span> err_opt {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Err(err));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(None) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {} &lt;span style="color:#75715e">// æ— å˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Err(err)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(WalkEvent::File(ent)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> de &lt;span style="color:#f92672">=&lt;/span> DirEntry::new_entry(ent, self.ig.clone());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self.skip_entry(&lt;span style="color:#f92672">&amp;amp;&lt;/span>de).unwrap_or(&lt;span style="color:#66d9ef">false&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>; &lt;span style="color:#75715e">// è·³è¿‡è¯¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(Ok(de)); &lt;span style="color:#75715e">// è¿”å›æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="walkeventiterçš„äº‹ä»¶ç”Ÿæˆ">WalkEventIterçš„äº‹ä»¶ç”Ÿæˆ
&lt;/h4>&lt;h5 id="1-æ ¸å¿ƒç»“æ„">1. æ ¸å¿ƒç»“æ„
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">WalkEventIter&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> depth: &lt;span style="color:#66d9ef">usize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> it: &lt;span style="color:#a6e22e">walkdir&lt;/span>::IntoIter,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> next: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>walkdir::DirEntry, walkdir::Error&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-åˆå§‹é˜¶æ®µ">2. åˆå§‹é˜¶æ®µ
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>WalkEventIter {depth: &lt;span style="color:#ae81ff">0&lt;/span>, it: &lt;span style="color:#a6e22e">it&lt;/span>.IntoIter, next: None }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-äº‹ä»¶ç”Ÿæˆ">3. äº‹ä»¶ç”Ÿæˆ
&lt;/h5>&lt;p>ä»&lt;code>it&lt;/code>è·å–&lt;code>DirEntry&lt;/code>ï¼Œ&lt;code>depth&lt;/code>è¡¨ç¤ºå½“å‰æ–‡ä»¶éå†æ·±åº¦ã€‚&lt;/p>
&lt;ol>
&lt;li>Exitäº‹ä»¶ç”Ÿæˆï¼šå½“æ£€æµ‹åˆ°æ·±åº¦å‡å°‘æ—¶ï¼ˆdent_depth &amp;lt; self.depthï¼‰ï¼Œè¡¨ç¤ºæ­£åœ¨ä»å­ç›®å½•è¿”å›&lt;/li>
&lt;li>&lt;strong>nextå­—æ®µ&lt;/strong>ï¼šä»…åœ¨ç”ŸæˆExitäº‹ä»¶æ—¶&lt;strong>ä¿å­˜å½“å‰æ¡ç›®&lt;/strong>ï¼Œç¡®ä¿ä¸‹æ¬¡å¤„ç†æ—¶èƒ½æ­£ç¡®å¤„ç†ï¼Œ
&lt;ul>
&lt;li>å› ä¸ºé€€å‡ºç›®å½•æ—¶ï¼Œæˆ‘ä»¬ç”Ÿæˆäº†Exitäº‹ä»¶ï¼Œ&lt;strong>å½“å‰æ¡ç›®è¢«å»¶è¿Ÿå¤„ç†äº†&lt;/strong>ï¼Œæ‰€ä»¥è¦ä¸´æ—¶ä¿å­˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>depthç®¡ç†ï¼š
&lt;ul>
&lt;li>è¿›å…¥å­ç›®å½•æ—¶ &lt;code>self.depth += 1&lt;/code>&lt;/li>
&lt;li>é€€å‡ºå­ç›®å½•æ—¶ &lt;code>self.depth -= 1&lt;/code>&lt;/li>
&lt;li>é‡åˆ°æ–°æ¡ç›®æ—¶æ›´æ–° &lt;code>self.depth = dent.depth()&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="walkparallel">WalkParallel
&lt;/h3>&lt;h5 id="1æ ¸å¿ƒæ„æˆ">1.æ ¸å¿ƒæ„æˆ
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">WalkParallel&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> paths: &lt;span style="color:#a6e22e">std&lt;/span>::vec::IntoIter&lt;span style="color:#f92672">&amp;lt;&lt;/span>PathBuf&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// è¦éå†çš„è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ig_root: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">// æ ¹ç›®å½•çš„å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> max_filesize: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u64&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æ–‡ä»¶å¤§å°é™åˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> max_depth: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">usize&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æœ€å¤§æ·±åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> follow_links: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ˜¯å¦è·Ÿè¸ªç¬¦å·é“¾æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> same_file_system: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ˜¯å¦é™åˆ¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> threads: &lt;span style="color:#66d9ef">usize&lt;/span>, &lt;span style="color:#75715e">// çº¿ç¨‹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> skip: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>Handle&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// è·³è¿‡è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> filter: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Filter&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// è‡ªå®šä¹‰è¿‡æ»¤å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Worker&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;s&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor: Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> ParallelVisitor&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// å¤„ç†æ–‡ä»¶/ç›®å½•çš„å›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> stack: &lt;span style="color:#a6e22e">Stack&lt;/span>, &lt;span style="color:#75715e">// ä»»åŠ¡æ ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> quit_now: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>AtomicBool&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æå‰ç»ˆæ­¢æ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> active_workers: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>AtomicUsize&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// æ´»è·ƒå·¥ä½œçº¿ç¨‹è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// ... å…¶ä»–çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-æ„å»ºåˆå§‹åŒ–">2. æ„å»ºåˆå§‹åŒ–
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 1. åˆ›å»ºå¹¶è¡Œéå†å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> walker &lt;span style="color:#f92672">=&lt;/span> WalkBuilder::new(&lt;span style="color:#e6db74">&amp;#34;/path&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .threads(&lt;span style="color:#ae81ff">4&lt;/span>) &lt;span style="color:#75715e">// è®¾ç½®çº¿ç¨‹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .build_parallel();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 2. è¿è¡Œéå†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>walker.run(&lt;span style="color:#f92672">||&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¯ä¸ªçº¿ç¨‹çš„åˆå§‹åŒ–ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Box::new(&lt;span style="color:#f92672">|&lt;/span>result&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ¯ä¸ªæ–‡ä»¶/ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> result {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(entry) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Found: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, entry.path().display()),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">eprintln!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error: &lt;/span>&lt;span style="color:#e6db74">{}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, err),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WalkState::Continue &lt;span style="color:#75715e">// æ§åˆ¶éå†æµç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-å…³é”®ç»„ä»¶">3. å…³é”®ç»„ä»¶
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>ParallelVisitor&lt;/strong>ï¼šå®šä¹‰å¦‚ä½•å¤„ç†éå†ç»“æœ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">trait&lt;/span> ParallelVisitor: Send {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">visit&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, entry: Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>DirEntry, Error&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">WalkState&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>Work&lt;/strong>ä»»åŠ¡å•å…ƒï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Work&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dent: &lt;span style="color:#a6e22e">DirEntry&lt;/span>, &lt;span style="color:#75715e">//ç›®å½•é¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> ignore: &lt;span style="color:#a6e22e">Ignore&lt;/span>, &lt;span style="color:#75715e">//å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> root_device: &lt;span style="color:#66d9ef">u64&lt;/span>, &lt;span style="color:#75715e">//è®¾å¤‡å·ï¼ˆç”¨äºè·¨æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="4-æ‰§è¡Œæµç¨‹">4. æ‰§è¡Œæµç¨‹
&lt;/h5>&lt;ol>
&lt;li>åˆ›å»ºå·¥ä½œçº¿ç¨‹æ± &lt;/li>
&lt;li>å°†åˆå§‹è·¯å¾„åŠ å…¥å·¥ä½œé˜Ÿåˆ—&lt;/li>
&lt;li>æ¯ä¸ªå·¥ä½œçº¿ç¨‹ï¼š
&lt;ul>
&lt;li>ä»é˜Ÿåˆ—è·å–ä»»åŠ¡&lt;/li>
&lt;li>å¤„ç†ç›®å½•é¡¹&lt;/li>
&lt;li>å‘ç°å­ç›®å½•ç”Ÿæˆæ–°ä»»åŠ¡&lt;/li>
&lt;li>å¤„ç†ignoreè§„åˆ™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="æµç¨‹è¯¦è§£">æµç¨‹è¯¦è§£
&lt;/h4>&lt;h5 id="1-åˆå§‹åŒ–é˜¶æ®µ">1. åˆå§‹åŒ–é˜¶æ®µ
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> walker &lt;span style="color:#f92672">=&lt;/span> WalkBuilder::new(&lt;span style="color:#e6db74">&amp;#34;/path&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .threads(&lt;span style="color:#ae81ff">4&lt;/span>) &lt;span style="color:#75715e">// 4ä¸ªå·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .build_parallel();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>walker.run(&lt;span style="color:#f92672">||&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¯ä¸ªçº¿ç¨‹åˆå§‹åŒ–æ—¶æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Box::new(&lt;span style="color:#f92672">|&lt;/span>result&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†æ¯ä¸ªæ–‡ä»¶/ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">{:?}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, result&lt;span style="color:#f92672">?&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WalkState::Continue
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-æ ¸å¿ƒæ–¹æ³•">2. æ ¸å¿ƒæ–¹æ³•
&lt;/h5>&lt;h6 id="21-visitæ–¹æ³•">2.1 &lt;code>visit&lt;/code>æ–¹æ³•
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">visit&lt;/span>(&lt;span style="color:#66d9ef">mut&lt;/span> self, builder: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> &lt;span style="color:#66d9ef">dyn&lt;/span> ParallelVisitorBuilder&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. åˆå§‹åŒ–å·¥ä½œé˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> threads &lt;span style="color:#f92672">=&lt;/span> self.threads();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> stack &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">vec!&lt;/span>[];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. å¤„ç†åˆå§‹è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> visitor &lt;span style="color:#f92672">=&lt;/span> builder.build();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ... å¤„ç†åˆå§‹è·¯å¾„å¹¶å¡«å…… stack ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. åˆ›å»ºå·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> quit_now &lt;span style="color:#f92672">=&lt;/span> Arc::new(AtomicBool::new(&lt;span style="color:#66d9ef">false&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> active_workers &lt;span style="color:#f92672">=&lt;/span> Arc::new(AtomicUsize::new(threads));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> stacks &lt;span style="color:#f92672">=&lt;/span> Stack::new_for_each_thread(threads, stack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. å¯åŠ¨å·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std::thread::scope(&lt;span style="color:#f92672">|&lt;/span>s&lt;span style="color:#f92672">|&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> handles: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> stacks
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .into_iter()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .map(&lt;span style="color:#f92672">|&lt;/span>stack&lt;span style="color:#f92672">|&lt;/span> Worker { &lt;span style="color:#75715e">/* ... */&lt;/span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .map(&lt;span style="color:#f92672">|&lt;/span>worker&lt;span style="color:#f92672">|&lt;/span> s.spawn(&lt;span style="color:#f92672">||&lt;/span> worker.run()))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 5. ç­‰å¾…æ‰€æœ‰å·¥ä½œçº¿ç¨‹å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> handle &lt;span style="color:#66d9ef">in&lt;/span> handles {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handle.join().unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="22-workerrunæ–¹æ³•">2.2 &lt;code>Worker::run&lt;/code>æ–¹æ³•
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>(&lt;span style="color:#66d9ef">mut&lt;/span> self) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(work) &lt;span style="color:#f92672">=&lt;/span> self.get_work() { &lt;span style="color:#75715e">//è·å–å·¥ä½œé¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> WalkState::Quit &lt;span style="color:#f92672">=&lt;/span> self.run_one(work) { &lt;span style="color:#75715e">//å¤„ç†å·¥ä½œé¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.quit_now()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="23-workerrun_oneæ–¹æ³•">2.3 &lt;code>Worker::run_one&lt;/code>æ–¹æ³•
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">run_one&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, work: &lt;span style="color:#a6e22e">Work&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">WalkState&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æœæ˜¯æ–‡ä»¶æˆ–ç¬¦å·é“¾æ¥ï¼Œç›´æ¥å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> work.is_symlink() &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#f92672">!&lt;/span>work.is_dir() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> self.visitor.visit(Ok(work.dent));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¯»å–ç›®å½•å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> readdir &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> work.read_dir() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(readdir) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> readdir,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> self.visitor.visit(Err(err)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†ç›®å½•ä¸­çš„æ¯ä¸ªæ¡ç›®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> result &lt;span style="color:#66d9ef">in&lt;/span> readdir {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> state &lt;span style="color:#f92672">=&lt;/span> self.generate_work(&lt;span style="color:#75715e">/* ... */&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> state.is_quit() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> state;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WalkState::Continue
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="24-workerget_workæ–¹æ³•">2.4 &lt;code>Worker::get_work&lt;/code>æ–¹æ³•
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">get_work&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Work&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. å…ˆå°è¯•ä»è‡ªå·±çš„é˜Ÿåˆ—è·å–å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(work) &lt;span style="color:#f92672">=&lt;/span> self.stack.pop() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(work);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. å°è¯•ä»å…¶ä»–çº¿ç¨‹çªƒå–å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(work) &lt;span style="color:#f92672">=&lt;/span> self.stack.steal() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Some(work);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. å¦‚æœéƒ½å¤±è´¥ï¼Œç­‰å¾…å·¥ä½œæˆ–é€€å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.stack.recv()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="3-å·¥ä½œæµç¨‹">3. å·¥ä½œæµç¨‹
&lt;/h5>&lt;h6 id="1-åˆå§‹åŒ–é˜¶æ®µ-1">1. åˆå§‹åŒ–é˜¶æ®µ
&lt;/h6>&lt;ul>
&lt;li>åˆ›å»ºæŒ‡å®šæ•°é‡çš„å·¥ä½œçº¿ç¨‹&lt;/li>
&lt;li>å°†åˆå§‹å·¥ä½œé¡¹åˆ†é…åˆ°å·¥ä½œé˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;h6 id="2-å·¥ä½œé˜¶æ®µ">2. å·¥ä½œé˜¶æ®µ
&lt;/h6>&lt;ul>
&lt;li>æ¯ä¸ªå·¥ä½œçº¿ç¨‹ä»è‡ªå·±çš„é˜Ÿåˆ—è·å–å·¥ä½œ&lt;/li>
&lt;li>å¤„ç†æ–‡ä»¶æˆ–éå†ç›®å½•&lt;/li>
&lt;li>å°†æ–°å‘ç°çš„å·¥ä½œæ”¾å…¥é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;h6 id="3-å·¥ä½œçªƒå–">3. å·¥ä½œçªƒå–
&lt;/h6>&lt;ul>
&lt;li>å½“çº¿ç¨‹è‡ªå·±çš„é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå°è¯•ä»å…¶ä»–çº¿ç¨‹çªƒå–å·¥ä½œ&lt;/li>
&lt;li>ä½¿ç”¨åŸå­æ“ä½œä¿è¯çº¿ç¨‹å®‰å…¨&lt;/li>
&lt;/ul>
&lt;h6 id="4-ç»ˆæ­¢æ¡ä»¶">4. ç»ˆæ­¢æ¡ä»¶
&lt;/h6>&lt;ul>
&lt;li>æ‰€æœ‰å·¥ä½œé˜Ÿåˆ—ä¸ºç©ºæ—¶&lt;/li>
&lt;li>æ‰€æœ‰å·¥ä½œçº¿ç¨‹éƒ½å¤„äºç©ºé—²çŠ¶æ€&lt;/li>
&lt;li>æ”¶åˆ°é€€å‡ºä¿¡å·&lt;/li>
&lt;/ul>
&lt;h5 id="4-å…³é”®è®¾è®¡ç‚¹">4. å…³é”®è®¾è®¡ç‚¹
&lt;/h5>&lt;ol>
&lt;li>å·¥ä½œçªƒå–ï¼šä½¿ç”¨å·¥ä½œçªƒå–ç®—æ³•å®ç°è´Ÿè½½å‡è¡¡&lt;/li>
&lt;li>æ— é”è®¾è®¡ï¼šä½¿ç”¨&lt;code>channel&lt;/code>è¿›è¡Œçº¿ç¨‹é—´é€šä¿¡&lt;/li>
&lt;li>ä¼˜é›…é€€å‡ºï¼šä½¿ç”¨åŸå­å¸ƒå°”å€¼æ§åˆ¶å·¥ä½œçº¿ç¨‹é€€å‡º&lt;/li>
&lt;li>èµ„æºç®¡ç†ï¼šä½¿ç”¨&lt;code>RAII&lt;/code>ç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾&lt;/li>
&lt;/ol>
&lt;h4 id="æ€»ç»“">æ€»ç»“
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>æ–‡ä»¶å‘ç°è·å¾—æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œä¹‹åä½¿ç”¨ç»å¯¹è·¯å¾„ä¾¿å¯è¯»å–æ–‡ä»¶å†…å®¹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¤šçº¿ç¨‹æ¨¡å¼ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆéå†ï¼Œå•çº¿ç¨‹ä½¿ç”¨äº†æ·±åº¦ä¼˜å…ˆéå†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Workeræ˜¯ä»»åŠ¡è°ƒåº¦ï¼ŒWorkæ˜¯ä»»åŠ¡å®šä¹‰ï¼ŒVisitoræ˜¯ä»»åŠ¡å¤„ç†&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ignoreçš„ç»“æ„">Ignoreçš„ç»“æ„
&lt;/h3>&lt;p>ç»“æ„ä½“&lt;code>Ignore&lt;/code>è´Ÿè´£ç®¡ç†å¿½ç•¥è§„åˆ™ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">/// Ignore is a matcher useful for recursively walking one or more directories.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span>&lt;span style="color:#75715e">#[derive(Clone, Debug)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Ignore&lt;/span>(Arc&lt;span style="color:#f92672">&amp;lt;&lt;/span>IgnoreInner&lt;span style="color:#f92672">&amp;gt;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[derive(Clone, Debug)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">IgnoreInner&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// A map of all existing directories that have already been
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">/// compiled into matchers.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">///
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">/// Note that this is never used during matching, only when adding new
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">/// parent directory matchers. This avoids needing to rebuild glob sets for
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">/// parent directories if many paths are being searched.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> compiled: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>RwLock&lt;span style="color:#f92672">&amp;lt;&lt;/span>HashMap&lt;span style="color:#f92672">&amp;lt;&lt;/span>OsString, Weak&lt;span style="color:#f92672">&amp;lt;&lt;/span>IgnoreInner&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// The path to the directory that this matcher was built from.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> dir: &lt;span style="color:#a6e22e">PathBuf&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// An override matcher (default is empty).
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> overrides: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Override&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// A file type matcher.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> types: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Types&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// The parent directory to match next.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> parent: &lt;span style="color:#a6e22e">Ignore&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether this matcher should be compiled case insensitively.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> case_insensitive: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to match hidden files.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> hidden: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to read .ignore files.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> ignore: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to respect any ignore files in parent directories.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> parents: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to read git&amp;#39;s global gitignore file.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> git_global: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to read .gitignore files.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> git_ignore: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to read .git/info/exclude files.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> git_exclude: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether to ignore files case insensitively
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> ignore_case_insensitive: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">/// Whether a git repository must be present in order to apply any
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> &lt;span style="color:#e6db74">/// git-related ignore rules.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&lt;/span> require_git: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å…³é”®ç»„ä»¶è§£æ">å…³é”®ç»„ä»¶è§£æ
&lt;/h5>&lt;ol>
&lt;li>Ignoreç»“æ„ä½“
&lt;ul>
&lt;li>ä½¿ç”¨&lt;code>Arc&lt;/code>è¿›è¡Œå¼•ç”¨è®¡æ•°ï¼Œå…è®¸å¤šçº¿ç¨‹å…±äº«&lt;/li>
&lt;li>å®é™…å®ç°åœ¨&lt;code>IgnoreInner&lt;/code>ä¸­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>IgnoreInner&lt;/code>å­—æ®µ
&lt;ul>
&lt;li>&lt;code>compiled&lt;/code>ï¼šç¼“å­˜å·²ç¼–è¯‘çš„ç›®å½•åŒ¹é…å™¨ï¼Œé¿å…é‡å¤æ„å»º&lt;/li>
&lt;li>&lt;code>dir&lt;/code>:å½“å‰åŒ¹é…å™¨å¯¹åº”çš„ç›®å½•è·¯å¾„&lt;/li>
&lt;li>&lt;code>overrides&lt;/code>ï¼šè¦†ç›–è§„åˆ™ï¼Œä¼˜å…ˆçº§æœ€é«˜&lt;/li>
&lt;li>&lt;code>types&lt;/code>ï¼šæ–‡ä»¶ç±»å‹åŒ¹é…å™¨&lt;/li>
&lt;li>&lt;code>parent&lt;/code>: çˆ¶ç›®å½•çš„åŒ¹é…å™¨ï¼Œå½¢æˆé“¾å¼ç»“æ„&lt;/li>
&lt;li>å„ç§æ ‡å¿—ä½ï¼šæ§åˆ¶å¿½ç•¥è§„åˆ™çš„è¡Œä¸º(å¦‚æ˜¯å¦å¿½ç•¥éšè—æ–‡ä»¶ã€æ˜¯å¦è¯»å–.gitignoreç­‰)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¿½ç•¥è§„åˆ™çš„ä¼˜å…ˆçº§
&lt;ul>
&lt;li>ä»é«˜åˆ°ä½
&lt;ol>
&lt;li>æ˜¾å¼è¦†ç›–è§„åˆ™(&lt;code>overrides&lt;/code>)&lt;/li>
&lt;li>å½“å‰ç›®å½•çš„.gitignore&lt;/li>
&lt;li>çˆ¶ç›®å½•çš„.gitignore&lt;/li>
&lt;li>å…¨å±€gitignore&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item><item><title>Walkå­¦ä¹ </title><link>https://www.dust-zed.site/rust/ripgrep/walk%E5%AD%A6%E4%B9%A0/</link><pubDate>Tue, 26 Aug 2025 15:01:45 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/walk%E5%AD%A6%E4%B9%A0/</guid><description>&lt;h3 id="æ ¸å¿ƒæ¶æ„åˆ†æ">æ ¸å¿ƒæ¶æ„åˆ†æ
&lt;/h3>&lt;h4 id="æ ¸å¿ƒåŠŸèƒ½">æ ¸å¿ƒåŠŸèƒ½
&lt;/h4>&lt;ul>
&lt;li>å¹¶å‘éå†(&lt;code>crossbeam_deque&lt;/code>)&lt;/li>
&lt;li>é¿å…é‡å¤å¤„ç†(&lt;code>same_file&lt;/code>)&lt;/li>
&lt;li>åŸºç¡€éå†èƒ½åŠ›(&lt;code>walkdir&lt;/code>)&lt;/li>
&lt;/ul>
&lt;h4 id="direntryçš„è®¾è®¡">DirEntryçš„è®¾è®¡
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#[derive(Debug, Clone)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">DirEntry&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dent: &lt;span style="color:#a6e22e">DirEntryInner&lt;/span>, &lt;span style="color:#75715e">//å®é™…çš„ç›®å½•æ¡ç›®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> err: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Error&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//é™„åŠ çš„é”™è¯¯ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="è®¾è®¡äº®ç‚¹">è®¾è®¡äº®ç‚¹ï¼š
&lt;/h5>&lt;ul>
&lt;li>é”™è¯¯ä¸é˜»å¡ - å³ä½¿æœ‰é”™è¯¯ä¹Ÿä¿ç•™æ¡ç›®ï¼Œåªæ˜¯é™„åŠ é”™è¯¯ä¿¡æ¯&lt;/li>
&lt;li>å†…éƒ¨æŠ½è±¡ - &lt;code>DirEntryInner&lt;/code>éšè—å…·ä½“å®ç°ç»†èŠ‚&lt;/li>
&lt;/ul>
&lt;h4 id="direntryinnerçš„è®¾è®¡">DirEntryInnerçš„è®¾è®¡
&lt;/h4>&lt;p>ä»ä»£ç å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç²¾å·§çš„å¤šæ€è®¾è®¡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">DirEntryInner&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Stdin, &lt;span style="color:#75715e">//æ ‡å‡†è¾“å…¥çš„ç‰¹æ®Šå¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> WalkDir(walkdir::DirEntry), &lt;span style="color:#75715e">//æ¥è‡ªwalkdir crateçš„æ¡ç›®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Raw(DirEntryRaw), &lt;span style="color:#75715e">//è‡ªå®šä¹‰çš„åŸå§‹æ¡ç›®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="ç»Ÿä¸€æ¥å£æ¨¡å¼">ç»Ÿä¸€æ¥å£æ¨¡å¼
&lt;/h5>&lt;p>æ¯ä¸ªæ–¹æ³•éƒ½é€šè¿‡æ¨¡å¼åŒ¹é…æä¾›ç»Ÿä¸€æ¥å£ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">path&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Path&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> &lt;span style="color:#f92672">*&lt;/span>self {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Stdin &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Path::new(&lt;span style="color:#e6db74">&amp;#34;&amp;lt;stdin&amp;gt;&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Walkdir(&lt;span style="color:#66d9ef">ref&lt;/span> x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> x.path(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Raw(&lt;span style="color:#66d9ef">ref&lt;/span> x) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> x.path(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§è®¾è®¡çš„ä»·å€¼ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç±»å‹å®‰å…¨&lt;/strong> - ç¼–è¯‘æ—¶ä¿å­˜æ‰€æœ‰å˜ä½“éƒ½è¢«å¤„ç†&lt;/li>
&lt;li>&lt;strong>æ€§èƒ½ä¼˜åŒ–&lt;/strong> - é›¶æˆæœ¬æŠ½è±¡ï¼Œè¿è¡Œæ—¶æ— è™šå‡½æ•°è°ƒç”¨å¼€é”€&lt;/li>
&lt;li>&lt;strong>æ‰©å±•æ€§&lt;/strong> - å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æ¡ç›®ç±»å‹&lt;/li>
&lt;/ol>
&lt;h4 id="direntryraw">DirEntryRaw
&lt;/h4>&lt;p>æ ¹æ®ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªé‡è¦çš„è·¨å¹³å°ä¼˜åŒ–ç­–ç•¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">DirEntryRaw&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> path: &lt;span style="color:#a6e22e">PathBuf&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ty: &lt;span style="color:#a6e22e">fileType&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> follow_link: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> depth: &lt;span style="color:#66d9ef">usize&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¹³å°ç‰¹åŒ–å­—æ®µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">#[cfg(unix)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ino: &lt;span style="color:#66d9ef">u64&lt;/span>, &lt;span style="color:#75715e">//Unix: å­˜å‚¨inodeå·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[cfg(windows)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> metadata: &lt;span style="color:#a6e22e">fs&lt;/span>::Metadata, &lt;span style="color:#75715e">//Windows:å­˜å‚¨å®Œæ•´å…ƒæ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å¹³å°ä¼˜åŒ–çš„è®¾è®¡æ€è·¯">å¹³å°ä¼˜åŒ–çš„è®¾è®¡æ€è·¯
&lt;/h5>&lt;p>&lt;strong>Unixç³»ç»Ÿ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>åªå­˜å‚¨&lt;code>inode&lt;/code>å·ï¼Œå› ä¸ºUnixæ–‡ä»¶ç³»ç»Ÿæ“ä½œç›¸å¯¹ä¾¿å®œ&lt;/li>
&lt;li>éœ€è¦æ—¶å†é€šè¿‡ç³»ç»Ÿè°ƒç”¨è·å–å®Œæ•´å…ƒæ•°æ®&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Windowsç³»ç»Ÿ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>é¢„å…ˆå­˜å‚¨å®Œæ•´çš„&lt;code>metadata&lt;/code>ï¼Œå› ä¸ºWindowsæ–‡ä»¶ç³»ç»Ÿè°ƒç”¨å¼€é”€æ¯”è¾ƒå¤§&lt;/li>
&lt;li>åœ¨ç›®å½•è¯»å–æ—¶å°±è·å–å…ƒæ•°æ®ï¼Œé¿å…åç»­é‡å¤è°ƒç”¨&lt;/li>
&lt;/ul>
&lt;h5 id="ç¬¦å·é“¾æ¥å¤„ç†é€»è¾‘">ç¬¦å·é“¾æ¥å¤„ç†é€»è¾‘
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">path_is_symlink&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.ty.is_symlink() &lt;span style="color:#f92672">||&lt;/span> self.follow_link
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µè®¤ä¸ºæ˜¯ç¬¦å·é“¾æ¥ï¼š&lt;/p>
&lt;ol>
&lt;li>çœŸæ­£çš„ç¬¦å·é“¾æ¥(&lt;code>self.ty.is_symlink()&lt;/code>)&lt;/li>
&lt;li>è·Ÿéšé“¾æ¥çš„æ¡ç›®(&lt;code>self.follow_link&lt;/code>)&lt;/li>
&lt;/ol>
&lt;h4 id="walkparallelçš„å¹¶å‘éå†æœºåˆ¶">WalkParallelçš„å¹¶å‘éå†æœºåˆ¶
&lt;/h4>&lt;p>ä»ä»£ç å¯ä»¥çœ‹åˆ°&lt;code>WalkParallel&lt;/code>çš„æ ¸å¿ƒè®¾è®¡ï¼š&lt;/p>
&lt;h5 id="å›è°ƒæ¨¡å¼è€Œéè¿­ä»£å™¨">å›è°ƒæ¨¡å¼è€Œéè¿­ä»£å™¨
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;s&lt;/span>, F&lt;span style="color:#f92672">&amp;gt;&lt;/span>(self, mkf: &lt;span style="color:#a6e22e">F&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">where&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> F: FnMut() -&amp;gt; &lt;span style="color:#a6e22e">FnVisitor&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;s&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªè®¿é—®å™¨ {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.visit(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> FnBuilder {builder: &lt;span style="color:#a6e22e">mkf&lt;/span>})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡åŸå› &lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å¹¶è¡Œè¿­ä»£å™¨éš¾ä»¥å®ç°&lt;code>Iterator&lt;/code>trait&lt;/li>
&lt;li>å›è°ƒæ¨¡å¼æ›´é€‚åˆå·¥ä½œçªƒå–ç®—æ³•&lt;/li>
&lt;li>æ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„è®¿é—®å™¨ï¼Œé¿å…åŒæ­¥å¼€é”€&lt;/li>
&lt;/ul>
&lt;h5 id="çº¿ç¨‹æ± å’Œå·¥ä½œåˆ†å‘">çº¿ç¨‹æ± å’Œå·¥ä½œåˆ†å‘
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">visit&lt;/span>(&lt;span style="color:#66d9ef">mut&lt;/span> self, builder: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> &lt;span style="color:#66d9ef">dyn&lt;/span> ParallelVisitorBuilder&lt;span style="color:#f92672">&amp;lt;&lt;/span>&amp;#39;_&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> threads &lt;span style="color:#f92672">=&lt;/span> self.threads();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> stack &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">vec!&lt;/span>[];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//ä¸ºæ¯ä¸ªæ ¹è·¯å¾„åˆ›å»ºåˆå§‹å·¥ä½œé¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> path &lt;span style="color:#66d9ef">in&lt;/span> paths {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (dent, root_device) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> path &lt;span style="color:#f92672">==&lt;/span> Path::new(&lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (DirEntry::new_stdin(), None)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//å¤„ç†æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œæ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> root_device &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.same_file_system {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> device_num(&lt;span style="color:#f92672">&amp;amp;&lt;/span>path)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œå¤„ç†">æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œå¤„ç†
&lt;/h5>&lt;p>æ³¨æ„&lt;code>same_file_system&lt;/code>çš„å¤„ç†ï¼š&lt;/p>
&lt;ul>
&lt;li>è·å–æ ¹è·¯å¾„çš„è®¾å¤‡å·(&lt;code>device_num&lt;/code>)&lt;/li>
&lt;li>éå†æ—¶æ£€æŸ¥æ˜¯å¦è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œ&lt;/li>
&lt;li>è¿™æ˜¯Unixç³»ç»Ÿä¸­çš„é‡è¦ä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;h4 id="å·¥ä½œçªƒå–å¹¶å‘æœºåˆ¶">å·¥ä½œçªƒå–å¹¶å‘æœºåˆ¶
&lt;/h4>&lt;p>ä»ä»£ç å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç²¾å·§çš„å¹¶å‘éå†å®ç°ï¼š&lt;/p>
&lt;h5 id="å·¥ä½œçªƒå–é˜Ÿåˆ—çš„è®¾è®¡">å·¥ä½œçªƒå–é˜Ÿåˆ—çš„è®¾è®¡
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ª LIFO é˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> deques: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>Deque&lt;span style="color:#f92672">&amp;lt;&lt;/span>Message&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std::iter::repeat_with(Deque::new_lifo).take(threads).collect();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åˆ›å»ºçªƒå–å™¨ï¼Œè®©æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½ä»å…¶ä»–é˜Ÿåˆ—çªƒå–å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> stealers &lt;span style="color:#f92672">=&lt;/span> Arc::&lt;span style="color:#f92672">&amp;lt;&lt;/span>[Stealer&lt;span style="color:#f92672">&amp;lt;&lt;/span>Message&lt;span style="color:#f92672">&amp;gt;&lt;/span>]&lt;span style="color:#f92672">&amp;gt;&lt;/span>::from(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> deques.iter().map(Deque::stealer).collect::&lt;span style="color:#f92672">&amp;lt;&lt;/span>Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>_&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>LIFOé˜Ÿåˆ—çš„é€‰æ‹©ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æ·±åº¦ä¼˜å…ˆéå†ï¼Œå‡å°‘å†…å­˜å ç”¨&lt;/li>
&lt;li>ä¿æŒgitignoreåŒ¹é…å™¨æ•°é‡è¾ƒä½&lt;/li>
&lt;li>å¯¹äºå®½ç›®å½•æ ‘çš„æ€§èƒ½ä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;h5 id="stackçš„çªƒå–ç­–ç•¥">Stackçš„çªƒå–ç­–ç•¥
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">steal&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Message&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…¬å¹³æ€§ï¼šä» index + 1 å¼€å§‹çªƒå–ï¼Œç„¶åç¯ç»•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> (left, right) &lt;span style="color:#f92672">=&lt;/span> self.stealers.split_at(self.index);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> right &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>right[&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">..&lt;/span>]; &lt;span style="color:#75715e">// ä¸ä»è‡ªå·±çªƒå–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> right.iter().chain(left.iter())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .map(&lt;span style="color:#f92672">|&lt;/span>s&lt;span style="color:#f92672">|&lt;/span> s.steal_batch_and_pop(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self.deque))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .find_map(&lt;span style="color:#f92672">|&lt;/span>s&lt;span style="color:#f92672">|&lt;/span> s.success())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>çªƒå–ç®—æ³•ç‰¹ç‚¹ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å…¬å¹³æ€§&lt;/strong> - è½®è¯¢å…¶ä»–çº¿ç¨‹çš„é˜Ÿåˆ—&lt;/li>
&lt;li>&lt;strong>æ‰¹é‡çªƒå–&lt;/strong> - &lt;code>steal_batch_and_pop&lt;/code>ä¸€æ¬¡çªƒå–å¤šä¸ªä»»åŠ¡&lt;/li>
&lt;li>&lt;strong>é¿å…è‡ªçªƒå–&lt;/strong> - è·³è¿‡è‡ªå·±çš„é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;h5 id="workerçš„èŒè´£åˆ†ç¦»">Workerçš„èŒè´£åˆ†ç¦»
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Worker&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">&amp;#39;s&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor: Box&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">dyn&lt;/span> ParallelVisitor &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">&amp;#39;s&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//ç”¨æˆ·å›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> stack: &lt;span style="color:#a6e22e">Stack&lt;/span>, &lt;span style="color:#75715e">//å·¥ä½œé˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> quit_now: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>AtomicBool&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//å…¨å±€é€€å‡ºä¿¡å·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> active_workers: &lt;span style="color:#a6e22e">Arc&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>AtomicUsize&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">//æ´»è·ƒå·¥ä½œçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">//...éå†é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡äº®ç‚¹&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç”Ÿäº§è€… + æ¶ˆè´¹è€…&lt;/strong> - æ—¢å¤„ç†å·¥ä½œåˆäº§ç”Ÿæ–°å·¥ä½œ&lt;/li>
&lt;li>&lt;strong>æ·±åº¦ä¼˜å…ˆ&lt;/strong> - ä½¿ç”¨æ ˆè€Œéé˜Ÿåˆ—ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨&lt;/li>
&lt;li>&lt;strong>åä½œå¼é€€å‡º&lt;/strong> - é€šè¿‡åŸå­å˜é‡åè°ƒçº¿ç¨‹é€€å‡º&lt;/li>
&lt;/ul>
&lt;h5 id="workerå¹¶å‘æ‰§è¡Œæœºåˆ¶">Workerå¹¶å‘æ‰§è¡Œæœºåˆ¶
&lt;/h5>&lt;p>&lt;strong>æ ¸å¿ƒå·¥ä½œæµç¨‹&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;code>Worker::run()&lt;/code> - ä¸»å¾ªç¯ï¼ŒæŒç»­è·å–å’Œå¤„ç†å·¥ä½œ&lt;/li>
&lt;li>&lt;code>Worker::run_one()&lt;/code> - å¤„ç†å•ä¸ªå·¥ä½œé¡¹ï¼ŒåŒ…æ‹¬ç›®å½•éå†å’Œæ–‡ä»¶è®¿é—®&lt;/li>
&lt;li>&lt;code>Worker::generate_work()&lt;/code> - ä¸ºå­ç›®å½•ç”Ÿæˆæ–°çš„å·¥ä½œé¡¹&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>å·¥ä½œçªƒå–é˜Ÿåˆ—æœºåˆ¶&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">get_work&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>Work&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> self.recv(); &lt;span style="color:#75715e">// ä»æœ¬åœ°é˜Ÿåˆ—è·å–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self.is_quit_now() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">=&lt;/span> Some(Message::Quit) &lt;span style="color:#75715e">// ä¼˜å…ˆå¤„ç†é€€å‡ºä¿¡å·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> value {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Message::Work(work)) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Some(work),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(Message::Quit) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.send_quit(); &lt;span style="color:#75715e">// ä¼ æ’­é€€å‡ºä¿¡å·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> None;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é”®ï¼šå·¥ä½œè€…å»æ¿€æ´»æœºåˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> self.deactivate_worker() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰€æœ‰å·¥ä½œè€…éƒ½ç©ºé—² = æ²¡æœ‰æ›´å¤šå·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.send_quit();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> None;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç­‰å¾…æ–°å·¥ä½œæˆ–çªƒå–å…¶ä»–é˜Ÿåˆ—çš„å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">loop&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(v) &lt;span style="color:#f92672">=&lt;/span> self.recv() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.activate_worker();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">=&lt;/span> Some(v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std::thread::sleep(Duration::from_millis(&lt;span style="color:#ae81ff">1&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="æ™ºèƒ½ç»ˆæ­¢æ£€æµ‹">æ™ºèƒ½ç»ˆæ­¢æ£€æµ‹
&lt;/h5>&lt;ul>
&lt;li>&lt;strong>åŸå­è®¡æ•°å™¨&lt;/strong>&lt;code>active_workers&lt;/code>è·Ÿè¸ªæ´»è·ƒå·¥ä½œè€…æ•°é‡&lt;/li>
&lt;li>&lt;strong>éæ¿€æ´»æœºåˆ¶&lt;/strong>ï¼šå½“å·¥ä½œè€…é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒåŸå­æ€§åœ°å‡å°‘æ´»è·ƒè®¡æ•°&lt;/li>
&lt;li>&lt;strong>å…¨å±€ç»ˆæ­¢æ£€æµ‹&lt;/strong>ï¼šå½“æ‰€æœ‰å·¥ä½œè€…éƒ½éæ¿€æ´»æ—¶ï¼Œè¯´æ˜æ²¡æœ‰æ›´å¤šçš„å·¥ä½œ&lt;/li>
&lt;li>&lt;strong>é€€å‡ºä¿¡å·ä¼ æ’­&lt;/strong>ï¼šä½¿ç”¨å¤šç±³è¯ºæ•ˆåº”å”¤é†’æ‰€æœ‰ä¼‘çœ çº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;h5 id="è¿‡æ»¤å’Œå¤„ç†é€»è¾‘">è¿‡æ»¤å’Œå¤„ç†é€»è¾‘
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">generate_work&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, ig: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Ignore&lt;/span>, depth: &lt;span style="color:#66d9ef">usize&lt;/span>, root_device: Option&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">u64&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>, result: Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>fs::DirEntry, io::Error&lt;span style="color:#f92672">&amp;gt;&lt;/span>) -&amp;gt; &lt;span style="color:#a6e22e">WalkState&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1. é”™è¯¯å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> fs_dent &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> result { &lt;span style="color:#f92672">..&lt;/span>. };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2. ç¬¦å·é“¾æ¥å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> self.follow_links &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> is_symlink {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ£€æŸ¥å¾ªç¯å¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Err(err) &lt;span style="color:#f92672">=&lt;/span> check_symlink_loop(ig, dent.path(), depth) { &lt;span style="color:#f92672">..&lt;/span>. }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3. å¤šå±‚è¿‡æ»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> should_skip_entry(ig, &lt;span style="color:#f92672">&amp;amp;&lt;/span>dent) { &lt;span style="color:#66d9ef">return&lt;/span> WalkState::Continue; } &lt;span style="color:#75715e">// ignore è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> is_stdout { &lt;span style="color:#66d9ef">return&lt;/span> WalkState::Continue; } &lt;span style="color:#75715e">// stdout æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> should_skip_filesize { &lt;span style="color:#f92672">..&lt;/span>. } &lt;span style="color:#75715e">// æ–‡ä»¶å¤§å°è¿‡æ»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> should_skip_filtered { &lt;span style="color:#f92672">..&lt;/span>. } &lt;span style="color:#75715e">// è‡ªå®šä¹‰è¿‡æ»¤å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4. ç”Ÿæˆæ–°å·¥ä½œé¡¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.send(Work { dent, ignore: &lt;span style="color:#a6e22e">ig&lt;/span>.clone(), root_device });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="å…³é”®è®¾è®¡æ¨¡å¼">å…³é”®è®¾è®¡æ¨¡å¼
&lt;/h5>&lt;ol>
&lt;li>&lt;strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼&lt;/strong>
&lt;ul>
&lt;li>æ¯ä¸ªWorkeræ—¢æ˜¯ç”Ÿäº§è€…åˆæ˜¯æ¶ˆè´¹è€…&lt;/li>
&lt;li>ä½¿ç”¨LIFOé˜Ÿåˆ—ä¿æŒæ·±åº¦ä¼˜å…ˆéå†çš„å±€éƒ¨æ€§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ä¼˜é›…ç»ˆæ­¢æ¨¡å¼&lt;/strong>
&lt;ul>
&lt;li>ä¼˜å…ˆçº§æ¶ˆæ¯ï¼šé€€å‡ºä¿¡å·ä¼˜å…ˆäºå·¥ä½œæ¶ˆæ¯&lt;/li>
&lt;li>ä¼ æ’­æœºåˆ¶ï¼šä¸€ä¸ªçº¿ç¨‹é€€å‡ºä¼šè§¦å‘æ‰€æœ‰çº¿ç¨‹é€€å‡º&lt;/li>
&lt;li>åŸå­çŠ¶æ€ç®¡ç†ï¼š ä½¿ç”¨&lt;code>AtomicBool&lt;/code>å’Œ&lt;code>AtomicUsize&lt;/code>è¿›è¡Œçº¿ç¨‹å®‰å…¨çš„çŠ¶æ€åè°ƒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é”™è¯¯æ¢å¤ç­–ç•¥&lt;/strong>
&lt;ul>
&lt;li>å•ä¸ªæ–‡ä»¶/ç›®å½•é”™è¯¯ä¸ä¼šç»ˆæ­¢æ•´ä¸ªéå†&lt;/li>
&lt;li>é”™è¯¯é€šè¿‡visitorå›è°ƒä¼ é€’ç»™ä¸Šå±‚å¤„ç†&lt;/li>
&lt;li>ç¬¦å·é“¾æ¥å¾ªç¯æ£€æµ‹é˜²æ­¢æ— é™é€’å½’&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>è¿™ä¸ªå®ç°å±•ç¤ºäº† Rust åœ¨ç³»ç»Ÿç¼–ç¨‹ä¸­çš„å¼ºå¤§èƒ½åŠ›ï¼š&lt;strong>é›¶æˆæœ¬æŠ½è±¡&lt;/strong>ã€&lt;strong>å†…å­˜å®‰å…¨çš„å¹¶å‘&lt;/strong>ã€&lt;strong>ä¼˜é›…çš„é”™è¯¯å¤„ç†&lt;/strong>ã€‚ç‰¹åˆ«æ˜¯å·¥ä½œçªƒå–é˜Ÿåˆ—å’Œæ™ºèƒ½ç»ˆæ­¢æ£€æµ‹çš„ç»“åˆï¼Œå®ç°äº†é«˜æ•ˆä¸”æ­£ç¡®çš„å¹¶è¡Œç›®å½•éå†ã€‚&lt;/p></description></item><item><title>Haystack</title><link>https://www.dust-zed.site/rust/ripgrep/haystack/</link><pubDate>Tue, 26 Aug 2025 09:21:41 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/haystack/</guid><description>&lt;p>&lt;code>haystack.rs&lt;/code>æ˜¯è¿æ¥æ–‡ä»¶å‘ç°å’Œæœç´¢æ‰§è¡Œçš„æ ¸å¿ƒæŠ½è±¡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//åœ¨main.rsä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> haystack_builder &lt;span style="color:#f92672">=&lt;/span> args.haystack_builder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> haystack &lt;span style="color:#f92672">=&lt;/span> haystack_builder.build_from_result(result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>searcher.search(&lt;span style="color:#f92672">&amp;amp;&lt;/span>haystack);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Haystack&lt;/code>æ˜¯å¯¹&lt;code>ignore::DirEntry&lt;/code>çš„åŒ…è£…ï¼Œæ·»åŠ äº†åº”ç”¨å±‚é€»è¾‘,å¯¹&lt;code>DirEntry&lt;/code>å¢åŠ äº†å‡ ç§åˆ¤æ–­ï¼Œè€Œ&lt;code>HaystackBuilder&lt;/code>åˆ™æ˜¯æ ¹æ®&lt;code>DirEntry&lt;/code>çš„ç±»å‹è¿”å›ä¸åŒçš„ç»“æœã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Haystack&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dent: &lt;span style="color:#a6e22e">ignore&lt;/span>::DirEntry,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> strip_dot_prefix: &lt;span style="color:#66d9ef">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">impl&lt;/span> Haystack {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_stdin&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_dir&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_explicit&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_file&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Haystack&lt;/code>ä¸­çš„æ–¹æ³•æŒ‡æ˜äº†æ–‡ä»¶ç±»å‹çš„å±‚æ¬¡å…³ç³»ï¼š&lt;/p>
&lt;ul>
&lt;li>æ™®é€šæ–‡ä»¶(&lt;code>is_file() == true&lt;/code>)&lt;/li>
&lt;li>ç›®å½•(&lt;code>is_dir() == true&lt;/code>)&lt;/li>
&lt;li>ç¬¦å·é“¾æ¥ (æ—¢ä¸æ˜¯æ–‡ä»¶ä¹Ÿä¸æ˜¯ç›®å½•)&lt;/li>
&lt;li>ç‰¹æ®Šæ–‡ä»¶(è®¾å¤‡ã€ç®¡é“ã€socket)&lt;/li>
&lt;/ul>
&lt;p>&lt;code>HaystackBuilder&lt;/code>æ ¹æ®å‡ ä¸ª&lt;code>is_*&lt;/code>æ–¹æ³•è¿”å›&lt;code>Option&amp;lt;Haystack&amp;gt;&lt;/code>ã€‚&lt;/p>
&lt;h4 id="haystackå¯¹direntryåŒ…è£…">Haystackå¯¹DirEntryåŒ…è£…
&lt;/h4>&lt;p>&lt;code>Haystack&lt;/code>åŒ…è£…äº†&lt;code>DirEntry&lt;/code>,è€Œä¸æ˜¯åœ¨&lt;code>DirEntry&lt;/code>ä¸­æ‰©å±•ï¼Œä½“ç°äº†å‡ ä¸ªé‡è¦çš„è®¾è®¡åŸåˆ™ï¼š&lt;/p>
&lt;h5 id="1-å…³æ³¨ç‚¹åˆ†ç¦»">1. å…³æ³¨ç‚¹åˆ†ç¦»
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ignore::DirEntry - é€šç”¨æ–‡ä»¶ç³»ç»ŸæŠ½è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// èŒè´£ï¼šæ–‡ä»¶éå†ã€åŸºç¡€å…ƒæ•°æ®ã€å¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Haystack - ripgrep ç‰¹å®šçš„æœç´¢æŠ½è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// èŒè´£ï¼šæœç´¢é€»è¾‘ã€ç”¨æˆ·æ„å›¾ç†è§£ã€åº”ç”¨å±‚ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="2-ä¸åŒçš„è¯­ä¹‰å±‚æ¬¡">2. ä¸åŒçš„è¯­ä¹‰å±‚æ¬¡
&lt;/h5>&lt;p>&lt;code>DirEntry&lt;/code>çš„è§†è§’ï¼šæ–‡ä»¶ç³»ç»Ÿæ¡ç›®&lt;/p>
&lt;ul>
&lt;li>&lt;code>is_file()&lt;/code>â†’&amp;ldquo;è¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå—ï¼Ÿ&amp;rdquo;&lt;/li>
&lt;li>&lt;code>is_dir()&lt;/code>â†’&amp;ldquo;è¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿç›®å½•å—ï¼Ÿ&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Haystack&lt;/code>çš„è§†è§’ï¼šæœç´¢ç›®æ ‡&lt;/p>
&lt;ul>
&lt;li>&lt;code>is_explicit()&lt;/code> â†’&amp;ldquo;ç”¨æˆ·æ˜ç¡®è¦æ±‚æœç´¢è¿™ä¸ªå—ï¼Ÿ&amp;rdquo;&lt;/li>
&lt;li>&lt;code>is_dir()&lt;/code>â†’ &amp;ldquo;ä»æœç´¢è§’åº¦çœ‹ï¼Œè¿™åº”è¯¥è¢«å½“ä½œç›®å½•å¤„ç†å—ï¼Ÿ&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;h5 id="3-ç¬¦å·é“¾æ¥å¤„ç†çš„å·®å¼‚">3. ç¬¦å·é“¾æ¥å¤„ç†çš„å·®å¼‚
&lt;/h5>&lt;p>æ³¨æ„&lt;code>Haystack::is_dir()&lt;/code>çš„ç‰¹æ®Šé€»è¾‘ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_dir&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> ft &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.dent.file_type() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Some(ft) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> ft,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ft.is_dir() { &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…³é”®å·®å¼‚ï¼šé¢å¤–çš„ç¬¦å·é“¾æ¥è§£æ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> self.dent.path_is_symlink() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> self.dent.path().is_dir()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªé€»è¾‘æ˜¯ripgrepç‰¹æœ‰çš„ï¼Œä¸åº”è¯¥æ±¡æŸ“é€šç”¨çš„&lt;code>DirEntry&lt;/code>&lt;/p>
&lt;h5 id="4-åº”ç”¨ç‰¹å®šçš„æ¦‚å¿µ">4. åº”ç”¨ç‰¹å®šçš„æ¦‚å¿µ
&lt;/h5>&lt;p>&lt;code>Haystack&lt;/code>å¼•å…¥äº†ripgrepç‰¹æœ‰çš„æ¦‚å¿µï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>is_explicit()&lt;/code> - åŸºäº&lt;code>depth == 0&lt;/code>åˆ¤æ–­ç”¨æˆ·æ„å›¾&lt;/li>
&lt;li>&lt;code>strip_dot_prefix&lt;/code> - UIä¼˜åŒ–åŠŸèƒ½&lt;/li>
&lt;li>æœç´¢ä¼˜å…ˆçº§ç­–ç•¥ - æ˜¾å¼ &amp;gt; æ–‡ä»¶ &amp;gt; å…¶ä»–&lt;/li>
&lt;/ul>
&lt;h5 id="5-ä¾èµ–æ–¹å‘æ§åˆ¶">5. ä¾èµ–æ–¹å‘æ§åˆ¶
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>ignore &lt;span style="color:#66d9ef">crate&lt;/span> (&lt;span style="color:#960050;background-color:#1e0010">é€šç”¨&lt;/span>) &lt;span style="color:#960050;background-color:#1e0010">â†&lt;/span> ripgrep core (&lt;span style="color:#960050;background-color:#1e0010">ç‰¹å®š&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœæŠŠ ripgrep é€»è¾‘æ”¾å…¥ DirEntryï¼Œä¼šè®©é€šç”¨åº“ä¾èµ–ç‰¹å®šåº”ç”¨ï¼Œè¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ã€‚&lt;/p>
&lt;h5 id="6-æ¶æ„ä¼˜åŠ¿">6. æ¶æ„ä¼˜åŠ¿
&lt;/h5>&lt;ol>
&lt;li>å¯æµ‹è¯•æ€§ - &lt;code>Haystack&lt;/code>çš„é€»è¾‘å¯ä»¥ç‹¬ç«‹æµ‹è¯•&lt;/li>
&lt;li>å¯æ‰©å±•æ€§ - å¯ä»¥æ·»åŠ æ›´å¤šripgrepç‰¹å®šçš„æ–¹æ³•&lt;/li>
&lt;li>å¤ç”¨æ€§ - &lt;code>ignore&lt;/code>crate å¯ä»¥è¢«å…¶ä»–å·¥å…·ä½¿ç”¨&lt;/li>
&lt;li>æ¸…æ™°æ€§ - æ¯ä¸ªç±»å‹çš„èŒè´£è¾¹ç•Œæ˜ç¡®&lt;/li>
&lt;/ol>
&lt;p>è¿™æ˜¯&lt;strong>é€‚é…å™¨æ¨¡å¼&lt;/strong>çš„ç»å…¸åº”ç”¨ï¼Œä½“ç°äº†ä¼˜ç§€çš„è½¯ä»¶æ¶æ„è®¾è®¡ã€‚&lt;/p>
&lt;h5 id="7-æŠ½è±¡å±‚æ¬¡çš„è§†è§’">7. æŠ½è±¡å±‚æ¬¡çš„è§†è§’
&lt;/h5>&lt;p>ä»&lt;code>Haystack&lt;/code>çš„è®¾è®¡å¯ä»¥å­¦åˆ°ä¼˜ç§€æ¶æ„è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³ï¼š&lt;strong>æŠ½è±¡å±‚æ¬¡çš„è§†è§’åˆ†ç¦»&lt;/strong>&lt;/p>
&lt;p>&lt;code>DirEntry&lt;/code>æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„æŠ½è±¡ï¼Œå°±åº”è¯¥ä»æ–‡ä»¶ç³»ç»Ÿè§†è§’å»æ·»åŠ ä¸€äº›æ–¹æ³•ï¼›&lt;code>Haystack&lt;/code>æ˜¯æœç´¢ç›®æ ‡çš„æŠ½è±¡ï¼Œå°±åº”è¯¥ä»æœç´¢è§’åº¦å»æ·»åŠ æ–¹æ³•ã€‚&lt;/p></description></item><item><title>HiArgså’ŒlowArgs</title><link>https://www.dust-zed.site/rust/ripgrep/hiargs%E5%92%8Clowargs/</link><pubDate>Sun, 24 Aug 2025 20:57:16 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/hiargs%E5%92%8Clowargs/</guid><description>&lt;h3 id="æ ¸å¿ƒè®¾è®¡æ¨¡å¼">æ ¸å¿ƒè®¾è®¡æ¨¡å¼
&lt;/h3>&lt;h4 id="1-ä¸¤å±‚å‚æ•°ç»“æ„">1. ä¸¤å±‚å‚æ•°ç»“æ„
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>LowArgs (&lt;span style="color:#960050;background-color:#1e0010">åŸå§‹å‚æ•°&lt;/span>) &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> HiArgs (&lt;span style="color:#960050;background-color:#1e0010">å¤„ç†åçš„é…ç½®&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡ç†å¿µ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>LowArgs&lt;/strong>ï¼šæ¥è¿‘CLIåŸå§‹è¾“å…¥ï¼Œæœ€å°éªŒè¯&lt;/li>
&lt;li>&lt;strong>HiArgs&lt;/strong>ï¼šä¸šåŠ¡å°±ç»ªçš„é…ç½®ï¼ŒåŒ…å«å¤æ‚å¯¹è±¡å’Œè®¡ç®—ç»“æœ&lt;/li>
&lt;li>&lt;strong>æœ€å°éªŒè¯&lt;/strong>ï¼šæœ€å°éªŒè¯çš„æ ¸å¿ƒæ˜¯&lt;strong>å°†ä¸å—ä¿¡ä»»æ•°æ®å¿«é€Ÿè½¬å˜ä¸ºå¯ä¿¡æ•°æ®&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h4 id="2-å­—æ®µç»„ç»‡ç­–ç•¥">2. å­—æ®µç»„ç»‡ç­–ç•¥
&lt;/h4>&lt;p>&lt;strong>ç®€å•é…ç½®å­—æ®µ&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>byte_offset: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>column: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>heading: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>quiet: &lt;span style="color:#66d9ef">bool&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ... ç›´æ¥ä»LowArgs å¤åˆ¶æˆ–ç®€å•è®¡ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å¤æ‚æ„å»ºå¯¹è±¡&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>globs: &lt;span style="color:#a6e22e">ignore&lt;/span>::overrides::Override,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pre_globs: &lt;span style="color:#a6e22e">ignore&lt;/span>::overrides::Overrode,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>types: &lt;span style="color:#a6e22e">ignore&lt;/span>::types::Types,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>patterns: &lt;span style="color:#a6e22e">Patterns&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>paths: &lt;span style="color:#a6e22e">Paths&lt;/span>,
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ç¯å¢ƒæ„ŸçŸ¥å­—æ®µ&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>is_terminal_stdout: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ£€æµ‹è¾“å‡ºç»ˆç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>mmap_choice: &lt;span style="color:#a6e22e">grep&lt;/span>::searcher::MmapChoice, &lt;span style="color:#75715e">// å†…å­˜æ˜ å°„ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>hyperlink_config: &lt;span style="color:#a6e22e">grep&lt;/span>::printer::HyperLinkConfig, &lt;span style="color:#75715e">// è¶…é“¾æ¥é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å…³é”®è®¾è®¡åŸåˆ™">å…³é”®è®¾è®¡åŸåˆ™
&lt;/h3>&lt;h4 id="1-å»¶è¿Ÿæ„å»ºæ¨¡å¼">1. å»¶è¿Ÿæ„å»ºæ¨¡å¼
&lt;/h4>&lt;p>å¤æ‚å¯¹è±¡åœ¨ &lt;code>from_low_args&lt;/code> ä¸­ç»Ÿä¸€æ„å»ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> globs &lt;span style="color:#f92672">=&lt;/span> globs(&lt;span style="color:#f92672">&amp;amp;&lt;/span>state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>low)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">// éœ€è¦æ‰€æœ‰ glob æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> types &lt;span style="color:#f92672">=&lt;/span> types(&lt;span style="color:#f92672">&amp;amp;&lt;/span>low)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">// éœ€è¦æ‰€æœ‰ç±»å‹è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> patterns &lt;span style="color:#f92672">=&lt;/span> Patterns::from_low_args(&lt;span style="color:#f92672">..&lt;/span>.)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">// éœ€è¦æ‰€æœ‰æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="2-çŠ¶æ€ä¾èµ–ç®¡ç†">2. çŠ¶æ€ä¾èµ–ç®¡ç†
&lt;/h4>&lt;p>é€šè¿‡ &lt;code>State&lt;/code> ç»“æ„ä½“ç®¡ç†ç¯å¢ƒçŠ¶æ€&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> state &lt;span style="color:#f92672">=&lt;/span> State::new()&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// state åŒ…å«ï¼šç»ˆç«¯æ£€æµ‹ã€stdin_cosumedã€å·¥ä½œç›®å½•ç­‰
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="3-é…ç½®è®¡ç®—æ¨¡å¼">3. é…ç½®è®¡ç®—æ¨¡å¼
&lt;/h4>&lt;p>æ ¹æ®ç¯å¢ƒå’Œæ ‡å¿—åŠ¨æ€è®¡ç®—æœ€ç»ˆé…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> color &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> low.color {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ColorChoice::Auto &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>state.is_terminal_stdout &lt;span style="color:#f92672">=&amp;gt;&lt;/span> ColorChoice::Never,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _ &lt;span style="color:#f92672">=&amp;gt;&lt;/span> low.color,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> heading &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> low.heading {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> None &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>low.vimgrep &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> state.is_terminal_stdout, &lt;span style="color:#75715e">// æ™ºèƒ½é»˜è®¤å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Some(value) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> value &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>low.vimgrep, &lt;span style="color:#75715e">// è€ƒè™‘æ ‡å¿—å†²çª
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>HiArgs&lt;/code> å’Œ &lt;code>LowArgs&lt;/code> è¿™ç§åˆ†å±‚è®¾è®¡ï¼Œå°†â€œè§£æâ€å’Œâ€œé…ç½®â€èŒè´£åˆ†ç¦»ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¨¡å—åŒ–ï¼Œæ¯å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œã€‚&lt;/p>
&lt;h3 id="æ ¸å¿ƒæ„å»ºæ–¹æ³•">æ ¸å¿ƒæ„å»ºæ–¹æ³•
&lt;/h3>&lt;h4 id="matcher-æ–¹æ³•çš„è®¾è®¡æ¨¡å¼">matcher() æ–¹æ³•çš„è®¾è®¡æ¨¡å¼
&lt;/h4>&lt;p>&lt;strong>ç­–ç•¥æ¨¡å¼&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pub&lt;/span>(&lt;span style="color:#66d9ef">crate&lt;/span>) &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">matcher&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>PatternMatcher&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> self.engine {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EngineChoice::Default &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.matcher_rust() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(m) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(m),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> anyhow::&lt;span style="color:#a6e22e">bail!&lt;/span>(suggest_other_engine(err.to_string())),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EngineChoice::&lt;span style="color:#66d9ef">PCRE2&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> Ok(self.matcher_pcre2()&lt;span style="color:#f92672">?&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EngineChoice::Auto &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°è¯• Rust å¼•æ“ï¼Œå¤±è´¥åˆ™å°è¯• PCRE2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> rust_err &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.matcher_rust() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(m) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Ok(m),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> err,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> pcre_err &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.matcher_pcre2() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(m) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Ok(m),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> err,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸¤ä¸ªéƒ½å¤±è´¥ï¼Œæä¾›è¯¦ç»†é”™è¯¯ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> anyhow::&lt;span style="color:#a6e22e">bail!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;regex could not be compiled with either engine...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡æ€è·¯&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„å¼•æ“ç±»å‹ï¼ŒåŠ¨æ€é€‰æ‹©ä¸åŒçš„åŒ¹é…å™¨å®ç°&lt;/li>
&lt;li>&lt;code>Auto&lt;/code> æ¨¡å¼ä½“ç°äº†ä¼˜é›…çš„é™çº§ç­–ç•¥ï¼šå…ˆå°è¯•é»˜è®¤å¼•æ“ï¼Œå¤±è´¥åˆ™å°è¯• PCRE2&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>å»ºé€ è€…æ¨¡å¼&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">matcher_rust&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>PatternMatcher&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> builder &lt;span style="color:#f92672">=&lt;/span> grep::regex::RegexMatcherBuilder::new();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .multi_line(&lt;span style="color:#66d9ef">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .unicode(&lt;span style="color:#f92672">!&lt;/span>self.no_unicode)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .octal(&lt;span style="color:#66d9ef">false&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .fixed_strings(self.fixed_strings);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ¹æ®é…ç½®é€æ­¥æ„å»º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> self.case {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CaseMode::Sensitive &lt;span style="color:#f92672">=&amp;gt;&lt;/span> builder.case_insensitive(&lt;span style="color:#66d9ef">false&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CaseMode::Insensitive &lt;span style="color:#f92672">=&amp;gt;&lt;/span> builder.case_insensitive(&lt;span style="color:#66d9ef">true&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CaseMode::Smart &lt;span style="color:#f92672">=&amp;gt;&lt;/span> builder.case_smart(&lt;span style="color:#66d9ef">true&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æœ€ç»ˆæ„å»º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> m &lt;span style="color:#f92672">=&lt;/span> builder.build_many(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self.patterns.patterns)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(PatternMatcher::RustRegex(m))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡æ€è·¯&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨å»ºé€ è€…æ¨¡å¼é€æ­¥é…ç½®å¤æ‚å¯¹è±¡&lt;/li>
&lt;li>é“¾å¼è°ƒç”¨æä¾›æµç•…çš„ API&lt;/li>
&lt;li>æœ€åè°ƒç”¨ &lt;code>build_many()&lt;/code> å®Œæˆæ„å»º&lt;/li>
&lt;/ul>
&lt;h4 id="æ¡ä»¶ç¼–è¯‘å’Œç‰¹æ€§é—¨æ§">æ¡ä»¶ç¼–è¯‘å’Œç‰¹æ€§é—¨æ§
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">matcher_pcre2&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self) -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>PatternMatcher&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[cfg(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;pcre2&amp;#34;&lt;/span>&lt;span style="color:#75715e">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// PCRE2 å®ç°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> builder &lt;span style="color:#f92672">=&lt;/span> grep::pcre2::RegexMatcherBuilder::new();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ... é…ç½®ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(PatternMatcher::&lt;span style="color:#66d9ef">PCRE2&lt;/span>(m))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#[cfg(not(feature = &lt;/span>&lt;span style="color:#e6db74">&amp;#34;pcre2&amp;#34;&lt;/span>&lt;span style="color:#75715e">))]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(anyhow::&lt;span style="color:#a6e22e">anyhow!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;PCRE2 is not available in this build&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>è®¾è®¡æ€è·¯&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä½¿ç”¨ Rust çš„æ¡ä»¶ç¼–è¯‘ç‰¹æ€§&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç‰¹æ€§å®šä¹‰ï¼ˆ&lt;code>Cargo.toml&lt;/code>ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#a6e22e">features&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">pcre2&lt;/span> = [&lt;span style="color:#e6db74">&amp;#34;grep/pcre2&amp;#34;&lt;/span>] &lt;span style="color:#960050;background-color:#1e0010">//&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">å®šä¹‰&lt;/span> &lt;span style="color:#a6e22e">pcre2&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">ç‰¹æ€§ï¼Œä¾èµ–äº&lt;/span> &lt;span style="color:#a6e22e">grep&lt;/span> &lt;span style="color:#a6e22e">crate&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">çš„&lt;/span> &lt;span style="color:#a6e22e">pcre2&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">ç‰¹æ€§&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>åœ¨ç¼–è¯‘æ—¶å†³å®šæ˜¯å¦åŒ…å« PCRE2 æ”¯æŒ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å…¶ä»–æ–¹æ³•">å…¶ä»–æ–¹æ³•
&lt;/h3>&lt;p>&lt;code>searcher()&lt;/code>ã€&lt;code>printer()&lt;/code> ç­‰å…¶ä»–æ„é€ æ–¹æ³•åŸºæœ¬é‡‡ç”¨å»ºé€ è€…æ¨¡å¼ã€‚&lt;code>search_worker()&lt;/code> æ–¹æ³•å•ç‹¬è¯´æ˜ï¼š&lt;/p>
&lt;h4 id="ç»„ä»¶ç»„åˆæ¨¡å¼">ç»„ä»¶ç»„åˆæ¨¡å¼
&lt;/h4>&lt;p>&lt;code>search_worker&lt;/code> ä½“ç°ç»å…¸çš„ &lt;strong>ç»„åˆæ¨¡å¼&lt;/strong>ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>SearchWorker
â”œâ”€â”€ PatternMatcher (æ¨¡å¼åŒ¹é…)
â”œâ”€â”€ Searcher (æ–‡ä»¶æœç´¢)
â””â”€â”€ Printer (ç»“æœè¾“å‡º)
&lt;/code>&lt;/pre>&lt;p>æ¯ä¸ªç»„ä»¶èŒè´£ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>PatternMatcher&lt;/code>ï¼šåˆ¤æ–­æ–‡æœ¬æ˜¯å¦åŒ¹é…æ¨¡å¼&lt;/li>
&lt;li>&lt;code>Searcher&lt;/code>ï¼šè¯»å–æ–‡ä»¶å†…å®¹ï¼ŒæŒ‰è¡Œå¤„ç†&lt;/li>
&lt;li>&lt;code>Printer&lt;/code>ï¼šæ ¼å¼åŒ–å¹¶è¾“å‡ºåŒ¹é…ç»“æœ&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>è®¾è®¡ä¼˜åŠ¿&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>èŒè´£åˆ†ç¦»ï¼šæ¯ä¸ªç»„ä»¶ä¸“æ³¨äºè‡ªå·±çš„åŠŸèƒ½&lt;/li>
&lt;li>å¯æµ‹è¯•æ€§ï¼šå¯ä»¥ç‹¬ç«‹æµ‹è¯•æ¯ä¸ªç»„ä»¶&lt;/li>
&lt;li>å¯æ‰©å±•æ€§ï¼šå¯ä»¥æ›¿æ¢ä»»ä½•ç»„ä»¶çš„å®ç°&lt;/li>
&lt;/ul>
&lt;h4 id="walk_builder">walk_builder()
&lt;/h4>&lt;h5 id="èŒè´£åˆ†å±‚">èŒè´£åˆ†å±‚
&lt;/h5>&lt;p>åŒ…å«å››ä¸ªæ ¸å¿ƒèŒè´£ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>è·¯å¾„ç®¡ç†&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> builder &lt;span style="color:#f92672">=&lt;/span> ignore::WalkBuilder::new(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self.paths.paths[&lt;span style="color:#ae81ff">0&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> path &lt;span style="color:#66d9ef">in&lt;/span> self.paths.paths.iter().skip(&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builder.add(path)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åˆå§‹åŒ–ï¼šä½¿ç”¨ç¬¬ä¸€ä¸ªè·¯å¾„ä½œä¸ºæ ¹è·¯å¾„&lt;/li>
&lt;li>æ‰©å±•ï¼šæ·»åŠ æ‰€æœ‰é¢å¤–çš„æœç´¢è·¯å¾„&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>&lt;strong>å¿½ç•¥æ–‡ä»¶ç³»ç»Ÿé…ç½®&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç”¨æˆ·è‡ªå®šä¹‰å¿½ç•¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.no_ignore_files {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> path &lt;span style="color:#66d9ef">in&lt;/span> self.ignore_file.iter() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(err) &lt;span style="color:#f92672">=&lt;/span> builder.add_ignore(path) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">ignore_message!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;{err}&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Git é›†æˆå¿½ç•¥è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>.git_global(&lt;span style="color:#f92672">!&lt;/span>self.no_ignore_vcs &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.no_ignore_global)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.git_ignore(&lt;span style="color:#f92672">!&lt;/span>self.no_ignore_vcs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.git_exclude(&lt;span style="color:#f92672">!&lt;/span>self.no_ignore_vcs &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.no_ignore_exclude)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é€šç”¨å¿½ç•¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>.ignore(&lt;span style="color:#f92672">!&lt;/span>self.no_ignore_dot)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.parents(&lt;span style="color:#f92672">!&lt;/span>self.no_ignore_parent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ripgrep ä¸“ç”¨å¿½ç•¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>self.no_ignore_dot {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builder.add_custom_ignore_filename(&lt;span style="color:#e6db74">&amp;#34;.rgignore&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>&lt;strong>éå†è¡Œä¸ºé…ç½®&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>builder
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .max_depth(self.max_depth) &lt;span style="color:#75715e">// æœ€å¤§é€’å½’æ·±åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .follow_links(self.follow) &lt;span style="color:#75715e">// æ˜¯å¦è·Ÿéšç¬¦å·é“¾æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .max_filesize(self.max_filesize) &lt;span style="color:#75715e">// æœ€å¤§æ–‡ä»¶å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .threads(self.threads) &lt;span style="color:#75715e">// çº¿ç¨‹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .same_file_system(self.one_file_system) &lt;span style="color:#75715e">// æ˜¯å¦é™åˆ¶åœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .skip_stdout(&lt;span style="color:#a6e22e">matches!&lt;/span>(self.mode, Mode::Search(_))) &lt;span style="color:#75715e">// è·³è¿‡æ ‡å‡†è¾“å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .hidden(&lt;span style="color:#f92672">!&lt;/span>self.hidden) &lt;span style="color:#75715e">// æ˜¯å¦åŒ…å«éšè—æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .require_git(&lt;span style="color:#f92672">!&lt;/span>self.no_require_git) &lt;span style="color:#75715e">// æ˜¯å¦è¦æ±‚ Git ä»“åº“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> .ignore_case_insensitive(self.ignore_file_case_insensitive); &lt;span style="color:#75715e">// å¿½ç•¥æ–‡ä»¶å¤§å°å†™
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>&lt;strong>é«˜çº§åŠŸèƒ½é…ç½®&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ–‡ä»¶ç±»å‹è¿‡æ»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>.overrides(self.globs.clone())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.types(self.types.clone())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ’åºä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(&lt;span style="color:#66d9ef">ref&lt;/span> sort) &lt;span style="color:#f92672">=&lt;/span> self.sort {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert_eq!&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, self.threads, &lt;span style="color:#e6db74">&amp;#34;sorting implies single threaded&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>sort.reverse &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">matches!&lt;/span>(sort.kind, SortModeKind::Path) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> builder.sort_by_file_name(&lt;span style="color:#f92672">|&lt;/span>a, b&lt;span style="color:#f92672">|&lt;/span> a.cmp(b));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>walk_builder&lt;/code> æ˜¯ç³»ç»Ÿé›†æˆç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>åº•å±‚&lt;/strong>ï¼šæ–‡ä»¶ç³»ç»Ÿéå†ï¼ˆ&lt;code>ignore::WalkBuilder&lt;/code>ï¼‰&lt;/li>
&lt;li>&lt;strong>ä¸­å±‚&lt;/strong>ï¼šå¿½ç•¥è§„åˆ™å¤„ç†ï¼ˆGitã€è‡ªå®šä¹‰ã€ç±»å‹è¿‡æ»¤ï¼‰&lt;/li>
&lt;li>&lt;strong>ä¸Šå±‚&lt;/strong>ï¼šç”¨æˆ·é…ç½®æ˜ å°„ï¼ˆå‘½ä»¤è¡Œå‚æ•°åˆ°è¡Œä¸ºï¼‰&lt;/li>
&lt;/ul>
&lt;h4 id="current_dir">current_dir()
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">current_dir&lt;/span>() -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>PathBuf&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> err &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">match&lt;/span> std::env::current_dir() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> err, &lt;span style="color:#75715e">// ä¿å­˜é”™è¯¯ï¼Œç»§ç»­å°è¯•å›é€€æ–¹æ¡ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Ok(cwd) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Ok(cwd), &lt;span style="color:#75715e">// æˆåŠŸåˆ™ç›´æ¥è¿”å›
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> Some(cwd) &lt;span style="color:#f92672">=&lt;/span> std::env::var_os(&lt;span style="color:#e6db74">&amp;#34;PWD&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">!&lt;/span>cwd.is_empty() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Ok(PathBuf::from(cwd));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> anyhow::&lt;span style="color:#a6e22e">bail!&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;failed to get current working directory: {err}&lt;/span>&lt;span style="color:#ae81ff">\n\&lt;/span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> did your CWD get deleted?&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ–¹æ³•è·å–å½“å‰å·¥ä½œç›®å½•æ—¶çš„å¼‚å¸¸å¤„ç†ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç›®å½•è¢«åˆ é™¤&lt;/strong> - è¿›ç¨‹æ‰€åœ¨ç›®å½•å¯èƒ½è¢«å…¶ä»–è¿›ç¨‹åˆ é™¤&lt;/li>
&lt;li>&lt;strong>æƒé™é—®é¢˜&lt;/strong> - æ— è¯»å–å½“å‰ç›®å½•æƒé™&lt;/li>
&lt;li>&lt;strong>ç¬¦å·é“¾æ¥é—®é¢˜&lt;/strong> - å½“å‰ç›®å½•æ˜¯æŸåçš„ç¬¦å·é“¾æ¥&lt;/li>
&lt;/ul>
&lt;p>ä¸ºä½•éœ€è¦å¤æ‚å¤„ç†ï¼Ÿ&lt;/p>
&lt;ol>
&lt;li>éœ€è¦ cwd å°†ç›¸å¯¹è·¯å¾„è½¬ç»å¯¹è·¯å¾„ï¼ˆå¦‚ &lt;code>rg &amp;quot;pattern&amp;quot; ../other_projects/&lt;/code>ï¼‰&lt;/li>
&lt;li>é€šè¿‡ &lt;code>PWD&lt;/code> ç¯å¢ƒå˜é‡å›é€€ä¿è¯å¥å£®æ€§&lt;/li>
&lt;/ol>
&lt;p>&lt;code>hiargs.rs&lt;/code> ä¸­å…¶ä»–æ–¹æ³•å‡åŸºäº &lt;code>LowArgs&lt;/code> å®Œå–„ &lt;code>HiArgs&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ ¸å¿ƒæ•°æ®ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> patterns &lt;span style="color:#f92672">=&lt;/span> Patterns::from_low_args(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> low)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> paths &lt;span style="color:#f92672">=&lt;/span> Paths::from_low_args(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>patterns, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> low)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> binary &lt;span style="color:#f92672">=&lt;/span> BinaryDetection::from_low_args(&lt;span style="color:#f92672">&amp;amp;&lt;/span>state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>low);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¾…åŠ©åŠŸèƒ½é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> colors &lt;span style="color:#f92672">=&lt;/span> take_color_specs(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> low);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> hyperlink_config &lt;span style="color:#f92672">=&lt;/span> take_hyperlink_config(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> low)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> stats &lt;span style="color:#f92672">=&lt;/span> stats(&lt;span style="color:#f92672">&amp;amp;&lt;/span>low);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> types &lt;span style="color:#f92672">=&lt;/span> types(&lt;span style="color:#f92672">&amp;amp;&lt;/span>low)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> globs &lt;span style="color:#f92672">=&lt;/span> globs(&lt;span style="color:#f92672">&amp;amp;&lt;/span>state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>low)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">// æ–‡ä»¶åŒ¹é…è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">let&lt;/span> pre_globs &lt;span style="color:#f92672">=&lt;/span> preprocessor_globs(&lt;span style="color:#f92672">&amp;amp;&lt;/span>state, &lt;span style="color:#f92672">&amp;amp;&lt;/span>low)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">// é¢„å¤„ç†å™¨è§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ ¸å¿ƒç»“æ„ä½“">æ ¸å¿ƒç»“æ„ä½“
&lt;/h3>&lt;h4 id="patterns">Patterns
&lt;/h4>&lt;p>è¡¨ç¤ºè¦åŒ¹é…çš„å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Patterns&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> patterns: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¨¡å¼æ¥æºçš„ç»Ÿä¸€å¤„ç†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">from_low_args&lt;/span>(state: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> State, low: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> LowArgs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>Patterns&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸‰ç§æ¨¡å¼æ¥æºï¼š&lt;/p>
&lt;ol>
&lt;li>positionalï¼š&lt;code>rg &amp;quot;pattern&amp;quot; file.txt&lt;/code>&lt;/li>
&lt;li>&lt;code>-e/--regexp&lt;/code>: &lt;code>rg -e &amp;quot;pattern1&amp;quot; -e &amp;quot;pattern2&amp;quot;&lt;/code>&lt;/li>
&lt;li>&lt;code>-f/--file&lt;/code>: &lt;code>rg -f patterns.txt&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>&lt;code>-e/--regexp&lt;/code> å¯¹åº” &lt;code>Pattern&lt;/code> flag çš„ update é€»è¾‘ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">update&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self, v: &lt;span style="color:#a6e22e">FlagValue&lt;/span>, args: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> LowArgs) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> regexp &lt;span style="color:#f92672">=&lt;/span> convert::string(v.unwrap_value());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> args.patterns.push(PatternSource::Regexp(regexp));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>-f/--file&lt;/code> å¯¹åº” &lt;code>File&lt;/code> flag çš„ update é€»è¾‘ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">update&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>self, v: &lt;span style="color:#a6e22e">FlagValue&lt;/span>, args: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> LowArgs) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> path &lt;span style="color:#f92672">=&lt;/span> PathBuf::from(v.unwrap_value());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> args.patterns.push(PatternSource::File(path));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Patterns::from_low_args&lt;/code> ä»ä¸‰ç§æ¥æºæ„é€ å»é‡(åˆ©ç”¨&lt;code>HashSet&lt;/code>)çš„ &lt;code>Patterns::patterns: Vec&amp;lt;String&amp;gt;&lt;/code> ã€‚&lt;code>-f file.txt, --file=file.txt&lt;/code>ä¸­&lt;code>file.txt(patternæ–‡ä»¶)&lt;/code>å­˜æ”¾ç€éœ€è¦åŒ¹é…çš„&lt;code>patterns&lt;/code>ã€‚&lt;/p>
&lt;h4 id="paths---è·¯å¾„ç®¡ç†ç³»ç»Ÿ">Paths - è·¯å¾„ç®¡ç†ç³»ç»Ÿ
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Paths&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> paths: Vec&lt;span style="color:#f92672">&amp;lt;&lt;/span>PathBuf&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#75715e">// å®é™…è·¯å¾„åˆ—è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> has_implicit_path: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ˜¯å¦æœ‰éšå¼è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> is_one_file: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// æ˜¯å¦åªæœç´¢å•ä¸ªæ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¦ä¹ˆä»&lt;code>positional&lt;/code>ä¸­è¯»å–æ–‡ä»¶è·¯å¾„ï¼Œè¦ä¹ˆå°±æ˜¯æ™ºèƒ½è·¯å¾„æ¨æ–­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">from_low_args&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> State,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Patterns&lt;/span>, &lt;span style="color:#75715e">// è™½ç„¶ä¸ä½¿ç”¨ï¼Œä½†å¼ºåˆ¶è¦æ±‚å­˜åœ¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> low: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> LowArgs,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>) -&amp;gt; &lt;span style="color:#a6e22e">anyhow&lt;/span>::Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>Paths&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> paths &lt;span style="color:#f92672">=&lt;/span> Vec::with_capacity(low.positional.len());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> osarg &lt;span style="color:#66d9ef">in&lt;/span> low.positional.drain(&lt;span style="color:#f92672">..&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> path &lt;span style="color:#f92672">=&lt;/span> PathBuf::from(osarg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> state.stdin_consumed &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> path &lt;span style="color:#f92672">==&lt;/span> Path::new(&lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> anyhow::&lt;span style="color:#a6e22e">bail!&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;error: attempted to read patterns from stdin &lt;/span>&lt;span style="color:#ae81ff">\&lt;/span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> while also searching stdin&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> paths.push(path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">..&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> use_cwd &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">!&lt;/span>is_readable_stdin
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">||&lt;/span> state.stdin_consumed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#a6e22e">matches!&lt;/span>(low.mode, Mode::Search(_));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (path, is_one_file) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> use_cwd {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (PathBuf::from(&lt;span style="color:#e6db74">&amp;#34;./&amp;#34;&lt;/span>), &lt;span style="color:#66d9ef">false&lt;/span>) &lt;span style="color:#75715e">// æœç´¢å½“å‰ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (PathBuf::from(&lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>), &lt;span style="color:#66d9ef">true&lt;/span>) &lt;span style="color:#75715e">// æœç´¢ stdin
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Paths::from_low_args()&lt;/code>å‡½æ•°ä½¿ç”¨äº†ä¸€ä¸ªéå¸¸å·§å¦™çš„&lt;strong>ç¼–è¯‘æ—¶ä¾èµ–çº¦æŸ&lt;/strong>è®¾è®¡ï¼Œè¿™ä¸ªè®¾è®¡ç¡®ä¿äº†&lt;/p>
&lt;ul>
&lt;li>è°ƒç”¨ç€å¿…é¡»å…ˆæ„é€ &lt;code>Patterns&lt;/code>&lt;/li>
&lt;li>ç¼–è¯‘å™¨ä¼šæ£€æŸ¥è¿™ä¸ªçº¦æŸ&lt;/li>
&lt;li>æ— æ³•æ„å¤–åœ°é¢ å€’è°ƒç”¨é¡ºåº&lt;/li>
&lt;/ul>
&lt;p>è®¾è®¡&lt;strong>ç¼–è¯‘æ—¶ä¾èµ–çº¦æŸ&lt;/strong>çš„åŸå› æ˜¯&lt;code>Patterns&lt;/code>å’Œ&lt;code>Paths&lt;/code>éƒ½ä½¿ç”¨äº†&lt;code>positional&lt;/code>,æ­¤æ•°æ®æ¶ˆè´¹é¡ºåºä¸å¯é¢ å€’ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Patterns::from_low_args ä¸­ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> low.patterns.is_empty() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> ospat &lt;span style="color:#f92672">=&lt;/span> low.positional.remove(&lt;span style="color:#ae81ff">0&lt;/span>); &lt;span style="color:#75715e">// æ¶ˆè´¹ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> Ok(Patterns { patterns: &lt;span style="color:#a6e22e">vec&lt;/span>&lt;span style="color:#f92672">!&lt;/span>[pat] });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Paths::from_low_args ä¸­ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">for&lt;/span> osarg &lt;span style="color:#66d9ef">in&lt;/span> low.positional.drain(&lt;span style="color:#f92672">..&lt;/span>) { &lt;span style="color:#75715e">// å¤„ç†å‰©ä½™çš„ä½ç½®å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> paths.push(PathBuf::from(osarg));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ç¼–è¯‘æ—¶ä¾èµ–çº¦æŸè®¾è®¡ä¼˜åŠ¿&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç¼–è¯‘æ—¶å®‰å…¨&lt;/strong> - ç±»å‹ç³»ç»Ÿé˜²æ­¢é”™è¯¯è°ƒç”¨é¡ºåº&lt;/li>
&lt;li>&lt;strong>è‡ªæ–‡æ¡£åŒ–&lt;/strong> - å‡½æ•°ç­¾åæ¸…æ¥šè¡¨è¾¾ä¾èµ–å…³ç³»&lt;/li>
&lt;li>&lt;strong>é›¶è¿è¡Œæ—¶æˆæœ¬&lt;/strong> - çº¦æŸåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œè¿è¡Œæ—¶æ— å¼€é”€&lt;/li>
&lt;li>&lt;strong>API æ¸…æ™°æ€§&lt;/strong> - å¼ºåˆ¶è°ƒç”¨è€…ç†è§£æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼&lt;/li>
&lt;/ol>
&lt;p>å•æ–‡ä»¶ä¼˜åŒ–æ£€æµ‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> is_one_file &lt;span style="color:#f92672">=&lt;/span> paths.len() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> (paths[&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#f92672">==&lt;/span> Path::new(&lt;span style="color:#e6db74">&amp;#34;-&amp;#34;&lt;/span>) &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#f92672">!&lt;/span>paths[&lt;span style="color:#ae81ff">0&lt;/span>].is_dir());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>!is_dir()&lt;/code> è€Œé &lt;code>is_file()&lt;/code> æ›´å‡†ç¡®&lt;/li>
&lt;li>stdin (&lt;code>-&lt;/code>) è¢«è§†ä¸ºå•æ–‡ä»¶&lt;/li>
&lt;li>å•æ–‡ä»¶æœç´¢å¯ç”¨ç‰¹å®šä¼˜åŒ–&lt;/li>
&lt;/ul>
&lt;h4 id="binarydetection---äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹ç³»ç»Ÿ">BinaryDetection - äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹ç³»ç»Ÿ
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">BinaryDetection&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> explicit: &lt;span style="color:#a6e22e">grep&lt;/span>::searcher::BinaryDetection &lt;span style="color:#75715e">// æ˜¾å¼æŒ‡å®šæ–‡ä»¶çš„æ£€æµ‹ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> implicit: &lt;span style="color:#a6e22e">grep&lt;/span>::searcher::BinaryDetection &lt;span style="color:#75715e">// éšå¼å‘ç°æ–‡ä»¶çš„æ£€æµ‹ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ˜¾å¼ vs éšå¼æ–‡ä»¶å¤„ç†&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> explicit &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> none {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> grep::searcher::BinaryDetection::none()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> grep::searcher::BinaryDetection::convert(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;\x00&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">let&lt;/span> implicit &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> none {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> grep::searcher::BinaryDetection::none()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> convert {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> grep::searcher::BinaryDetection::convert(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;\x00&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> grep::searcher::BinaryDetection::quit(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;\x00&amp;#39;&lt;/span>) &lt;span style="color:#75715e">// å…³é”®å·®å¼‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>æ˜¾å¼æ–‡ä»¶&lt;/strong>ï¼šç”¨æˆ·æ˜ç¡®æŒ‡å®šï¼Œå¿…é¡»æœç´¢ï¼Œä¸èƒ½â€œé€€å‡ºâ€&lt;/li>
&lt;li>&lt;strong>éšå¼æ–‡ä»¶&lt;/strong>ï¼šç›®å½•éå†å‘ç°ï¼Œå¯ä»¥è·³è¿‡äºŒè¿›åˆ¶æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä¸‰ç§æ£€æµ‹æ¨¡å¼&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>none&lt;/code>ï¼šç¦ç”¨äºŒè¿›åˆ¶æ£€æµ‹ï¼Œå½“ä½œæ–‡æœ¬å¤„ç† (&lt;code>--text&lt;/code> æˆ– &lt;code>--null-data&lt;/code>)&lt;/li>
&lt;li>&lt;code>convert(b'\x00')&lt;/code>ï¼šå°† null å­—èŠ‚è½¬æ¢ä¸ºæ¢è¡Œç¬¦ç»§ç»­æœç´¢ (&lt;code>--binary&lt;/code>)&lt;/li>
&lt;li>&lt;code>quit(b'\x00')&lt;/code>ï¼šé‡åˆ° null å­—èŠ‚ç«‹å³åœæ­¢æœç´¢è¯¥æ–‡ä»¶&lt;/li>
&lt;/ol>
&lt;p>é»˜è®¤ç­–ç•¥ï¼š&lt;/p>
&lt;ul>
&lt;li>æ˜¾å¼æ–‡ä»¶ï¼š&lt;code>convert(b'\x00')&lt;/code>&lt;/li>
&lt;li>éšå¼æ–‡ä»¶ï¼š&lt;code>quit(b'\x00')&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="state---è§£æçŠ¶æ€ç®¡ç†">State - è§£æçŠ¶æ€ç®¡ç†
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">State&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> is_terminal_stdout: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// stdout æ˜¯å¦è¿æ¥åˆ°ç»ˆç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> stdin_consumed: &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#75715e">// stdin æ˜¯å¦å·²è¢«æ¶ˆè´¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> cwd: &lt;span style="color:#a6e22e">PathBuf&lt;/span>, &lt;span style="color:#75715e">// å½“å‰å·¥ä½œç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>is_terminal_stdout&lt;/code>ï¼šå½±å“é¢œè‰²è¾“å‡ºã€ç¼“å†²ç­–ç•¥ç­‰ï¼ˆéœ€è·¨å¹³å°å¤„ç†ï¼‰&lt;/li>
&lt;li>&lt;code>stdin_consumed&lt;/code>ï¼šé˜²æ­¢åŒæ—¶ä» stdin è¯»å–æ¨¡å¼å’Œå†…å®¹&lt;/li>
&lt;/ul>
&lt;h3 id="ç»“æ„ä½“è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³">ç»“æ„ä½“è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³
&lt;/h3>&lt;h4 id="1-èŒè´£åˆ†ç¦»">1. èŒè´£åˆ†ç¦»
&lt;/h4>&lt;ul>
&lt;li>&lt;code>Patterns&lt;/code>ï¼šæ¨¡å¼æ”¶é›†å’Œå»é‡&lt;/li>
&lt;li>&lt;code>Paths&lt;/code>ï¼šè·¯å¾„ç®¡ç†å’Œæ¨æ–­&lt;/li>
&lt;li>&lt;code>BinaryDetection&lt;/code>ï¼šäºŒè¿›åˆ¶æ–‡ä»¶å¤„ç†ç­–ç•¥&lt;/li>
&lt;li>&lt;code>State&lt;/code>ï¼šè§£æçŠ¶æ€è·Ÿè¸ª&lt;/li>
&lt;/ul></description></item><item><title>Flagsç›¸å…³</title><link>https://www.dust-zed.site/rust/ripgrep/flags%E7%9B%B8%E5%85%B3/</link><pubDate>Sat, 23 Aug 2025 12:06:35 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/flags%E7%9B%B8%E5%85%B3/</guid><description>&lt;p>&lt;code>flag&lt;/code>æ˜¯å‘½ä»¤è¡Œä¸­çš„ä¸€ä¸ªé€‰é¡¹æˆ–å¼€å…³(ä»¥&lt;code>-&lt;/code>æˆ–&lt;code>--&lt;/code>å¼€å¤´)ï¼Œç”¨æ¥æ”¹å˜ç¨‹åºçš„è¡Œä¸ºæˆ–ä¼ å…¥å‚æ•°ã€‚&lt;/p>
&lt;h4 id="ç›¸å…³å®šä¹‰">ç›¸å…³å®šä¹‰
&lt;/h4>&lt;p>&lt;code>FlagValue&lt;/code>å¯¹flagè¿›è¡Œäº†åˆ†ç±»ï¼š&lt;code>Switch&lt;/code>&amp;mdash;-æ”¹å˜ç¨‹åºè¡Œä¸ºå’Œ&lt;code>Value&lt;/code>&amp;mdash;&amp;ndash;ä¼ å…¥å‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">FlagValue&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Switch(&lt;span style="color:#66d9ef">bool&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Value(OsString),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Flag&lt;/code> traitæŠ½è±¡å¹¶å®šä¹‰äº†â€œä¸€ä¸ªé€»è¾‘ä¸Šçš„å‘½ä»¤è¡Œé€‰é¡¹/å¼€å…³çš„å…ƒä¿¡æ¯ä¸è¡Œä¸ºï¼ˆåç§°ã€åˆ«åã€æ˜¯å¦ä¸ºå¼€å…³ã€å¸®åŠ©æ–‡æœ¬ã€ç±»åˆ«ç­‰ï¼‰â€ä»¥åŠåœ¨è§£æåå¦‚ä½•æŠŠè¯¥é€‰é¡¹çš„å€¼åº”ç”¨åˆ°ä½çº§å‚æ•°ç»“æ„&lt;code>LowArgs&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">trait&lt;/span> Flag {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">is_switch&lt;/span>() -&amp;gt; &lt;span style="color:#66d9ef">bool&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">name_&lt;/span>&lt;span style="color:#f92672">*&lt;/span>(); &lt;span style="color:#75715e">// åå­—ä¸åˆ«å/å¦å®šå
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">doc_&lt;/span>&lt;span style="color:#f92672">*&lt;/span>(); &lt;span style="color:#75715e">//å¸®åŠ©æ–‡æœ¬æ–‡æ¡£ã€å˜é‡åã€å¯é€‰å€¼åˆ—è¡¨ã€ç±»åˆ«ç­‰ï¼ˆç”¨äºç”Ÿæˆ-h/man/completionï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">completion_type&lt;/span>(); &lt;span style="color:#75715e">// ç”¨äºshellè‡ªåŠ¨è¡¥å…¨çš„å‚æ•°ç±»å‹åˆ†ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">update&lt;/span>(); &lt;span style="color:#75715e">//æŠŠè§£æå¾—åˆ°çš„FlagValueåº”ç”¨åˆ°LowArgs(åªåšéªŒè¯/èµ‹å€¼ï¼Œä¸æ‰§è¡Œæ˜‚è´µæ“ä½œ)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨æµç¨‹(ä¼ªä»£ç )&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> token &lt;span style="color:#66d9ef">in&lt;/span> argv {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (flag_impl, value) &lt;span style="color:#f92672">=&lt;/span> match_token_to_flag(token, &lt;span style="color:#66d9ef">FLAGS&lt;/span>)&lt;span style="color:#f92672">?&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flag_impl.update(value, &lt;span style="color:#f92672">&amp;amp;&lt;/span>mutual low_args)&lt;span style="color:#f92672">?&lt;/span>; &lt;span style="color:#75715e">//æ¯ä¸ªFlagæŠŠè‡ªå·±çš„è¯­ä¹‰å†™å…¥low_args
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è®¾è®¡åŸåˆ™ï¼šFlagçš„updateä¸åšå‰¯ä½œç”¨æ€§â€œåŠ¨ä½œâ€ï¼ˆå¦‚è¿è¡Œå¤–éƒ¨å‘½ä»¤ï¼‰ï¼›åªè´Ÿè´£éªŒè¯å¹¶æŠŠé…ç½®è®°å½•åˆ°LowArgsï¼Œåç»­åœ¨HiArgsé˜¶æ®µæ‰§è¡Œæ„é€ /åˆå§‹åŒ–å·¥ä½œã€‚&lt;/p>
&lt;h4 id="è§£ææµç¨‹">è§£ææµç¨‹
&lt;/h4>&lt;p>æ€»ä½“çš„è§£ææµç¨‹æ˜¯&lt;code>cliä¸­çš„token&lt;/code> &amp;mdash;&amp;ndash;&amp;gt; &lt;code>lowArgs&lt;/code> &amp;mdash;&amp;mdash;&amp;gt; &lt;code>hiArgs&lt;/code>&lt;/p>
&lt;h5 id="parse_low">parse_low
&lt;/h5>&lt;ul>
&lt;li>åŠŸèƒ½ï¼šå°†&lt;code>token&lt;/code>è§£æä¸º&lt;code>LowArgs&lt;/code>&lt;/li>
&lt;li>è¯´æ˜ï¼š&lt;code>parse_low&lt;/code>æ‰§è¡Œäº†ä¸¤æ¬¡parseï¼Œå…¶ç›®çš„æ˜¯ä¿è¯æ­£ç¡®çš„ä¼˜å…ˆçº§å’Œå‰¯ä½œç”¨æ§åˆ¶
&lt;ul>
&lt;li>ç¬¬ä¸€æ¬¡å¿«é€Ÿè§£æ(åªç”¨å‘½ä»¤è¡Œ)ç”¨äºï¼š
&lt;ul>
&lt;li>ç«‹å³è®¾ç½®æ—¥å¿—/æ¶ˆæ¯ç›¸å…³çš„å…¨å±€çŠ¶æ€(set_log_levels)ï¼Œè¿™æ ·åœ¨éšåè¯»å–å¹¶è§£æé…ç½®æ–‡ä»¶æ—¶æŒ‰ç…§CLIæŒ‡å®šçš„æ—¥å¿—çº§åˆ«è¾“å‡ºï¼ˆä¾‹å¦‚&amp;ndash;traceï¼‰&lt;/li>
&lt;li>æ£€æµ‹ç‰¹æ®Šæ¨¡å¼ï¼ˆhelp/versionï¼‰ï¼Œå¦‚æœæ˜¯specialå°±ç«‹åˆ»çŸ­è·¯è¿”å›ï¼Œä¸å»è¯»é…ç½®æ–‡ä»¶æˆ–åšæ›´å¤šçš„å·¥ä½œ&lt;/li>
&lt;li>æ£€æµ‹&lt;code>--no-config&lt;/code>æ ‡å¿—ï¼Œè‹¥å­˜åœ¨åˆ™ç›´æ¥ä½¿ç”¨ç¬¬ä¸€æ¬¡çš„ç»“æœå¹¶è¿”å›ï¼ˆä¸è¯»é…ç½®æ–‡ä»¶ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç¬¬äºŒæ¬¡å®Œæ•´è§£æï¼šæ²¡æœ‰çŸ­è·¯è¿”å›ä¸”å…è®¸è¯»é…ç½®æ–‡ä»¶ï¼Œæ‰å»è¯»å–é…ç½®æ–‡ä»¶è·å¾—config_argsï¼Œå¹¶æŠŠå®ƒä»¬ä¸åŸå§‹CLIå‚æ•°åˆå¹¶ï¼ˆconfig_argsåœ¨å‰ï¼ŒCLIå‚æ•°åœ¨åï¼Œä¿è¯CLIè¦†ç›–é…ç½®æ–‡ä»¶çš„è®¾ç½®ï¼‰ï¼Œç„¶åç¬¬äºŒæ¬¡å®Œæ•´çš„parseå‡ºæœ€ç»ˆçš„LowArgsã€‚å¦å¤–ï¼Œç¬¬äºŒæ¬¡ä¼šé‡æ–°æ„é€ ä¸€ä¸ªæ–°çš„LowArgsï¼ˆè€Œä¸æ˜¯åœ¨ç¬¬ä¸€æ¬¡çš„åŸºç¡€ä¸Šæ”¹ï¼‰ï¼Œè¿™æ ·é¿å…ç¬¬ä¸€æ¬¡è§£ææ—¶å¯èƒ½é—ç•™çš„ä¸­é—´çŠ¶æ€å½±å“æœ€ç»ˆç»“æœï¼Œä¿æŒè¯­ä¹‰æ¸…æ™°ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="parse">parse
&lt;/h5>&lt;ul>
&lt;li>
&lt;p>&lt;code>parse_low&lt;/code>è°ƒç”¨&lt;code>parse&lt;/code>æ‰§è¡Œå…·ä½“çš„è§£æé€»è¾‘&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨&lt;code>lexopt&lt;/code>è¿™ä¸ªcrateæŠŠtokenåˆ†ä¸ºäº†&lt;code>Short&lt;/code>,&lt;code>Long&lt;/code>,&lt;code>Value&lt;/code>ï¼›å…¶ä¸­&lt;code>-abc&lt;/code>ä¼šä¾æ¬¡äº§ç”Ÿ&lt;code>Short('a')&lt;/code>,&lt;code>Short('b')&lt;/code>,&lt;code>Short('c')&lt;/code>;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½œä¸ºé€‰é¡¹å‚æ•°çš„value&lt;/p>
&lt;ul>
&lt;li>ç”± parse åœ¨é‡åˆ° Short/Long åæ ¹æ®è¯¥ Flag çš„ç±»å‹å†³å®šæ˜¯å¦ç”¨ p.value() è¯»å–ï¼ˆæ”¯æŒ &amp;ndash;opt=value æˆ– &amp;ndash;opt valueï¼‰ã€‚&lt;/li>
&lt;li>è¿™ç±»å€¼è¢«å°è£…ä¸º FlagValue::Value å¹¶ä¼ å…¥ç›¸åº”çš„ Flag.update(&amp;hellip;) å»ä¿®æ”¹ LowArgs çš„å­—æ®µã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ä½ç½®å‚æ•°(positional)&lt;/p>
&lt;ul>
&lt;li>lexopt åœ¨é‡åˆ°ä¸ä»¥ &lt;code>-&lt;/code> å¼€å¤´çš„ &lt;code>token&lt;/code> æ—¶è¿”å› &lt;code>Arg::Value&lt;/code>ï¼Œparse ç›´æ¥æŠŠå®ƒ push åˆ° args.positionalã€‚&lt;/li>
&lt;li>è¿™äº›ä½ç½®å‚æ•°åœ¨åç»­ LowArgs -&amp;gt; HiArgs é˜¶æ®µè¢«è¯­ä¹‰åŒ–ï¼ˆç¬¬ä¸€ä¸ªå¯èƒ½æ˜¯ PATTERNï¼Œåé¢æ˜¯ PATHSï¼Œç‰¹æ®Šçš„ &amp;ldquo;-&amp;rdquo; è¡¨ç¤º stdin ç­‰ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Special case: -h/-Vä¸&amp;ndash;help/&amp;ndash;versionçš„çŸ­è·¯å¤„ç†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åç§°åˆ°Flagçš„æŸ¥æ‰¾ï¼š&lt;/p>
&lt;p>å…ˆç®€å•ä»‹ç»ä¸‹ç›¸å…³çš„ç±»&lt;/p>
&lt;ul>
&lt;li>&lt;code>FlagInfo&lt;/code>æ˜¯å¯¹Flagç±»çš„è¡¥å……ï¼ŒFlag traitè¡¨ç¤ºä¸€ä¸ª&amp;quot;é€»è¾‘ä¸Šçš„&amp;quot;é€‰é¡¹ï¼ˆå¸¦é•¿åã€å¯é€‰çŸ­åã€å¦å®šåã€åˆ«åä»¥åŠupdateè¡Œä¸ºï¼›FlagInfoåˆ™æ˜¯å¯¹åŒä¸€ä¸ªé€»è¾‘flagåœ¨è§£æå™¨ä¸­å…·ä½“å‡ºç°å½¢å¼ï¼ˆæŸä¸ªé•¿å/çŸ­å/åˆ«å/å¦å®šåï¼‰çš„ä¸€æ¡è®°å½•ã€‚&lt;/li>
&lt;li>&lt;code>FlagMap&lt;/code>å®é™…æ˜¯hashmap&amp;lt;vec[u8], usize&amp;gt;,usizeå¯¹åº”Vec&amp;lt;FlagInfo&amp;gt;çš„indexï¼ŒParserå°±ç»´æŠ¤äº† flagMapå’ŒVec&amp;lt;FlagInfo&amp;gt;&lt;/li>
&lt;li>&lt;code>FlagLookUp&lt;/code>æ˜¯enumç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæ ¹æ®flag nameæŸ¥æ‰¾çš„flagçš„ç»“æœï¼Œåˆ†ä¸º&lt;code>Match(&amp;amp;'a FlagInfo')&lt;/code>,&lt;code>UnrecognizedShort(char)&lt;/code>,&lt;code>UnrecognizedLong(String)&lt;/code>.&lt;/li>
&lt;/ul>
&lt;p>æ¥ç€å°±æ˜¯å¯¹lexoptè§£æå‡ºçš„short/longè¿›è¡Œå¤„ç†ï¼Œåˆ†åˆ«è°ƒç”¨&lt;code>find_short&lt;/code>å’Œ&lt;code>find_long&lt;/code>åœ¨FlagMapå’ŒVec&amp;lt;FlagInfo&amp;gt;è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¹¶è¿”å›&lt;code>FlagLookUp&lt;/code>ï¼Œæ‰¾åˆ°å¯¹åº”çš„FlagInfoå°±ä¼šä½¿ç”¨Flag traitä¸­çš„&lt;code>update&lt;/code>å¯¹æ™®é€švalueè¿›è¡Œå¤„ç†&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="ç”¨ä¾‹å­ç†Ÿæ‚‰æµç¨‹">ç”¨ä¾‹å­ç†Ÿæ‚‰æµç¨‹
&lt;/h4>&lt;p>ä»¥&lt;code>rg --json -F 'impl&amp;lt;T&amp;gt; ParseResult&amp;lt;T&amp;gt;'&lt;/code>ä¸ºä¾‹ç†Ÿæ‚‰ä¸‹æµç¨‹&lt;/p>
&lt;ol>
&lt;li>&lt;code>lexopt&lt;/code>è¯æ³•åŒ–ï¼šæŠŠ&lt;code>--json&lt;/code>ä½œä¸º&lt;code>lexopt::Arg::Long(&amp;quot;json&amp;quot;)&lt;/code>äº¤ç»™Parserã€‚&lt;/li>
&lt;li>åç§°æŸ¥æ‰¾ï¼š&lt;code>Parser::new()&lt;/code>æ„å»ºä¸€æ¬¡æ€§çš„è§£æè¡¨ï¼›&lt;code>Parser.find_long&lt;/code>åœ¨&lt;code>FlagMap&lt;/code>ä¸­æŸ¥æ‰¾,è¿”å›FlagLookup::Match(&amp;amp;FlagInfo)ã€‚&lt;/li>
&lt;li>æ„é€ FlagValueï¼Œç”±äº&lt;code>--json&lt;/code>åœ¨&lt;code>defs.rs&lt;/code>å®šä¹‰ä¸ºswitch,æ‰€ä»¥æ„é€ ä¸º&lt;code>FlagValue::Switch(true)&lt;/code>&lt;/li>
&lt;li>è°ƒç”¨&lt;code>Flag.update&lt;/code>å†™å…¥&lt;code>LowArgs&lt;/code>ï¼Œæœ¬ä¾‹å°±æ˜¯&lt;code>LowArgs.mode&lt;/code>è¢«è®¾ç½®ä¸º&lt;code>Search(JSON)&lt;/code>&lt;/li>
&lt;li>&lt;code>LowArgs&lt;/code> -&amp;gt; &lt;code>HiArgs&lt;/code>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="parsersä¸­ä¼˜ç§€çš„ç¼–ç¨‹æ€æƒ³">parse.rsä¸­ä¼˜ç§€çš„ç¼–ç¨‹æ€æƒ³
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>&lt;strong>æ˜ç¡®çš„èŒè´£åˆ†ç¦»&lt;/strong>ï¼šæŠŠâ€œè¯†åˆ«tokenï¼ˆparseï¼‰â€ã€â€œæŠŠflagå€¼å†™å…¥LowArgs(Flag::update)â€å’Œâ€œæŠŠLowArgså‡ä¸ºHiArgsï¼ˆHiArgs::from_low_argsï¼‰â€æ¸…æ™°æ‹†å¼€ï¼Œé™ä½æ¯ä¸ªæ¨¡å—å¤æ‚åº¦ï¼Œä¾¿äºæµ‹è¯•ä¸å¤ç”¨ã€‚&lt;strong>è§£æ â†’ ä¸­é—´ç»“æ„ â†’ è¿è¡Œæ—¶æ„é€ &lt;/strong>çš„åˆ†å±‚è§£æ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¸¤é˜¶æ®µè§£æä»¥æ”¯æŒé…ç½®åˆå¹¶ä¸æ—©æœŸçŸ­è·¯&lt;/strong>ï¼šå…ˆå…ˆç”¨ CLI å¿«é€Ÿè®¾ç½®æ—¥å¿—/short-circuitï¼ˆhelp/versionï¼‰ï¼Œå†åœ¨éœ€è¦æ—¶åˆå¹¶ config args å¹¶é‡æ–°è§£æï¼Œæ—¢èƒ½æ—©æœŸåé¦ˆåˆä¿æŒæœ€ç»ˆè¯­ä¹‰ä¸€è‡´&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨OnceLockåšæƒ°æ€§å…¨å±€åªè¯»åˆå§‹åŒ–ï¼šç”¨OnceLockåˆå§‹åŒ–ä¸€æ¬¡æ€§ä¸å¯å˜è§£æå™¨ï¼Œæ—¢çº¿ç¨‹å®‰å…¨åˆé¿å…é‡å¤æ„é€ å¼€é”€&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::sync::OnceLock;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> P: &lt;span style="color:#a6e22e">OnceLock&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Parser&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> OnceLock::new();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>P.get_or_init(&lt;span style="color:#f92672">||&lt;/span> {&lt;span style="color:#75715e">/* build parser*/&lt;/span> })
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç”¨trait + å®ç° å®ç°å¯æ‰©å±•æ€§ï¼ˆ&lt;strong>é¢å‘æ¥å£ç¼–ç¨‹&lt;/strong>ï¼‰: &lt;code>Flag&lt;/code> traitå®šä¹‰è¡Œä¸ºï¼Œå…·ä½“flagå®ç°åªæ”¹updateï¼Œè§£æå™¨åªä¾èµ–traitï¼Œä¸è€¦åˆå…·ä½“å®ç°ï¼Œæ–°å¢flagä»…éœ€å®ç°traitå¹¶åŠ å…¥FLAGSï¼›å›´ç»•&lt;code>Flag&lt;/code>traitå®šä¹‰äº†Flagç›¸å…³çš„structã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é¿å…è‡ªå¼•ç”¨ç»“æ„çš„æŠ€å·§ï¼ˆ&lt;strong>ç´¢å¼•æ›¿ä»£å¼•ç”¨&lt;/strong>ï¼‰ï¼šç”¨ HashMap&amp;lt;Vec&lt;u8>, usize&amp;gt; + Vec&lt;FlagInfo>ï¼ˆmap å­˜ç´¢å¼•ï¼‰ç»•å¼€åœ¨åŒä¸€ struct ä¸­å­˜æ”¾è‡ªå¼•ç”¨çš„é—®é¢˜ï¼ŒåŒæ—¶æé«˜æŸ¥æ‰¾åè®¿é—®æ•ˆç‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½çº§è§£æåº“ï¼ˆ&lt;code>lexopt&lt;/code>ï¼‰ç»“åˆè‡ªå®šä¹‰é€»è¾‘ï¼šé‡‡ç”¨ä½å±‚è§£æå™¨ä»¥è·å¾—æœ€å¤§æ§åˆ¶æƒï¼ˆæ”¯æŒ negationã€suggestã€è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯ç­‰ï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨é«˜çº§åº“å¼ºè¡Œé€‚é…ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸°å¯Œçš„é”™è¯¯ä¸Šä¸‹æ–‡ï¼ˆ&lt;code>anyhow::Context / with_context&lt;/code>ï¼‰ï¼šåœ¨å¯èƒ½å¤±è´¥çš„ç‚¹ç”¨ .with_context(|| format!(&amp;hellip;)) åŒ…è£…é”™è¯¯ï¼Œç»™å‡ºå¯¹ç”¨æˆ·/è°ƒè¯•æ›´å‹å¥½çš„ä¿¡æ¯ï¼ˆâ€œmissing value for flag â€¦â€ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ˜ç¡®åœ°æŠŠâ€œé€‰é¡¹å‚æ•°â€å’Œâ€œä½ç½®å‚æ•°â€åˆ†å¼€æ”¶é›†ä¸å¤„ç†ï¼šåœ¨parseé˜¶æ®µæŠŠpositionalç›´æ¥æ”¶é›†ï¼Œåé¢åŒä¸€è¯­ä¹‰åŒ–(pattern/path)ï¼Œæœ‰åˆ©äºä¿æŒè§£æé€»è¾‘æ•´æ´&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="æ€è€ƒ">æ€è€ƒ
&lt;/h4>&lt;ul>
&lt;li>å¦‚ä½•åšåˆ°æ°åˆ°å¥½å¤„çš„åˆ†å±‚ï¼Œæ—¢ä¸è¿‡åº¦ä¹Ÿä¸è®©æŸä¸€å±‚è¿‡äºå†—æ‚ï¼Ÿ&lt;/li>
&lt;li>é¢å‘æ¥å£/traitç¼–ç¨‹æ€è·¯çš„åˆç†åº”ç”¨ã€‚ æŠŠtraitå½“ä½œâ€&lt;strong>å¯æ’æ‹”ç‚¹&lt;/strong>â€è€Œä¸æ˜¯é»˜è®¤æ¨¡ç‰ˆ&lt;/li>
&lt;/ul></description></item><item><title>ripgrepçš„mainå‡½æ•°</title><link>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84main%E5%87%BD%E6%95%B0/</link><pubDate>Fri, 22 Aug 2025 22:03:01 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84main%E5%87%BD%E6%95%B0/</guid><description>&lt;h4 id="æ¦‚è§ˆ">æ¦‚è§ˆ
&lt;/h4>&lt;ul>
&lt;li>&lt;code>main.rs&lt;/code>&lt;/li>
&lt;li>è§’è‰²ï¼šripgrepå¯æ‰§è¡Œç¨‹åºçš„å…¥å£ï¼Œè´Ÿè´£é¡¶å±‚å‚æ•°åˆ†å‘ã€å¹¶å‘ç­–ç•¥é€‰è€…ã€é”™è¯¯ä¸é€€å‡ºç å¤„ç†ã€ä»¥åŠå‡ ç§è¿è¡Œæ¨¡å¼(search/files/types/generate/special)çš„åè°ƒã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="ä¸»è¦èŒè´£">ä¸»è¦èŒè´£
&lt;/h4>&lt;ul>
&lt;li>è°ƒç”¨flags::parse()è·å–è§£æç»“æœå¹¶äº¤ç”±run()å¤„ç†&lt;/li>
&lt;li>åœ¨é¡¶å±‚å¤„ç†run()è¿”å›çš„é”™è¯¯ï¼šBrokenPipeè¢«è§†ä¸ºä¼˜é›…é€€å‡ºï¼ˆé€€å‡ºç ä¸º0ï¼‰ï¼Œå…¶ä»–é”™è¯¯æ‰“å°å¹¶è¿”å›2ã€‚&lt;/li>
&lt;li>æ ¹æ®HiArgså’ŒModeå†³å®šå•çº¿ç¨‹æˆ–å¹¶è¡Œæ‰§è¡Œæœç´¢/åˆ—ä¸¾ç­‰é€»è¾‘ã€‚&lt;/li>
&lt;li>åœ¨æœç´¢ç»“æŸåä¾æ®åŒ¹é…æƒ…å†µã€é”™è¯¯æ ‡è®°å’Œquietæ ‡å¿—è®¡ç®—æœ€ç»ˆé€€å‡ºç  (0/1/2)ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="æ§åˆ¶æµä¼ªä»£ç ">æ§åˆ¶æµï¼ˆä¼ªä»£ç ï¼‰
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//é«˜å±‚ä¼ªä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() -&amp;gt; &lt;span style="color:#a6e22e">ExitCode&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">match&lt;/span> run(flags::parse()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(code) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> code,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Err(err) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> err.chain() contains BrokenPipe { &lt;span style="color:#66d9ef">return&lt;/span> ExitCode::from(&lt;span style="color:#ae81ff">0&lt;/span>); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> eprintln(err);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExitCode::from(&lt;span style="color:#ae81ff">2&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å…³é”®å‡½æ•°ä¸èŒè´£">å…³é”®å‡½æ•°ä¸èŒè´£
&lt;/h4>&lt;ul>
&lt;li>mainï¼šé¡¶å±‚é”™è¯¯æ•è·ä¸BrokenPipeç‰¹æ®Šå¤„ç†&lt;/li>
&lt;li>run(result): è§£åŒ…ParseResultï¼ˆErr/Special/Okï¼‰ï¼Œåˆ†æ´¾åˆ°å…·ä½“æ¨¡å¼ï¼›è®¡ç®—æœ€ç»ˆé€€å‡ºç ã€‚&lt;/li>
&lt;li>search(args, mode)ï¼šå•çº¿ç¨‹æœç´¢ã€‚æ„é€ walk -&amp;gt; haystack -&amp;gt; é¡ºåºè°ƒç”¨searcherï¼Œç»Ÿè®¡å¹¶æ‰“å°statsã€‚&lt;/li>
&lt;li>search_parallel(args, mode)ï¼šå¹¶è¡Œæœç´¢ï¼Œä½¿ç”¨walkçš„å¹¶è¡Œrunnerï¼Œworker closuerè´Ÿè´£å•æ–‡ä»¶æœç´¢ã€ç»Ÿè®¡åˆå¹¶å’Œé€šè¿‡bufwtræ‰“å°ç»“æœã€‚&lt;/li>
&lt;li>files(args)/file_parallel(args)ï¼šåˆ—å‡ºæ–‡ä»¶è·¯å¾„(å•çº¿ç¨‹/å¤šçº¿ç¨‹å®ç°ï¼Œåè€…ä½¿ç”¨æ‰“å°çº¿ç¨‹å’Œmpsc channel)ã€‚&lt;/li>
&lt;li>special(mode)ï¼šè¾“å‡ºhelp/versionç­‰çŸ­è·¯æ¨¡å¼(æœ€å°‘åˆå§‹åŒ–)&lt;/li>
&lt;li>generate(mode)ï¼šç”Ÿæˆmané¡µæˆ–shellè¡¥å…¨å¹¶å†™stdout&lt;/li>
&lt;li>print_stats(&amp;hellip;)ï¼šæ ¹æ®SearchModeè¾“å‡ºæ–‡æœ¬æˆ–JSONç»Ÿè®¡ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="é‡è¦æ¦‚å¿µä¸ç±»å‹">é‡è¦æ¦‚å¿µä¸ç±»å‹
&lt;/h4>&lt;ul>
&lt;li>HiArgsï¼šé«˜å±‚è¿è¡Œæ—¶é…ç½®ï¼ˆï¼‰&lt;/li>
&lt;li>Mode/SearchModeï¼šå†³å®šæ˜¯ Search/Files/Types/Generate/Special ä»¥åŠ JSON/text è¾“å‡ºç­‰ã€‚&lt;/li>
&lt;li>WalkStateï¼šignore crateçš„éå†æ§åˆ¶(Continue/Quit)&lt;/li>
&lt;/ul></description></item><item><title>Rustä¸­çš„IOæ“ä½œ</title><link>https://www.dust-zed.site/rust/rust%E4%B8%AD%E7%9A%84io%E6%93%8D%E4%BD%9C/</link><pubDate>Fri, 22 Aug 2025 06:01:17 +0800</pubDate><guid>https://www.dust-zed.site/rust/rust%E4%B8%AD%E7%9A%84io%E6%93%8D%E4%BD%9C/</guid><description>&lt;p>åœ¨Rustä¸­ï¼ŒI/Oæ“ä½œä¸»è¦é€šè¿‡&lt;code>Read&lt;/code>å’Œ&lt;code>Write&lt;/code>ä¸¤ä¸ªæ ¸å¿ƒtraitå®ç°ï¼Œè€Œ&lt;code>Cursor&lt;/code>ã€&lt;code>BufWriter&lt;/code>å’Œ&lt;code>ReadBuf&lt;/code>æ˜¯å›´ç»•è¿™äº›traitçš„å®ç”¨å·¥å…·ã€‚&lt;/p>
&lt;hr>
&lt;h4 id="1-readå’Œwrite-trait">1. &lt;code>Read&lt;/code>å’Œ&lt;code>Write&lt;/code> trait
&lt;/h4>&lt;h5 id="stdioread">&lt;code>std::io::Read&lt;/code>
&lt;/h5>&lt;p>&lt;strong>ä½œç”¨&lt;/strong>ï¼šä»æ•°æ®æºï¼ˆæ–‡ä»¶ã€ç½‘ç»œç­‰ï¼‰è¯»å–å­—èŠ‚æµã€‚&lt;/p>
&lt;p>&lt;strong>æ ¸å¿ƒæ–¹æ³•&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">read&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, buf: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">mut&lt;/span> [&lt;span style="color:#66d9ef">u8&lt;/span>]) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">usize&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å°è¯•è¯»å–æ•°æ®åˆ°ç¼“å†²åŒº&lt;code>buf&lt;/code>&lt;/li>
&lt;li>è¿”å›å®é™…è¯»å–çš„å­—èŠ‚æ•°(&lt;code>Ok(n)&lt;/code>)ï¼Œæˆ–é”™è¯¯ï¼ˆ&lt;code>Err(e)&lt;/code>ï¼‰&lt;/li>
&lt;li>å½“è¯»å–åˆ°EOFæ—¶è¿”å›&lt;code>Ok(0)&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>å¸¸ç”¨æ–¹æ³•&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>read_to_end(&amp;amp;mut vec)&lt;/code>:è¯»å–æ‰€æœ‰å­—èŠ‚åˆ°&lt;code>Vec&amp;lt;u8&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>read_to_string(&amp;amp;mut string)&lt;/code>:è¯»å–UTF-8å­—èŠ‚åˆ°&lt;code>String&lt;/code>&lt;/li>
&lt;li>&lt;code>read_exact(&amp;amp;mut buf)&lt;/code>:ç²¾ç¡®è¯»å–&lt;code>buf.len()&lt;/code>å­—èŠ‚ï¼Œå¦åˆ™æŠ¥é”™&lt;/li>
&lt;/ul>
&lt;h5 id="stdiowrite">&lt;code>std::io::Write&lt;/code>
&lt;/h5>&lt;p>&lt;strong>ä½œç”¨&lt;/strong>ï¼šå°†å­—èŠ‚æµå†™å…¥ç›®æ ‡&lt;/p>
&lt;p>&lt;strong>æ ¸å¿ƒæ–¹æ³•&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">write&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self, buf: &lt;span style="color:#66d9ef">&amp;amp;&lt;/span>[&lt;span style="color:#66d9ef">u8&lt;/span>]) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">usize&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">flush&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">mut&lt;/span> self) -&amp;gt; Result&lt;span style="color:#f92672">&amp;lt;&lt;/span>()&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>write&lt;/code>å°è¯•å†™å…¥ç¼“å†²åŒº&lt;code>buf&lt;/code>ï¼Œè¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°&lt;/li>
&lt;li>&lt;code>flush&lt;/code>ç¡®ä¿æ‰€æœ‰ç¼“å†²æ•°æ®å†™å…¥ç›®æ ‡ï¼ˆå¦‚ç£ç›˜ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="2-cursort">2. &lt;code>Cursor&amp;lt;T&amp;gt;&lt;/code>
&lt;/h4>&lt;p>&lt;strong>ä½œç”¨&lt;/strong>ï¼šå°†å†…å­˜ç±»å‹åŒ…è£…æˆå¯&lt;code>éšæœºè®¿é—®&lt;/code>çš„&lt;code>Read&lt;/code>/&lt;code>Write&lt;/code>å¯¹è±¡ã€‚&lt;/p>
&lt;p>&lt;strong>ç‰¹ç‚¹&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿæ–‡ä»¶æŒ‡é’ˆï¼ˆç»´æŠ¤&lt;code>position&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>å®ç°Readå’ŒWriteï¼ˆéœ€&lt;code>T: AsMut&amp;lt;[u8]&amp;gt;&lt;/code>)ï¼Œæ”¯æŒ&lt;code>Seek&lt;/code>ã€‚&lt;/li>
&lt;li>é›¶æˆæœ¬æŠ½è±¡ï¼Œé«˜æ€§èƒ½å†…å­˜æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä½¿ç”¨åœºæ™¯&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä»&lt;code>Vec&amp;lt;u8&amp;gt;&lt;/code>è¯»å–æ•°æ®ï¼Œæˆ–å†™å…¥åˆ°&lt;code>Vec&amp;lt;u8&amp;gt;&lt;/code>ã€‚&lt;/li>
&lt;li>æµ‹è¯•æ—¶ä»£æ›¿çœŸå®æ–‡ä»¶I/Oã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="3-bufwriterw">3. &lt;code>BufWriter&amp;lt;W&amp;gt;&lt;/code>
&lt;/h4>&lt;p>&lt;strong>ä½œç”¨&lt;/strong>ï¼šåŒ…è£…ä¸€ä¸ª&lt;code>Write&lt;/code>å¯¹è±¡ï¼Œæä¾›&lt;strong>å†™å…¥ç¼“å†²&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;strong>ä¼˜ç‚¹&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ç£ç›˜ã€ç½‘ç»œå†™å…¥ï¼‰ã€‚&lt;/li>
&lt;li>æ‰¹é‡å†™å…¥æé«˜æ€§èƒ½ï¼ˆé»˜è®¤ç¼“å†²åŒºå¤§å°&lt;strong>8KB&lt;/strong>ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è¡Œä¸º&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>å…ˆå†™å…¥å†…å­˜ç¼“å†²åŒºï¼Œæ»¡æ—¶è‡ªåŠ¨åˆ·æ–°åˆ°å†…éƒ¨&lt;code>W&lt;/code>ã€‚&lt;/li>
&lt;li>æ‰‹åŠ¨è°ƒç”¨&lt;code>flush()&lt;/code>æˆ–&lt;code>Drop&lt;/code>æ—¶å¼ºåˆ¶åˆ·æ–°ç¼“å†²åŒºã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="4-bufreaderr">4. &lt;code>BufReader&amp;lt;R&amp;gt;&lt;/code>
&lt;/h4>&lt;p>&lt;strong>ä½œç”¨&lt;/strong>ï¼šåŒ…è£…&lt;code>Read&lt;/code>å¯¹è±¡ï¼Œæä¾›&lt;strong>è¯»å–ç¼“å†²&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;strong>ä¼˜ç‚¹&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡å°‘é¢‘ç¹ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚è¯»å–æ–‡ä»¶æ—¶å¤šæ¬¡å°æ•°æ®è¯»å–ï¼‰&lt;/li>
&lt;li>æ”¯æŒæŒ‰è¡Œè¯»å–ï¼ˆ&lt;code>read_line&lt;/code>å’Œ&lt;code>lines&lt;/code>ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="å®Œæ•´çŸ¥è¯†å›¾è°±">å®Œæ•´çŸ¥è¯†å›¾è°±
&lt;/h4>&lt;pre tabindex="0">&lt;code>I/O æ ¸å¿ƒ Trait
â”‚
â”œâ”€â”€ Read (å­—èŠ‚æº)
â”‚ â”œâ”€â”€ å®ç°ç±»å‹ï¼šFile, TcpStream, Vec&amp;lt;u8&amp;gt;, etc.
â”‚ â”œâ”€â”€ å·¥å…·ï¼šBufReader (ç¼“å†²è¯»å–), Take (é™åˆ¶è¯»å–é•¿åº¦)
â”‚ â””â”€â”€ æ‰©å±•ï¼šBufRead (æä¾› read_line, lines ç­‰æ–¹æ³•)
â”‚
â”œâ”€â”€ Write (å­—èŠ‚ç›®æ ‡)
â”‚ â”œâ”€â”€ å®ç°ç±»å‹ï¼šFile, TcpStream, Vec&amp;lt;u8&amp;gt;, etc.
â”‚ â””â”€â”€ å·¥å…·ï¼šBufWriter (ç¼“å†²å†™å…¥), LineWriter (è¡Œç¼“å†²)
â”‚
â”œâ”€â”€ Seek (éšæœºè®¿é—®)
â”‚ â””â”€â”€ å®ç°ç±»å‹ï¼šFile, Cursor&amp;lt;T&amp;gt;
â”‚
â””â”€â”€ å†…å­˜é€‚é…å™¨
â””â”€â”€ Cursor&amp;lt;T&amp;gt; (å†…å­˜æ¨¡æ‹Ÿ I/O)
â”œâ”€â”€ æ”¯æŒï¼šRead/Write/Seek
â””â”€â”€ é€‚ç”¨ï¼šVec&amp;lt;u8&amp;gt;, &amp;amp;[u8], String, &amp;amp;str
&lt;/code>&lt;/pre>&lt;hr>
&lt;h5 id="å…³é”®åŸåˆ™">å…³é”®åŸåˆ™
&lt;/h5>&lt;p>&lt;strong>1. ç¼“å†²ä½¿ç”¨&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>BufReader/BufWriteræ€»æ˜¯æ¨èç”¨äºæ–‡ä»¶/ç½‘ç»œ I/Oã€‚&lt;/li>
&lt;li>Cursorç”¨äºå†…å­˜æ•°æ®ï¼ˆå¦‚è§£æäºŒè¿›åˆ¶æ ¼å¼ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>2. é”™è¯¯å¤„ç†&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰€æœ‰I/Oæ“ä½œè¿”å›&lt;code>Result&lt;/code>ï¼Œå¿…é¡»å¤„ç†&lt;code>Err&lt;/code>æƒ…å†µã€‚&lt;/li>
&lt;li>ç‰¹åˆ«æ³¨æ„&lt;code>flush()&lt;/code>çš„é”™è¯¯ï¼ˆå¦‚ç£ç›˜æ»¡ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>3. æ€§èƒ½&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å°æ•°æ®å†™å…¥ç”¨&lt;code>BufWriter&lt;/code>&lt;/li>
&lt;li>é¿å…é¢‘ç¹å°æ•°æ®è¯»å–ï¼ˆç¼“å†²æˆ–æ‰¹é‡åŒ–ï¼‰&lt;/li>
&lt;/ul></description></item><item><title>å¤§ç«¯åºå’Œå°ç«¯åº</title><link>https://www.dust-zed.site/rust/%E5%A4%A7%E7%AB%AF%E5%BA%8F%E5%92%8C%E5%B0%8F%E7%AB%AF%E5%BA%8F/</link><pubDate>Fri, 22 Aug 2025 03:33:16 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E5%A4%A7%E7%AB%AF%E5%BA%8F%E5%92%8C%E5%B0%8F%E7%AB%AF%E5%BA%8F/</guid><description>&lt;p>å¤§ç«¯åºå’Œå°ç«¯åºæ˜¯ä¸¤ç§ä¸åŒçš„&lt;strong>å­—èŠ‚å­˜å‚¨é¡ºåº&lt;/strong>ï¼Œç”¨äºæè¿°å¤šå­—èŠ‚æ•°æ®ï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰åœ¨è®¡ç®—æœºå†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼ã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äºå­—èŠ‚çš„æ’åˆ—é¡ºåºï¼š&lt;/p>
&lt;h4 id="å¤§ç«¯åº">å¤§ç«¯åº
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨ä½åœ°å€&lt;/strong>ï¼Œä½ä½å­—èŠ‚å­˜å‚¨åœ¨é«˜åœ°å€&lt;/li>
&lt;/ul>
&lt;h4 id="å°ç«¯åº">å°ç«¯åº
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>ä½ä½å­—èŠ‚å­˜å‚¨åœ¨ä½åœ°å€&lt;/strong>ï¼Œé«˜ä½å­—èŠ‚å­˜å‚¨åœ¨é«˜åœ°å€&lt;/li>
&lt;/ul>
&lt;p>å°ç«¯åºæ›´ç¬¦åˆè®¡ç®—æœºçš„å¤„ç†é€»è¾‘&lt;/p></description></item><item><title>éœ€è¦å¤šç†Ÿæ‚‰çš„rustè¯­æ³•</title><link>https://www.dust-zed.site/rust/%E9%9C%80%E8%A6%81%E5%A4%9A%E7%86%9F%E6%82%89%E7%9A%84rust%E8%AF%AD%E6%B3%95/</link><pubDate>Tue, 19 Aug 2025 15:02:39 +0800</pubDate><guid>https://www.dust-zed.site/rust/%E9%9C%80%E8%A6%81%E5%A4%9A%E7%86%9F%E6%82%89%E7%9A%84rust%E8%AF%AD%E6%B3%95/</guid><description>&lt;h4 id="ç»‘å®šè¿ç®—ç¬¦">@(ç»‘å®šè¿ç®—ç¬¦)
&lt;/h4>&lt;p>åœ¨Rustä¸­ï¼Œ&lt;code>@&lt;/code>è¢«ç§°ä¸ºç»‘å®šè¿ç®—ç¬¦ï¼Œç”¨äºåœ¨æ¨¡å¼åŒ¹é…çš„å€¼ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ï¼ŒåŒæ—¶å…è®¸è¿›ä¸€æ­¥è§£æ„å†…éƒ¨ç»“æ„ã€‚&lt;/p>
&lt;p>&lt;strong>å…·ä½“è§£æ&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">match&lt;/span> self.reader.read(buf) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(len) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self.size &lt;span style="color:#f92672">-=&lt;/span> len;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Ok(len)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> err &lt;span style="color:#f92672">@&lt;/span> Err(_) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>&lt;code>Ok(len)&lt;/code>åˆ†æ”¯&lt;/strong>ï¼šåŒ¹é…æˆåŠŸçš„&lt;code>Ok&lt;/code>å˜ä½“ï¼Œæå–å†…éƒ¨çš„&lt;code>len&lt;/code>å€¼ï¼Œç„¶åæ›´æ–°&lt;code>self.size&lt;/code>å¹¶è¿”å›&lt;code>Ok(len)&lt;/code>&lt;/li>
&lt;li>**&lt;code>err @ Err(_)&lt;/code>**åˆ†æ”¯ï¼š
&lt;ul>
&lt;li>&lt;code>Err(_)&lt;/code>åŒ¹é…ä»»æ„&lt;code>Err&lt;/code>å˜ä½“(ä¸å…³å¿ƒå†…éƒ¨é”™è¯¯çš„å…·ä½“å€¼)&lt;/li>
&lt;li>&lt;code>@&lt;/code>å°†æ•´ä¸ªErrçš„å€¼(å¦‚&lt;code>Err(&amp;quot;io_error&amp;quot;)&lt;/code>)ç»‘å®šåˆ°å˜é‡&lt;code>err&lt;/code>&lt;/li>
&lt;li>åˆ†æ”¯è¿”å›&lt;code>err&lt;/code>ï¼Œå³åŸå§‹çš„&lt;code>Err&lt;/code>å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>è§£æ„é»˜è®¤ä¼šå‘ç”Ÿæ‰€æœ‰æƒè½¬ç§»ï¼Œ&lt;code>let Data(inner) = &amp;amp;data;&lt;/code>ç­‰ä»·äº&lt;code>let Data(ref inner) = &amp;amp;data;&lt;/code>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="asref">AsRef
&lt;/h4>&lt;p>&lt;code>AsRef&lt;/code> traitçš„æ ¸å¿ƒä½œç”¨æ˜¯å…è®¸ä¸€ä¸ªç±»å‹ä»¥&lt;strong>é›¶å¼€é”€&lt;/strong>çš„æ–¹å¼å°†è‡ªå·±æˆ–å¼•ç”¨è½¬æ¢æˆ&lt;strong>å¦ä¸€ç§ç±»å‹çš„å¼•ç”¨&lt;/strong>ã€‚&lt;code>AsMut&lt;/code>æ˜¯&lt;code>AsRef&lt;/code>çš„å¯å˜ç‰ˆæœ¬&lt;/p>
&lt;p>&lt;strong>1. æ ¸å¿ƒæœºåˆ¶&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>AsRef&amp;lt;T&amp;gt;&lt;/code>å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š&lt;code>fn as_ref(&amp;amp;self) -&amp;gt; &amp;amp;T&lt;/code>&lt;/li>
&lt;li>å®ƒæ¥å—&lt;code>&amp;amp;self&lt;/code>ï¼Œè¿”å›ç›®æ ‡ç±»å‹&lt;code>&amp;amp;T&lt;/code>çš„å¼•ç”¨&lt;/li>
&lt;li>æœ¬è´¨ä¸Šï¼šå°†&lt;code>&amp;amp;Self&lt;/code>è½¬æ¢ä¸º&lt;code>&amp;amp;T&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>2. è½¬æ¢ç±»å‹&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å…è®¸çš„æ˜¯&lt;code>Self&lt;/code>åˆ°&lt;code>T&lt;/code>çš„å¼•ç”¨è½¬æ¢ã€‚&lt;/li>
&lt;li>ä¾‹å¦‚ï¼š
&lt;ul>
&lt;li>&lt;code>String&lt;/code>å®ç°&lt;code>AsRef&amp;lt;str&amp;gt;&lt;/code>: &lt;code>&amp;amp;String -&amp;gt; &amp;amp;str&lt;/code>&lt;/li>
&lt;li>&lt;code>Vec&amp;lt;T&amp;gt;&lt;/code> å®ç°&lt;code>AsRef&amp;lt;[T]&amp;gt;&lt;/code>: &lt;code>&amp;amp;Vec&amp;lt;T&amp;gt; -&amp;gt;&amp;amp;[T]&lt;/code>&lt;/li>
&lt;li>&lt;code>PathBuf&lt;/code>å®ç°&lt;code>AsRef&amp;lt;Path&amp;gt;&lt;/code>: &lt;code>&amp;amp;PathBuf -&amp;gt; &amp;amp;Path&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>**3. è®¾è®¡ç›®çš„ **&lt;/p>
&lt;ul>
&lt;li>æ³›å‹çµæ´»æ€§ï¼šè®©å‡½æ•°æ¥å—å¤šç§ç±»å‹å‚æ•°&lt;/li>
&lt;li>é›¶å¼€é”€æŠ½è±¡ï¼šè½¬æ¢è¿‡ç¨‹æ— é¢å¤–å †åˆ†é…æˆ–å¤åˆ¶&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="é›¶å¼€é”€">é›¶å¼€é”€
&lt;/h4>&lt;p>&lt;strong>ä»€ä¹ˆæ˜¯é›¶å¼€é”€&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æ ˆæ“ä½œå’Œå¾®å°çš„å¯„å­˜å™¨å¤åˆ¶æ˜¯å…è®¸çš„&lt;/li>
&lt;li>æ²¡æœ‰&lt;strong>å †å†…å­˜åˆ†é…&lt;/strong>ï¼šç»ä¸è°ƒç”¨å†…å­˜åˆ†é…å™¨&lt;/li>
&lt;li>æ²¡æœ‰&lt;strong>æ·±æ‹·è´&lt;/strong>ï¼šä¸å¤åˆ¶åº•å±‚æ•°æ®æœ¬èº«ï¼ˆå³ä½¿æ˜¯æ ˆä¸Šçš„è§£æ„ä¹Ÿéœ€è¦åˆç†åŒºåˆ†ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="åˆ‡ç‰‡å¼•ç”¨">åˆ‡ç‰‡å¼•ç”¨
&lt;/h4>&lt;p>&lt;strong>åˆ‡ç‰‡å¼•ç”¨æœ¬è´¨å°±æ˜¯å®½æŒ‡é’ˆ&lt;/strong>ï¼Œç”±&lt;strong>æ•°æ®æŒ‡é’ˆ&lt;/strong>å’Œ&lt;strong>é•¿åº¦&lt;/strong>ç»„æˆ&lt;/p>
&lt;hr>
&lt;h4 id="condvar">Condvar
&lt;/h4>&lt;p>åœ¨rustä¸­ï¼Œ&lt;code>Condvar&lt;/code>ï¼ˆæ¡ä»¶å˜é‡ï¼‰æ˜¯ç”¨äºçº¿ç¨‹é—´åŒæ­¥çš„æ ¸å¿ƒå·¥å…·ï¼Œé€šå¸¸ä¸&lt;code>Mutex&lt;/code>ç»“åˆä½¿ç”¨ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯è®©çº¿ç¨‹åœ¨æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶&lt;strong>ä¸»åŠ¨é˜»å¡&lt;/strong>ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹ä¿®æ”¹æ¡ä»¶å¹¶é€šçŸ¥å®ƒç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;ul>
&lt;li>ä½œç”¨ï¼šè§£å†³çº¿ç¨‹é—´çš„&lt;strong>ç­‰å¾…-é€šçŸ¥&lt;/strong>é—®é¢˜ï¼Œé¿å…busy loopingã€‚&lt;/li>
&lt;li>ä¾èµ–ï¼šå¿…é¡»ä¸&lt;code>Mutex&lt;/code>é…åˆä½¿ç”¨ï¼ˆä¿æŠ¤å…±äº«æ•°æ® + åŒæ­¥æ¡ä»¶ï¼‰&lt;/li>
&lt;li>å…¸å‹åœºæ™¯ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€ä»»åŠ¡é˜Ÿåˆ—è°ƒåº¦ã€èµ„æºæ± ç®¡ç†ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-rust" data-lang="rust">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::sync::{Arc, Mutex, Condvar};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> std::thread;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fn&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//åˆ›å»ºå…±äº«æ•°æ®ç»“æ„ï¼š(Mutex&amp;lt;bool&amp;gt;, Condvar)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> pair &lt;span style="color:#f92672">=&lt;/span> Arc::new(Mutex::new(&lt;span style="color:#66d9ef">false&lt;/span>), Condvar::new()));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> pair_clone &lt;span style="color:#f92672">=&lt;/span> Arc::clone(&lt;span style="color:#f92672">&amp;amp;&lt;/span>pair);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> consumer &lt;span style="color:#f92672">=&lt;/span> thread::spawn(&lt;span style="color:#66d9ef">move&lt;/span> &lt;span style="color:#f92672">||&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (lock, cvar) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;*&lt;/span>pair_clone;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> condition &lt;span style="color:#f92672">=&lt;/span> lock.lock().unwarp();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//ç­‰æ¡ä»¶æ»¡è¶³
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#f92672">!*&lt;/span>condition {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//é‡Šæ”¾é”å¹¶é˜»å¡ï¼Œè¢«å”¤é†’å(waitè¿”å›å)é‡æ–°è·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> condition &lt;span style="color:#f92672">=&lt;/span> cvar.wait(condition).unwarp();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;æ¶ˆè´¹è€…ï¼šæ¡ä»¶å·²æ»¡è¶³ï¼ç»§ç»­æ‰§è¡Œ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//æ¶ˆè´¹è€…çš„å¤„ç†é€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> thread::sleep(Duration::from_secs(&lt;span style="color:#ae81ff">1&lt;/span>));&lt;span style="color:#75715e">//æ¨¡æ‹Ÿå·¥ä½œè€—æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> (lock, cvar) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;*&lt;/span>pair;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#66d9ef">mut&lt;/span> condition &lt;span style="color:#f92672">=&lt;/span> lock.lock().unwarp();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ç”Ÿäº§è€…ï¼šæ›´æ–°æ¡ä»¶å¹¶é€šçŸ¥æ¶ˆè´¹è€…...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>condition &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šçŸ¥ä¸€ä¸ªç­‰å¾…çš„æ¶ˆè´¹è€…çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> cvar.notify_one();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.join().unwrap();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">println!&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ä¸»çº¿ç¨‹: æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæˆ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="pin">PIN
&lt;/h4>&lt;hr>
&lt;p>&lt;strong>&lt;code>haystack&lt;/code>&lt;strong>å‘½åæºè‡ªè‹±è¯­è°šè¯­&lt;/strong>&amp;ldquo;looking for a needle in a haystack&amp;rdquo;&lt;/strong>(å¤§æµ·æé’ˆ),&lt;code>haystack&lt;/code>è¡¨ç¤ºè¢«æœç´¢çš„&lt;strong>ä¸»ä½“æ•°æ®&lt;/strong>ï¼Œ&lt;code>needle&lt;/code>è¡¨ç¤ºå¾…æŸ¥æ‰¾çš„&lt;strong>ç›®æ ‡å…ƒç´ &lt;/strong>.&lt;/p>
&lt;p>rustä¸­æœ‰ä¸¤ç§è§£å¼•ç”¨çš„æ–¹å¼ï¼š&lt;strong>&lt;code>*&lt;/code>&lt;strong>å’Œ&lt;/strong>æ¨¡å¼åŒ¹é…è§£å¼•ç”¨&lt;/strong>&lt;/p>
&lt;hr>
&lt;h4 id="unicodeasciiå’Œutf-8ç­‰">Unicodeã€ASCIIå’ŒUTF-8ç­‰
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Unicode&lt;/strong>ä¸ºæ‰€æœ‰å­—ç¬¦åˆ†é…äº†å”¯ä¸€æ ‡è¯†(ç§°ä¸º&lt;strong>ç ç‚¹&lt;/strong>)&lt;/li>
&lt;li>&lt;strong>UTF-8&lt;/strong>ç­‰æ˜¯éœ€è¦å°†è¿™äº›ç ç‚¹è½¬æ¢ä¸ºç”¨äºå­˜å‚¨/ä¼ è¾“çš„&lt;strong>å­—èŠ‚åºåˆ—&lt;/strong>,æ ¹æ®&lt;strong>ç ç‚¹å€¼çš„èŒƒå›´åˆ†ç±»&lt;/strong>ï¼Œç¡®å®šå­—èŠ‚åºåˆ—çš„&lt;strong>é•¿åº¦&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>ASCII&lt;/strong>æ˜¯Unicodeå’ŒUTF-8çš„&lt;strong>ç‰¹æ®Šå…¼å®¹å­é›†&lt;/strong>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="å­—ç¬¦æ•°æ®">å­—ç¬¦æ•°æ®
&lt;/h4>&lt;ul>
&lt;li>&lt;code>b&lt;/code>å‰ç¼€æ ‡è¯†çš„æ•°æ®ï¼šè¡¨ç¤º&lt;code>ASCII&lt;/code>å­—ç¬¦é›†çš„å­—èŠ‚æ•°æ®ï¼Œç±»å‹ä¸º&lt;code>u8&lt;/code>æˆ–&lt;code>&amp;amp;[u8]&lt;/code>&lt;/li>
&lt;li>&lt;code>&amp;amp;str&lt;/code>å’Œ&lt;code>&amp;amp;[u8]&lt;/code>ï¼š&lt;code>&amp;amp;str&lt;/code>æ˜¯utf-8ç¼–ç çš„åˆ‡ç‰‡å¼•ç”¨ä¸”ä¸å¯å˜ï¼Œ&lt;code>&amp;amp;[u8]&lt;/code>æ˜¯å¯¹åŸå§‹å­—èŠ‚çš„åˆ‡ç‰‡å¼•ç”¨ï¼Œå¯å˜ç‰ˆæœ¬æ˜¯&lt;code>&amp;amp;mut [u8]&lt;/code>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h4 id="ä¸ºä»€ä¹ˆå¯ä»¥æ‰‹åŠ¨è°ƒç”¨dropxè€Œä¸èƒ½è°ƒç”¨xdrop">ä¸ºä»€ä¹ˆå¯ä»¥æ‰‹åŠ¨è°ƒç”¨drop(x)è€Œä¸èƒ½è°ƒç”¨x.drop()
&lt;/h4>&lt;p>å…³é”®åœ¨äº&lt;strong>æ‰€æœ‰æƒ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>std::mem::drop&amp;lt;T&amp;gt;(_x: T)&lt;/code>è½¬ç§»äº†æ‰€æœ‰æƒï¼Œ_xç¦»å¼€dropå‡½æ•°ä½œç”¨åŸŸï¼Œ&lt;strong>è‡ªåŠ¨è§¦å‘ææ„é€»è¾‘&lt;/strong>ï¼ˆè°ƒç”¨&lt;code>Drop::drop&lt;/code> traitçš„å®ç°ï¼‰&lt;/li>
&lt;li>&lt;code>drop(&amp;amp;mut self)&lt;/code>æ²¡æœ‰å‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»ï¼Œå¦‚æœå…è®¸æ‰‹åŠ¨è°ƒç”¨&lt;code>x.drop&lt;/code>,ç¼–è¯‘æœŸåœ¨ä½œç”¨åŸŸç»“æŸæ—¶ä»ä¼šå†æ¬¡è°ƒç”¨&lt;code>drop&lt;/code>ï¼ŒåŒé‡é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜å®‰å…¨é—®é¢˜ã€‚&lt;/li>
&lt;/ul></description></item><item><title>Ripgrepçš„å‘½ä»¤æ–‡æ¡£</title><link>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84%E5%91%BD%E4%BB%A4%E6%96%87%E6%A1%A3/</link><pubDate>Fri, 15 Aug 2025 12:50:54 +0800</pubDate><guid>https://www.dust-zed.site/rust/ripgrep/ripgrep%E7%9A%84%E5%91%BD%E4%BB%A4%E6%96%87%E6%A1%A3/</guid><description>&lt;p>ç”¨æ³• ï¼ˆ&lt;code>[]&lt;/code>å†…è¡¨ç¤ºæ˜¯å¯é€‰å‚æ•°):&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] PATTERN [PATH ...]&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] -e PATTERN ... [PATH ...]&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] -f PATTERNFILE ... [PATH ...]&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] --files [PATH ...]&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] --type-list&lt;/code>&lt;/p>
&lt;p>&lt;code>command | rg [OPTIONS] PATTERN&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] --help&lt;/code>&lt;/p>
&lt;p>&lt;code>rg [OPTIONS] --version&lt;/code>&lt;/p>
&lt;h4 id="å‚æ•°è§£é‡Š">å‚æ•°è§£é‡Š
&lt;/h4>&lt;p>PATTERN: è¦æœç´¢çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥&lt;code>-&lt;/code>å¼€å§‹çš„æ­£åˆ™éœ€è¦æ·»åŠ  &lt;code>-e&lt;/code>/&lt;code>--regexp&lt;/code>flagï¼Œå¦‚&lt;code>rg -e -foo&lt;/code>&lt;/p>
&lt;p>PATH&amp;hellip;: éœ€è¦æ£€ç´¢çš„æ–‡ä»¶æˆ–ç›®å½•&lt;/p>
&lt;h4 id="è¾“å…¥é€‰é¡¹input-options">è¾“å…¥é€‰é¡¹(input options)
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>&lt;code>--&lt;/code>ï¼šè¡¨ç¤ºåç»­ä»¥&lt;code>-&lt;/code>å¼€å¤´çš„&lt;code>word&lt;/code>éƒ½ä¸å†æ˜¯&lt;code>flag&lt;/code>è€Œæ˜¯&lt;code>pattern&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-e PATTERN, --regexp=PATTERN&lt;/code>: éœ€è¦æœç´¢çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯å¤šæ¬¡æŒ‡å®š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-f PATTERNFILE, --file=PATTERNFILE&lt;/code>:æŒ‡å®šä»ä½•æ–‡ä»¶æœç´¢æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯å¤šæ¬¡æŒ‡å®š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>--pre=COMMAND&lt;/code> å…è®¸æŒ‡å®šä¸€ä¸ªæ–‡ä»¶æ ¼å¼è½¬æ¢å‘½ä»¤ï¼Œripgrepä¼šå…ˆå°†æ–‡ä»¶é€šè¿‡è¯¥å‘½ä»¤è½¬æ¢ï¼Œç„¶ååœ¨è½¬æ¢åçš„å†…å®¹æœç´¢æ­£åˆ™è¡¨è¾¾å¼ã€‚&lt;code>æ–‡ä»¶&lt;/code> â†’ &lt;code>COMMANDå¤„ç†&lt;/code> â†’ &lt;code>è·å–æ ‡å‡†è¾“å‡º&lt;/code> â†’ &lt;code>ripgrepæœç´¢è¾“å‡ºå†…å®¹&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>--pre-glob=GLOB&lt;/code>ä¸“ä¸º&lt;code>--pre&lt;/code>å‘½ä»¤è®¾è®¡ï¼Œç²¾ç¡®çš„ç­›é€‰éœ€è¦é¢„å¤„ç†çš„æ–‡ä»¶ï¼Œé¿å…å¯¹ä¸åŒ¹é…çš„æ–‡ä»¶æ‰§è¡Œä¸å¿…è¦çš„æ ¼å¼è½¬æ¢ï¼Œå¤§å¹…æå‡æ€§èƒ½ã€‚&lt;code>rg --pre=pre-pdftotext --pre-glob='*.pdf' 'å…³é”®è¯'&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>report.pdf&lt;/code> â†’ è°ƒç”¨ &lt;code>pdftotext&lt;/code> è½¬æ¢åæœç´¢&lt;/li>
&lt;li>&lt;code>notes.txt&lt;/code> â†’ ç›´æ¥æœç´¢æ–‡æœ¬ï¼ˆçœå»è¿›ç¨‹åˆ›å»ºï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-z, --search-zip&lt;/code>æœç´¢å‹ç¼©åŒ…&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="search-options">search options
&lt;/h4>&lt;ul>
&lt;li>&lt;code>-s, --case-sensitive&lt;/code>æ‰§è¡Œæœç´¢æ—¶åŒºåˆ†å¤§å°å†™&lt;/li>
&lt;li>&lt;code>-i, --ignore-case&lt;/code>æ‰§è¡Œæœç´¢æ—¶ä¸åŒºåˆ†å¤§å°å†™&lt;/li>
&lt;li>&lt;code>--crlf&lt;/code>å¯åŠ¨æ—¶å°†CRLF(\r\n)è§†ä¸ºè¡Œç»ˆæ­¢ç¬¦ï¼Œè€Œä¸æ˜¯\n&lt;/li>
&lt;li>&lt;code>--dfa-size-limit=NUM+SUFFIX?&lt;/code>æ­£åˆ™è¡¨è¾¾å¼çš„dfaä¸Šé™ï¼Œå¯å¸¦å•ä½&lt;/li>
&lt;li>&lt;code>--regex-size-limit=NUM+SUFFIX?&lt;/code>è®¾ç½®&lt;strong>åœ¨å†…å­˜ä¸­æ„å»º&lt;/strong>çš„æ•´ä½“æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡çš„æœ€å¤§å°ºå¯¸&lt;/li>
&lt;li>&lt;code>--engine=ENGINE&lt;/code>æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼å¼•æ“&lt;/li>
&lt;li>&lt;code>-E ENCODING, --encoding=ENCODING&lt;/code>å¼ºåˆ¶ ripgrep ä½¿ç”¨ç‰¹å®šç¼–ç å¤„ç†æ‰€æœ‰è¢«æœç´¢æ–‡ä»¶ï¼ˆé»˜è®¤è‡ªåŠ¨æ£€æµ‹ç¼–ç ï¼‰&lt;/li>
&lt;li>&lt;code>-F, --fixedstrings&lt;/code>å°†æ‰€æœ‰æ¨¡å¼è§†ä¸ºå­—é¢é‡è€Œä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼&lt;/li>
&lt;li>&lt;code>-v --invert-match&lt;/code>åè½¬åŒ¹é…ï¼Œæ‰“å°ä¸åŒ¹é…çš„è¡Œï¼Œ&lt;code>--no-invert-match&lt;/code>ä¸ºç›¸åçš„è¾“å…¥&lt;/li>
&lt;li>&lt;code>-x --line-regexp&lt;/code>æ•´è¡ŒåŒ¹é…&lt;/li>
&lt;li>&lt;code>-w, --word-regexp&lt;/code>ç‹¬ç«‹å•è¯åŒ¹é…ï¼Œå¯ç”¨æ­¤æ ‡å¿—åï¼Œripgrep åªæ˜¾ç¤ºè¢«&lt;strong>å•è¯è¾¹ç•Œ&lt;/strong>åŒ…å›´çš„åŒ¹é…ç»“æœã€‚ç±»ä¼¼äºåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­è‡ªåŠ¨ç»™æœç´¢è¯æ·»åŠ  &lt;code>\b&lt;/code> è¾¹ç•Œï¼Œæ¯”&lt;code>-x&lt;/code>ä¼˜å…ˆçº§é«˜&lt;/li>
&lt;li>&lt;code>-m NUM, --max-count=NUM&lt;/code> é™åˆ¶æ¯ä¸ªæ–‡ä»¶çš„åŒ¹é…è¡Œæ•°é‡ï¼Œåˆ°è¾¾æŒ‡å®šæ•°é‡å°±åœæ­¢å½“å‰æ–‡ä»¶æœç´¢&lt;/li>
&lt;li>&lt;code>--mmap&lt;/code>ä¼˜å…ˆä½¿ç”¨&lt;code>mmap&lt;/code>æŠ€æœ¯è¿›è¡Œæ–‡ä»¶æœç´¢&lt;/li>
&lt;li>&lt;code>-U, --multiline&lt;/code>å¤šè¡Œæ¨¡å¼ï¼Œå…è®¸åŒ¹é…å†…å®¹è·¨è¶Šå¤šä¸ªè¡Œï¼Œçªç ´é»˜è®¤çš„å•è¡ŒåŒ¹é…é™åˆ¶&lt;/li>
&lt;li>&lt;code>--multiline-dotall&lt;/code>å½“å¯ç”¨å¤šè¡Œæœç´¢æ—¶(&lt;code>-U&lt;/code>)ï¼Œå¼ºåˆ¶æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‚¹å·&lt;code>.&lt;/code>åŒ¹é…&lt;strong>åŒ…æ‹¬æ¢è¡Œç¬¦&lt;/strong>çš„æ‰€æœ‰å­—ç¬¦&lt;/li>
&lt;li>&lt;code>--no-unicode&lt;/code>ç¦ç”¨unicodeæ¨¡å¼&lt;/li>
&lt;li>&lt;code>--null-data&lt;/code> å°†é»˜è®¤çš„è¡Œç»ˆæ­¢ç¬¦ä»æ¢è¡Œç¬¦&lt;code>\n&lt;/code>æ”¹ä¸ºNULå­—ç¬¦(&lt;code>\0&lt;/code>æˆ–ASCII 0)&lt;/li>
&lt;li>&lt;code>-P, --pcre2&lt;/code>åˆ‡æ¢é»˜è®¤çš„æ­£åˆ™å¼•æ“æ›´æ¢ä¸º&lt;strong>PCRE2&lt;/strong>&lt;/li>
&lt;li>&lt;code>-S, --smart-case&lt;/code>å¯ç”¨æ™ºèƒ½å¤§å°å†™åŒ¹é…æ¨¡å¼&lt;/li>
&lt;li>&lt;code>--stop-no-nonmatch&lt;/code>æ‰¾åˆ°è‡³å°‘ä¸€ä¸ªåŒ¹é…è¡Œä¸”åç»­é‡åˆ°ä¸åŒ¹é…è¡Œå°±æå‰åœæ­¢è¯»å–æ–‡ä»¶&lt;/li>
&lt;li>&lt;code>-a, --text&lt;/code>å¼ºåˆ¶å°†æ‰€æœ‰æ–‡ä»¶å½“ä½œçº¯æ–‡æœ¬æ–‡ä»¶å¤„ç†ï¼Œç¦ç”¨å…¶é»˜è®¤çš„äºŒè¿›åˆ¶æ–‡ä»¶æ£€æµ‹æœºåˆ¶&lt;/li>
&lt;li>&lt;code>-j NUM, --threads=NUM&lt;/code>æ§åˆ¶æœç´¢æ—¶ä½¿ç”¨çš„å¹¶è¡Œçº¿ç¨‹æ•°&lt;/li>
&lt;/ul>
&lt;h4 id="filter-options">filter options
&lt;/h4>&lt;ul>
&lt;li>&lt;code>--binary&lt;/code> é»˜è®¤æƒ…å†µä¸‹ripgrepä½¿ç”¨&lt;code>NUL&lt;/code>å­—èŠ‚ä½œä¸ºå¯å‘å¼æ ‡å¿—ã€‚ä¸€æ—¦åœ¨æ–‡ä»¶ä¸­æ£€æµ‹åˆ°NULå­—èŠ‚ï¼Œç«‹å³åˆ¤æ–­ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åç«‹å³åœæ­¢æœç´¢è¯¥æ–‡ä»¶å¹¶ä¸æ˜¾ç¤ºåŒ¹é…å†…å®¹ã€‚å¯ç”¨åå³ä½¿æ£€æµ‹åˆ°NULå­—èŠ‚ï¼Œä¹Ÿç»§ç»­æœç´¢æ–‡ä»¶ï¼Œç›´åˆ°æ‰¾åˆ°&lt;strong>é¦–ä¸ªåŒ¹é…é¡¹&lt;/strong>æˆ–æœç´¢åˆ°&lt;strong>æ–‡ä»¶ç»“æŸ&lt;/strong>åœæ­¢æœç´¢&lt;/li>
&lt;li>&lt;code>-L, --follow&lt;/code> å¼€å¯â€œè·Ÿéšç¬¦å·é“¾æ¥â€åŠŸèƒ½ï¼ˆé»˜è®¤å…³é—­ï¼‰,ç”¨ &lt;code>--no-follow&lt;/code> åœ¨æœ¬å‘½ä»¤ä¸­å–æ¶ˆ &lt;code>-L&lt;/code> çš„æ•ˆæœ&lt;/li>
&lt;li>&lt;code>-g GLOB, --glob=GLOB&lt;/code> é€šè¿‡é€šé…ç¬¦æ¨¡å¼ï¼ˆglobï¼‰&lt;strong>åŒ…å«æˆ–æ’é™¤ç‰¹å®šæ–‡ä»¶å’Œç›®å½•&lt;/strong>è¿›è¡Œæœç´¢&lt;/li>
&lt;li>&lt;code>--glob-case-insensitive&lt;/code>è®©æ‰€æœ‰é€šè¿‡&lt;code>-g/--glob&lt;/code>æŒ‡å®šçš„é€šé…ç¬¦è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…ï¼Œ&lt;code>--no-glob-case-insensitive&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--iglob=GLOB&lt;/code>å…è®¸ç”¨æˆ·é€šè¿‡&lt;strong>ä¸åŒºåˆ†å¤§å°å†™&lt;/strong>çš„é€šé…ç¬¦æ¨¡å¼æ¥&lt;strong>åŒ…å«æˆ–æ’é™¤æ–‡ä»¶/ç›®å½•&lt;/strong>&lt;/li>
&lt;li>&lt;code>-., --hidden&lt;/code> æœç´¢éšè—æ–‡ä»¶å’Œç›®å½•ï¼Œ&lt;code>--no-hidden&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--ignore-file=PATH&lt;/code> é€šè¿‡å¤–éƒ¨æ–‡ä»¶æŒ‡å®šå¿½ç•¥è§„åˆ™ï¼ˆ&lt;code>gitignore&lt;/code> æ ¼å¼ï¼‰&lt;/li>
&lt;li>&lt;code>--ignore-file-case-insensitive&lt;/code> æ§åˆ¶&lt;strong>å¿½ç•¥æ–‡ä»¶è§„åˆ™åŒ¹é…æ—¶æ˜¯å¦åŒºåˆ†å¤§å°å†™&lt;/strong>&lt;/li>
&lt;li>&lt;code>-d NUM, --max-depth=NUM&lt;/code>æŒ‡å®šæœç´¢çš„ç›®å½•éå†çš„æ·±åº¦å±‚çº§&lt;/li>
&lt;li>&lt;code>--max-filesize=NUM+SUFFIX?&lt;/code> è·³è¿‡è¶…è¿‡æŒ‡å®šå¤§å°çš„æ–‡ä»¶&lt;/li>
&lt;li>&lt;code>--no-ignore&lt;/code> è·³è¿‡æ‰€æœ‰å¿½ç•¥æ–‡ä»¶ï¼Œ&lt;code>--ignore&lt;/code>å–æ¶ˆè¿™æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-ignore-dot&lt;/code> ä»…è·³è¿‡ &lt;code>.ignore&lt;/code> å’Œ&lt;code>.rgignore&lt;/code> æ–‡ä»¶ä¸­çš„è¿‡æ»¤è§„åˆ™ï¼Œé€šè¿‡ &lt;code>--ignore-dot&lt;/code> å¯å…³é—­æ­¤åŠŸèƒ½&lt;/li>
&lt;li>&lt;code>--no-ignore-exclude&lt;/code> ç¦ç”¨æ‰‹åŠ¨é…ç½®çš„æ’é™¤è§„åˆ™ï¼Œ&lt;code>--ignore-exclude&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-ignore-files&lt;/code> ç¦ç”¨æ˜¾å¼æŒ‡å®šçš„å¿½ç•¥æ–‡ä»¶ï¼Œ&lt;code>--ignore-files&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-ignore-global&lt;/code> ç¦ç”¨æ¥è‡ªâ€œå…¨å±€â€æºçš„å¿½ç•¥è§„åˆ™ï¼ˆ&lt;code>.gitignore&lt;/code> æ–‡ä»¶ï¼‰ï¼Œ&lt;code>--ignore-global&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-ignore-parent&lt;/code>ä¸åº”ç”¨ä»çˆ¶ç›®å½•ä¸­æ‰¾åˆ°çš„å¿½ç•¥æ–‡ä»¶ï¼ˆå¦‚ &lt;code>.gitignore&lt;/code>ï¼‰ä¸­çš„è§„åˆ™ï¼Œ&lt;code>--ignore-parent&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-ignore-vcs&lt;/code> ç¦ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„å¿½ç•¥è§„åˆ™ï¼Œ&lt;code>-ignore--vcs&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-require-git&lt;/code> é»˜è®¤åªåœ¨gitä»“åº“æ‰éµå®ˆç‰ˆæœ¬æ§åˆ¶çš„å¿½ç•¥æ–‡ä»¶ï¼ˆå¦‚&lt;code>.gitignore&lt;/code>ï¼‰ï¼Œå¯ç”¨åå³ä½¿ä¸å†gitä»“åº“ï¼Œä¹Ÿä¼šéµå®ˆç‰ˆæœ¬æ§åˆ¶çš„å¿½ç•¥æ–‡ä»¶ã€‚&lt;code>--require-git&lt;/code>å–æ¶ˆæ­¤æ•ˆæœ&lt;/li>
&lt;li>&lt;code>--no-file-system&lt;/code> éå†ç›®å½•æ ‘æœç´¢æ–‡ä»¶æ—¶ï¼Œä¸ä¼šè·¨è¶Šä»»ä½•æ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œï¼Œ&lt;code>--no-one-file-system&lt;/code>å–æ¶ˆæ­¤æ•ˆæœã€‚åœ¨æœç´¢&lt;strong>æ¯ä¸ªç»™å®šçš„èµ·å§‹è·¯å¾„&lt;/strong>æ—¶ï¼Œé‡åˆ°&lt;strong>æŒ‚è½½ç‚¹ï¼ˆé€šå¾€å¦ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„â€œé—¨â€ï¼‰å°±åœä¸‹æ¥ï¼Œä¸è¿›å»æœç´¢&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;code>-t TYPE, --type=TYPE&lt;/code> ç”¨äºé™åˆ¶åªæœç´¢ç‰¹å®šç±»å‹çš„æ–‡ä»¶&lt;/li>
&lt;li>&lt;code>-T TYPE, --type-not=TYPE&lt;/code> ç”¨äº&lt;strong>æ’é™¤&lt;/strong>æŒ‡å®šç±»å‹çš„æ–‡ä»¶ä¸è¿›è¡Œæœç´¢&lt;/li>
&lt;li>&lt;code>--type-add=TYPESPEC&lt;/code> ç”¨äºåˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶ç±»å‹åŒ¹é…è§„åˆ™&lt;/li>
&lt;li>&lt;code>--type-clear=TYPE&lt;/code> æ¸…æ¥š &lt;code>type-add&lt;/code>åˆ›å»ºçš„è‡ªå®šä¹‰æ–‡ä»¶ç±»å‹åŒ¹é…è§„åˆ™&lt;/li>
&lt;li>&lt;code>-u, --unrestricted&lt;/code> æ ‡å¿—é€šè¿‡å¤šæ¬¡é‡å¤ï¼ˆæœ€é«˜3æ¬¡ï¼‰é€æ­¥é™ä½ ripgrep çš„æ™ºèƒ½è¿‡æ»¤çº§åˆ«ï¼Œä½¿æœç´¢èŒƒå›´è¶Šæ¥è¶Šå¹¿&lt;/li>
&lt;/ul>
&lt;h4 id="output-options">output options
&lt;/h4>&lt;ul>
&lt;li>&lt;code>-A NUM, --after-context=NUM&lt;/code> ä¼šæ˜¾ç¤ºæ¯æ¡åŒ¹é…ç»“æœ&lt;strong>ä¹‹å&lt;/strong>çš„ NUM è¡Œå†…å®¹&lt;/li>
&lt;li>&lt;code>-B, --before-context=NUM&lt;/code> ä¼šæ˜¾ç¤ºæ¯æ¡åŒ¹é…ç»“æœä¹‹å‰çš„NUMè¡Œå†…å®¹&lt;/li>
&lt;li>&lt;code>-C NUM, --context=NUM&lt;/code>åœ¨åŒ¹é…ç»“æœå‰åæ˜¾ç¤ºNUMè¡Œå†…å®¹&lt;/li>
&lt;li>&lt;code>block-buffered&lt;/code>ä½¿ç”¨å†…å­˜ç¼“å†²åŒºï¼Œåªæœ‰å½“è¿™ä¸ªç¼“å†²åŒºç§¯ç´¯åˆ°ä¸€å®šå¤§å°åï¼Œæ‰ä¼šä¸€æ¬¡æ€§å°†å…¶å†…å®¹**åˆ·æ–° (flush) **åˆ°æ ‡å‡†è¾“å‡º (stdout)ã€‚&lt;code>--no-block-buffered&lt;/code>å–æ¶ˆæ­¤åŠŸèƒ½&lt;/li>
&lt;li>&lt;code>-b, --byte-offset&lt;/code>åœ¨è¾“å‡ºä¸­æ·»åŠ æ•°å­—å‰ç¼€ï¼Œè¡¨ç¤ºè¡Œæˆ–åŒ¹é…æ–‡æœ¬åœ¨æ–‡ä»¶ä¸­çš„èµ·å§‹å­—èŠ‚ä½ç½®ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼‰&lt;/li>
&lt;li>&lt;code>--color=WHEN&lt;/code>æ­¤é€‰é¡¹å†³å®šä½•æ—¶åœ¨è¾“å‡ºä¸­ä½¿ç”¨&lt;strong>é¢œè‰²é«˜äº®&lt;/strong>å’Œ&lt;strong>ANSIè½¬ä¹‰åºåˆ—&lt;/strong>&lt;/li>
&lt;li>&lt;code>--colors=COLOR_SPEC&lt;/code>é€‰é¡¹ç”¨äº&lt;strong>è‡ªå®šä¹‰è¾“å‡ºå†…å®¹çš„é¢œè‰²å’Œæ ·å¼&lt;/strong>ï¼Œå¯é€šè¿‡å¤šæ¬¡æŒ‡å®šå®ç°å¤šå±‚æ ·å¼å åŠ &lt;/li>
&lt;li>&lt;code>--column&lt;/code>åœ¨è¾“å‡ºä¸­å¢åŠ åˆ—å·ä¿¡æ¯ï¼Œ&lt;code>--no-column&lt;/code>å–æ¶ˆè¿™ä¸ªåŠŸèƒ½&lt;/li>
&lt;li>&lt;code>--context-separator=SEPARATOR&lt;/code>åœ¨ä½¿ç”¨ä¸Šä¸‹æ–‡é€‰é¡¹ï¼ˆ&lt;code>-A/-B/-C&lt;/code>ï¼‰æ—¶ï¼ŒæŒ‡å®š&lt;strong>åˆ†éš”ä¸åŒä¸Šä¸‹æ–‡å—çš„æ˜¾ç¤ºç¬¦å·&lt;/strong>,&lt;code>--no-context-separator&lt;/code>å–æ¶ˆæ­¤åŠŸèƒ½&lt;/li>
&lt;li>&lt;code>--field-match-separator=SEPARATOR&lt;/code>è‡ªå®šä¹‰ ripgrep è¾“å‡ºç»“æœä¸­&lt;strong>å„å­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦å·&lt;/strong>&lt;/li>
&lt;li>&lt;code>--heading&lt;/code>åœ¨æ¯ä¸ªæ–‡ä»¶åŒ¹é…ç»“æœç»„çš„&lt;strong>é¡¶éƒ¨&lt;/strong>æ˜¾ç¤ºä¸€æ¬¡æ–‡ä»¶è·¯å¾„ï¼Œè€Œä¸æ˜¯åœ¨æ¯è¡ŒåŒ¹é…å‰éƒ½é‡å¤æ˜¾ç¤ºï¼Œ&lt;code>--no-heading&lt;/code>å–æ¶ˆæ­¤åŠŸèƒ½&lt;/li>
&lt;li>&lt;code>-h, --help&lt;/code> &lt;code>-h&lt;/code>æ˜¯ç²¾ç®€å¸®åŠ©æ¨¡å¼ï¼Œ&lt;code>--help&lt;/code>æ˜¯å®Œæ•´å¸®åŠ©æ¨¡å¼&lt;/li>
&lt;li>&lt;code>--hyperlink-format=FORMAT&lt;/code> åˆ›å»ºå¯ç‚¹å‡»çš„è¶…é“¾æ¥&lt;/li>
&lt;/ul></description></item></channel></rss>